/*
 * @Author: xiuquanxu
 * @Company: kaochong
 * @Date: 2021-04-02 14:02:51
 * @LastEditors: xiuquanxu
 * @LastEditTime: 2021-04-02 14:02:52
 */
var H5PlayerVideoLib = function (e) { function webpackJsonpCallback(t) { for (var n, i, a = t[0], s = t[1], u = 0, d = []; u < a.length; u++)i = a[u], Object.prototype.hasOwnProperty.call(r, i) && r[i] && d.push(r[i][0]), r[i] = 0; for (n in s) Object.prototype.hasOwnProperty.call(s, n) && (e[n] = s[n]); for (o && o(t); d.length;)d.shift()() } var t = {}, r = { 0: 0 }; function __webpack_require__(r) { if (t[r]) return t[r].exports; var n = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(n.exports, n, n.exports, __webpack_require__), n.l = !0, n.exports } __webpack_require__.e = function requireEnsure(e) { var t = [], n = r[e]; if (0 !== n) if (n) t.push(n[2]); else { var i = new Promise(function (t, i) { n = r[e] = [t, i] }); t.push(n[2] = i); var a, o = document.createElement("script"); o.charset = "utf-8", o.timeout = 120, __webpack_require__.nc && o.setAttribute("nonce", __webpack_require__.nc), o.src = function jsonpScriptSrc(e) { return __webpack_require__.p + "js/player_first/" + ({ 1: "kiwi.min.js_0e36f63", 2: "qvbp2p_douyu_v1.8.15.js_39c8510", 3: "stream-sub", 4: "vendors~stream-sub", 5: "whprelease.3.2.0.0_200604.1.js_55a1707" }[e] || e) + "_" + { 1: "d47fdad", 2: "0fe39ac", 3: "69c654c", 4: "9822b57", 5: "1354382" }[e] + ".js" }(e); var s = new Error; a = function (t) { o.onerror = o.onload = null, clearTimeout(u); var n = r[e]; if (0 !== n) { if (n) { var i = t && ("load" === t.type ? "missing" : t.type), a = t && t.target && t.target.src; s.message = "Loading chunk " + e + " failed.\n(" + i + ": " + a + ")", s.name = "ChunkLoadError", s.type = i, s.request = a, n[1](s) } r[e] = void 0 } }; var u = setTimeout(function () { a({ type: "timeout", target: o }) }, 12e4); o.onerror = o.onload = a, document.head.appendChild(o) } return Promise.all(t) }, __webpack_require__.m = e, __webpack_require__.c = t, __webpack_require__.d = function (e, t, r) { __webpack_require__.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: r }) }, __webpack_require__.r = function (e) { "undefined" !== typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }, __webpack_require__.t = function (e, t) { if (1 & t && (e = __webpack_require__(e)), 8 & t) return e; if (4 & t && "object" === typeof e && e && e.__esModule) return e; var r = Object.create(null); if (__webpack_require__.r(r), Object.defineProperty(r, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var n in e) __webpack_require__.d(r, n, function (t) { return e[t] }.bind(null, n)); return r }, __webpack_require__.n = function (e) { var t = e && e.__esModule ? function getDefault() { return e.default } : function getModuleExports() { return e }; return __webpack_require__.d(t, "a", t), t }, __webpack_require__.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, __webpack_require__.p = "https://shark2.douyucdn.cn/front-publish/live-master/", __webpack_require__.oe = function (e) { throw console.error(e), e }; var n = window.shark_player_first_jsonp = window.shark_player_first_jsonp || [], i = n.push.bind(n); n.push = webpackJsonpCallback, n = n.slice(); for (var a = 0; a < n.length; a++)webpackJsonpCallback(n[a]); var o = i; return __webpack_require__(__webpack_require__.s = "1c1a3") }({ "0266f": function (e, t, r) { "use strict"; e.exports = function isCancel(e) { return !(!e || !e.__CANCEL__) } }, "09565": function (e, t, r) { "use strict"; var n, i = "object" === typeof Reflect ? Reflect : null, a = i && "function" === typeof i.apply ? i.apply : function ReflectApply(e, t, r) { return Function.prototype.apply.call(e, t, r) }; n = i && "function" === typeof i.ownKeys ? i.ownKeys : Object.getOwnPropertySymbols ? function ReflectOwnKeys(e) { return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)) } : function ReflectOwnKeys(e) { return Object.getOwnPropertyNames(e) }; var o = Number.isNaN || function NumberIsNaN(e) { return e !== e }; function EventEmitter() { EventEmitter.init.call(this) } e.exports = EventEmitter, EventEmitter.EventEmitter = EventEmitter, EventEmitter.prototype._events = void 0, EventEmitter.prototype._eventsCount = 0, EventEmitter.prototype._maxListeners = void 0; var s = 10; function $getMaxListeners(e) { return void 0 === e._maxListeners ? EventEmitter.defaultMaxListeners : e._maxListeners } function _addListener(e, t, r, n) { var i, a, o; if ("function" !== typeof r) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof r); if (void 0 === (a = e._events) ? (a = e._events = Object.create(null), e._eventsCount = 0) : (void 0 !== a.newListener && (e.emit("newListener", t, r.listener ? r.listener : r), a = e._events), o = a[t]), void 0 === o) o = a[t] = r, ++e._eventsCount; else if ("function" === typeof o ? o = a[t] = n ? [r, o] : [o, r] : n ? o.unshift(r) : o.push(r), (i = $getMaxListeners(e)) > 0 && o.length > i && !o.warned) { o.warned = !0; var s = new Error("Possible EventEmitter memory leak detected. " + o.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit"); s.name = "MaxListenersExceededWarning", s.emitter = e, s.type = t, s.count = o.length, function ProcessEmitWarning(e) { console && console.warn && console.warn(e) }(s) } return e } function _onceWrap(e, t, r) { var n = { fired: !1, wrapFn: void 0, target: e, type: t, listener: r }, i = function onceWrapper() { for (var e = [], t = 0; t < arguments.length; t++)e.push(arguments[t]); this.fired || (this.target.removeListener(this.type, this.wrapFn), this.fired = !0, a(this.listener, this.target, e)) }.bind(n); return i.listener = r, n.wrapFn = i, i } function _listeners(e, t, r) { var n = e._events; if (void 0 === n) return []; var i = n[t]; return void 0 === i ? [] : "function" === typeof i ? r ? [i.listener || i] : [i] : r ? function unwrapListeners(e) { for (var t = new Array(e.length), r = 0; r < t.length; ++r)t[r] = e[r].listener || e[r]; return t }(i) : arrayClone(i, i.length) } function listenerCount(e) { var t = this._events; if (void 0 !== t) { var r = t[e]; if ("function" === typeof r) return 1; if (void 0 !== r) return r.length } return 0 } function arrayClone(e, t) { for (var r = new Array(t), n = 0; n < t; ++n)r[n] = e[n]; return r } Object.defineProperty(EventEmitter, "defaultMaxListeners", { enumerable: !0, get: function () { return s }, set: function (e) { if ("number" !== typeof e || e < 0 || o(e)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + e + "."); s = e } }), EventEmitter.init = function () { void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 }, EventEmitter.prototype.setMaxListeners = function setMaxListeners(e) { if ("number" !== typeof e || e < 0 || o(e)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + e + "."); return this._maxListeners = e, this }, EventEmitter.prototype.getMaxListeners = function getMaxListeners() { return $getMaxListeners(this) }, EventEmitter.prototype.emit = function emit(e) { for (var t = [], r = 1; r < arguments.length; r++)t.push(arguments[r]); var n = "error" === e, i = this._events; if (void 0 !== i) n = n && void 0 === i.error; else if (!n) return !1; if (n) { var o; if (t.length > 0 && (o = t[0]), o instanceof Error) throw o; var s = new Error("Unhandled error." + (o ? " (" + o.message + ")" : "")); throw s.context = o, s } var u = i[e]; if (void 0 === u) return !1; if ("function" === typeof u) a(u, this, t); else { var d = u.length, c = arrayClone(u, d); for (r = 0; r < d; ++r)a(c[r], this, t) } return !0 }, EventEmitter.prototype.addListener = function addListener(e, t) { return _addListener(this, e, t, !1) }, EventEmitter.prototype.on = EventEmitter.prototype.addListener, EventEmitter.prototype.prependListener = function prependListener(e, t) { return _addListener(this, e, t, !0) }, EventEmitter.prototype.once = function once(e, t) { if ("function" !== typeof t) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); return this.on(e, _onceWrap(this, e, t)), this }, EventEmitter.prototype.prependOnceListener = function prependOnceListener(e, t) { if ("function" !== typeof t) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); return this.prependListener(e, _onceWrap(this, e, t)), this }, EventEmitter.prototype.removeListener = function removeListener(e, t) { var r, n, i, a, o; if ("function" !== typeof t) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t); if (void 0 === (n = this._events)) return this; if (void 0 === (r = n[e])) return this; if (r === t || r.listener === t) 0 === --this._eventsCount ? this._events = Object.create(null) : (delete n[e], n.removeListener && this.emit("removeListener", e, r.listener || t)); else if ("function" !== typeof r) { for (i = -1, a = r.length - 1; a >= 0; a--)if (r[a] === t || r[a].listener === t) { o = r[a].listener, i = a; break } if (i < 0) return this; 0 === i ? r.shift() : function spliceOne(e, t) { for (; t + 1 < e.length; t++)e[t] = e[t + 1]; e.pop() }(r, i), 1 === r.length && (n[e] = r[0]), void 0 !== n.removeListener && this.emit("removeListener", e, o || t) } return this }, EventEmitter.prototype.off = EventEmitter.prototype.removeListener, EventEmitter.prototype.removeAllListeners = function removeAllListeners(e) { var t, r, n; if (void 0 === (r = this._events)) return this; if (void 0 === r.removeListener) return 0 === arguments.length ? (this._events = Object.create(null), this._eventsCount = 0) : void 0 !== r[e] && (0 === --this._eventsCount ? this._events = Object.create(null) : delete r[e]), this; if (0 === arguments.length) { var i, a = Object.keys(r); for (n = 0; n < a.length; ++n)"removeListener" !== (i = a[n]) && this.removeAllListeners(i); return this.removeAllListeners("removeListener"), this._events = Object.create(null), this._eventsCount = 0, this } if ("function" === typeof (t = r[e])) this.removeListener(e, t); else if (void 0 !== t) for (n = t.length - 1; n >= 0; n--)this.removeListener(e, t[n]); return this }, EventEmitter.prototype.listeners = function listeners(e) { return _listeners(this, e, !0) }, EventEmitter.prototype.rawListeners = function rawListeners(e) { return _listeners(this, e, !1) }, EventEmitter.listenerCount = function (e, t) { return "function" === typeof e.listenerCount ? e.listenerCount(t) : listenerCount.call(e, t) }, EventEmitter.prototype.listenerCount = listenerCount, EventEmitter.prototype.eventNames = function eventNames() { return this._eventsCount > 0 ? n(this._events) : [] } }, "097de": function (e, t, r) { "use strict"; var n = r("c9415"), i = r("11b2e"), a = r("0266f"), o = r("41571"), s = r("9faa2"), u = r("68e4d"); function throwIfCancellationRequested(e) { e.cancelToken && e.cancelToken.throwIfRequested() } e.exports = function dispatchRequest(e) { return throwIfCancellationRequested(e), e.baseURL && !s(e.url) && (e.url = u(e.baseURL, e.url)), e.headers = e.headers || {}, e.data = i(e.data, e.headers, e.transformRequest), e.headers = n.merge(e.headers.common || {}, e.headers[e.method] || {}, e.headers || {}), n.forEach(["delete", "get", "head", "post", "put", "patch", "common"], function cleanHeaderConfig(t) { delete e.headers[t] }), (e.adapter || o.adapter)(e).then(function onAdapterResolution(t) { return throwIfCancellationRequested(e), t.data = i(t.data, t.headers, e.transformResponse), t }, function onAdapterRejection(t) { return a(t) || (throwIfCancellationRequested(e), t && t.response && (t.response.data = i(t.response.data, t.response.headers, e.transformResponse))), Promise.reject(t) }) } }, "0fa6e": function (e, t, r) { (0, r("366c1").roomIsOpenH265)() ? e.exports = r("1a93b") : e.exports = r("1b384") }, 11489: function (e, t, r) { "use strict"; var n = r("c9415"), i = r("63e3f"), a = r("9b5d6"), o = r("41571"); function createInstance(e) { var t = new a(e), r = i(a.prototype.request, t); return n.extend(r, a.prototype, t), n.extend(r, t), r } var s = createInstance(o); s.Axios = a, s.create = function create(e) { return createInstance(n.merge(o, e)) }, s.Cancel = r("92545"), s.CancelToken = r("9511e"), s.isCancel = r("0266f"), s.all = function all(e) { return Promise.all(e) }, s.spread = r("6da80"), e.exports = s, e.exports.default = s }, "11b2e": function (e, t, r) { "use strict"; var n = r("c9415"); e.exports = function transformData(e, t, r) { return n.forEach(r, function transform(r) { e = r(e, t) }), e } }, "13c9f": function (e, t, r) { "use strict"; var n = r("c9415"), i = r("1b396"), a = r("9ebb9"), o = r("9992b"), s = r("6d420"), u = r("d3043"); e.exports = function xhrAdapter(e) { return new Promise(function dispatchXhrRequest(t, d) { var c = e.data, l = e.headers; n.isFormData(c) && delete l["Content-Type"]; var p = new XMLHttpRequest; if (e.auth) { var f = e.auth.username || "", h = e.auth.password || ""; l.Authorization = "Basic " + btoa(f + ":" + h) } if (p.open(e.method.toUpperCase(), a(e.url, e.params, e.paramsSerializer), !0), p.timeout = e.timeout, p.onreadystatechange = function handleLoad() { if (p && 4 === p.readyState && (0 !== p.status || p.responseURL && 0 === p.responseURL.indexOf("file:"))) { var r = "getAllResponseHeaders" in p ? o(p.getAllResponseHeaders()) : null, n = { data: e.responseType && "text" !== e.responseType ? p.response : p.responseText, status: p.status, statusText: p.statusText, headers: r, config: e, request: p }; i(t, d, n), p = null } }, p.onerror = function handleError() { d(u("Network Error", e, null, p)), p = null }, p.ontimeout = function handleTimeout() { d(u("timeout of " + e.timeout + "ms exceeded", e, "ECONNABORTED", p)), p = null }, n.isStandardBrowserEnv()) { var _ = r("b76a7"), m = (e.withCredentials || s(e.url)) && e.xsrfCookieName ? _.read(e.xsrfCookieName) : void 0; m && (l[e.xsrfHeaderName] = m) } if ("setRequestHeader" in p && n.forEach(l, function setRequestHeader(e, t) { "undefined" === typeof c && "content-type" === t.toLowerCase() ? delete l[t] : p.setRequestHeader(t, e) }), e.withCredentials && (p.withCredentials = !0), e.responseType) try { p.responseType = e.responseType } catch (t) { if ("json" !== e.responseType) throw t } "function" === typeof e.onDownloadProgress && p.addEventListener("progress", e.onDownloadProgress), "function" === typeof e.onUploadProgress && p.upload && p.upload.addEventListener("progress", e.onUploadProgress), e.cancelToken && e.cancelToken.promise.then(function onCanceled(e) { p && (p.abort(), d(e), p = null) }), void 0 === c && (c = null), p.send(c) }) } }, "1a93b": function (e, t, r) { e.exports = function (e) { var t = {}; function __webpack_require__(r) { if (t[r]) return t[r].exports; var n = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(n.exports, n, n.exports, __webpack_require__), n.l = !0, n.exports } return __webpack_require__.m = e, __webpack_require__.c = t, __webpack_require__.d = function (e, t, r) { __webpack_require__.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: r }) }, __webpack_require__.n = function (e) { var t = e && e.__esModule ? function getDefault() { return e.default } : function getModuleExports() { return e }; return __webpack_require__.d(t, "a", t), t }, __webpack_require__.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, __webpack_require__.p = "", __webpack_require__(__webpack_require__.s = 15) }([function (e, t, r) { "use strict"; var n = this && this.__spreadArrays || function () { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; var n = Array(e), i = 0; for (t = 0; t < r; t++)for (var a = arguments[t], o = 0, s = a.length; o < s; o++, i++)n[i] = a[o]; return n }; Object.defineProperty(t, "__esModule", { value: !0 }), t.makeLogger = void 0; var i = !1; function setEnable(e) { i = e } function customize(e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; var a = n(["[html5 player]", "[dylive]"], t.map(function (e) { return "[" + e + "]" })); return function () { for (var t = [], r = 0; r < arguments.length; r++)t[r] = arguments[r]; i && e.call.apply(e, n([console], a, t)) } } function makeLogger() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; return { log: customize.apply(void 0, n([console.log], e)), debug: customize.apply(void 0, n([console.debug], e)), info: customize.apply(void 0, n([console.info], e)), warn: customize.apply(void 0, n([console.warn], e)), error: customize.apply(void 0, n([console.error], e)), setEnable: setEnable } } t.makeLogger = makeLogger, t.default = makeLogger() }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.ErrorIds = t.errorRestore = t.errorClone = t.DyDemuxError = t.DyMediaError = t.DyNetworkError = t.DyError = void 0; var a = function (e) { function DyError(t, r, n) { void 0 === n && (n = !0); var i = e.call(this, t) || this; return i.errorId = 0, i.fatal = !0, i.updatedSource = !1, i.errorId = r || d.Unknown, i.name = "DyError", i.fatal = n, i } return i(DyError, e), DyError }(Error); t.DyError = a; var o = function (e) { function DyNetworkError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyNetworkError", n } return i(DyNetworkError, e), DyNetworkError }(a); t.DyNetworkError = o; var s = function (e) { function DyMediaError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyMediaError", n } return i(DyMediaError, e), DyMediaError }(a); t.DyMediaError = s; var u = function (e) { function DyDemuxError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyDemuxError", n } return i(DyDemuxError, e), DyDemuxError }(a); t.DyDemuxError = u, t.errorClone = function errorClone(e) { return { name: e.name, message: e.message, errorId: e.errorId, stack: e.stack, fatal: e.fatal } }; var d, c = { Error: a, DyError: a, DyNetworkError: o, DyMediaError: s, DyDemuxError: u }; t.errorRestore = function errorRestore(e) { var t = c[e.name]; if (t) { var r = new t(e.message, e.errorId, e.fatal); return r.stack = e.stack, r } return null }, function (e) { e[e.Unknown = 100] = "Unknown", e[e.ParserInitError = 101] = "ParserInitError", e[e.ParserConfigMiss = 102] = "ParserConfigMiss", e[e.ParserConfigError = 103] = "ParserConfigError", e[e.ParserDataError = 104] = "ParserDataError", e[e.ParserCodecUnsupport = 105] = "ParserCodecUnsupport", e[e.DecoderWasmError = 106] = "DecoderWasmError", e[e.DecoderInvalidCanvas = 107] = "DecoderInvalidCanvas", e[e.DecoderDecodeError = 108] = "DecoderDecodeError", e[e.RenderWebglError = 109] = "RenderWebglError", e[e.NetworkError = 110] = "NetworkError", e[e.MediaError = 111] = "MediaError", e[e.MediaAddSourceBufferError = 112] = "MediaAddSourceBufferError", e[e.MediaUnsupportCodec = 113] = "MediaUnsupportCodec", e[e.MediaAppendError = 114] = "MediaAppendError", e[e.WasmUnsupportError = 115] = "WasmUnsupportError", e[e.NoSupportedLoader = 116] = "NoSupportedLoader", e[e.NoSupportedMediaHandler = 117] = "NoSupportedMediaHandler", e[e.InvalidFlv = 118] = "InvalidFlv", e[e.UnsupportedFlvAudio = 119] = "UnsupportedFlvAudio", e[e.UnsupportedFlvVideo = 120] = "UnsupportedFlvVideo", e[e.InvalidFlvVideoPacket = 121] = "InvalidFlvVideoPacket", e[e.WorkerError = 122] = "WorkerError", e[e.HlsM3u8ParseError = 123] = "HlsM3u8ParseError", e[e.HlsTsNetworkError = 124] = "HlsTsNetworkError", e[e.HlsM3u8LoadError = 125] = "HlsM3u8LoadError", e[e.HlsTsCustomError = 126] = "HlsTsCustomError", e[e.TransmuxerError = 127] = "TransmuxerError", e[e.UnsupportDemux = 128] = "UnsupportDemux", e[e.UnsupportRemux = 129] = "UnsupportRemux", e[e.CustomLoaderError = 130] = "CustomLoaderError", e[e.UnsupportedError = 131] = "UnsupportedError", e[e.AcceleratorClosed = 132] = "AcceleratorClosed", e[e.AcceleratorError = 133] = "AcceleratorError" }(d = t.ErrorIds || (t.ErrorIds = {})) }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.concatUrl = t.resolveUrl = t.isPlayerSupported = t.isMediaSupported = t.isBrowserSupported = t.getRandomId = t.binsert = t.binsearch = t.numberCompare = t.connectEventbus = t.isHls = t.saveAs = t.isH265Supported = t.loadScript = t.isPthreadsSupported = t.isWasmSupported = t.bufferConcat = t.timescaledTime64 = t.timescaledTime = t.u8aClone = t.safeClone = t.configClone = t.isBufferEqual = void 0; var i = n(r(35)), a = r(4), o = n(r(7)); function safeClone(e) { if ("object" !== typeof e) return e; var t = {}; return Object.keys(e).forEach(function (r) { var n = e[r]; n && "object" === typeof n ? Object.getPrototypeOf(n) === Object.prototype && (t[r] = safeClone(n)) : "function" !== typeof n && (t[r] = n) }), t } function isWasmSupported() { return "object" === typeof WebAssembly } function pipeEventbus(e, t) { return function (r) { var n, i = r.data; if ("internalevents" !== i.name) return e(r); (n = t.__internal.eventbus).emit.apply(n, i.params) } } function numberCompare(e, t) { return +e - +t } function binsearch(e, t, r) { if (0 === e.length) return 0; if (r || (r = numberCompare), r(t, e[0]) <= 0) return 0; if (r(t, e[e.length - 1]) >= 0) return e.length; var n, i; for (n = 0, i = e.length - 1; i - n > 1;) { var a = n + i >> 1, o = r(t, e[a]); if (o < 0) i = a; else { if (!(o > 0)) return a; n = a } } return i } function isBrowserSupported() { return o.default.chrome && o.default.version.major >= 43 || o.default.firefox && o.default.version.major >= 43 || o.default.msedge || "mac" === o.default.platform && o.default.safari && o.default.version.major >= 11 } function isMediaSupported() { return MediaSource.isTypeSupported('video/mp4; codecs="avc1.640028, mp4a.40.2"') } t.isBufferEqual = function isBufferEqual(e, t) { if (e === t) return !0; if (!e || !t) return !1; if (e.length !== t.length) return !1; for (var r = 0, n = e.length; r < n; r++)if (e[r] !== t[r]) return !1; return !0 }, t.configClone = function configClone(e, t) { return self.Worker && e instanceof self.Worker ? safeClone(t) : t }, t.safeClone = safeClone, t.u8aClone = function u8aClone(e) { var t = new Uint8Array(e.byteLength); return t.set(e, 0), t }, t.timescaledTime = function timescaledTime(e, t) { return Math.round(e * t / 1e3) }, t.timescaledTime64 = function timescaledTime64(e, t) { return i.default.fromNumber(Math.round(e / 1e3 * t), !0) }, t.bufferConcat = function bufferConcat(e) { var t = e.reduce(function (e, t) { return e + t.length }, 0), r = new Uint8Array(t), n = 0; return e.forEach(function (e) { r.set(e, n), n += e.length }), r }, t.isWasmSupported = isWasmSupported, t.isPthreadsSupported = function isPthreadsSupported() { return !!(isWasmSupported() && self.SharedArrayBuffer && self.Atomics && new WebAssembly.Memory({ initial: 1, maximum: 1, shared: !0 }).buffer instanceof SharedArrayBuffer) }, t.loadScript = function loadScript(e) { return new Promise(function (t, r) { var n = document.createElement("script"); n.onload = t, n.onerror = r, n.src = e, document.head.appendChild(n) }) }, t.isH265Supported = function isH265Supported() { return MediaSource.isTypeSupported("video/mp4; codecs=hvc1.1.6.L93") }, t.saveAs = function saveAs(e, t) { var r = window.URL.createObjectURL(e), n = document.createElement("a"); n.style.display = "none", n.href = r, n.download = t, document.body.appendChild(n), n.click(), document.body.removeChild(n), setTimeout(function () { window.URL.revokeObjectURL(r) }, 1e3) }, t.isHls = function isHls(e) { return -1 !== e.toLowerCase().indexOf(".m3u8") }, t.connectEventbus = function connectEventbus(e, t, r) { self.Worker && e instanceof self.Worker ? (r.__internal.eventbus.pipe = function (t, r) { return e.postMessage({ name: "internalevents", params: [t, r] }) }, e.onmessage = pipeEventbus(t, r)) : e.inWorker ? (r.__internal.eventbus = new a.InternalEventBus, r.__internal.eventbus.pipe = function (t, r) { return e.dispatchMessage({ name: "internalevents", params: [t, r] }) }, self.onmessage = pipeEventbus(t, r)) : e.onmessage = t }, t.numberCompare = numberCompare, t.binsearch = binsearch, t.binsert = function binsert(e, t, r) { e.splice(binsearch(e, t, r), 0, t) }, t.getRandomId = function getRandomId() { return Date.now() + "-" + Math.floor(Math.random() * (Math.floor(999999999) - Math.ceil(1))) + Math.ceil(1) }, t.isBrowserSupported = isBrowserSupported, t.isMediaSupported = isMediaSupported, t.isPlayerSupported = function isPlayerSupported() { return isBrowserSupported() && isMediaSupported() }, t.resolveUrl = function resolveUrl(e, t) { return new URL(e, t).href }, t.concatUrl = function concatUrl(e, t) { return t && (e = e + (-1 === e.indexOf("?") ? "?" : "&") + t), e } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.bindAll = void 0, t.bindAll = function bindAll(e) { for (var t = e, r = {}; e && e !== Object.prototype;)Object.getOwnPropertyNames(e).forEach(function (n) { var i = Object.getOwnPropertyDescriptor(e, n); if (i) { if (i.get || i.set) return; "function" === typeof t[n] && (r[n] = !0) } }), e = Object.getPrototypeOf(e); Object.keys(r).forEach(function (e) { t[e] = t[e].bind(t) }) } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.InternalEvents = t.InternalEventBus = void 0; var o = a(r(17)), s = r(2), u = function (e) { function InternalEventBus() { var t = null !== e && e.apply(this, arguments) || this; return t.id = s.getRandomId(), t } return i(InternalEventBus, e), InternalEventBus.prototype.emit = function (t, r) { return (null === r || void 0 === r ? void 0 : r.__sourceId) !== this.id && (r || (r = {}), r.__sourceId || (r.__sourceId = this.id), this.pipe && this.pipe(t, r), e.prototype.emit.call(this, t, r)) }, InternalEventBus }(o.default); t.InternalEventBus = u, function (e) { e.METADATA = "METADATA", e.VBR = "VBR", e.SEEK = "SEEK", e.FIRST_FRAME = "FIRST_FRAME", e.BASE_TS = "BASE_TS", e.STAT = "STAT", e.M3U8TIME = "M3U8TIME", e.GET_SMOOTH_SWITCH_TIME = "GET_SMOOTH_SWITCH_TIME", e.SWITCH_SOURCE_SUCCESS = "SWITCH_SOURCE_SUCCESS", e.SWITCH_SOURCE_FAIL = "SWITCH_SOURCE_FAIL" }(t.InternalEvents || (t.InternalEvents = {})) }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.Codec = t.TimeDispatchType = t.VERSION = void 0, t.VERSION = "dylive_202103250306", function (e) { e.H264_SEI = "H264_SEI", e.AAC_FIL = "AAC_FIL", e.EXTRA_DATA = "EXTRA_DATA" }(t.TimeDispatchType || (t.TimeDispatchType = {})), function (e) { e.H264 = "h264", e.H265 = "h265", e.AAC = "aac", e.MP3 = "mp3" }(t.Codec || (t.Codec = {})) }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.isFrameTrack = t.MediaAction = void 0, function (e) { e[e.END = 0] = "END", e[e.FIRST_FRAME = 1] = "FIRST_FRAME", e[e.RESET = 2] = "RESET", e[e.GET_DURATION = 3] = "GET_DURATION" }(t.MediaAction || (t.MediaAction = {})), t.isFrameTrack = function isFrameTrack(e) { return !e.flag || "KEY" === e.flag } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = {}; !function detect() { var e = self.navigator.userAgent.toLowerCase(), t = /(edge)\/([\w.]+)/.exec(e) || /(chrome)[ \/]([\w.]+)/.exec(e) || /(iemobile)[\/]([\w.]+)/.exec(e) || /(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+)/.exec(e) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e) || /(msie) ([\w.]+)/.exec(e) || e.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec(e) || e.indexOf("compatible") < 0 && /(firefox)[ \/]([\w.]+)/.exec(e) || [], r = /(ipad)/.exec(e) || /(ipod)/.exec(e) || /(windows phone)/.exec(e) || /(iphone)/.exec(e) || /(kindle)/.exec(e) || /(android)/.exec(e) || /(windows)/.exec(e) || /(mac)/.exec(e) || /(linux)/.exec(e) || /(cros)/.exec(e) || [], i = { browser: t[5] || t[3] || t[1] || "", version: t[2] || t[4] || "0", majorVersion: t[4] || t[2] || "0", platform: r[0] || "" }, a = {}; if (i.browser) { a[i.browser] = !0; var o = i.majorVersion.split("."); a.version = { major: parseInt(i.majorVersion, 10), string: i.version }, o.length > 1 && (a.version.minor = parseInt(o[1], 10)), o.length > 2 && (a.version.build = parseInt(o[2], 10)) } i.platform && (a[i.platform] = !0), (a.chrome || a.opr || a.safari) && (a.webkit = !0), (a.rv || a.iemobile) && (a.rv && delete a.rv, i.browser = "msie", a.msie = !0); a.edge && (delete a.edge, i.browser = "msedge", a.msedge = !0); a.opr && (i.browser = "opera", a.opera = !0); a.safari && a.android && (i.browser = "android", a.android = !0); for (var s in a.name = i.browser, a.platform = i.platform, n) n.hasOwnProperty(s) && delete n[s]; Object.assign(n, a) }(), t.default = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BaseStream = void 0; var n = r(3), i = function () { function BaseStream() { this._destroyed = !1, n.bindAll(this) } return BaseStream.prototype.dispose = function () { this._destroyed = !0, this.onData = null, this.onError = null }, BaseStream.prototype.error = function (e) { this.onError(e), this.dispose() }, BaseStream.prototype.catch = function (e) { return this.onError = e, this }, BaseStream.prototype.pipe = function (e) { return this.onData = e.append, this.onError = e.error, e }, BaseStream.prototype.out = function (e) { return this.onData = e, this }, BaseStream }(); t.BaseStream = i }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function ByteArray(e) { var t = void 0 === e ? {} : e, r = t.buffer, n = t.initLength, i = void 0 === n ? 1024 : n, a = t.autoClear, o = void 0 !== a && a, s = t.increase, u = void 0 === s ? 0 : s, d = t.littleEndian, c = void 0 === d ? ByteArray.littleEndian : d; this._rposition = 0, this._wposition = 0, this._count = 0, this._autoClear = o, this.increase = u, this.littleEndian = c, r ? (this._buffer = r, this._wposition = r.byteLength) : this._buffer = new ArrayBuffer(i) } return ByteArray.fromArray = function (e) { var t = 0; e.forEach(function (e) { return t += e.byteLength }); var r = new ByteArray({ initLength: t }); return e.forEach(function (e) { return r.write(e) }), r }, Object.defineProperty(ByteArray.prototype, "buffer", { get: function () { return this._buffer.slice(0, this._wposition) }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "byteAvailable", { get: function () { return this._wposition - this._rposition }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "byteLength", { get: function () { return this._wposition }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "bytePosition", { get: function () { return this._rposition }, enumerable: !1, configurable: !0 }), ByteArray.prototype.read = function (e) { if (e > this.byteAvailable) throw new Error("[" + ByteArray.TAG + "] not enough data for read."); var t = this._buffer.slice(this._rposition, this._rposition + e); return this._rposition += e, t }, ByteArray.prototype.readAll = function () { return this.read(this.byteAvailable) }, ByteArray.prototype.readUint8 = function () { return new DataView(this.read(1)).getUint8(0) }, ByteArray.prototype.readUint16 = function () { return new DataView(this.read(2)).getUint16(0, this.littleEndian) }, ByteArray.prototype.readUint24 = function () { var e = new Uint8Array(this.read(3)); return this.littleEndian && e.reverse(), e[0] << 16 | e[1] << 8 | e[2] }, ByteArray.prototype.readUint32 = function () { return new DataView(this.read(4)).getUint32(0, this.littleEndian) }, ByteArray.prototype.readString = function (e) { return String.fromCharCode.apply(null, new Uint8Array(this.read(e))) }, ByteArray.prototype.write = function (e) { if (e && e.byteLength > 0) { var t = e.byteLength, r = this._wposition + t; if (r > this._buffer.byteLength) { var n = this._autoClear ? this._rposition : 0, i = r - n, a = this._buffer.slice(n, this._wposition), o = void 0; i > this._buffer.byteLength ? (this.increase ? i += this.increase : i = 2 * (this.buffer.byteLength + t), this._count++, o = new ArrayBuffer(i)) : o = this._buffer, new Uint8Array(o).set(new Uint8Array(a), 0), this._rposition -= n, this._wposition = a.byteLength, this._buffer = o } new Uint8Array(this._buffer).set(e instanceof ArrayBuffer ? new Uint8Array(e) : e, this._wposition), this._wposition += t } }, ByteArray.prototype.peekBytes = function (e, t) { if (void 0 === e && (e = this.byteAvailable), void 0 === t && (t = 0), t + e > this.byteAvailable) throw new Error("[" + ByteArray.TAG + "] not enough data for read."); return new Uint8Array(this._buffer, this._rposition + t, e) }, ByteArray.prototype.skip = function (e) { this._rposition += e }, ByteArray.prototype.back = function (e) { this._rposition -= e }, ByteArray.prototype.reset = function () { this._wposition = 0, this._rposition = 0 }, ByteArray.TAG = "ByteArray", ByteArray.littleEndian = !1, ByteArray }(); t.default = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BaseLoader = void 0; var n = r(3), i = r(6), a = function () { function BaseLoader() { this._destroyed = !1, this._loaderBytes = 0, this._loadStartTime = 0, this._loadEndTime = 0, this._speed = 0, this._status = 0, n.bindAll(this) } return Object.defineProperty(BaseLoader.prototype, "url", { get: function () { return this._url }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "redirectUrl", { get: function () { return this._redirectUrl }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "supportSmooth", { get: function () { return !1 }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "format", { get: function () { return "flv" }, enumerable: !1, configurable: !0 }), BaseLoader.prototype.load = function (e, t, r) { this._loaderBytes = 0, this._url = e, this._config = t, this._loadStartTime = Date.now() }, BaseLoader.prototype.dispose = function () { this._destroyed = !0, this.onData = null, this.onEnd = null, this.onError = null }, BaseLoader.prototype.getStatistics = function () { return { loaderBytes: this._loaderBytes, cdnBytes: this._loaderBytes, p2pBytes: 0, totalDropBytes: 0, uploadBytes: 0, speed: this._speed, url: this._url, status: this._status } }, BaseLoader.prototype.attachMedia = function (e) { this._media = e }, BaseLoader.prototype.updateSource = function (e) { }, BaseLoader.prototype.endOfStream = function () { this._onEnd() }, BaseLoader.prototype.reset = function (e) { this.onData && this.onData({ action: i.MediaAction.RESET, actionData: e }) }, BaseLoader.prototype._onData = function (e) { e && (e instanceof ArrayBuffer ? this._loaderBytes += e.byteLength : e.data && (this._loaderBytes += e.data.byteLength), this.onData && this.onData(e)) }, BaseLoader.prototype._onRedirectUrl = function (e) { this._redirectUrl = e }, BaseLoader.prototype._onError = function (e) { this._calcSpeed(), this.onError && this.onError(e) }, BaseLoader.prototype._onEnd = function () { this._calcSpeed(), this.onEnd && this.onEnd() }, BaseLoader.prototype._calcSpeed = function () { this._loadEndTime = Date.now(), this._speed = this._loaderBytes / 1024 / ((this._loadEndTime - this._loadStartTime) / 1e3) }, BaseLoader }(); t.BaseLoader = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.createMediaHandler = t.MediaHandler = void 0; var n = r(60); Object.defineProperty(t, "MediaHandler", { enumerable: !0, get: function () { return n.MediaHandler } }); var i = r(26), a = r(62); t.createMediaHandler = function createMediaHandler(e) { switch (e.mediaHandle) { case "mse": return new i.ToMSE(e); case "file": return new a.ToFile(e); case "soft": return new (0, r(63).ToSoftDecoder)(e); default: return null } } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.createLoader = void 0; var n = r(29), i = r(30), a = r(31), o = r(2), s = r(10); Object.defineProperty(t, "BaseLoader", { enumerable: !0, get: function () { return s.BaseLoader } }), t.createLoader = function createLoader(e) { return o.isHls(e.url) ? new a.HlsLoader : n.FetchStreamLoader.isSupported() ? new n.FetchStreamLoader : i.MozChunkedLoader.isSupported() ? new i.MozChunkedLoader : void 0 } }, function (e, t, r) { function webpackBootstrapFunc(e) { var t = {}; function __webpack_require__(r) { if (t[r]) return t[r].exports; var n = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(n.exports, n, n.exports, __webpack_require__), n.l = !0, n.exports } __webpack_require__.m = e, __webpack_require__.c = t, __webpack_require__.i = function (e) { return e }, __webpack_require__.d = function (e, t, r) { __webpack_require__.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: r }) }, __webpack_require__.r = function (e) { Object.defineProperty(e, "__esModule", { value: !0 }) }, __webpack_require__.n = function (e) { var t = e && e.__esModule ? function getDefault() { return e.default } : function getModuleExports() { return e }; return __webpack_require__.d(t, "a", t), t }, __webpack_require__.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, __webpack_require__.p = "/", __webpack_require__.oe = function (e) { throw console.error(e), e }; var r = __webpack_require__(__webpack_require__.s = ENTRY_MODULE); return r.default || r } var n = "[\\.|\\-|\\+|\\w|/|@]+", i = "\\((/\\*.*?\\*/)?s?.*?(" + n + ").*?\\)"; function quoteRegExp(e) { return (e + "").replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&") } function getModuleDependencies(e, t, a) { var o = {}; o[a] = []; var s = t.toString(), u = s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/); if (!u) return o; for (var d, c = u[1], l = new RegExp("(\\\\n|\\W)" + quoteRegExp(c) + i, "g"); d = l.exec(s);)"dll-reference" !== d[3] && o[a].push(d[3]); for (l = new RegExp("\\(" + quoteRegExp(c) + '\\("(dll-reference\\s(' + n + '))"\\)\\)' + i, "g"); d = l.exec(s);)e[d[2]] || (o[a].push(d[1]), e[d[2]] = r(d[1]).m), o[d[2]] = o[d[2]] || [], o[d[2]].push(d[4]); return o } function hasValuesInQueues(e) { return Object.keys(e).reduce(function (t, r) { return t || e[r].length > 0 }, !1) } e.exports = function (e, t) { t = t || {}; var n = { main: r.m }, i = t.all ? { main: Object.keys(n) } : function getRequiredModules(e, t) { for (var r = { main: [t] }, n = { main: [] }, i = { main: {} }; hasValuesInQueues(r);)for (var a = Object.keys(r), o = 0; o < a.length; o++) { var s = a[o], u = r[s].pop(); if (i[s] = i[s] || {}, !i[s][u] && e[s][u]) { i[s][u] = !0, n[s] = n[s] || [], n[s].push(u); for (var d = getModuleDependencies(e, e[s][u], s), c = Object.keys(d), l = 0; l < c.length; l++)r[c[l]] = r[c[l]] || [], r[c[l]] = r[c[l]].concat(d[c[l]]) } } return n }(n, e), a = ""; Object.keys(i).filter(function (e) { return "main" !== e }).forEach(function (e) { for (var t = 0; i[e][t];)t++; i[e].push(t), n[e][t] = "(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })", a = a + "var " + e + " = (" + webpackBootstrapFunc.toString().replace("ENTRY_MODULE", JSON.stringify(t)) + ")({" + i[e].map(function (t) { return JSON.stringify(t) + ": " + n[e][t].toString() }).join(",") + "});\n" }), a = a + "new ((" + webpackBootstrapFunc.toString().replace("ENTRY_MODULE", JSON.stringify(e)) + ")({" + i.main.map(function (e) { return JSON.stringify(e) + ": " + n.main[e].toString() }).join(",") + "}))(self);"; var o = new window.Blob([a], { type: "text/javascript" }); if (t.bare) return o; var s = (window.URL || window.webkitURL || window.mozURL || window.msURL).createObjectURL(o), u = new window.Worker(s); return u.objectURL = s, u } }, function (e, t) { !function () { "use strict"; function FrameSink(e, t) { throw new Error("abstract") } FrameSink.prototype.drawFrame = function (e) { throw new Error("abstract") }, FrameSink.prototype.clear = function () { throw new Error("abstract") }, e.exports = FrameSink }() }, function (e, t, r) { "use strict"; var n = this && this.__createBinding || (Object.create ? function (e, t, r, n) { void 0 === n && (n = r), Object.defineProperty(e, n, { enumerable: !0, get: function () { return t[r] } }) } : function (e, t, r, n) { void 0 === n && (n = r), e[n] = t[r] }), i = this && this.__exportStar || function (e, t) { for (var r in e) "default" === r || t.hasOwnProperty(r) || n(t, e, r) }; Object.defineProperty(t, "__esModule", { value: !0 }), i(r(28), t), i(r(1), t), i(r(12), t) }, function (e, t) { "function" != typeof Object.assign && Object.defineProperty(Object, "assign", { value: function assign(e, t) { "use strict"; if (null == e) throw new TypeError("Cannot convert undefined or null to object"); for (var r = Object(e), n = 1; n < arguments.length; n++) { var i = arguments[n]; if (null != i) for (var a in i) Object.prototype.hasOwnProperty.call(i, a) && (r[a] = i[a]) } return r }, writable: !0, configurable: !0 }), Array.prototype.find || Object.defineProperty(Array.prototype, "find", { value: function (e) { if (null == this) throw new TypeError('"this" is null or not defined'); var t = Object(this), r = t.length >>> 0; if ("function" !== typeof e) throw new TypeError("predicate must be a function"); for (var n = arguments[1], i = 0; i < r;) { var a = t[i]; if (e.call(n, a, i, t)) return a; i++ } } }) }, function (e, t, r) { "use strict"; var n = Object.prototype.hasOwnProperty, i = "~"; function Events() { } function addListener(e, t, r, n, a) { if ("function" !== typeof r) throw new TypeError("The listener must be a function"); var o = new function EE(e, t, r) { this.fn = e, this.context = t, this.once = r || !1 }(r, n || e, a), s = i ? i + t : t; return e._events[s] ? e._events[s].fn ? e._events[s] = [e._events[s], o] : e._events[s].push(o) : (e._events[s] = o, e._eventsCount++), e } function clearEvent(e, t) { 0 === --e._eventsCount ? e._events = new Events : delete e._events[t] } function EventEmitter() { this._events = new Events, this._eventsCount = 0 } Object.create && (Events.prototype = Object.create(null), (new Events).__proto__ || (i = !1)), EventEmitter.prototype.eventNames = function eventNames() { var e, t, r = []; if (0 === this._eventsCount) return r; for (t in e = this._events) n.call(e, t) && r.push(i ? t.slice(1) : t); return Object.getOwnPropertySymbols ? r.concat(Object.getOwnPropertySymbols(e)) : r }, EventEmitter.prototype.listeners = function listeners(e) { var t = i ? i + e : e, r = this._events[t]; if (!r) return []; if (r.fn) return [r.fn]; for (var n = 0, a = r.length, o = new Array(a); n < a; n++)o[n] = r[n].fn; return o }, EventEmitter.prototype.listenerCount = function listenerCount(e) { var t = i ? i + e : e, r = this._events[t]; return r ? r.fn ? 1 : r.length : 0 }, EventEmitter.prototype.emit = function emit(e, t, r, n, a, o) { var s = i ? i + e : e; if (!this._events[s]) return !1; var u, d, c = this._events[s], l = arguments.length; if (c.fn) { switch (c.once && this.removeListener(e, c.fn, void 0, !0), l) { case 1: return c.fn.call(c.context), !0; case 2: return c.fn.call(c.context, t), !0; case 3: return c.fn.call(c.context, t, r), !0; case 4: return c.fn.call(c.context, t, r, n), !0; case 5: return c.fn.call(c.context, t, r, n, a), !0; case 6: return c.fn.call(c.context, t, r, n, a, o), !0 }for (d = 1, u = new Array(l - 1); d < l; d++)u[d - 1] = arguments[d]; c.fn.apply(c.context, u) } else { var p, f = c.length; for (d = 0; d < f; d++)switch (c[d].once && this.removeListener(e, c[d].fn, void 0, !0), l) { case 1: c[d].fn.call(c[d].context); break; case 2: c[d].fn.call(c[d].context, t); break; case 3: c[d].fn.call(c[d].context, t, r); break; case 4: c[d].fn.call(c[d].context, t, r, n); break; default: if (!u) for (p = 1, u = new Array(l - 1); p < l; p++)u[p - 1] = arguments[p]; c[d].fn.apply(c[d].context, u) } } return !0 }, EventEmitter.prototype.on = function on(e, t, r) { return addListener(this, e, t, r, !1) }, EventEmitter.prototype.once = function once(e, t, r) { return addListener(this, e, t, r, !0) }, EventEmitter.prototype.removeListener = function removeListener(e, t, r, n) { var a = i ? i + e : e; if (!this._events[a]) return this; if (!t) return clearEvent(this, a), this; var o = this._events[a]; if (o.fn) o.fn !== t || n && !o.once || r && o.context !== r || clearEvent(this, a); else { for (var s = 0, u = [], d = o.length; s < d; s++)(o[s].fn !== t || n && !o[s].once || r && o[s].context !== r) && u.push(o[s]); u.length ? this._events[a] = 1 === u.length ? u[0] : u : clearEvent(this, a) } return this }, EventEmitter.prototype.removeAllListeners = function removeAllListeners(e) { var t; return e ? (t = i ? i + e : e, this._events[t] && clearEvent(this, t)) : (this._events = new Events, this._eventsCount = 0), this }, EventEmitter.prototype.off = EventEmitter.prototype.removeListener, EventEmitter.prototype.addListener = EventEmitter.prototype.on, EventEmitter.prefixed = i, EventEmitter.EventEmitter = EventEmitter, e.exports = EventEmitter }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), r(16); var o = r(6), s = r(19), u = r(23), d = r(0), c = r(48), l = r(25), p = r(4), f = r(1), h = a(r(57)), _ = r(58), m = d.makeLogger("tranmuxer-worker"), y = function (e) { function TransmuxerWorkerable() { var t = null !== e && e.apply(this, arguments) || this; return t.destroyed = !1, t } return i(TransmuxerWorkerable, e), TransmuxerWorkerable.prototype.terminate = function () { e.prototype.terminate.call(this), this.destroyed = !0, this._demux && (this._demux.dispose(), this._demux = null), this._remux && (this._remux.dispose(), this._remux = null), this._parser && (this._parser.dispose(), this._parser = null), this._wsTranscoder && (this._wsTranscoder.dispose(), this._wsTranscoder = null), this._trackGenerator && (this._trackGenerator.dispose(), this._trackGenerator = null) }, TransmuxerWorkerable.prototype.init = function (t) { e.prototype.init.call(this, t), this._config.__internal.eventbus.on(p.InternalEvents.FIRST_FRAME, this.firstFrame), this._demux = s.createDemuxer(t), this._demux ? (this._remux = u.createRemuxer(t), this._remux ? (this._parser = new c.TrackParser(t), this._trackGenerator = new _.TrackGenerator(t), this.pipeline()) : this._onError(new f.DyError("unsupport remux format: " + t.format, f.ErrorIds.UnsupportRemux))) : this._onError(new f.DyError("unsupport demxu format: " + t.format, f.ErrorIds.UnsupportDemux)) }, TransmuxerWorkerable.prototype.pipeline = function () { var e = this._config, t = this._demux.pipe(this._trackGenerator).pipe(this._parser).pipe(this._remux); e.accelerator.enable && "h265" === e.videoCodec && (this._wsTranscoder = new h.default(e), t = t.pipe(this._wsTranscoder)), t.out(this._onRemuxData).catch(this._onError) }, TransmuxerWorkerable.prototype.appendData = function (e) { this.destroyed || this._demux.append(e) }, TransmuxerWorkerable.prototype.appendEnd = function () { this.destroyed || this._demux.append(o.MediaAction.END) }, TransmuxerWorkerable.prototype.firstFrame = function () { this.destroyed || this._demux.append(o.MediaAction.FIRST_FRAME) }, TransmuxerWorkerable.prototype._onRemuxData = function (e) { var t = []; e.data && t.push(e.data.buffer), this.dispatchMessage({ name: "_onRemuxData", params: e }, t) }, TransmuxerWorkerable.prototype.setLoggerEnable = function (e) { m.setEnable(e) }, TransmuxerWorkerable.prototype._onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "init": this.init(n); break; case "appendData": this.appendData(n); break; case "appendEnd": this.appendEnd(); break; case "setLoggerEnable": this.setLoggerEnable(n); break; case "changeFormat": this._changeFormat(n); break; default: m.warn("unknown function: transmuxer." + r) } } catch (e) { this._onError(new f.DyError("call transmuxer worker " + r + " error: " + e, f.ErrorIds.TransmuxerError)) } }, TransmuxerWorkerable.prototype._changeFormat = function (e) { this._config.format = e; var t = s.createDemuxer(this._config); t || this._onError(new f.DyError("unsupport demxu format: " + e, f.ErrorIds.UnsupportDemux)), this._demux && (this._demux.transfer(t), this._demux.dispose()), this._demux = t, this.pipeline() }, TransmuxerWorkerable }(l.Workerable); t.default = y }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.createDemuxer = t.Demuxer = void 0; var i = r(20); Object.defineProperty(t, "Demuxer", { enumerable: !0, get: function () { return i.Demuxer } }); var a = n(r(39)), o = r(42); t.createDemuxer = function createDemuxer(e) { switch (e.format) { case "flv": return new a.default(e); case "raw": return new i.Demuxer(e); case "ts": return new o.TsDemuxer(e); default: return null } } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.Demuxer = void 0; var a = r(8), o = r(6), s = r(0), u = r(4), d = s.makeLogger("demuxer"), c = function (e) { function Demuxer(t) { var r = e.call(this) || this; return r._audioConfig = r._generateTrackConfig("audio"), r._videoConfig = r._generateTrackConfig("video"), r._lastTracks = {}, r._hasFirstFrame = !1, r._trackLength = 2, r._duration = 0, r._baseTs = -1, r._pengdingTracks = [], r._config = t, !1 !== t.hasAudio && !1 !== t.hasVideo || (r._trackLength = 1), r } return i(Demuxer, e), Demuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._lastTracks = void 0, this._pengdingTracks = void 0 }, Demuxer.prototype.append = function (e) { if (!this._destroyed) if (e instanceof ArrayBuffer) this._appendArrayBuffer(e); else if (e.type) this._appendTrack(e); else if (e.action) { var t = e; t.action === o.MediaAction.GET_DURATION ? this._duration = t.actionData : t.action === o.MediaAction.RESET && this._resetTrack(t.actionData) } else e === o.MediaAction.END ? this._appendEnd() : e === o.MediaAction.FIRST_FRAME ? this._hasFirstFrame = !0 : d.warn("unknown append data: ", e) }, Demuxer.prototype.transfer = function (e) { Object.assign(e, { _audioConfig: this._audioConfig, _videoConfig: this._videoConfig, _lastTracks: this._lastTracks }) }, Demuxer.prototype._appendArrayBuffer = function (e) { }, Demuxer.prototype._appendTrack = function (e) { if ("audio" === e.type || "video" === e.type) { if (("audio" !== e.type || !1 !== this._config.hasAudio) && ("video" !== e.type || !1 !== this._config.hasVideo)) { if (e.trackLength ? this._trackLength = e.trackLength : e.trackLength = this._trackLength, -1 === this._baseTs && o.isFrameTrack(e)) { if (e.dts < 0 && !this._config.startFromZero && (d.warn("negative dts detected: " + e.type + " " + e.dts + ", use relative time."), this._config.startFromZero = !0), this._config.startFromZero && 2 === e.trackLength) { if (d.log("detecting first audio/video pts: " + e.type + " " + e.pts), void 0 === this._firstAudioTs && "audio" === e.type && (this._firstAudioTs = e.pts), void 0 === this._firstVideoTs && "video" === e.type && (this._firstVideoTs = e.pts), void 0 === this._firstAudioTs || void 0 === this._firstVideoTs) return void this._pengdingTracks.push(e); d.log("detected first audio/video pts: " + this._firstAudioTs + "/" + this._firstVideoTs), this._baseTs = Math.max(this._firstAudioTs, this._firstVideoTs) } else this._baseTs = e.pts; this._config.__internal.eventbus.emit(u.InternalEvents.BASE_TS, { data: this._config.startFromZero ? 0 : this._baseTs }), d.log("baseTs = " + this._baseTs), this._pengdingTracks.length && this._pengdingTracks.splice(0).forEach(this._appendTrack) } if ("live" === this._config.mode) { var t = this._lastTracks[e.trackId]; t && o.isFrameTrack(e) && t.dts - e.dts > 5 && d.warn("Dts error: " + e.type + " track dts rollback, last=" + t.dts + ", now=" + e.dts + ", delta=" + (e.dts - t.dts)) } e.extradata || (e.extradata = {}); var r = e.config; if (r || ("audio" === e.type ? r = this._audioConfig : "video" === e.type && (r = this._videoConfig)), r) return e.trackId >= 0 && (r.trackId = e.trackId), r.codec || (r.codec = e.codec), this._config.startFromZero && -1 !== this._baseTs && (e.pts = Math.max(e.pts - this._baseTs, 0), e.dts = Math.max(e.dts - this._baseTs, 0)), this._duration && !r.duration && (r.duration = this._duration, this._config.startFromZero || (r.duration += this._baseTs)), e.config = r, "audio" === e.type ? this._audioConfig = r : "video" === e.type && (this._videoConfig = r), this.onData(e), o.isFrameTrack(e) && (this._lastTracks[e.trackId] = e), !0; d.warn("unable to generate track config, type=" + e.type) } } else d.warn("unknown track type=" + e.type) }, Demuxer.prototype._appendEnd = function () { var e = this; Object.keys(this._lastTracks).forEach(function (t) { var r = e._lastTracks[t]; e._appendTrack({ type: r.type, trackId: r.trackId, dts: r.dts, pts: r.pts, codec: r.codec, isEnd: !0 }) }) }, Demuxer.prototype._generateTrackConfig = function (e) { return "audio" === e ? { type: "audio", trackId: 1, codec: void 0, detailCodec: "", timescale: 9e4, duration: 0, refSampleDuration: 0, bytes: void 0, mimeType: "", channelCount: 0, audioSampleRate: 0 } : "video" === e ? { type: "video", trackId: 2, codec: void 0, detailCodec: "", timescale: 9e4, duration: 0, refSampleDuration: 0, bytes: void 0, mimeType: "", presentWidth: 0, presentHeight: 0, codecWidth: 0, codecHeight: 0 } : null }, Demuxer.prototype._resetTrack = function (e) { var t = this; Object.keys(this._lastTracks).forEach(function (r, n, i) { var a = t._lastTracks[r]; t._appendTrack({ type: a.type, trackId: a.trackId, dts: 0, pts: 0, codec: a.codec, flag: "RESET", extradata: n === i.length - 1 ? e : void 0 }) }), this._trackLength = 2, this._duration = 0, this._baseTs = -1, this._pengdingTracks = [], this._firstAudioTs = void 0, this._firstVideoTs = void 0 }, Demuxer }(a.BaseStream); t.Demuxer = c }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.parseNal = void 0; var n = r(5); function findStartCode(e, t) { for (var r = e.byteLength; t < r - 2;) { if (0 === e[t] && 0 === e[t + 1]) { if (1 === e[t + 2]) return [t, t + 3]; if (0 === e[t + 2] && 1 === e[t + 3]) return [t, t + 4] } t++ } return [-1, -1] } function addNalu(e, t, r) { 9 !== t && (e.codec === n.Codec.H264 ? (7 !== t && 8 !== t || e.configNalus.push({ naluType: t, naluData: r }), e.nals.push({ naluType: t, naluData: r }), e.nalsLength += r.byteLength) : e.codec === n.Codec.H265 && (32 !== t && 33 !== t && 34 !== t || e.configNalus.push({ naluType: t, naluData: r }), e.nals.push({ naluType: t, naluData: r }), e.nalsLength += r.byteLength)) } t.parseNal = function parseNal(e) { for (var t, r, i, a = e.codec, o = e.bytes, s = { configNalus: [], nals: [], nalsLength: 0, codec: a }, u = findStartCode(o, 0), d = u[0], c = u[1]; -1 !== d;)r && addNalu(s, i, o.subarray(r, d)), r = c, i = s.codec === n.Codec.H265 ? (126 & o[r]) >> 1 : 31 & o[r], d = (t = findStartCode(o, c + 1))[0], c = t[1]; return r && addNalu(s, i, o.subarray(r, o.byteLength)), s } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.aac = t.reference = void 0; var i = r(0), a = n(r(44)), o = n(r(7)), s = r(5), u = i.makeLogger("aac-parser"); t.reference = { mpegSamplingRates: [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350] }, t.aac = { name: s.Codec.AAC, inited: !0, parseConfig: function parseConfig(e) { var r, n, i = e.bytes, a = 0, o = null; if (a = i[0] >>> 3, (n = (7 & i[0]) << 1 | i[1] >>> 7) < 0 || n >= t.reference.mpegSamplingRates.length) return u.warn("AAC invalid sampling frequency index!"), -1; var s = t.reference.mpegSamplingRates[n], d = (120 & i[1]) >>> 3; if (d < 0 || d >= 8) return u.warn("AAC invalid channel configuration"), -1; 5 === a && (o = (7 & i[1]) << 1 | i[2] >>> 7, i[2]); var c = self.navigator.userAgent.toLowerCase(); return -1 !== c.indexOf("firefox") ? n >= 6 ? (a = 5, r = new Array(4), o = n - 3) : (a = 2, r = new Array(2), o = n) : -1 !== c.indexOf("android") ? (a = 2, r = new Array(2), o = n) : (a = 5, o = n, r = new Array(4), n >= 6 ? o = n - 3 : 1 === d && (a = 2, r = new Array(2), o = n)), r[0] = a << 3, r[0] |= (15 & n) >>> 1, r[1] = (15 & n) << 7, r[1] |= (15 & d) << 3, 5 === a && (r[1] |= (15 & o) >>> 1, r[2] = (1 & o) << 7, r[2] |= 8, r[3] = 0), e.bytes = new Uint8Array(r), e.audioSampleRate = s, e.channelCount = d, e.detailCodec = "mp4a.40." + a, e.refSampleDuration = 1024 / s * 1e3, 0 }, parseData: function parseData(e) { var t = e.data; if (32 === t.byteLength && 33 === t[0] && 31 === t[1] && 16 === t[2]) return u.warn("private aac data, ignore!"), delete e.data, -1; if (6 === (t[0] >> 5 & 7)) { var r = a.default.getDbData(a.default.parseAacFilData(t)); r && (e.extradata.aacfil = { aacTimestamp: e.dts, data: r }, delete e.data), o.default.msedge && delete e.data } return 0 } } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.createRemuxer = t.Remuxer = void 0; var i = r(45); Object.defineProperty(t, "Remuxer", { enumerable: !0, get: function () { return i.Remuxer } }); var a = n(r(46)); t.createRemuxer = function createRemuxer(e) { switch (e.outputFormat) { case "mp4": return new a.default(e); default: return null } } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.H264SeiUUIDType = t.H264SeiType = void 0; var i = n(r(0)); t.H264SeiType = { H264_SEI_TYPE_BUFFERING_PERIOD: 0, H264_SEI_TYPE_PIC_TIMING: 1, H264_SEI_TYPE_PAN_SCAN_RECT: 2, H264_SEI_TYPE_FILLER_PAYLOAD: 3, H264_SEI_TYPE_USER_DATA_REGISTERED: 4, H264_SEI_TYPE_USER_DATA_UNREGISTERED: 5, H264_SEI_TYPE_RECOVERY_POINT: 6, H264_SEI_TYPE_FRAME_PACKING: 45, H264_SEI_TYPE_DISPLAY_ORIENTATION: 47, H264_SEI_TYPE_GREEN_METADATA: 56, H264_SEI_TYPE_MASTERING_DISPLAY_COLOUR_VOLUME: 137, H264_SEI_TYPE_ALTERNATIVE_TRANSFER: 147 }, t.H264SeiUUIDType = { AdsCtrlSEIV00001: "AdsCtrlSEIV00001", AdsCtrlSEIV00003: "AdsCtrlSEIV00003", CloudVideoStream: "CloudVideoStream", RoiMaskSeiV00001: "RoiMaskSeiV00001" }; var a = function () { function SEIParser() { } return SEIParser._ebsp2rbsp = function (e) { for (var t = e, r = t.byteLength, n = new Uint8Array(r), i = 0, a = 0; a < r; a++)a >= 2 && 3 === t[a] && 0 === t[a - 1] && 0 === t[a - 2] || (n[i] = t[a], i++); return new Uint8Array(n.buffer, 0, i) }, SEIParser.parseSEI = function (e) { var r, n, i = SEIParser._ebsp2rbsp(e), a = new DataView(i.buffer), o = 0, s = 0, u = 0; do { n = a.getUint8(u), u += 1, o += n } while (255 === n); do { n = a.getUint8(u), u += 1, s += n } while (255 === n); switch (o) { case t.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED: r = SEIParser.decodeUnregisteredUserData(a, u, s) }return { seiType: o, seiData: r } }, SEIParser.buffer2JSON = function (e) { for (var t = [], r = new Uint8Array(e), n = 0, i = e.byteLength; n < i; n++)t.push(String.fromCharCode(r[n])); return JSON.parse(t.join("")) }, SEIParser.decodeUnregisteredUserData = function (e, r, n) { if (n < 16) return i.default.warn("SEIParser ", "error size: ", n), null; var a, o, s = String.fromCharCode.apply(null, new Uint8Array(e.buffer, r, 16)); switch (r += 16, s) { case t.H264SeiUUIDType.AdsCtrlSEIV00001: case t.H264SeiUUIDType.AdsCtrlSEIV00003: 0 === (o = e.getUint8(r++)) && (a = SEIParser.buffer2JSON(e.buffer.slice(r, n + r - 17))); break; case t.H264SeiUUIDType.CloudVideoStream: var u = e.getUint32(r).toString(2), d = e.getUint32(r + 4).toString(2); a = parseInt("" + u + (d.length < 32 ? new Array(32 - d.length + 1).join("0") : "") + d, 2); break; case t.H264SeiUUIDType.RoiMaskSeiV00001: var c = e.getUint8(r); r += 1, 1 === c && (a = String.fromCharCode.apply(null, new Uint8Array(e.buffer, r, n - 17))) }return { uuid: s, enctype: o, data: a } }, SEIParser }(); t.default = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.Workerable = void 0; var n = r(3), i = r(1), a = r(2), o = function () { function Workerable() { var e = this; this.inWorker = !1, n.bindAll(this), this.inWorker = "object" !== typeof window, this.inWorker && (self.onmessage = this._onMessage, self.onerror = function (t) { return e._onError(new i.DyError("worker error: " + t, i.ErrorIds.WorkerError)) }) } return Workerable.prototype.init = function (e) { this._config = e, this.inWorker && a.connectEventbus(this, this._onMessage, e) }, Workerable.prototype.postMessage = function (e, t) { this._onMessage({ data: e }) }, Workerable.prototype.terminate = function () { var e, t; this.onmessage = null, this.onerror = null, this.inWorker && this._config && (null === (t = null === (e = this._config.__internal) || void 0 === e ? void 0 : e.eventbus) || void 0 === t || t.removeAllListeners(), this._config = null) }, Workerable.prototype.dispatchMessage = function (e, t) { this.inWorker ? t && t[0] instanceof ArrayBuffer ? self.postMessage(e, t) : self.postMessage(e) : this.onmessage && this.onmessage({ data: e }) }, Workerable.prototype._onError = function (e) { this.dispatchMessage({ name: "_onError", params: this.inWorker ? i.errorClone(e) : e }), this.terminate() }, Workerable }(); t.Workerable = o }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.ToMSE = void 0; var a = r(1), o = r(61), s = r(11), u = r(6), d = r(0), c = r(2), l = r(4), p = d.makeLogger("to-mse"), f = function (e) { function ToMSE(t) { var r = e.call(this, t) || this; return r.preTimestamp = 0, r._tracks = {}, r._sourceBufferAdded = {}, r._trackEndedFlag = {}, r._isLoadEnded = !1, r._isPlayEnded = !1, r._isWaiting = !0, r._reachCanplay = !1, r._jumpOverList = [], r._keyframes = [], r._isTracksReady = !1, r._lastPlayTime = -1, r._removeBuffer = o.throttle(r._removeBufferNow, 1e3), r._smoothSwitchTime = 1 / 0, window.T_ADV_Timestamp = r.T_ADV_Timestamp, r._config.enableJitterBuffer && (r._checkBufferTimer = setInterval(r._checkBuffer, 1e3)), r._jumpOverTimer = setInterval(r._jumpOver, 200), r._checkBufferGapTimer = setInterval(r._checkBufferGap, 500), r._checkStuckTimer = setInterval(r._checkPlayStuck, 2e3), r._config.__internal.eventbus.on(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, r._onGetSmoothSwitchTime), r } return i(ToMSE, e), ToMSE.prototype.dispose = function () { if (e.prototype.dispose.call(this), this._config.__internal.eventbus.off(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, this._onGetSmoothSwitchTime), this._mediaSource) { if ("closed" !== this._mediaSource.readyState) for (var t = this._mediaSource.sourceBuffers, r = 0; r < t.length; r++) { var n = t[r]; try { this._mediaSource.removeSourceBuffer(n) } catch (e) { p.warn("remove source buffer error: ", e) } n.removeEventListener("updateend", this._onUpdateend) } if ("open" === this._mediaSource.readyState) try { this._mediaSource.endOfStream() } catch (e) { p.warn("endOfStream error: ", e) } this._mediaSource.removeEventListener("sourceopen", this._appendBuffer), this._mediaSource = null } this._mediaSourceUrl && (URL.revokeObjectURL(this._mediaSourceUrl), this._mediaSourceUrl = null), this._sourceBufferAdded = {} }, ToMSE.prototype.appendData = function (t) { var r; if (!this._destroyed) { if (e.prototype.appendData.call(this, t), "RESET" === t.flag) return (null === (r = t.extradata) || void 0 === r ? void 0 : r.switchSource) && (this._switchingSource = t.extradata.switchSource, this._switchingSource.pendingAppend = !0), void this._reset(); var n = this._tracks[t.trackId]; n || (n = this._tracks[t.trackId] = []), n.push(t), this._switchingSource && this._checkSwitchSource(t), this._isTracksReady || (this._isTracksReady = this._checkTracksReady()), this._isTracksReady && this._appendBuffer(), t.isEnd && this._onUpdateend() } }, ToMSE.prototype.appendEnd = function () { if (!this._destroyed && this._mediaSource && "open" === this._mediaSource.readyState) { for (var e = this._mediaSource.sourceBuffers, t = !1, r = 0; r < e.length; r++) { if (e[r].updating) { t = !0; break } } t || (this._mediaSource.endOfStream(), p.log("media end")) } }, ToMSE.prototype.attach = function (t) { if (e.prototype.attach.call(this, t), this._video.addEventListener("stalled", this._onStalled), this._video.addEventListener("progress", this._checkBufferGap), this._video.addEventListener("canplay", this._onCanplay), this._video.addEventListener("waiting", this._onWaiting), this._video.addEventListener("ended", this._onEnded), this._video.addEventListener("error", this._onMediaError), this._video.addEventListener("seeking", this._onSeeking), this._video.addEventListener("play", this._onPlay), !this._mediaSourceUrl) { var r = this._mediaSource = new MediaSource; r.addEventListener("sourceopen", this._appendBuffer), this._mediaSourceUrl = URL.createObjectURL(r) } this._video.src = this._mediaSourceUrl }, ToMSE.prototype.detach = function () { this._video && (this._video.removeEventListener("stalled", this._onStalled), this._video.removeEventListener("progress", this._checkBufferGap), this._video.removeEventListener("canplay", this._onCanplay), this._video.removeEventListener("waiting", this._onWaiting), this._video.removeEventListener("ended", this._onEnded), this._video.removeEventListener("error", this._onMediaError), this._video.removeEventListener("seeking", this._onSeeking), this._video.removeEventListener("play", this._onPlay), this._video.playbackRate = 1, this._video.src = "", this._video.removeAttribute("src"), this._video = null), this._removeBuffer.cancel(), clearInterval(this._checkStuckTimer), clearInterval(this._checkBufferTimer), clearInterval(this._jumpOverTimer), clearInterval(this._checkBufferGapTimer), e.prototype.detach.call(this) }, ToMSE.prototype._appendBuffer = function () { var e, t = this; this._destroyed || !this._mediaSource || "closed" === this._mediaSource.readyState || null !== (e = this._switchingSource) && void 0 !== e && e.pendingAppend || Object.keys(this._tracks).some(function (e) { for (var r = t._tracks[e], n = [], i = t._sourceBufferAdded[e]; r.length > 0;) { var o = r[0]; if (!i) { var s = o.config.mimeType; if (!MediaSource.isTypeSupported(s)) return t._onError(new a.DyMediaError("Unsupported MIME type or codec: " + s, a.ErrorIds.MediaUnsupportCodec)), !0; try { p.log("add source buffer " + o.trackId + ": " + s), (i = t._mediaSource.addSourceBuffer(s)).addEventListener("updateend", t._onUpdateend), t._sourceBufferAdded[o.trackId] = i } catch (e) { return t._onError(new a.DyMediaError("failed add more source buffer, length=" + t._mediaSource.sourceBuffers.length + ", readyState=" + t._mediaSource.readyState + "\n" + e, a.ErrorIds.MediaAddSourceBufferError)), !0 } return } if (!i || i.updating) return; if (o.isEnd && !t._isLoadEnded && (t._trackEndedFlag[o.trackId] = !0, o.trackLength === Object.keys(t._trackEndedFlag).length && (t._isLoadEnded = !0)), o.extradata) { var u = o.extradata, d = u.jumpOverTs, l = u.timeOffset, f = u.seiTimestamp, h = u.aacfil, _ = u.sei; d > 0 && (t._jumpOverList.push({ start: o.pts / 1e3, end: d / 1e3 }), p.warn("jumpover timestamp list changed: ", JSON.stringify(t._jumpOverList))), l && -1 !== l && (i.timestampOffset = l / 1e3, p.log("buffer time offset change: " + i.timestampOffset)), f && (t.seiTimestamp = f), h && t._onExtraData({ type: "aacfil", ts: o.pts, data: h }), _ && t._onExtraData({ type: "sei", ts: o.pts, data: _ }) } o.pts && (t.preTimestamp = o.pts, t._switchingSource && "video" === o.type && (t._switchingSource.lastUpdateVideoTs = o.pts)), "video" === o.type && o.isKeyframe && (c.binsert(t._keyframes, o.pts / 1e3), t.onHasKeyframe && t.onHasKeyframe()), o.data && o.data.byteLength > 0 && n.push(o.data), delete o.data, r.shift() } if (n.length > 0) try { i.appendBuffer(c.bufferConcat(n)) } catch (e) { p.warn("append buffer error: ", e, t._video.error), 22 === e.code || t._onError(new a.DyMediaError("append buffer error: " + e + " " + t._video.error, a.ErrorIds.MediaAppendError)) } }) }, ToMSE.prototype._removeBufferNow = function () { var e; if (this._video && !this._isPlayEnded && (null === (e = this._switchingSource) || void 0 === e || !e.pendingAppend)) for (var t = this._video.currentTime, r = this._mediaSource.sourceBuffers, n = function (e) { var n = r[e]; if (!n.updating) { var a = n.buffered; if (a.length > 0) { var o = a.start(0); if (t - o > i._config.videoBackTimeThreshold) { var s = t - i._config.videoBackTime; (s = i._searchNearestKeyframe(s) - 1) && s - o > 5 && (p.debug("remove played sb[" + e + "]: " + o + " --\x3e " + s), n.remove(Math.max(o - 1, 0), s), i._keyframes = i._keyframes.filter(function (e) { return e >= s })) } } } }, i = this, a = 0; a < r.length; a++)n(a) }, ToMSE.prototype._searchNearestKeyframe = function (e) { var t = this._keyframes.length; if (0 === t) return p.log("no keyframe info!"), e; if (!(e < this._keyframes[0])) for (var r = 0; r < t; r++) { if (e >= this._keyframes[r] && (r === t - 1 || e < this._keyframes[r + 1])) return this._keyframes[r] } }, ToMSE.prototype._onUpdateend = function () { this._switchingSource && this._trySwitchSourceSmooth(), this._removeBuffer(), this._appendBuffer(), this._isLoadEnded && this.appendEnd() }, ToMSE.prototype._checkPlayStuck = function () { if (this._video && !this._video.paused && this._reachCanplay) { var e = this._video.buffered, t = this._video.currentTime; if (this._lastPlayTime === t && this._isWaiting && e.length > 0 && !this._isPlayEnded) if (e.end(e.length - 1) > t + 3) { var r = t + 1; p.warn("player stuck, force move forward: " + t + " -> " + r), this._printBuffer(this._video.buffered), this._video.currentTime = r } this._lastPlayTime = this._video.currentTime } }, ToMSE.prototype._checkBufferGap = function () { if (this._video && this._isWaiting) for (var e = this._video.buffered, t = this._video.currentTime, r = 0; r < e.length; r++) { var n = e.start(r), i = e.end(r); if (n > t && (!this._reachCanplay || i - n > 1)) { if (r > 0) if (e.end(r - 1) - t > 2) return; this._video.currentTime = n, p.log("jump over buffer gap " + (r > 0 ? "[" + e.start(r - 1) + ", " + e.end(r - 1) + "], [" + e.start(r) + ", " + e.end(r) + "]" : "0, [" + e.start(r) + ", " + e.end(r) + "]") + ", " + t + " --\x3e " + n); break } } }, ToMSE.prototype._checkBuffer = function () { if (this._video) { var e = this._video.buffered; if (e && e.length > 0) { var t = e.end(e.length - 1) - this._video.currentTime, r = this._video.playbackRate, n = void 0; if (t < this._config.minBuffer) n = this._config.slowRate; else if (t < this._config.maxBuffer) { var i = (this._config.minBuffer + this._config.maxBuffer) / 2; r < 1 && t > i && (n = 1), r > 1 && t < i && (n = 1) } else n = this._config.fastRate; n && n !== r && (this._video.playbackRate = n, p.log("playback rate change to " + n)) } } }, ToMSE.prototype._printBuffer = function (e) { var t = "buffer status: current = " + this._video.currentTime, r = e.length; t += " buffered ="; for (var n = 0; n < r; n++)t += " [" + e.start(n) + ", " + e.end(n) + "]"; p.log(t) }, ToMSE.prototype._jumpOver = function () { var e = this._jumpOverList.length; if (e > 0) { if (!this._video) return; for (var t = this._video.currentTime, r = this._jumpOverList.concat(), n = e - 1; n >= 0; n--) { var i = r[n]; if (t >= i.start && t < i.end) { var a = i.end + 1; p.warn("Large gap detected, jump from " + t + " to " + a), this._video.currentTime = a, this._jumpOverList.splice(0, n + 1); break } t > i.end && this._jumpOverList.splice(n, 1) } } }, ToMSE.prototype._onStalled = function () { }, ToMSE.prototype._onWaiting = function () { this._isWaiting = !0, this._checkBufferGap() }, ToMSE.prototype._onCanplay = function () { this._reachCanplay = !0, this._isWaiting = !1, this._video.removeEventListener("progress", this._checkBufferGap) }, ToMSE.prototype._onEnded = function () { this._isPlayEnded = !0, this._removeBufferNow() }, ToMSE.prototype._onMediaError = function () { var e = "Media Error"; this._video && this._video.error && (e = "code=" + this._video.error.code + ", message=" + this._video.error.message + ", url=" + this._video.src), this._onError(new a.DyMediaError(e, a.ErrorIds.MediaError)) }, ToMSE.prototype._onError = function (e) { this.onError && this.onError(e) }, ToMSE.prototype._checkTracksReady = function () { var e = this, t = Object.keys(this._tracks)[0]; if (!t) return !1; var r = this._tracks[t]; if (!r || 0 === r.length) return !1; var n = r[0].trackLength, i = Object.keys(this._tracks).map(function (t) { return e._tracks[t][0] }).map(function (e) { return e && e.config.mimeType }).filter(function (e) { return e }); return i.length !== n ? (p.log("tracks not ready, trackLength=" + n + ", now we have [" + i.join(",") + "], waiting..."), !1) : (p.log("tracks are ready, trackLength=" + n + ", now we have [" + i.join(",") + "]"), !0) }, ToMSE.prototype.T_ADV_Timestamp = function () { if (this._video) { if (0 == this._video.buffered.length) return; return { bufferLength: this.getBufferTime(), ptsTimestamp: this.preTimestamp, seiTimestamp: this.seiTimestamp, keyframes: this._keyframes.concat() } } }, ToMSE.prototype.getBufferTime = function () { return this._video && !this._video.seeking && this._video.buffered.length ? this._video.buffered.end(0) - this._video.currentTime : 0 }, ToMSE.prototype.getCurrentTime = function () { return this._video ? this._video.currentTime : 0 }, ToMSE.prototype.getIsWaiting = function () { return this._isWaiting }, ToMSE.prototype._onSeeking = function () { if (p.log("seeking to " + this._video.currentTime), this._isPlayEnded = !1, this._smoothSwitchTime = 1 / 0, "live" !== this._config.mode) { if (this._video) for (var e = this._video.buffered.length, t = this._video.currentTime, r = 0; r < e; r++) { var n = this._video.buffered.start(r), i = this._video.buffered.end(r); if (n - t <= .1 && t - i <= this._config.hls.seekThreshold) return } this._config.__internal.eventbus.emit(l.InternalEvents.SEEK, { data: this._video.currentTime }) } }, ToMSE.prototype._reset = function () { var e = this; if (this._isPlayEnded = !1, this._isLoadEnded = !1, this._jumpOverList = [], this._keyframes = [], this._smoothSwitchTime !== 1 / 0) { var t = 1e3 * this._smoothSwitchTime; Object.keys(this._tracks).forEach(function (r) { e._tracks[r] = e._tracks[r].filter(function (e) { return e.dts < t }) }) } else this._tracks = {}; p.log("mse reset") }, ToMSE.prototype._onPlay = function () { this._isPlayEnded && this._reset() }, ToMSE.prototype._onGetSmoothSwitchTime = function (e) { var t = e.data.time; this._smoothSwitchTime = t + 1 }, ToMSE.prototype._checkSwitchSource = function (e) { var t = this; if (void 0 === this._switchingSource.firstTs && "video" === e.type && e.isKeyframe && u.isFrameTrack(e)) { this._switchingSource.firstTs = e.pts; var r = this._switchingSource.firstTs / 1e3, n = this._video.buffered; if (n.length) { var i = n.start(0), a = n.end(0); if (this._switchingSource.firstTs > 1e3 && i - 2 <= r && r <= a && !this._switchingSource.quick) return p.warn("switch source smooth=true, current=" + this._video.currentTime + ", sourceStart=" + r), this._switchingSource.smooth = !0, void (this._switchingSource.pendingAppend = !1) } p.warn("switch source smooth=false"), this._switchingSource.smooth = !1; var o = this._switchingSource; this._clearAllBuffer().then(function () { o.pendingAppend = !1, t._appendBuffer() }) } }, ToMSE.prototype._trySwitchSourceSmooth = function () { if (!this._destroyed && this._switchingSource && !this._switchingSource.pendingAppend) if (!0 === this._switchingSource.smooth) this._switchingSource.lastUpdateVideoTs >= 1e3 * this._video.currentTime && (p.log("switch source success: smooth=true"), this._printBuffer(this._video.buffered), this._switchingSource = void 0, this._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_SUCCESS, { data: { smooth: !0 } })); else if (!1 === this._switchingSource.smooth) { var e = this._video.buffered; if (0 === e.length) return; p.log("switch source success: smooth=false"), this._video.currentTime = e.start(0), this._printBuffer(this._video.buffered), this._switchingSource = void 0, this._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_SUCCESS, { data: { smooth: !1 } }) } }, ToMSE.prototype._clearAllBuffer = function () { var e = this; return new Promise(function (t) { var r = function () { var n = Object.keys(e._sourceBufferAdded).map(function (t) { return e._sourceBufferAdded[t] }); if (n.every(function (e) { return !e.updating })) return n.forEach(function (e) { e.buffered.length && e.remove(0, 1 / 0) }), p.log("buffer all cleared."), t(); setTimeout(r, 50) }; r() }) }, ToMSE }(s.MediaHandler); t.ToMSE = f }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var o = r(0), s = a(r(9)), u = r(25), d = r(1), c = o.makeLogger("decoder-single"), l = function (e) { function DecoderSingle() { var t = null !== e && e.apply(this, arguments) || this; return t._videoBytes = new s.default({ autoClear: !0 }), t._isEnd = !1, t._playTime = 0, t._playTimeUpdateTime = 0, t._hidden = !1, t._buffers = {}, t } return i(DecoderSingle, e), DecoderSingle.prototype.terminate = function () { e.prototype.terminate.call(this), this._wasm && (this._wasm._decode_abort(1), this._wasm = null), this._videoBytes = null, this._buffers = null }, DecoderSingle.prototype.init = function (t) { e.prototype.init.call(this, t), t.debug && c.setEnable(!0), this._initWasm() }, DecoderSingle.prototype._initWasm = function () { this._onError(new d.DyError("unsupport single thread decode.", d.ErrorIds.DecoderDecodeError)) }, DecoderSingle.prototype._onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "init": this.init(n); break; case "bytes": this._videoBytes.write(n); break; case "playtime": this._playTime = 1e3 * n, this._playTimeUpdateTime = Date.now(); break; case "end": this._isEnd = !0; break; case "visibility": this._hidden = n, this._wasm && this._wasm._set_hidden(this._hidden ? 1 : 0) } } catch (e) { c.warn('call decoder worker "' + r + '" error', e) } }, DecoderSingle.prototype.outer_read = function (e, t) { if (this._videoBytes.byteAvailable > 0) { var r = Math.min(this._videoBytes.byteAvailable, t), n = new Uint8Array(this._videoBytes.read(r)); return this._wasm.HEAPU8.set(n, e), r } return this._isEnd ? (this._wasm._decode_abort(2), -1) : (c.log("no data, wait..."), 0) }, DecoderSingle.prototype.outer_close = function () { return c.log("outer_close"), 0 }, DecoderSingle.prototype.frame_out = function (e, t, r, n, i, a, o, s, u) { var d = this._buffers, c = d.yBuffer, l = d.uBuffer, p = d.vBuffer, f = self.SharedArrayBuffer || self.ArrayBuffer, h = n * t; c && c.byteLength === h || (c = this._buffers.yBuffer = new Uint8Array(new f(h))), c.set(this._wasm.HEAPU8.subarray(o, o + h), 0); var _ = i * t / 2; l && l.byteLength === _ || (l = this._buffers.uBuffer = new Uint8Array(new f(_))), l.set(this._wasm.HEAPU8.subarray(s, s + _), 0); var m = a * t / 2; p && p.byteLength === m || (p = this._buffers.vBuffer = new Uint8Array(new f(m))), p.set(this._wasm.HEAPU8.subarray(u, u + m), 0), this.dispatchMessage({ name: "frame", params: { width: e, height: t, pts: r, stride_y: n, stride_u: i, stride_v: a, y: c, u: l, v: p } }, [c.buffer, l.buffer, p.buffer]) }, DecoderSingle.prototype.get_play_time = function () { return this._playTime ? this._playTime + (Date.now() - this._playTimeUpdateTime) : 0 }, DecoderSingle.prototype.play_exit = function (e) { c.log("exit: ", e), e < 0 ? this.dispatchMessage({ name: "_onError", params: d.errorClone(new d.DyError("play exit, error code=" + e, d.ErrorIds.DecoderWasmError)) }) : this.dispatchMessage({ name: "end" }) }, DecoderSingle }(u.Workerable); t.default = l }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.LivePlayer = t.PlayerEvents = void 0, r(16); var o = a(r(17)), s = r(3), u = r(12), d = r(38), c = r(1), l = r(59), p = r(5), f = r(0), h = r(11), _ = r(2), m = r(4), y = f.makeLogger("live-player"); t.PlayerEvents = { ON_MEDIA_INFO: "mediaInfo", ON_FIRST_FRAME: "firstFrame", ON_ERROR: "player_error", ON_SEI: "sei", ON_LOAD_SEI: "loadSei", ON_AAC_DATA: "aacData", ON_EXTRA_DATA_LOAD: "extra_data_load", ON_EXTRA_DATA_PLAY: "extra_data_play", ON_LOW_PERFORMANCE: "low_performance", ON_STAT: "on_stat", ON_M3U8: "ON_M3U8", ON_SWITCH_SUCCESS: "ON_SWITCH_SUCCESS", ON_SWITCH_FAIL: "ON_SWITCH_FAIL" }; var v = { url: "", mode: "live", format: "flv", outputFormat: "mp4", mediaHandle: "mse", videoCodec: "h264", enableWorker: !0, debug: !1, stashBuffer: 65536, stashTime: 200, videoBackTime: 10, videoBackTimeThreshold: 15, enableJitterBuffer: !1, minBuffer: 2, maxBuffer: 6, slowRate: .95, fastRate: 1.05, audioDurationThreshold: 200, videoDurationThreshold: 100, startFromZero: !1, smoothSwitchTime: 2, hls: { m3u8LoadInterval: 1e3, m3u8LoadTimeout: 3e3, maxBufferTime: 20, seekThreshold: 10, tsRetryTimes: 4, maxRemainFragments: 50, upLevelThreshold: 8, enableM3u8Cache: !0 }, accelerator: { enable: !1, byteRate: 6e3 } }, g = function (e) { function LivePlayer(t) { var n = e.call(this) || this; if (n._destroyed = !1, n._isFirstFrameEmitted = !1, n._vbr = 0, n._isUpdatingSource = !1, s.bindAll(n), t.hls = Object.assign({}, v.hls, t.hls), t.accelerator = Object.assign({}, v.accelerator, t.accelerator), t.__internal = { eventbus: new m.InternalEventBus }, n._config = t = Object.assign({}, v, t), y.setEnable(t.debug), y.log("version=" + p.VERSION), "h265" === t.videoCodec) { if (!_.isWasmSupported()) return setTimeout(function () { n._onError(new c.DyError("Do not support wasm, can't play h265 video.", c.ErrorIds.WasmUnsupportError)) }, 0), n; t.__internal.wasmHvcc = r(75), t.__internal.wasmDecoderPthread = r(77), _.isH265Supported() ? (y.log("h265 browser supported, use mse play."), t.mediaHandle = "mse") : n._config.accelerator.enable ? (y.log("h265 accelerator enabled, use mse play."), t.mediaHandle = "mse") : (y.log("h265 browser not supported, use soft decode."), t.mediaHandle = "soft") } return n._config.loader ? n._loader = n._config.loader : n._loader = u.createLoader(n._config), n._loader ? (t.format = n._loader.format, n._mediaHandler = h.createMediaHandler(t), n._mediaHandler ? (n._mediaHandler.onHasKeyframe = n._onFirstFrame, n._mediaHandler.onExtraData = n._onExtraData, n._mediaHandler.onMediaInfo = n._onMediaInfo, n._mediaHandler.onLowPerformance = n._onLowPerformance, n._timeDispatch = new l.TimeDispatch, n._timeDispatch.onSend = n._onTimeDispatch, n._mediaManager = new d.MediaManager(n._loader, n._mediaHandler, n._config), n._mediaManager.onError = n._onError, n._mediaManager.init(), n._config.__internal.eventbus.on(m.InternalEvents.SEEK, n._onSeek), n._config.__internal.eventbus.on(m.InternalEvents.STAT, n._onStat), n._config.__internal.eventbus.on(m.InternalEvents.M3U8TIME, n._outM3u8Time), n._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_SUCCESS, n._onSwitchSourceSuccess), n._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_FAIL, n._onSwitchSourceFail), y.log("init"), n) : (setTimeout(function () { n._onError(new c.DyError("Do not has supported media-handler.", c.ErrorIds.NoSupportedMediaHandler)) }, 0), n)) : (setTimeout(function () { n._onError(new c.DyError("Do not has supported loader.", c.ErrorIds.NoSupportedLoader)) }, 0), n) } return i(LivePlayer, e), LivePlayer.isSupported = function () { return _.isPlayerSupported() }, LivePlayer.isH265Supported = function () { return navigator.hardwareConcurrency >= 4 && _.isWasmSupported() && _.isPthreadsSupported() }, Object.defineProperty(LivePlayer.prototype, "mediaHandle", { get: function () { return this._config.mediaHandle }, enumerable: !1, configurable: !0 }), LivePlayer.prototype.dispose = function () { var e, t; this._destroyed || (this.pause(), this.detach(), this._mediaManager && (this._mediaManager.dispose(), this._mediaManager = null), this._loader && (this._loader.dispose(), this._loader = null), this._mediaHandler && (this._mediaHandler.dispose(), this._mediaHandler = null), this._timeDispatch && (this._timeDispatch.destroy(), this._timeDispatch = null), this.removeAllListeners(), this._config && (null === (t = null === (e = this._config.__internal) || void 0 === e ? void 0 : e.eventbus) || void 0 === t || t.removeAllListeners(), this._config = null), this._destroyed = !0, y.log("disposed")) }, LivePlayer.prototype.load = function () { this._destroyed || (this._loader ? (y.log("loading..."), this._loader.load(this._config.url, this._config)) : y.warn("can't load because there is no available loader")) }, LivePlayer.prototype.attach = function (e) { this._mediaHandler && (this._timeDispatch.attach(e), this._video = e, this._video.addEventListener("loadedmetadata", this._onFirstFrameFromMeta), this._video.addEventListener("canplay", this._onCanplay), this._mediaHandler.attach(e)) }, LivePlayer.prototype.detach = function () { this._mediaHandler && this._mediaHandler.detach(), this._timeDispatch && this._timeDispatch.detach(), this._video && (this._video.removeEventListener("loadedmetadata", this._onFirstFrameFromMeta), this._video.removeEventListener("canplay", this._onCanplay), this._video = null) }, LivePlayer.prototype.play = function () { this._video && this._video.play() }, LivePlayer.prototype.pause = function () { this._video && this._video.pause() }, LivePlayer.prototype.getMediaInfo = function () { return this._mediaInfo }, LivePlayer.prototype.getStatInfo = function () { var e = { url: "", redirectedURL: "", loaderBytes: 0, decodedFrames: 0, droppedFrames: 0, cdnBytes: 0, p2pBytes: 0, totalDropBytes: 0, uploadBytes: 0, fps: 0, decodeFps: 0, renderFps: 0, vbr: this._vbr }; if (this._loader) { var t = this._loader.getStatistics(), r = t.loaderBytes, n = t.cdnBytes, i = t.p2pBytes, a = t.totalDropBytes, o = t.uploadBytes; e.url = this._loader.url, e.redirectedURL = this._loader.redirectUrl, e.loaderBytes = r, e.cdnBytes = n, e.p2pBytes = i, e.totalDropBytes = a || 0, e.uploadBytes = o || 0 } if (this._video) if ("function" === typeof this._video.getVideoPlaybackQuality) { var s = this._video.getVideoPlaybackQuality(); e.decodedFrames = s.totalVideoFrames, e.droppedFrames = s.droppedVideoFrames } else void 0 !== this._video.webkitDecodedFrameCount && (e.decodedFrames = this._video.webkitDecodedFrameCount, e.droppedFrames = this._video.webkitDroppedFrameCount); return this._mediaInfo && (e.fps = this._mediaInfo.fps), this._mediaHandler && Object.assign(e, this._mediaHandler.getStatInfo()), e }, LivePlayer.prototype.T_ADV_Timestamp = function () { return this._mediaHandler && this._mediaHandler.T_ADV_Timestamp() }, LivePlayer.prototype.updateSource = function (e) { var t; if (!this._destroyed) if (this._isUpdatingSource = !0, y.log("update source: ", e), null !== (t = this._loader) && void 0 !== t && t.supportSmooth) this._loader.updateSource(e); else { var r = e.loader || u.createLoader(Object.assign({}, this._config, { url: e.url })); r ? (delete e.loader, this._loader && (this._loader.format !== r.format && (y.log("format changed: " + this._loader.format + " -> " + r.format), this._config.format = r.format, this._mediaManager.changeFormat(r.format)), this._loader.reset({ switchSource: e }), this._loader.dispose()), this._loader = r, this._mediaManager.attachLoader(this._loader), this._loader.load(e.url, this._config)) : y.warn("unsupport source: ", e) } }, LivePlayer.prototype.endOfStream = function () { this._loader && this._loader.endOfStream() }, LivePlayer.prototype._onMediaInfo = function (e) { y.log("onMediaInfo: ", e), this._mediaInfo = e, this.emit(t.PlayerEvents.ON_MEDIA_INFO, e) }, LivePlayer.prototype._onFirstFrameFromMeta = function () { this._onFirstFrame("meta") }, LivePlayer.prototype._onFirstFrame = function (e) { void 0 === e && (e = "keyframe"), this._isFirstFrameEmitted || (this._isFirstFrameEmitted = !0, this.emit(t.PlayerEvents.ON_FIRST_FRAME), y.log("first frame from " + e)) }, LivePlayer.prototype._onExtraData = function (e) { if ("sei" === e.type) { var r = e.data; r && r.length > 0 && r.forEach(this._onSei) } else "aacfil" === e.type ? this._onAACData(e.data) : "vbr" === e.type && (this._vbr = e.data); this._timeDispatch.add({ type: p.TimeDispatchType.EXTRA_DATA, ts: e.ts, data: e }), this.emit(t.PlayerEvents.ON_EXTRA_DATA_LOAD, e) }, LivePlayer.prototype._onCanplay = function () { this._config.__internal.eventbus.emit(m.InternalEvents.FIRST_FRAME) }, LivePlayer.prototype._onError = function (e) { e && e.errorId || (e = new c.DyError("unknown error: " + e, c.ErrorIds.Unknown)), e.updatedSource = this._isUpdatingSource, y.warn("player error: " + e.name + " fatal=" + e.fatal + " updatedSource=" + e.updatedSource + " errorId=" + e.errorId + " " + e.message), this._isUpdatingSource && this._onSwitchSourceFail({ data: {} }), this.emit(t.PlayerEvents.ON_ERROR, e), e.fatal && this.dispose() }, LivePlayer.prototype._onSei = function (e) { this._timeDispatch.add({ type: p.TimeDispatchType.H264_SEI, ts: e.seiTimestamp, data: e }), this.emit(t.PlayerEvents.ON_LOAD_SEI, e) }, LivePlayer.prototype._onAACData = function (e) { this.emit(t.PlayerEvents.ON_AAC_DATA, e.data) }, LivePlayer.prototype._onTimeDispatch = function (e) { switch (e.type) { case p.TimeDispatchType.H264_SEI: this.emit(t.PlayerEvents.ON_SEI, e.data); break; case p.TimeDispatchType.EXTRA_DATA: this.emit(t.PlayerEvents.ON_EXTRA_DATA_PLAY, e.data) } }, LivePlayer.prototype._onLowPerformance = function () { this.emit(t.PlayerEvents.ON_LOW_PERFORMANCE) }, LivePlayer.prototype._onSeek = function () { this._timeDispatch && this._timeDispatch.clear() }, LivePlayer.prototype._onStat = function (e) { var r = e.data; this.emit(t.PlayerEvents.ON_STAT, r) }, LivePlayer.prototype._outM3u8Time = function (e) { var r = e.data; this.emit(t.PlayerEvents.ON_M3U8, r) }, LivePlayer.prototype._onSwitchSourceSuccess = function (e) { var r = e.data; this._isUpdatingSource && this.emit(t.PlayerEvents.ON_SWITCH_SUCCESS, r), this._isUpdatingSource = !1 }, LivePlayer.prototype._onSwitchSourceFail = function (e) { var r = e.data; this._isUpdatingSource && this.emit(t.PlayerEvents.ON_SWITCH_FAIL, r), this._isUpdatingSource = !1 }, LivePlayer }(o.default); t.LivePlayer = g }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.FetchStreamLoader = void 0; var o = r(10), s = r(1), u = a(r(7)), d = function (e) { function FetchStreamLoader() { return null !== e && e.apply(this, arguments) || this } return i(FetchStreamLoader, e), FetchStreamLoader.isSupported = function () { try { var e = u.default.msedge && u.default.version.minor >= 15048, t = !u.default.msedge || e; return self.fetch && self.ReadableStream && t } catch (e) { return !1 } }, FetchStreamLoader.prototype.load = function (t, r, n) { var i, a = this; e.prototype.load.call(this, t, r), (null === n || void 0 === n ? void 0 : n.headers) && (i = { headers: n.headers }), fetch(t, i).then(function (e) { if (a._status = null === e || void 0 === e ? void 0 : e.status, e && e.ok) return t !== e.url && a._onRedirectUrl(e.url), e.body.getReader(); throw e ? new Error("err: " + e.status + " " + e.statusText) : new Error("err: no response, maybe blocked.") }).then(function (e) { if (a._reader = e, a._destroyed) a.dispose(); else { var t = function (r) { var n = r.done, i = r.value; n ? a._onEnd() : (a._onData(i.buffer), e.read().then(t).catch(a._onError)) }; e.read().then(t).catch(a._onError) } }).catch(function (e) { e && 11 === e.code && u.default.msedge || a._onError(new s.DyNetworkError("fetch stream failed: " + e, s.ErrorIds.NetworkError)) }) }, FetchStreamLoader.prototype.dispose = function () { this._reader && (this._reader.cancel().catch(function (e) { }), this._reader = null), e.prototype.dispose.call(this) }, FetchStreamLoader.prototype._onEnd = function () { this._reader = null, e.prototype._onEnd.call(this) }, FetchStreamLoader }(o.BaseLoader); t.FetchStreamLoader = d }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.MozChunkedLoader = void 0; var a = r(10), o = r(1), s = function (e) { function MozChunkedLoader() { var t = e.call(this) || this; return t._xhr = null, t._requestAbort = !1, t } return i(MozChunkedLoader, e), MozChunkedLoader.isSupported = function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "moz-chunked-arraybuffer", "moz-chunked-arraybuffer" === e.responseType } catch (e) { return !1 } }, MozChunkedLoader.prototype.load = function (t, r, n) { e.prototype.load.call(this, t, r), this._requestURL = t; var i = this._xhr = new XMLHttpRequest; i.open("GET", t, !0), i.responseType = "moz-chunked-arraybuffer", (null === n || void 0 === n ? void 0 : n.headers) && Object.keys(n.headers).forEach(function (e) { return i.setRequestHeader(e, n.headers[e]) }), i.onreadystatechange = this._onReadyStateChange.bind(this), i.onprogress = this._onProgress.bind(this), i.onloadend = this._onLoadEnd.bind(this), i.onerror = this._onXhrError.bind(this), i.send() }, MozChunkedLoader.prototype.dispose = function () { this.abort(), this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onloadend = null, this._xhr.onerror = null, this._xhr = null), e.prototype.dispose.call(this) }, MozChunkedLoader.prototype.abort = function () { this._requestAbort = !0, this._xhr && this._xhr.abort() }, MozChunkedLoader.prototype._onReadyStateChange = function (e) { var t = e.target; 2 === t.readyState && (void 0 != t.responseURL && t.responseURL !== this._requestURL && this._onRedirectUrl(t.responseURL), this._status = t.status, 0 !== t.status && (t.status < 200 || t.status > 299) && this._onError(new o.DyNetworkError("MozChunkedLoader: Http code invalid, " + t.status + " " + t.statusText, o.ErrorIds.NetworkError))) }, MozChunkedLoader.prototype._onProgress = function (e) { var t = e.target.response; this._onData(t) }, MozChunkedLoader.prototype._onLoadEnd = function (e) { !0 !== this._requestAbort ? this._onEnd() : this._requestAbort = !1 }, MozChunkedLoader.prototype._onXhrError = function (e) { this._onError("xhr load exit") }, MozChunkedLoader }(a.BaseLoader); t.MozChunkedLoader = s }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }; Object.defineProperty(t, "__esModule", { value: !0 }), t.HlsLoader = void 0; var o = r(10), s = r(1), u = r(32), d = r(0), c = r(33), l = r(4), p = r(2), f = r(6), h = r(36), _ = r(37), m = d.makeLogger("hls-loader"), y = function (e) { function HlsLoader() { var t = null !== e && e.apply(this, arguments) || this; return t._fragments = {}, t._lastSequence = -1, t._baseTime = 0, t._m3u8HasEnd = !1, t._isTsLoading = !1, t._beginDownLoadM3u8Time = 0, t._endDownLoadM3u8Time = 0, t._m3u8Streams = [], t._waitingForSmoothSwitch = !1, t._m3u8Cache = {}, t } return i(HlsLoader, e), Object.defineProperty(HlsLoader.prototype, "supportSmooth", { get: function () { return !0 }, enumerable: !1, configurable: !0 }), Object.defineProperty(HlsLoader.prototype, "format", { get: function () { return "ts" }, enumerable: !1, configurable: !0 }), HlsLoader.prototype.load = function (t, r) { e.prototype.load.call(this, t, r), this._config.__internal.eventbus.on(l.InternalEvents.SEEK, this._onSeeking), this._config.__internal.eventbus.on(l.InternalEvents.BASE_TS, this._onBaseTs); var n = a({ getBufferTime: this._getBufferTime, CdnLoader: c.TsLoader }, r); this._config.hls.TsLoader ? this._tsLoader = new this._config.hls.TsLoader(n) : this._tsLoader = new c.TsLoader(n), this._tsLoader.onData = this._onTsData, this._tsLoader.onEnd = this._onTsEnd, this._tsLoader.onError = this._onTsError, this._m3u8Load(), this._checkLoadTimer = setInterval(this._checkLoad, 2e3), "live" === this._config.mode && (this._reloadTimer = setInterval(this._m3u8Load, this._config.hls.m3u8LoadInterval)), this._bitrateControl = new _.BitrateControl, this._bitrateControl.onBitrate = this._onBitrate }, HlsLoader.prototype.dispose = function () { e.prototype.dispose.call(this), this._config.__internal.eventbus.off(l.InternalEvents.SEEK, this._onSeeking), this._config.__internal.eventbus.off(l.InternalEvents.BASE_TS, this._onBaseTs), this._tsLoader && (this._tsLoader.dispose(), this._tsLoader = null), this._fragments = null, this._tsLoadError = null, this._m3u8Request && (this._m3u8Request.cancel(), this._m3u8Request = null), this._updateRequest && (this._updateRequest.cancel(), this._updateRequest = null), clearInterval(this._reloadTimer), clearInterval(this._checkLoadTimer), this._bitrateControl = null, this._m3u8Streams = null, this._currentStream = null, this._m3u8Cache = null, m.log("disposed") }, HlsLoader.prototype.updateSource = function (e, t) { var r = this; p.isHls(e.url) ? (this._updateRequest && (this._updateRequest.cancel(), this._updateRequest = null), this._requestM3u8(e.url, function (e) { return r._updateRequest = e }).then(function (n) { r._url = e.url, r._updateFragments(n, !0), m.log("update source success, total length: " + n.fragments.length), t && t(), "smooth" === e.switch && (r._waitingForSmoothSwitch = !0, r._checkLoad()) }).catch(function (t) { m.warn("update source error: " + t), "smooth" === e.switch && r._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_FAIL) }).then(function () { r._updateRequest = null })) : m.warn("can't update source: " + e.url) }, HlsLoader.prototype.endOfStream = function () { if (this._m3u8HasEnd = !0, "vod" === this._config.mode) { var e = Object.keys(this._fragments).sort(p.numberCompare); if (e.length > 0) { var t = this._fragments[e[e.length - 1]].endTime; this._onData({ action: f.MediaAction.GET_DURATION, actionData: 1e3 * t }) } } clearInterval(this._reloadTimer), m.log("m3u8 reached end") }, HlsLoader.prototype.reset = function (t) { this._tsLoadError = null, e.prototype.reset.call(this, t) }, HlsLoader.prototype._m3u8Load = function () { var e = this; if (!this._m3u8Request) { var t = this._url; this._beginDownLoadM3u8Time = (new Date).getTime(), this._requestM3u8(t, function (t) { return e._m3u8Request = t }).then(this._parseM3u8).catch(function (t) { e._media.getIsWaiting() && e._onError(new s.DyNetworkError("load m3u8 error: " + t, s.ErrorIds.HlsM3u8LoadError)) }).then(function () { e._m3u8Request = null }) } }, HlsLoader.prototype._parseM3u8 = function (e) { var t, r = this; if (e) { this._endDownLoadM3u8Time = (new Date).getTime(); var n = this._endDownLoadM3u8Time - this._beginDownLoadM3u8Time; if (n && this._config.__internal.eventbus.emit(l.InternalEvents.M3U8TIME, { data: n }), null === (t = e.streams) || void 0 === t ? void 0 : t.length) return this._m3u8Streams = e.streams.sort(function (e, t) { return t.bitrate - e.bitrate }), this._m3u8Streams.forEach(function (e) { return e.url = p.resolveUrl(e.url, r._url) }), this._config.hls.streamFilter && (this._m3u8Streams = this._m3u8Streams.filter(this._config.hls.streamFilter)), this._currentStream = this._m3u8Streams[this._m3u8Streams.length - 1], this._url = this._currentStream.url, void setTimeout(this._m3u8Load, 0); this._updateFragments(e), e.hasEnd && this.endOfStream(), this._isTsLoading || this._checkLoad() } }, HlsLoader.prototype._checkLoad = function (e) { var t = this; if (void 0 === e && (e = !1), !this._destroyed) { if (this._media.getIsWaiting() && this._tsLoadError) return this._tsLoadError.fatal = !0, void this._onError(this._tsLoadError); if (this._waitingForSmoothSwitch) { if (!this._smoothSwitch()) return; this._waitingForSmoothSwitch = !1, this._currentIndex >= this._nextIndex && (e = !0) } if ((!this._isTsLoading || e) && ("live" === this._config.mode || e || this._getBufferTime() < this._config.hls.maxBufferTime)) { var r = -1; if (this._tsLoadError) return; if (void 0 === this._nextIndex) { var n = Object.keys(this._fragments).sort(p.numberCompare); if ("live" === this._config.mode && this._config.liveDelay) for (var i = 0, a = n.length - 1; a >= 0; a--)if ((i += this._fragments[n[a]].duration) >= this._config.liveDelay) { r = +n[a]; break } -1 === r && (r = +n[0]) } else r = this._nextIndex; var o = this._fragments[r]; o || Object.keys(this._fragments).sort(p.numberCompare).some(function (e) { if (+e > r) return m.warn("fragment[" + r + "] can't find in list, seek to " + e), o = t._fragments[e], !0 }), o && this._loadTs(o) } } }, HlsLoader.prototype._onSeeking = function (e) { var t = e.data, r = this._getFragmentIndex(t); if (-1 !== r) { var n = this._fragments[r]; m.log("out-buffer seek " + t + " success: base=" + this._baseTime + " frag index=" + r + ", start=" + (this._baseTime + n.startTime) + ", end=" + (this._baseTime + n.endTime)), this._nextIndex = r, this._checkLoad(!0) } else m.warn("out-buffer seek can't find fragment with time=" + (t - 2) + ", seeking " + t + " failed.") }, HlsLoader.prototype._onTsData = function (e) { this._bitrateControl.receiveData(e), this._onData(e) }, HlsLoader.prototype._onTsEnd = function () { this._isTsLoading = !1, this._bitrateControl.endDownload(), !this._m3u8HasEnd || this._fragments[this._nextIndex] ? this._checkLoad() : this._onEnd() }, HlsLoader.prototype._onTsError = function (e) { this._isTsLoading = !1, "string" === typeof e && (e = new s.DyError(e, s.ErrorIds.HlsTsCustomError, !1)), this._tsLoadError = e, this._onError(e) }, HlsLoader.prototype._getFragmentIndex = function (e) { var t = this, r = -1; return Object.keys(this._fragments).sort(p.numberCompare).some(function (n) { var i = t._fragments[n]; if (t._baseTime + i.endTime >= e) return r = +n, !0 }), r }, HlsLoader.prototype._onBaseTs = function (e) { var t = e.data; this._baseTime = +t / 1e3 }, HlsLoader.prototype._smoothSwitch = function () { m.log("smooth switching..."); var e, t = this._media.getCurrentTime(), r = this._getFragmentIndex(t); if (!this._media.video.paused) { for (e = this._fragments[++r]; e && this._baseTime + e.startTime - t < this._config.smoothSwitchTime;)e = this._fragments[++r]; if (!e) return m.log("smooth switch failed, can't find proper fragment, current=" + (t - this._baseTime) + "(" + t + "-" + this._baseTime + ")", this._fragments), !1; r = e.index, this._fragments[this._nextIndex] && (r = Math.min(this._nextIndex, r)) } return !!(e = this._fragments[r]) && (m.log("smooth switch will start from " + (this._baseTime + e.startTime) + ", currentTime=" + t + ", currentIndex=" + this._currentIndex + ", nextIndex=" + r), this._nextIndex = r, this._config.__internal.eventbus.emit(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, { data: { time: this._baseTime + e.startTime } }), !0) }, HlsLoader.prototype._getBufferTime = function () { if (this._fragments[this._nextIndex]) { var e = this._media.getCurrentTime(); return this._fragments[this._nextIndex].startTime + this._baseTime - e } return 0 }, HlsLoader.prototype._onBitrate = function (e) { var t = this; if (this._m3u8Streams.length && !this._updateRequest) { m.log("target bitrate: " + e); var r = this._m3u8Streams[this._m3u8Streams.length - 1]; this._m3u8Streams.some(function (t) { if (e >= t.bitrate) return r = t, !0 }), r && r.bitrate !== this._currentStream.bitrate && (m.log("bitrate change from " + this._currentStream.bitrate + " to " + r.bitrate), this.updateSource({ url: r.url, switch: "smooth" }, function () { t._currentStream = r })) } }, HlsLoader.prototype._loadTs = function (e) { void 0 !== this._currentIndex && e.index !== this._currentIndex + 1 && (m.warn("fragment load discontinue, current=" + this._currentIndex + ", next=" + e.index), this.reset()); var t = { url: p.concatUrl(e.url, this._config.hls.extraQuery), m3u8: p.concatUrl(this._url, this._config.hls.extraQuery), urlRaw: e.urlRaw, retryTimes: this._config.hls.tsRetryTimes, retryInterval: 1e3, timeout: e.duration ? Math.max(2e3 * e.duration, 1e4) : 0 }; (e.startBytes || e.endBytes) && (t.extra = { headers: { Range: "bytes=" + e.startBytes + "-" + e.endBytes } }), this._tsLoader.load(t), this._isTsLoading = !0, this._currentIndex = e.index, this._nextIndex = e.index + 1, this._bitrateControl.startDownload(e), this._currentStream ? m.log("load ts: index=" + e.index + ", start=" + (this._baseTime + e.startTime) + ", end=" + (this._baseTime + e.endTime) + ", bitrate=" + this._currentStream.bitrate) : m.log("load ts: index=" + e.index + ", start=" + (this._baseTime + e.startTime) + ", end=" + (this._baseTime + e.endTime)) }, HlsLoader.prototype._updateFragments = function (e, t) { var r = this; void 0 === t && (t = !1); var n = e.fragments; if (n.length > 0 && (this._lastSequence !== e.sequence || t)) { this._lastSequence = e.sequence; var i = this._fragments; this._fragments = {}; var a = Object.keys(i).sort(p.numberCompare); n.forEach(function (t) { if (t.url = p.resolveUrl(t.urlRaw, r._url), i[t.index - 1]) t.startTime = i[t.index - 1].endTime; else if (t.startTime = 0, a.length && t.index > 0) { m.warn("fragment index discontinue. missing " + (t.index - 1), e); var n = i[a[0]]; n.programDateTime && t.programDateTime && (t.startTime = n.startTime + (t.programDateTime - n.programDateTime) / 1e3, m.log("adjust fragment start time with program date time: index=" + t.index + ", start=" + t.startTime)) } t.endTime = t.startTime + t.duration, r._fragments[t.index] = i[t.index] = t }) } }, HlsLoader.prototype._requestM3u8 = function (e, t) { var r = this; return void 0 === t && (t = null), Promise.resolve().then(function () { var n = r._m3u8Cache[e]; if (n) return n; var i = h.request({ method: "get", url: p.concatUrl(e, r._config.hls.extraQuery), timeout: r._config.hls.m3u8LoadTimeout, retryTimes: 2, retryDelay: 500 }); return t && t(i), i.then(function (e) { return e.data }).then(function (t) { if (!r._destroyed) return n = u.parseM3u8(t), r._config.hls.enableM3u8Cache && "vod" === r._config.mode && (r._m3u8Cache[e] = n), n }) }) }, HlsLoader }(o.BaseLoader); t.HlsLoader = y }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.parseM3u8 = void 0; var n = r(0).makeLogger("m3u8-parser"), i = /#EXTINF:([\d.]+)/, a = /^(?!#)(\S+)/, o = /#EXT-X-BYTERANGE:(\d+)@*(\d*)/, s = /#EXT-X-MEDIA-SEQUENCE:(\d+)/, u = /#EXT-X-ENDLIST/, d = /#EXT-X-PREFETCH:(\S+)/, c = /#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+)/, l = /#EXT-X-PROGRAM-DATE-TIME:(\S+)/; t.parseM3u8 = function parseM3u8(e) { if (!e) throw new Error("no m3u8 data: " + e); return c.test(e) ? function parseStream(e) { var t, r, n = { streams: [] }; return e.split(/\s/).forEach(function (e) { if (!(t = e.match(c))) return (t = e.match(a)) ? (r.url = t[1], void n.streams.push(r)) : void 0; r = { bitrate: parseInt(t[1], 10), streamInfo: e } }), n }(e) : function parseContent(e) { var t, r, c; (c = s.exec(e)) ? t = parseInt(c[1], 10) : (n.warn("no sequence tag, use default sequence=0"), t = 0), r = !!u.exec(e); var p = { sequence: t, hasEnd: r, fragments: [] }, f = { index: t++ }; return e.split(/\n/).forEach(function (e) { if (c = e.match(d)) return f.url = c[1], f.urlRaw = c[1], f.duration = 0, p.fragments.push(f), void (f = { index: t++ }); if (c = e.match(l)) f.programDateTime = Date.parse(c[1]); else { if (!(c = e.match(i))) { if (c = e.match(o)) { var r = parseInt(c[1]), n = void 0; return n = c[2] ? parseInt(c[2]) : p.fragments[f.index - 1].endBytes + 1, f.startBytes = n, void (f.endBytes = n + r - 1) } return (c = e.match(a)) ? (f.url = f.urlRaw = c[1], p.fragments.push(f), void (f = { index: t++ })) : void 0 } f.duration = parseFloat(c[1]) } }), p }(e) } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.TsLoader = void 0; var n = r(34), i = r(1), a = r(3), o = r(0), s = r(4), u = o.makeLogger("ts-loader"), d = function () { function TsLoader(e) { this._config = e, a.bindAll(this) } return TsLoader.prototype.load = function (e) { this._request && (u.log("abort last ts request, need reset player: " + this._request.url), this._request.dispose(), this._request = null), this._request = new n.StreamRequest(this._config), this._request.onData = this.onData, this._request.onEnd = this._onEnd, this._request.onError = this._onError, this._request.load(e) }, TsLoader.prototype.dispose = function () { this._request && (this._request.dispose(), this._request = null), this.onData = null, this.onEnd = null, this.onError = null }, TsLoader.prototype._onEnd = function () { this._finish(), this.onEnd() }, TsLoader.prototype._onError = function (e) { this._finish(), this.onError(new i.DyError(e, i.ErrorIds.HlsTsNetworkError, !1)) }, TsLoader.prototype._finish = function () { this._request && (this._config.__internal.eventbus.emit(s.InternalEvents.STAT, { data: this._request.getStatistics() }), this._request.dispose(), this._request = null) }, TsLoader }(); t.TsLoader = d }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.StreamRequest = void 0; var n = r(12), i = r(0), a = r(3), o = i.makeLogger("stream-request"), s = { timeout: 0, retryTimes: 0, retryInterval: 200 }, u = function () { function StreamRequest(e) { this._retryTimes = 0, this._continueBytes = 0, this._loadedBytes = 0, this._config = e, a.bindAll(this) } return Object.defineProperty(StreamRequest.prototype, "url", { get: function () { return this._options.url }, enumerable: !1, configurable: !0 }), StreamRequest.prototype.dispose = function () { clearTimeout(this._delayTimer), clearTimeout(this._timeoutTimer), this.onData = null, this.onEnd = null, this.onError = null, this._loader && (this._loader.dispose(), this._loader = null) }, StreamRequest.prototype.load = function (e) { clearTimeout(this._delayTimer), clearTimeout(this._timeoutTimer), this._loader && (this._loader.dispose(), this._loader = null), this._options = Object.assign({}, s, e), this._loader = n.createLoader({ url: this._options.url }), this._loader.onData = this._onLoadData, this._loader.onEnd = this._onLoadEnd, this._loader.onError = this._onLoadError, this._loader.load(this._options.url, this._config, this._options.extra), this._options.timeout > 0 && (this._timeoutTimer = setTimeout(this._onTimeout, this._options.timeout)), this._continueBytes = this._loadedBytes, this._loadedBytes = 0, o.log("request " + this._options.url + ", extra=" + JSON.stringify(this._options.extra) + ", timeout=" + this._options.timeout) }, StreamRequest.prototype.getStatistics = function () { var e; return null === (e = this._loader) || void 0 === e ? void 0 : e.getStatistics() }, StreamRequest.prototype._onLoadData = function (e) { if (this._loadedBytes += e.byteLength, this._continueBytes) { if (this._loadedBytes <= this._continueBytes) return; var t = e.byteLength + this._continueBytes - this._loadedBytes; t > 0 && (e = e.slice(t)), this._continueBytes = 0 } this.onData(e) }, StreamRequest.prototype._onTimeout = function () { this._onError("request " + this._options.url + " timeout, exceed " + this._options.timeout + "ms") }, StreamRequest.prototype._onLoadError = function (e) { clearTimeout(this._timeoutTimer), this._onError("request " + this._options.url + " error: " + e) }, StreamRequest.prototype._onLoadEnd = function () { clearTimeout(this._timeoutTimer), this.onEnd() }, StreamRequest.prototype._onError = function (e) { var t = this; if (o.log(e), this._retryTimes >= this._options.retryTimes) { var r = "request failed: " + e; return o.warn(r), void (this.onError && this.onError(r)) } this._delayTimer = setTimeout(function () { t._retryTimes++, t.load(t._options), o.log("retry request " + t._options.url + " " + t._retryTimes + " times.") }, this._options.retryInterval) }, StreamRequest }(); t.StreamRequest = u }, function (e, t) { e.exports = Long; var r = null; try { r = new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 13, 2, 96, 0, 1, 127, 96, 4, 127, 127, 127, 127, 1, 127, 3, 7, 6, 0, 1, 1, 1, 1, 1, 6, 6, 1, 127, 1, 65, 0, 11, 7, 50, 6, 3, 109, 117, 108, 0, 1, 5, 100, 105, 118, 95, 115, 0, 2, 5, 100, 105, 118, 95, 117, 0, 3, 5, 114, 101, 109, 95, 115, 0, 4, 5, 114, 101, 109, 95, 117, 0, 5, 8, 103, 101, 116, 95, 104, 105, 103, 104, 0, 0, 10, 191, 1, 6, 4, 0, 35, 0, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 126, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 127, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 128, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 129, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 130, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11])), {}).exports } catch (e) { } function Long(e, t, r) { this.low = 0 | e, this.high = 0 | t, this.unsigned = !!r } function isLong(e) { return !0 === (e && e.__isLong__) } Long.prototype.__isLong__, Object.defineProperty(Long.prototype, "__isLong__", { value: !0 }), Long.isLong = isLong; var n = {}, i = {}; function fromInt(e, t) { var r, a, o; return t ? (o = 0 <= (e >>>= 0) && e < 256) && (a = i[e]) ? a : (r = fromBits(e, (0 | e) < 0 ? -1 : 0, !0), o && (i[e] = r), r) : (o = -128 <= (e |= 0) && e < 128) && (a = n[e]) ? a : (r = fromBits(e, e < 0 ? -1 : 0, !1), o && (n[e] = r), r) } function fromNumber(e, t) { if (isNaN(e)) return t ? l : c; if (t) { if (e < 0) return l; if (e >= s) return m } else { if (e <= -u) return y; if (e + 1 >= u) return _ } return e < 0 ? fromNumber(-e, t).neg() : fromBits(e % o | 0, e / o | 0, t) } function fromBits(e, t, r) { return new Long(e, t, r) } Long.fromInt = fromInt, Long.fromNumber = fromNumber, Long.fromBits = fromBits; var a = Math.pow; function fromString(e, t, r) { if (0 === e.length) throw Error("empty string"); if ("NaN" === e || "Infinity" === e || "+Infinity" === e || "-Infinity" === e) return c; if ("number" === typeof t ? (r = t, t = !1) : t = !!t, (r = r || 10) < 2 || 36 < r) throw RangeError("radix"); var n; if ((n = e.indexOf("-")) > 0) throw Error("interior hyphen"); if (0 === n) return fromString(e.substring(1), t, r).neg(); for (var i = fromNumber(a(r, 8)), o = c, s = 0; s < e.length; s += 8) { var u = Math.min(8, e.length - s), d = parseInt(e.substring(s, s + u), r); if (u < 8) { var l = fromNumber(a(r, u)); o = o.mul(l).add(fromNumber(d)) } else o = (o = o.mul(i)).add(fromNumber(d)) } return o.unsigned = t, o } function fromValue(e, t) { return "number" === typeof e ? fromNumber(e, t) : "string" === typeof e ? fromString(e, t) : fromBits(e.low, e.high, "boolean" === typeof t ? t : e.unsigned) } Long.fromString = fromString, Long.fromValue = fromValue; var o = 4294967296, s = o * o, u = s / 2, d = fromInt(1 << 24), c = fromInt(0); Long.ZERO = c; var l = fromInt(0, !0); Long.UZERO = l; var p = fromInt(1); Long.ONE = p; var f = fromInt(1, !0); Long.UONE = f; var h = fromInt(-1); Long.NEG_ONE = h; var _ = fromBits(-1, 2147483647, !1); Long.MAX_VALUE = _; var m = fromBits(-1, -1, !0); Long.MAX_UNSIGNED_VALUE = m; var y = fromBits(0, -2147483648, !1); Long.MIN_VALUE = y; var v = Long.prototype; v.toInt = function toInt() { return this.unsigned ? this.low >>> 0 : this.low }, v.toNumber = function toNumber() { return this.unsigned ? (this.high >>> 0) * o + (this.low >>> 0) : this.high * o + (this.low >>> 0) }, v.toString = function toString(e) { if ((e = e || 10) < 2 || 36 < e) throw RangeError("radix"); if (this.isZero()) return "0"; if (this.isNegative()) { if (this.eq(y)) { var t = fromNumber(e), r = this.div(t), n = r.mul(t).sub(this); return r.toString(e) + n.toInt().toString(e) } return "-" + this.neg().toString(e) } for (var i = fromNumber(a(e, 6), this.unsigned), o = this, s = ""; ;) { var u = o.div(i), d = (o.sub(u.mul(i)).toInt() >>> 0).toString(e); if ((o = u).isZero()) return d + s; for (; d.length < 6;)d = "0" + d; s = "" + d + s } }, v.getHighBits = function getHighBits() { return this.high }, v.getHighBitsUnsigned = function getHighBitsUnsigned() { return this.high >>> 0 }, v.getLowBits = function getLowBits() { return this.low }, v.getLowBitsUnsigned = function getLowBitsUnsigned() { return this.low >>> 0 }, v.getNumBitsAbs = function getNumBitsAbs() { if (this.isNegative()) return this.eq(y) ? 64 : this.neg().getNumBitsAbs(); for (var e = 0 != this.high ? this.high : this.low, t = 31; t > 0 && 0 == (e & 1 << t); t--); return 0 != this.high ? t + 33 : t + 1 }, v.isZero = function isZero() { return 0 === this.high && 0 === this.low }, v.eqz = v.isZero, v.isNegative = function isNegative() { return !this.unsigned && this.high < 0 }, v.isPositive = function isPositive() { return this.unsigned || this.high >= 0 }, v.isOdd = function isOdd() { return 1 === (1 & this.low) }, v.isEven = function isEven() { return 0 === (1 & this.low) }, v.equals = function equals(e) { return isLong(e) || (e = fromValue(e)), (this.unsigned === e.unsigned || this.high >>> 31 !== 1 || e.high >>> 31 !== 1) && (this.high === e.high && this.low === e.low) }, v.eq = v.equals, v.notEquals = function notEquals(e) { return !this.eq(e) }, v.neq = v.notEquals, v.ne = v.notEquals, v.lessThan = function lessThan(e) { return this.comp(e) < 0 }, v.lt = v.lessThan, v.lessThanOrEqual = function lessThanOrEqual(e) { return this.comp(e) <= 0 }, v.lte = v.lessThanOrEqual, v.le = v.lessThanOrEqual, v.greaterThan = function greaterThan(e) { return this.comp(e) > 0 }, v.gt = v.greaterThan, v.greaterThanOrEqual = function greaterThanOrEqual(e) { return this.comp(e) >= 0 }, v.gte = v.greaterThanOrEqual, v.ge = v.greaterThanOrEqual, v.compare = function compare(e) { if (isLong(e) || (e = fromValue(e)), this.eq(e)) return 0; var t = this.isNegative(), r = e.isNegative(); return t && !r ? -1 : !t && r ? 1 : this.unsigned ? e.high >>> 0 > this.high >>> 0 || e.high === this.high && e.low >>> 0 > this.low >>> 0 ? -1 : 1 : this.sub(e).isNegative() ? -1 : 1 }, v.comp = v.compare, v.negate = function negate() { return !this.unsigned && this.eq(y) ? y : this.not().add(p) }, v.neg = v.negate, v.add = function add(e) { isLong(e) || (e = fromValue(e)); var t = this.high >>> 16, r = 65535 & this.high, n = this.low >>> 16, i = 65535 & this.low, a = e.high >>> 16, o = 65535 & e.high, s = e.low >>> 16, u = 0, d = 0, c = 0, l = 0; return c += (l += i + (65535 & e.low)) >>> 16, d += (c += n + s) >>> 16, u += (d += r + o) >>> 16, u += t + a, fromBits((c &= 65535) << 16 | (l &= 65535), (u &= 65535) << 16 | (d &= 65535), this.unsigned) }, v.subtract = function subtract(e) { return isLong(e) || (e = fromValue(e)), this.add(e.neg()) }, v.sub = v.subtract, v.multiply = function multiply(e) { if (this.isZero()) return c; if (isLong(e) || (e = fromValue(e)), r) return fromBits(r.mul(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned); if (e.isZero()) return c; if (this.eq(y)) return e.isOdd() ? y : c; if (e.eq(y)) return this.isOdd() ? y : c; if (this.isNegative()) return e.isNegative() ? this.neg().mul(e.neg()) : this.neg().mul(e).neg(); if (e.isNegative()) return this.mul(e.neg()).neg(); if (this.lt(d) && e.lt(d)) return fromNumber(this.toNumber() * e.toNumber(), this.unsigned); var t = this.high >>> 16, n = 65535 & this.high, i = this.low >>> 16, a = 65535 & this.low, o = e.high >>> 16, s = 65535 & e.high, u = e.low >>> 16, l = 65535 & e.low, p = 0, f = 0, h = 0, _ = 0; return h += (_ += a * l) >>> 16, f += (h += i * l) >>> 16, h &= 65535, f += (h += a * u) >>> 16, p += (f += n * l) >>> 16, f &= 65535, p += (f += i * u) >>> 16, f &= 65535, p += (f += a * s) >>> 16, p += t * l + n * u + i * s + a * o, fromBits((h &= 65535) << 16 | (_ &= 65535), (p &= 65535) << 16 | (f &= 65535), this.unsigned) }, v.mul = v.multiply, v.divide = function divide(e) { if (isLong(e) || (e = fromValue(e)), e.isZero()) throw Error("division by zero"); var t, n, i; if (r) return this.unsigned || -2147483648 !== this.high || -1 !== e.low || -1 !== e.high ? fromBits((this.unsigned ? r.div_u : r.div_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this; if (this.isZero()) return this.unsigned ? l : c; if (this.unsigned) { if (e.unsigned || (e = e.toUnsigned()), e.gt(this)) return l; if (e.gt(this.shru(1))) return f; i = l } else { if (this.eq(y)) return e.eq(p) || e.eq(h) ? y : e.eq(y) ? p : (t = this.shr(1).div(e).shl(1)).eq(c) ? e.isNegative() ? p : h : (n = this.sub(e.mul(t)), i = t.add(n.div(e))); else if (e.eq(y)) return this.unsigned ? l : c; if (this.isNegative()) return e.isNegative() ? this.neg().div(e.neg()) : this.neg().div(e).neg(); if (e.isNegative()) return this.div(e.neg()).neg(); i = c } for (n = this; n.gte(e);) { t = Math.max(1, Math.floor(n.toNumber() / e.toNumber())); for (var o = Math.ceil(Math.log(t) / Math.LN2), s = o <= 48 ? 1 : a(2, o - 48), u = fromNumber(t), d = u.mul(e); d.isNegative() || d.gt(n);)d = (u = fromNumber(t -= s, this.unsigned)).mul(e); u.isZero() && (u = p), i = i.add(u), n = n.sub(d) } return i }, v.div = v.divide, v.modulo = function modulo(e) { return isLong(e) || (e = fromValue(e)), r ? fromBits((this.unsigned ? r.rem_u : r.rem_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this.sub(this.div(e).mul(e)) }, v.mod = v.modulo, v.rem = v.modulo, v.not = function not() { return fromBits(~this.low, ~this.high, this.unsigned) }, v.and = function and(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low & e.low, this.high & e.high, this.unsigned) }, v.or = function or(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low | e.low, this.high | e.high, this.unsigned) }, v.xor = function xor(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low ^ e.low, this.high ^ e.high, this.unsigned) }, v.shiftLeft = function shiftLeft(e) { return isLong(e) && (e = e.toInt()), 0 === (e &= 63) ? this : e < 32 ? fromBits(this.low << e, this.high << e | this.low >>> 32 - e, this.unsigned) : fromBits(0, this.low << e - 32, this.unsigned) }, v.shl = v.shiftLeft, v.shiftRight = function shiftRight(e) { return isLong(e) && (e = e.toInt()), 0 === (e &= 63) ? this : e < 32 ? fromBits(this.low >>> e | this.high << 32 - e, this.high >> e, this.unsigned) : fromBits(this.high >> e - 32, this.high >= 0 ? 0 : -1, this.unsigned) }, v.shr = v.shiftRight, v.shiftRightUnsigned = function shiftRightUnsigned(e) { if (isLong(e) && (e = e.toInt()), 0 === (e &= 63)) return this; var t = this.high; return e < 32 ? fromBits(this.low >>> e | t << 32 - e, t >>> e, this.unsigned) : fromBits(32 === e ? t : t >>> e - 32, 0, this.unsigned) }, v.shru = v.shiftRightUnsigned, v.shr_u = v.shiftRightUnsigned, v.toSigned = function toSigned() { return this.unsigned ? fromBits(this.low, this.high, !1) : this }, v.toUnsigned = function toUnsigned() { return this.unsigned ? this : fromBits(this.low, this.high, !0) }, v.toBytes = function toBytes(e) { return e ? this.toBytesLE() : this.toBytesBE() }, v.toBytesLE = function toBytesLE() { var e = this.high, t = this.low; return [255 & t, t >>> 8 & 255, t >>> 16 & 255, t >>> 24, 255 & e, e >>> 8 & 255, e >>> 16 & 255, e >>> 24] }, v.toBytesBE = function toBytesBE() { var e = this.high, t = this.low; return [e >>> 24, e >>> 16 & 255, e >>> 8 & 255, 255 & e, t >>> 24, t >>> 16 & 255, t >>> 8 & 255, 255 & t] }, Long.fromBytes = function fromBytes(e, t, r) { return r ? Long.fromBytesLE(e, t) : Long.fromBytesBE(e, t) }, Long.fromBytesLE = function fromBytesLE(e, t) { return new Long(e[0] | e[1] << 8 | e[2] << 16 | e[3] << 24, e[4] | e[5] << 8 | e[6] << 16 | e[7] << 24, t) }, Long.fromBytesBE = function fromBytesBE(e, t) { return new Long(e[4] << 24 | e[5] << 16 | e[6] << 8 | e[7], e[0] << 24 | e[1] << 16 | e[2] << 8 | e[3], t) } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.request = t.RequestError = void 0; var a = r(0).makeLogger("request"), o = function (e) { function RequestError(t, r) { var n = e.call(this, t) || this; return n.response = r, n } return i(RequestError, e), RequestError }(Error); t.RequestError = o; var s = { method: "get", type: "text", retryTimes: 0, retryDelay: 200 }; function setResponse(e, t) { e.status = t.status, e.statusText = t.statusText, e.data = t.response } t.request = function request(e) { var t, r, n, i = Object.assign({}, s, e), u = i.url, d = i.method, c = i.type, l = i.timeout, p = i.retryTimes, f = i.retryDelay, h = new Promise(function (i, s) { var h = {}, _ = function (d) { if (p < 1) return a.warn("request " + u + " failed"), setResponse(h, t), void s(new o(d, h)); r = setTimeout(function () { a.log("retry request " + u + ", remain times: " + (p - 1)), (n = request(Object.assign({}, e, { retryTimes: p - 1 }))).then(i).catch(s) }, f) }; (t = new XMLHttpRequest).responseType = c, t.open(d.toUpperCase(), u, !0), l && (t.timeout = l), t.onerror = function () { return _("Network error, status=" + t.status + ", statusText=" + t.statusText) }, t.ontimeout = function () { return _("Network timeout exceed " + l + "ms, , status=" + t.status + ", statusText=" + t.statusText) }, t.onload = function () { setResponse(h, t), t.status >= 200 && t.status < 300 ? i(h) : _("Network error, status=" + t.status + ", statusText=" + t.statusText) }, t.send(null) }); return h.cancel = function (e) { void 0 === e && (e = "cancel"), clearTimeout(r), n && n.cancel(e), t && t.abort() }, h.url = u, h } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BitrateControl = void 0; r(0).makeLogger("bitrate-control"); var n = function () { function BitrateControl() { this._byteLength = 0, this._startTime = 0, this._endTime = 0, this._dispatchTime = 0 } return BitrateControl.prototype.startDownload = function (e) { this._fragment = e, this._startTime = Date.now(), this._byteLength = 0 }, BitrateControl.prototype.receiveData = function (e) { e instanceof ArrayBuffer && (this._byteLength += e.byteLength) }, BitrateControl.prototype.endDownload = function () { this._endTime = Date.now(); var e = (this._endTime - this._startTime) / 1e3, t = 8 * this._byteLength / e, r = Date.now(); r - this._dispatchTime > 3e4 && (this.onBitrate(t), this._dispatchTime = r) }, BitrateControl }(); t.BitrateControl = n }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.MediaManager = void 0; var i = r(3), a = r(2), o = r(0), s = r(1), u = n(r(18)), d = o.makeLogger("media-manager"), c = function () { function MediaManager(e, t, n) { this._destroyed = !1, i.bindAll(this), this._config = n; var o = n.enableWorker, s = n.debug; this._mediaHandler = t, this._mediaHandler.onError = this._onError, this.attachLoader(e), o ? (this._transmuxer = r(13)(18), this._transmuxer.postMessage({ name: "setLoggerEnable", params: s }, void 0), d.log("transmuxe with worker")) : (this._transmuxer = new u.default, d.log("transmuxe with no worker")), a.connectEventbus(this._transmuxer, this._onMessage, this._config) } return MediaManager.prototype.init = function () { this._transmuxer.postMessage({ name: "init", params: a.configClone(this._transmuxer, this._config) }) }, MediaManager.prototype.dispose = function () { this._destroyed = !0, this.onError = null, this._mediaHandler = null, this._loader = null, this._transmuxer.terminate(), this._transmuxer = null }, MediaManager.prototype.attachLoader = function (e) { this._loader = e, this._loader.onData = this.appendData, this._loader.onEnd = this.appendEnd, this._loader.onError = this._onLoaderError, this._loader.attachMedia(this._mediaHandler) }, MediaManager.prototype.appendData = function (e) { if (!this._destroyed) if (e instanceof ArrayBuffer) this._transmuxer.postMessage({ name: "appendData", params: e }, [e]); else { var t = []; this._config.enableWorker && e.data && (e.data = a.u8aClone(e.data), t.push(e.data.buffer)), this._transmuxer.postMessage({ name: "appendData", params: e }, t) } }, MediaManager.prototype.appendEnd = function () { d.log("loader end"), this._transmuxer.postMessage({ name: "appendEnd" }, void 0) }, MediaManager.prototype.changeFormat = function (e) { this._transmuxer.postMessage({ name: "changeFormat", params: e }, void 0) }, MediaManager.prototype._onRemuxData = function (e) { this._mediaHandler && this._mediaHandler.appendData(e) }, MediaManager.prototype._onError = function (e) { this.onError && (!e || e instanceof Error || !e.name || (e = s.errorRestore(e)), this.onError(e)) }, MediaManager.prototype._onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "_onRemuxData": this._onRemuxData(n); break; case "_onError": this._onError(n) } } catch (e) { d.warn("call " + r + " error", e) } }, MediaManager.prototype._onLoaderError = function (e) { e instanceof Error ? void 0 === e.errorId && (e.errorId = s.ErrorIds.CustomLoaderError, e.fatal = !0) : e = new s.DyError("custom loader error: " + e, s.ErrorIds.CustomLoaderError), this._onError(e) }, MediaManager }(); t.MediaManager = c }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__generator || function (e, t) { var r, n, i, a, o = { label: 0, sent: function () { if (1 & i[0]) throw i[1]; return i[1] }, trys: [], ops: [] }; return a = { next: verb(0), throw: verb(1), return: verb(2) }, "function" === typeof Symbol && (a[Symbol.iterator] = function () { return this }), a; function verb(a) { return function (s) { return function step(a) { if (r) throw new TypeError("Generator is already executing."); for (; o;)try { if (r = 1, n && (i = 2 & a[0] ? n.return : a[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, a[1])).done) return i; switch (n = 0, i && (a = [2 & a[0], i.value]), a[0]) { case 0: case 1: i = a; break; case 4: return o.label++, { value: a[1], done: !1 }; case 5: o.label++, n = a[1], a = [0]; continue; case 7: a = o.ops.pop(), o.trys.pop(); continue; default: if (!(i = (i = o.trys).length > 0 && i[i.length - 1]) && (6 === a[0] || 2 === a[0])) { o = 0; continue } if (3 === a[0] && (!i || a[1] > i[0] && a[1] < i[3])) { o.label = a[1]; break } if (6 === a[0] && o.label < i[1]) { o.label = i[1], i = a; break } if (i && o.label < i[2]) { o.label = i[2], o.ops.push(a); break } i[2] && o.ops.pop(), o.trys.pop(); continue }a = t.call(e, o) } catch (e) { a = [6, e], n = 0 } finally { r = i = 0 } if (5 & a[0]) throw a[1]; return { value: a[0] ? a[1] : void 0, done: !0 } }([a, s]) } } }, s = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var u, d = s(r(9)), c = s(r(40)), l = r(20), p = r(5), f = r(1), h = r(0), _ = r(4), m = h.makeLogger("flv-demuxer"); !function (e) { e[e.WAIT_FLV_FLAG = 0] = "WAIT_FLV_FLAG", e[e.WAIT_PRE_TAG_SIZE = 1] = "WAIT_PRE_TAG_SIZE", e[e.WAIT_TAG = 2] = "WAIT_TAG" }(u || (u = {})); var y = function (e) { function FlvDemuxer(t) { var r = e.call(this, t) || this; return r.TAG = "FlvDemuxer", r._destroyed = !1, r._flvSoundRateTable = [5500, 11025, 22050, 44100, 48e3], r._status = u.WAIT_FLV_FLAG, r._lastParseTime = 0, r._tracks = [], r._needMp3Header = !0, r._byteArray = new d.default({ initLength: r._config.stashBuffer, autoClear: !0 }), r } return i(FlvDemuxer, e), FlvDemuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._parser && (this._parser.return("dispose"), this._parser = null), this._byteArray = null, this._audioConfig = null, this._videoConfig = null, this._tracks = [], this._destroyed = !0, m.log("disposed") }, FlvDemuxer.prototype._appendArrayBuffer = function (e) { this._byteArray.write(e), this._parseData() }, FlvDemuxer.prototype._appendEnd = function () { this._parseData(!0), this._parser && this._parser.return("end"), e.prototype._appendEnd.call(this) }, FlvDemuxer.prototype._parseData = function (e) { if (void 0 === e && (e = !1), this._byteArray.byteAvailable > 0) { this._parser || (this._parser = this._parse()); var t = Date.now(); if (e || !this._hasFirstFrame || this._byteArray.byteAvailable > this._config.stashBuffer || t - this._lastParseTime > this._config.stashTime) { this._lastParseTime = t; var r = this._parser.next().value; if (r && r.name === f.DyDemuxError.name) return void this._error(r); this._tracks.splice(0).forEach(this._dispatchTrack) } } }, FlvDemuxer.prototype._parse = function () { var e, t, r, n, i, a, s, d, c, l; return o(this, function (o) { switch (o.label) { case 0: switch (this._status) { case u.WAIT_FLV_FLAG: return [3, 1]; case u.WAIT_PRE_TAG_SIZE: return [3, 4]; case u.WAIT_TAG: return [3, 7] }return [3, 13]; case 1: return this._byteArray.byteAvailable < 9 ? [4] : [3, 3]; case 2: return o.sent(), [3, 1]; case 3: return "FLV" !== (e = this._byteArray.readString(3)) ? [2, new f.DyDemuxError("Not valid flv file : " + e, f.ErrorIds.InvalidFlv)] : (this._byteArray.readUint8(), t = this._byteArray.readUint8(), !!(4 & t) && !!(1 & t) || (this._trackLength = 1), this._byteArray.read(4), this._status = u.WAIT_PRE_TAG_SIZE, [3, 13]); case 4: return this._byteArray.byteAvailable < 4 ? [4] : [3, 6]; case 5: return o.sent(), [3, 4]; case 6: return this._byteArray.read(4), this._status = u.WAIT_TAG, [3, 13]; case 7: return this._byteArray.byteAvailable < 11 ? [4] : [3, 9]; case 8: return o.sent(), [3, 7]; case 9: r = this._byteArray.readUint8(), n = this._byteArray.readUint24(), i = this._byteArray.readUint24(), a = this._byteArray.readUint8(), s = (a << 24 | i) >>> 0, this._byteArray.readUint24(), o.label = 10; case 10: return this._byteArray.byteAvailable < n ? [4] : [3, 12]; case 11: return o.sent(), [3, 10]; case 12: switch (d = this._byteArray.bytePosition, c = this._byteArray.read(n), l = void 0, r) { case 8: !1 !== this._config.hasAudio && (l = this._parseAudio(c, s)); break; case 9: !1 !== this._config.hasVideo && (l = this._parseVideo(c, s, d)); break; case 18: this._parseScript(c); break; default: m.warn("unsupport flv tag type", r) }return this._status = u.WAIT_PRE_TAG_SIZE, l ? [2, l] : [3, 13]; case 13: return [3, 0]; case 14: return [2] } }) }, FlvDemuxer.prototype._error = function (e) { this.onError && this.onError(e) }, FlvDemuxer.prototype._parseAudio = function (e, t) { var r = new d.default({ buffer: e }), n = r.readUint8(), i = (240 & n) >> 4, o = (12 & n) >> 2, s = 1 & n, u = r.read(r.byteAvailable), c = this._audioConfig; if (c.channelCount = 0 === s ? 1 : 2, c.audioSampleRate = this._flvSoundRateTable[o], 10 === i) { var l = new Uint8Array(u), h = l[0], _ = l.subarray(1), y = { type: "audio", trackId: c.trackId, dts: t, pts: t, codec: p.Codec.AAC, config: c, data: _ }; 0 === h ? (y.flag = "CFG", this._pushTrack(y)) : 1 === h ? this._pushTrack(y) : m.warn(this.TAG, "Flv: Unsupported AAC data type " + h) } else { if (2 !== i) return new f.DyDemuxError("unsupport audio type = " + i, f.ErrorIds.UnsupportedFlvAudio); var v = new Uint8Array(u); y = { type: "audio", trackId: c.trackId, dts: t, pts: t, codec: p.Codec.MP3, config: c, data: v }; if (this._needMp3Header) { var g = a(a({}, y), { flag: "CFG", data: new Uint8Array(u.slice(0, 4)) }); this._pushTrack(g), this._needMp3Header = !1 } this._pushTrack(y) } }, FlvDemuxer.prototype._parseVideo = function (e, t, r) { var n = new d.default({ buffer: e }), i = n.readUint8(), a = (240 & i) >> 4, o = 15 & i; if (7 !== o && 12 !== o) return new f.DyDemuxError("unsupport video codec type = " + o, f.ErrorIds.UnsupportedFlvVideo); var s = n.read(n.byteAvailable); return this._parseVideoPacket(s, 0, s.byteLength, t, r, a, o) }, FlvDemuxer.prototype._parseScript = function (e) { var t = c.default.parseScriptData(e, 0, e.byteLength); if ("onMetaData" in t) { var r = t.onMetaData; "number" === typeof r.audiodatarate && void 0 === this._audioConfig.dataRate && (this._audioConfig.dataRate = r.audiodatarate), "number" === typeof r.videodatarate && void 0 === this._videoConfig.dataRate && (this._videoConfig.dataRate = r.videodatarate), this._config.__internal.eventbus.emit(_.InternalEvents.METADATA, r), m.log(this.TAG, "Parsed onMetaData", r) } }, FlvDemuxer.prototype._parseVideoPacket = function (e, t, r, n, i, a, o) { if (r < 4) m.warn(this.TAG, "Flv: Invalid Video packet, missing PacketType or/and CompositionTime"); else { var s = new DataView(e, t, r), u = s.getUint8(0), d = (16777215 & s.getUint32(0, !1)) << 8 >> 8, c = this._videoConfig, l = new Uint8Array(e, t + 4, r - 4), h = { type: "video", trackId: c.trackId, dts: n, pts: n + d, codec: 12 === o ? p.Codec.H265 : p.Codec.H264, config: c, data: l, isKeyframe: 1 === a }; if (0 === u) h.flag = "CFG", this._pushTrack(h); else if (1 === u) this._pushTrack(h); else if (2 !== u) return new f.DyDemuxError("Flv: Invalid video packet type " + u, f.ErrorIds.InvalidFlvVideoPacket) } }, FlvDemuxer.prototype._pushTrack = function (e) { this._tracks.push(e) }, FlvDemuxer.prototype._dispatchTrack = function (e) { this._destroyed || this._appendTrack(e) }, FlvDemuxer.prototype._resetTrack = function (t) { e.prototype._resetTrack.call(this, t), this._byteArray.reset(), this._status = u.WAIT_FLV_FLAG, this._tracks = [], this._needMp3Header = !0, this._hasFirstFrame = !1, this._parser && (this._parser.return("reset"), this._parser = null) }, FlvDemuxer }(l.Demuxer); t.default = y }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var i, a = n(r(0)), o = n(r(41)), s = (i = new ArrayBuffer(2), new DataView(i).setInt16(0, 256, !0), 256 === new Int16Array(i)[0]), u = function () { function AMF() { } return AMF.parseScriptData = function (e, t, r) { var n = {}; try { var i = AMF.parseValue(e, t, r), o = AMF.parseValue(e, t + i.size, r - i.size); n[i.data] = o.data } catch (e) { a.default.error("AMF", e.toString()) } return n }, AMF.parseObject = function (e, t, r) { if (r < 3) throw new Error("Data not enough when parse ScriptDataObject"); var n = AMF.parseString(e, t, r), i = AMF.parseValue(e, t + n.size, r - n.size), a = i.objectEnd; return { data: { name: n.data, value: i.data }, size: n.size + i.size, objectEnd: a } }, AMF.parseVariable = function (e, t, r) { return AMF.parseObject(e, t, r) }, AMF.parseString = function (e, t, r) { if (r < 2) throw new Error("Data not enough when parse String"); var n = new DataView(e, t, r).getUint16(0, !s); return { data: n > 0 ? o.default(new Uint8Array(e, t + 2, n)) : "", size: 2 + n } }, AMF.parseLongString = function (e, t, r) { if (r < 4) throw new Error("Data not enough when parse LongString"); var n = new DataView(e, t, r).getUint32(0, !s); return { data: n > 0 ? o.default(new Uint8Array(e, t + 4, n)) : "", size: 4 + n } }, AMF.parseDate = function (e, t, r) { if (r < 10) throw new Error("Data size invalid when parse Date"); var n = new DataView(e, t, r), i = n.getFloat64(0, !s), a = n.getInt16(8, !s); return { data: new Date(i += 60 * a * 1e3), size: 10 } }, AMF.parseValue = function (e, t, r) { if (r < 1) throw new Error("Data not enough when parse Value"); var n, i = new DataView(e, t, r), o = 1, u = i.getUint8(0), d = !1; try { switch (u) { case 0: n = i.getFloat64(1, !s), o += 8; break; case 1: n = !!i.getUint8(1), o += 1; break; case 2: var c = AMF.parseString(e, t + 1, r - 1); n = c.data, o += c.size; break; case 3: n = {}; var l = 0; for (9 === (16777215 & i.getUint32(r - 4, !s)) && (l = 3); o < r - 4;) { var p = AMF.parseObject(e, t + o, r - o - l); if (p.objectEnd) break; n[p.data.name] = p.data.value, o += p.size } if (o <= r - 3) 9 === (16777215 & i.getUint32(o - 1, !s)) && (o += 3); break; case 8: n = {}, o += 4; l = 0; for (9 === (16777215 & i.getUint32(r - 4, !s)) && (l = 3); o < r - 8;) { var f = AMF.parseVariable(e, t + o, r - o - l); if (f.objectEnd) break; n[f.data.name] = f.data.value, o += f.size } if (o <= r - 3) 9 === (16777215 & i.getUint32(o - 1, !s)) && (o += 3); break; case 9: n = void 0, o = 1, d = !0; break; case 10: n = []; var h = i.getUint32(1, !s); o += 4; for (var _ = 0; _ < h; _++) { var m = AMF.parseValue(e, t + o, r - o); n.push(m.data), o += m.size } break; case 11: var y = AMF.parseDate(e, t + 1, r - 1); n = y.data, o += y.size; break; case 12: var v = AMF.parseString(e, t + 1, r - 1); n = v.data, o += v.size; break; default: o = r, a.default.warn("AMF", "Unsupported AMF value type " + u) } } catch (e) { a.default.error("AMF", e.toString()) } return { data: n, size: o, objectEnd: d } }, AMF }(); t.default = u }, function (e, t, r) { "use strict"; function checkContinuation(e, t, r) { var n = e; if (t + r < n.length) { for (; r--;)if (128 !== (192 & n[++t])) return !1; return !0 } return !1 } Object.defineProperty(t, "__esModule", { value: !0 }), t.default = function decodeUTF8(e) { for (var t = [], r = e, n = 0, i = e.length; n < i;)if (r[n] < 128) t.push(String.fromCharCode(r[n])), ++n; else { if (r[n] < 192); else if (r[n] < 224) { if (checkContinuation(r, n, 1) && (a = (31 & r[n]) << 6 | 63 & r[n + 1]) >= 128) { t.push(String.fromCharCode(65535 & a)), n += 2; continue } } else if (r[n] < 240) { if (checkContinuation(r, n, 2) && (a = (15 & r[n]) << 12 | (63 & r[n + 1]) << 6 | 63 & r[n + 2]) >= 2048 && 55296 !== (63488 & a)) { t.push(String.fromCharCode(65535 & a)), n += 3; continue } } else if (r[n] < 248) { var a; if (checkContinuation(r, n, 3) && (a = (7 & r[n]) << 18 | (63 & r[n + 1]) << 12 | (63 & r[n + 2]) << 6 | 63 & r[n + 3]) > 65536 && a < 1114112) { a -= 65536, t.push(String.fromCharCode(a >>> 10 | 55296)), t.push(String.fromCharCode(1023 & a | 56320)), n += 4; continue } } t.push(String.fromCharCode(65533)), ++n } return t.join("") } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.TsDemuxer = void 0; var s = r(19), u = r(0), d = o(r(9)), c = r(5), l = r(43), p = r(21), f = r(22), h = r(2), _ = u.makeLogger("ts-demuxer"), m = function (e) { function TsDemuxer(t) { var r = e.call(this, t) || this; return r._pmt = { streams: {} }, r._byteArray = new d.default({ initLength: r._config.stashBuffer, autoClear: !0 }), r } return i(TsDemuxer, e), TsDemuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._byteArray = null, this._pmt = null, this._audioConfig = null, this._videoConfig = null, _.log("disposed") }, TsDemuxer.prototype._appendArrayBuffer = function (e) { this._byteArray.write(e), this._parseTsPacket() }, TsDemuxer.prototype._parseTsPacket = function (e) { for (void 0 === e && (e = !1); this._byteArray.byteAvailable >= 188;) { var t = this._byteArray.read(188), r = new Uint8Array(t); if (0 === this._byteArray.byteAvailable && !e) return void this._byteArray.back(188); if (this._byteArray.byteAvailable > 0) { var n = this._byteArray.peekBytes(1)[0]; if (71 !== r[0] || 71 !== n) { _.log("invalid ts packet, trying find new ts"), this._resetPes(), this._byteArray.back(187), this._findTsPacket(); continue } } var i = r[1] >> 6 & 1, a = (31 & r[1]) << 8 | r[2], o = r[3] >> 4 & 3, s = 4; if (2 === o || 3 === o) { var u = r[s++]; s += u } if (0 !== a) { if (this._pmt.pid && a === this._pmt.pid) { g = r[s++], w = (s += g) + 3 + (b = (15 & r[s + 1]) << 8 | r[s + 2]) - 4; for (s += 12 + ((15 & r[s + 10]) << 8 | r[s + 11]); s < w;) { var l = r[s], p = (31 & r[s + 1]) << 8 | r[s + 2]; if (s += 5 + ((15 & r[s + 3]) << 8 | r[s + 4]), !this._pmt.streams[p]) { var f = void 0, h = void 0; switch (l) { case 27: f = "video", h = c.Codec.H264; break; case 36: f = "video", h = c.Codec.H265; break; case 15: f = "audio", h = c.Codec.AAC; break; case 3: f = "audio", h = c.Codec.MP3; break; case 21: break; default: _.warn("unsupport stream type: " + l + ", pid: " + p) }this._pmt.foundVideo && "video" === f ? _.warn("multiple video found, ignore this one: " + f + " " + h + " " + p) : this._pmt.foundAudio && "audio" === f ? _.warn("multiple audio found, ignore this one: " + f + " " + h + " " + p) : f && (this._pmt.streams[p] = { type: f, codec: h, pes: { ba: new d.default({ initLength: this._config.stashBuffer, autoClear: !0 }), waitStart: !0 } }, "video" === f ? this._pmt.foundVideo = !0 : this._pmt.foundAudio = !0, _.log("found stream: " + f + " " + h + " " + p)) } } } else if (this._pmt.streams[a]) { var m = this._pmt.streams[a].pes, y = r.subarray(s), v = this._isPesStart(y); if (m.waitStart && !v) { _.warn("ignore un-start packet pid=" + a + ", size=" + y.byteLength); continue } i && v && this._parsePes(a), m.ba.write(y), m.waitStart = !1 } } else { var g = r[s++], b = (15 & r[(s += g) + 1]) << 8 | r[s + 2]; if (!(1 & r[s + 5])) continue; var w = s + 3 + b - 4; for (s += 8; s < w;) { r[s] << 8 | r[s + 1] && (this._pmt.pid = (31 & r[s + 2]) << 8 | r[s + 3]), s += 4 } } } }, TsDemuxer.prototype._isPesStart = function (e) { return 0 === e[0] && 0 === e[1] && 1 === e[2] }, TsDemuxer.prototype._parsePes = function (e) { var t = this._pmt.streams[e], r = t.pes.ba; if (!(r.byteAvailable < 11)) { r.read(3); r.readUint8(), r.readUint16(), r.readUint8(); var n = r.readUint8(), i = (r.readUint8(), 536870912 * (14 & r.readUint8()) + (r.readUint16() >> 1 << 15) + (r.readUint16() >> 1)); i > 4294967295 && (i -= 8589934592); var a = i /= 90; 192 === n && ((a = 536870912 * (14 & r.readUint8()) + (r.readUint16() >> 1 << 15) + (r.readUint16() >> 1)) > 4294967295 && (a -= 8589934592), a /= 90); var o = r.read(r.byteAvailable), s = t.codec; switch (s) { case c.Codec.H264: case c.Codec.H265: this._parseNal(o, i, a, s); break; case c.Codec.AAC: this._parseAdts(o, i, a); break; case c.Codec.MP3: this._parseMp3(o, i, a); break; default: _.warn("unsupport codec=" + s) } } }, TsDemuxer.prototype._parseNal = function (e, t, r, n) { var i = this._videoConfig, o = new Uint8Array(e), s = { type: i.type, trackId: i.trackId, dts: r, pts: t, codec: n, config: i }, u = p.parseNal({ codec: n, bytes: o }); if (u.configNalus.length > 0) { var d = a(a({}, s), { flag: "CFG", data: o.slice(0), dataFormat: "nalu" }); this._appendTrack(d) } if (u.nals.length > 0) { var c = new l.BufferWriter(new ArrayBuffer(u.nalsLength + 4 * u.nals.length)); u.nals.forEach(function (e) { return c.writeUint32(e.naluData.byteLength).write(e.naluData) }), s.data = new Uint8Array(c.buf), this._appendTrack(s) } }, TsDemuxer.prototype._parseAdts = function (e, t, r) { for (var n = new Uint8Array(e), i = n.byteLength, o = this._audioConfig, s = { type: "audio", trackId: o.trackId, dts: r, pts: t, codec: c.Codec.AAC, config: o }, u = 0, d = 0; u < i;) { var l = n.slice(u, u + 7); if (!this._audioHeader || !h.isBufferEqual(this._audioHeader, l)) { this._audioHeader = l; var p = n[u + 2] >> 6, m = n[u + 2] >> 2 & 15, y = f.reference.mpegSamplingRates[m]; o.refSampleDuration = 1024 / y * 1e3; var v = (1 & n[u + 2]) << 2 | n[u + 3] >> 6, g = [], b = p + 1; g[0] = b << 3, g[0] |= (15 & m) >>> 1, g[1] = (15 & m) << 7, g[1] |= (15 & v) << 3, 5 === b && (o[1] |= (15 & m) >>> 1, o[2] = (1 & m) << 7, o[2] |= 8, o[3] = 0); var w = a(a({}, s), { flag: "CFG", data: new Uint8Array(g) }); this._appendTrack(w) } var E = (3 & n[u + 3]) << 11 | n[u + 4] << 3 | n[u + 5] >> 5 & 7, T = u + E, S = t + d * o.refSampleDuration; if (n.length < T) return void _.warn("imcomplete aac frame, aac_frame_length=" + E + ", missing bytes=" + (T - n.length)); this._appendTrack(a(a({}, s), { pts: S, dts: S, data: n.subarray(u + 7, T) })), u = T, d++ } }, TsDemuxer.prototype._parseMp3 = function (e, t, r) { var n = new Uint8Array(e), i = this._audioConfig, o = { type: "audio", trackId: i.trackId, dts: r, pts: t, codec: c.Codec.MP3, config: i, data: n }, s = n.slice(0, 4); if (!this._audioHeader || !h.isBufferEqual(this._audioHeader, s)) { this._audioHeader = s; var u = a(a({}, o), { flag: "CFG", data: s }); this._appendTrack(u) } this._appendTrack(o) }, TsDemuxer.prototype._resetTrack = function (t) { e.prototype._resetTrack.call(this, t), this._byteArray.reset(), this._resetPes() }, TsDemuxer.prototype._resetPes = function () { var e = this; Object.keys(this._pmt.streams).forEach(function (t) { var r = e._pmt.streams[t]; r.pes.ba.reset(), r.pes.waitStart = !0 }) }, TsDemuxer.prototype._flush = function () { var e = this; this._parseTsPacket(!0), Object.keys(this._pmt.streams).forEach(function (t) { e._parsePes(+t) }) }, TsDemuxer.prototype._appendEnd = function () { this._flush(), e.prototype._appendEnd.call(this) }, TsDemuxer.prototype._findTsPacket = function () { var e = this; this._byteArray.peekBytes().some(function (t, r) { if (71 === t) return _.log("find new ts packet, skip " + r + " bytes."), e._byteArray.skip(r), !0 }) }, TsDemuxer }(s.Demuxer); t.TsDemuxer = m }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BufferWriter = void 0; var n = function () { function BufferWriter(e) { this._offset = 0, this.buf = e, this.dv = new DataView(e), this.u8a = new Uint8Array(e) } return Object.defineProperty(BufferWriter.prototype, "offset", { get: function () { return this._offset }, enumerable: !1, configurable: !0 }), BufferWriter.prototype.write = function (e) { var t = e instanceof ArrayBuffer ? new Uint8Array(e) : e, r = t.length; return r > 0 && (this.u8a.set(t, this._offset), this._offset += r), this }, BufferWriter.prototype.writeString = function (e) { return e && e.length > 0 && this.write(e.split("").map(function (e) { return e.charCodeAt(0) })), this }, BufferWriter.prototype.writeInt8 = function (e) { return this.dv.setInt8(this._offset, e), this._offset += 1, this }, BufferWriter.prototype.writeInt16 = function (e, t) { return this.dv.setInt16(this._offset, e, t), this._offset += 2, this }, BufferWriter.prototype.writeInt32 = function (e, t) { return this.dv.setInt32(this._offset, e, t), this._offset += 4, this }, BufferWriter.prototype.writeUint8 = function (e) { return this.dv.setUint8(this._offset, e), this._offset += 1, this }, BufferWriter.prototype.writeUint16 = function (e, t) { return this.dv.setUint16(this._offset, e, t), this._offset += 2, this }, BufferWriter.prototype.writeUint32 = function (e, t) { return this.dv.setUint32(this._offset, e, t), this._offset += 4, this }, BufferWriter.prototype.skip = function (e) { return this._offset += e, this }, BufferWriter }(); t.BufferWriter = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function AAcFilParser() { } return AAcFilParser._getbits = function (e, t, r) { if (!r || t <= 0 || t > 8) return -1; var n, i, a = 0; if (i = 7 & e, a = r[n = e >> 3] << i & 255, a >>= 8 - t, i + t > 8) { if (void 0 === r[n + 1]) return -1; a |= r[n + 1] >> 16 - t - i } return a }, AAcFilParser.parseAacFilData = function (e) { for (var t = 0, r = 0, n = []; ;) { var i = 0, a = 0, o = 0, s = [1, 35, 69, 103, 137, 100, 111, 117, 121]; if (i = AAcFilParser._getbits(t, 3, e), t += 3, i < 0) return null; if (7 == i) return n; if (6 != i) return null; if (a = AAcFilParser._getbits(t, 4, e), t += 4, a < 0) return null; if (15 === a) { if (o = AAcFilParser._getbits(t, 8, e), t += 8, o < 0) return null; a += o - 1 } if (a < 9) return null; for (var u = 0; u < 9; u++) { if (t >> 3 >= e.length) return null; if (i = AAcFilParser._getbits(t, 8, e), t += 8, i != s[u]) return null } if (r + a - 9 > e.length) return null; for (u = 0; u < a - 9; u++) { if (t >> 3 >= e.length) return null; if (i = AAcFilParser._getbits(t, 8, e), t += 8, i < 0) return null; n[r++] = i } } return n }, AAcFilParser.getDbData = function (e) { if (!e) return null; var t = {}; if (e) { var r = 0; if (t.type = e[r++], 16 == t.type) { for (var n = e[r++], i = [], a = 0; a < n; a++) { var o = { uid: "", db: 0 }, s = e[r++], u = e[r++] - s; o.uid = ""; for (var d = 0; d < u; d++)o.uid += (e[r++] - 48).toString(); o.db = e[r++], i.push(o) } t.data = i } else t.data = e.slice(r) } return t }, AAcFilParser }(); t.default = n }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.Remuxer = void 0; var a = r(0), o = r(2), s = r(8), u = a.makeLogger("remuxer"), d = function (e) { function Remuxer(t) { var r = e.call(this) || this; return r._trackConfigs = {}, r._config = t, r } return i(Remuxer, e), Remuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._trackConfigs = {} }, Remuxer.prototype.append = function (e) { if (!this._destroyed) if ("CFG" === e.flag) { var t = e.config, r = this._trackConfigs[e.trackId]; o.isBufferEqual(null === r || void 0 === r ? void 0 : r.bytes, t.bytes) || (this._configChanged(t, r, e), this._trackConfigs[e.trackId] = Object.assign({}, t)) } else this._handleTrackData(e) }, Remuxer.prototype._handleTrackData = function (e) { this.onData(e) }, Remuxer.prototype._configChanged = function (e, t, r) { u.log("track config changed!", t, e) }, Remuxer }(s.BaseStream); t.Remuxer = d }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var s = o(r(47)), u = o(r(7)), d = r(23), c = r(0), l = r(2), p = c.makeLogger("mp4-remuxer"), f = function (e) { function Mp4Remuxer() { var t = null !== e && e.apply(this, arguments) || this; return t.TAG = "MP4Remuxer", t._useAudioMpeg = !1, t._isAudioTimeNeedUpdate = !1, t._trackInfos = {}, t } return i(Mp4Remuxer, e), Mp4Remuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._trackInfos = void 0 }, Mp4Remuxer.prototype._configChanged = function (e, t, r) { p.log("track config changed!", t, e); var n = a(a({}, e), { duration: l.timescaledTime64(e.duration, e.timescale) }); "audio" === e.type ? "mp3" !== e.detailCodec || u.default.firefox ? (e.mimeType = "audio/mp4; codecs=" + e.detailCodec, r.data = s.default.generateInitSegment(n), p.log("generate init audio segment")) : (e.mimeType = "audio/mpeg", this._useAudioMpeg = !0, this._isAudioTimeNeedUpdate = !0, delete r.data) : "video" === e.type && (e.mimeType = "video/mp4; codecs=" + e.detailCodec, r.data = s.default.generateInitSegment(n), p.log("generate init video segment")); var i = this._trackInfos[r.trackId]; i && i.lastTrack ? i.pendingConfigTrack = r : this.onData(r) }, Mp4Remuxer.prototype._handleTrackData = function (e) { var t = this._trackConfigs[e.trackId]; if (t) { if (e.config = t, "audio" === e.type && this._useAudioMpeg) return this._isAudioTimeNeedUpdate && (e.extradata.timeOffset = e.pts, this._isAudioTimeNeedUpdate = !1), void this.onData(e); var r = this._trackInfos[e.trackId]; if (r || (this._trackInfos[e.trackId] = r = { lastTrack: void 0, sequenceNumber: 1 }), e.isEnd || "RESET" === e.flag) return r.lastTrack && (r.lastTrack.duration = t.refSampleDuration, this._remuxTrack(r.lastTrack), r.lastTrack = null), e.duration = t.refSampleDuration, this.onData(e), void ("RESET" === e.flag && delete this._trackInfos[e.trackId]); e.data ? (r.lastTrack && (r.lastTrack.duration = e.dts - r.lastTrack.dts, (u.default.msedge || u.default.firefox) && "audio" === r.lastTrack.type && r.lastTrack.duration < this._config.audioDurationThreshold && (r.lastTrack.duration = e.config.refSampleDuration, e.dts = e.pts = r.lastTrack.dts + r.lastTrack.duration), this._remuxTrack(r.lastTrack), r.pendingConfigTrack && (this.onData(r.pendingConfigTrack), r.pendingConfigTrack = void 0)), r.lastTrack = e) : this.onData(e) } }, Mp4Remuxer.prototype._mergeBoxes = function (e, t) { var r = new Uint8Array(e.byteLength + t.byteLength); return r.set(e, 0), r.set(t, e.byteLength), r }, Mp4Remuxer.prototype._remuxAudio = function (e) { if (e.duration < 0 && (e.duration = 0), e.duration > this._config.audioDurationThreshold && !e.isFake && (p.warn("audio duration too long " + e.duration), e.extradata.jumpOverTs = e.pts + e.duration), e.data) { var t = { trackId: e.trackId, sequenceNumber: this._trackInfos[e.trackId].sequenceNumber++, samples: [{ duration: l.timescaledTime(e.duration, e.config.timescale), size: e.data.byteLength, cts: 0, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0, isNonSync: 0 } }] }, r = s.default.moof(t, l.timescaledTime64(e.dts, e.config.timescale)), n = s.default.mdat(e.data); e.data = this._mergeBoxes(r, n) } this.onData(e) }, Mp4Remuxer.prototype._remuxVideo = function (e) { e.duration < 0 && (e.duration = 0), e.duration > this._config.videoDurationThreshold && !e.isFake && p.warn("video duration too long " + e.duration); var t = e.isKeyframe; if (e.data) { var r = { trackId: e.trackId, sequenceNumber: this._trackInfos[e.trackId].sequenceNumber++, samples: [{ duration: l.timescaledTime(e.duration, e.config.timescale), size: e.data.byteLength, cts: l.timescaledTime(e.pts - e.dts, e.config.timescale), flags: { isLeading: 0, dependsOn: t ? 2 : 1, isDependedOn: t ? 1 : 0, hasRedundancy: 0, isNonSync: t ? 0 : 1 } }] }; if (u.default.chrome && (u.default.version.major < 50 || 50 === u.default.version.major && u.default.version.build < 2661)) { var n = r.samples[0].flags; n.dependsOn = 2, n.isNonSync = 0 } var i = s.default.moof(r, l.timescaledTime64(e.dts, e.config.timescale)), a = s.default.mdat(e.data); e.data = this._mergeBoxes(i, a) } this.onData(e) }, Mp4Remuxer.prototype._remuxTrack = function (e) { "audio" === e.type ? this._remuxAudio(e) : "video" === e.type && this._remuxVideo(e) }, Mp4Remuxer }(d.Remuxer); t.default = f }, function (e, t, r) { "use strict"; var n = this && this.__spreadArrays || function () { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; var n = Array(e), i = 0; for (t = 0; t < r; t++)for (var a = arguments[t], o = 0, s = a.length; o < s; o++, i++)n[i] = a[o]; return n }; Object.defineProperty(t, "__esModule", { value: !0 }); var i = function () { function MP4() { } return MP4.init = function () { for (var e in MP4.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [], ".mp3": [], hvc1: [], hvcC: [] }, MP4.types) MP4.types.hasOwnProperty(e) && (MP4.types[e] = [e.charCodeAt(0), e.charCodeAt(1), e.charCodeAt(2), e.charCodeAt(3)]); var t = MP4.constants = {}; t.FTYP = new Uint8Array([105, 115, 111, 109, 0, 0, 0, 1, 105, 115, 111, 109, 97, 118, 99, 49]), t.STSD_PREFIX = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), t.STTS = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), t.STSC = t.STCO = t.STTS, t.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), t.HDLR_VIDEO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), t.HDLR_AUDIO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), t.DREF = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), t.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), t.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) }, MP4.box = function (e) { for (var t = 8, r = null, n = Array.prototype.slice.call(arguments, 1), i = n.length, a = 0; a < i; a++)t += n[a].byteLength; (r = new Uint8Array(t))[0] = t >>> 24 & 255, r[1] = t >>> 16 & 255, r[2] = t >>> 8 & 255, r[3] = 255 & t, r.set(e, 4); var o = 8; for (a = 0; a < i; a++)r.set(n[a], o), o += n[a].byteLength; return r }, MP4.generateInitSegment = function (e) { var t = MP4.box(MP4.types.ftyp, MP4.constants.FTYP), r = MP4.moov(e), n = new Uint8Array(t.byteLength + r.byteLength); return n.set(t, 0), n.set(r, t.byteLength), n }, MP4.moov = function (e) { var t = MP4.mvhd(e.timescale, e.duration), r = MP4.trak(e), n = MP4.mvex(e); return MP4.box(MP4.types.moov, t, r, n) }, MP4.mvhd = function (e, t) { return MP4.box(MP4.types.mvhd, new Uint8Array(n([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, 255 & e], t.toBytesBE(), [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]))) }, MP4.trak = function (e) { return MP4.box(MP4.types.trak, MP4.tkhd(e), MP4.mdia(e)) }, MP4.tkhd = function (e) { var t = e.trackId, r = e.duration, i = e.presentWidth, a = e.presentHeight; return MP4.box(MP4.types.tkhd, new Uint8Array(n([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, 0, 0, 0, 0], r.toBytesBE(), [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, i >>> 8 & 255, 255 & i, 0, 0, a >>> 8 & 255, 255 & a, 0, 0]))) }, MP4.mdia = function (e) { return MP4.box(MP4.types.mdia, MP4.mdhd(e), MP4.hdlr(e), MP4.minf(e)) }, MP4.mdhd = function (e) { var t = e.timescale, r = e.duration; return MP4.box(MP4.types.mdhd, new Uint8Array(n([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t], r.toBytesBE(), [85, 196, 0, 0]))) }, MP4.hdlr = function (e) { var t = null; return t = "audio" === e.type ? MP4.constants.HDLR_AUDIO : MP4.constants.HDLR_VIDEO, MP4.box(MP4.types.hdlr, t) }, MP4.minf = function (e) { var t = null; return t = "audio" === e.type ? MP4.box(MP4.types.smhd, MP4.constants.SMHD) : MP4.box(MP4.types.vmhd, MP4.constants.VMHD), MP4.box(MP4.types.minf, t, MP4.dinf(), MP4.stbl(e)) }, MP4.dinf = function () { return MP4.box(MP4.types.dinf, MP4.box(MP4.types.dref, MP4.constants.DREF)) }, MP4.stbl = function (e) { return MP4.box(MP4.types.stbl, MP4.stsd(e), MP4.box(MP4.types.stts, MP4.constants.STTS), MP4.box(MP4.types.stsc, MP4.constants.STSC), MP4.box(MP4.types.stsz, MP4.constants.STSZ), MP4.box(MP4.types.stco, MP4.constants.STCO)) }, MP4.stsd = function (e) { return "audio" === e.type ? "mp3" === e.detailCodec ? MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp3(e)) : MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp4a(e)) : "h265" === e.codec ? MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.hvc1(e)) : MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.avc1(e)) }, MP4.mp3 = function (e) { var t = e.channelCount, r = e.audioSampleRate, n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t, 0, 16, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, 0, 0]); return MP4.box(MP4.types[".mp3"], n) }, MP4.mp4a = function (e) { var t = e.channelCount, r = e.audioSampleRate, n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t, 0, 16, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, 0, 0]); return MP4.box(MP4.types.mp4a, n, MP4.esds(e)) }, MP4.esds = function (e) { var t = n(e.bytes), r = t.length, i = new Uint8Array([0, 0, 0, 0, 3, 23 + r, 0, 1, 0, 4, 15 + r, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([r]).concat(t).concat([6, 1, 2])); return MP4.box(MP4.types.esds, i) }, MP4.avc1 = function (e) { var t = e.bytes, r = e.codecWidth, n = e.codecHeight, i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, n >>> 8 & 255, 255 & n, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 115, 107, 121, 45, 119, 97, 110, 103, 64, 113, 113, 46, 99, 111, 109, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return MP4.box(MP4.types.avc1, i, MP4.box(MP4.types.avcC, t)) }, MP4.hvc1 = function (e) { var t = e.bytes, r = e.codecWidth, n = e.codecHeight, i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, n >>> 8 & 255, 255 & n, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 115, 107, 121, 45, 119, 97, 110, 103, 64, 113, 113, 46, 99, 111, 109, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return MP4.box(MP4.types.hvc1, i, MP4.box(MP4.types.hvcC, t)) }, MP4.mvex = function (e) { return MP4.box(MP4.types.mvex, MP4.trex(e)) }, MP4.trex = function (e) { var t = e.trackId, r = new Uint8Array([0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return MP4.box(MP4.types.trex, r) }, MP4.moof = function (e, t) { return MP4.box(MP4.types.moof, MP4.mfhd(e.sequenceNumber), MP4.traf(e, t)) }, MP4.mfhd = function (e) { var t = new Uint8Array([0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, 255 & e]); return MP4.box(MP4.types.mfhd, t) }, MP4.traf = function (e, t) { var r = e.trackId, i = MP4.box(MP4.types.tfhd, new Uint8Array([0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r])), a = MP4.box(MP4.types.tfdt, new Uint8Array(n([1, 0, 0, 0], t.toBytesBE()))), o = MP4.sdtp(e), s = MP4.trun(e, o.byteLength + 16 + 16 + 8 + 16 + 8 + 8 + 4); return MP4.box(MP4.types.traf, i, a, s, o) }, MP4.sdtp = function (e) { for (var t = e.samples || [], r = t.length, n = new Uint8Array(4 + r), i = 0; i < r; i++) { var a = t[i].flags; n[i + 4] = a.isLeading << 6 | a.dependsOn << 4 | a.isDependedOn << 2 | a.hasRedundancy } return MP4.box(MP4.types.sdtp, n) }, MP4.trun = function (e, t) { var r = e.samples || [], n = r.length, i = 12 + 16 * n, a = new Uint8Array(i); t += 8 + i, a.set([0, 0, 15, 1, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t], 0); for (var o = 0; o < n; o++) { var s = r[o].duration, u = r[o].size, d = r[o].flags, c = r[o].cts; a.set([s >>> 24 & 255, s >>> 16 & 255, s >>> 8 & 255, 255 & s, u >>> 24 & 255, u >>> 16 & 255, u >>> 8 & 255, 255 & u, d.isLeading << 2 | d.dependsOn, d.isDependedOn << 6 | d.hasRedundancy << 4 | d.isNonSync, 0, 0, c >>> 24 & 255, c >>> 16 & 255, c >>> 8 & 255, 255 & c], 12 + 16 * o) } return MP4.box(MP4.types.trun, a) }, MP4.mdat = function (e) { return MP4.box(MP4.types.mdat, e) }, MP4 }(); i.init(), t.default = i }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.TrackParser = void 0; var o = r(0), s = r(8), u = r(49), d = r(1), c = a(r(7)), l = r(5), p = r(4), f = o.makeLogger("track-parser"), h = 50, _ = function (e) { function TrackParser(t) { var r = e.call(this) || this; return r._pendingTracks = [], r._isPending = !1, r._audioGap = h, r._vbrTime = 0, r._vbrBytes = 0, r._config = t, r } return i(TrackParser, e), TrackParser.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._pendingTracks = void 0 }, TrackParser.prototype.append = function (e) { if (!this._destroyed) if (this._isPending) this._pendingTracks.push(e); else if ("RESET" === e.flag && (this._pendingTracks = [], this._audioExpect = void 0, this._vbrTime = 0, this._vbrBytes = 0, f.log("reset")), e.data) { var t = e.codec, r = u.getParser(t); if (r) { if (!r.inited) return this._isPending = !0, this._pendingTracks.push(e), void r.init(this._config, this._onParserInited); var n = e.config; if (n.mimeType || "CFG" === e.flag) { if ("KEY" === e.flag && (e.isKeyframe = !0), "CFG" === e.flag) { if (n.bytes = e.data, !n.bytes.byteLength) return void f.warn(e.type + " track config bytes is missing"); if (0 !== r.parseConfig(n, e.dataFormat)) return void f.warn("parse " + t + " config error"); "audio" === e.type && (n.timescale = n.audioSampleRate) } else if (e.data && !e.isFake && (this._vbrDetect(e), this._audioGapDetect(e), 0 !== r.parseData(e))) return void f.warn("parse " + t + " data error"); this.onData(e) } else f.warn("first track is not cfg, ignore: trackId=" + e.trackId + ", type=" + e.type + ", dts=" + e.dts + ", pts=" + e.pts) } else this.onError(new d.DyDemuxError("unsupport codec: " + t, d.ErrorIds.ParserCodecUnsupport)) } else this.onData(e) }, TrackParser.prototype._onParserInited = function (e) { e ? this.onError(new d.DyDemuxError("" + e, d.ErrorIds.ParserInitError)) : (this._isPending = !1, this._pendingTracks.splice(0).forEach(this.append)) }, TrackParser.prototype._audioGapDetect = function (e) { if (c.default.chrome && "audio" === e.type && e.codec === l.Codec.AAC && e.data && ("KEY" === e.flag || void 0 === e.flag) && e.trackLength > 1) { if (void 0 === this._audioExpect) this._audioExpect = e.dts; else { var t = Math.floor(1e3 * this._audioExpect), r = 1e3 * e.dts - t, n = Math.floor(Math.abs(r) / 1e3); n > this._audioGap && (f.warn("Large timestamp gap detected; may cause AV sync to drift. time:" + 1e3 * e.dts + "us expected:" + t + "us delta:" + r + "us"), this._audioGap = n, this._audioGap > 150 && (f.warn("Large timestamp gap exceed 150ms, jump over " + e.dts + " and reset."), e.extradata.jumpOverTs = e.dts, this._audioGap = h, this._audioExpect = e.dts)) } this._audioExpect += e.config.refSampleDuration } }, TrackParser.prototype._vbrDetect = function (e) { if (this._vbrTime) { this._vbrBytes += e.data.byteLength; var t = e.dts - this._vbrTime; if (t >= 23e3) { var r = Math.round(8 * this._vbrBytes / 1024 / (t / 1e3)); this._vbrBytes = 0, this._vbrTime = e.dts, this._config.__internal.eventbus.emit(p.InternalEvents.VBR, { data: { vbr: r, pts: e.pts } }), f.log("vbr=" + r + ", dts=" + e.dts + ", delta=" + t) } } else this._vbrBytes = 0, this._vbrTime = e.dts }, TrackParser }(s.BaseStream); t.TrackParser = _ }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.getParser = t.registerParser = void 0; var n = r(22), i = r(50), a = r(53), o = {}; function registerParser(e) { o[e.name] = e } t.registerParser = registerParser, t.getParser = function getParser(e) { return o[e] }, registerParser(i.h264), registerParser(n.aac), registerParser(a.mp3), registerParser(r(54).h265) }, function (e, t, r) { "use strict"; var n = this && this.__createBinding || (Object.create ? function (e, t, r, n) { void 0 === n && (n = r), Object.defineProperty(e, n, { enumerable: !0, get: function () { return t[r] } }) } : function (e, t, r, n) { void 0 === n && (n = r), e[n] = t[r] }), i = this && this.__setModuleDefault || (Object.create ? function (e, t) { Object.defineProperty(e, "default", { enumerable: !0, value: t }) } : function (e, t) { e.default = t }), a = this && this.__importStar || function (e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) "default" !== r && Object.hasOwnProperty.call(e, r) && n(t, e, r); return i(t, e), t }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.h264 = void 0; var s = r(0), u = o(r(51)), d = a(r(24)), c = r(5), l = r(21), p = s.makeLogger("h264-parser"), f = { referenceFrameRate: { fixed: !0, fps: 23.976, fps_num: 23976, fps_den: 1e3 } }; t.h264 = { name: c.Codec.H264, inited: !0, parseConfig: function parseConfig(e, t) { if ("nalu" === t) { var r = l.parseNal({ codec: c.Codec.H264, bytes: e.bytes }); if (!(r.configNalus.length > 0)) return p.warn("wrong nalu config data", e), -1; e.bytes = function writeAvcc(e) { var t = e.configNalus.find(function (e) { return 7 === e.naluType }), r = e.configNalus.find(function (e) { return 8 === e.naluType }); if (!t || !t) return null; var n = u.default.parseSPS(t.naluData), i = t.naluData.byteLength, a = r.naluData.byteLength, o = [1, n.profile_idc, n.profile_compatibility, n.level_idc, 255, 225, i >> 8, 255 & i].concat(Array.prototype.slice.call(t.naluData)).concat([1, a >> 8, 255 & a]).concat(Array.prototype.slice.call(r.naluData)); return void 0 !== n.bit_depth_luma_minus8 && (o = o.concat([252 | n.chroma_format_idc, 248 | n.bit_depth_luma_minus8, 248 | n.bit_depth_chroma_minus8, 0])), new Uint8Array(o) }(r) } var n = e.bytes && e.bytes.byteLength; if (n < 7) return p.warn("Invalid AVCDecoderConfigurationRecord, lack of data!"), -1; var i, a = e.bytes.buffer, o = e.bytes.byteOffset, s = new DataView(a, o, n), d = (new Uint8Array(a.slice(o, o + n)), 0), h = 0, _ = 0, m = 0, y = 0, v = "", g = f.referenceFrameRate, b = s.getUint8(0), w = s.getUint8(1); if (s.getUint8(2), s.getUint8(3), 1 !== b || 0 === w) return p.warn("Invalid AVCDecoderConfigurationRecord"), -1; if (3 !== (i = 1 + (3 & s.getUint8(4))) && 4 !== i) return p.warn("Strange NaluLengthSizeMinusOne: " + (i - 1)), -1; var E = 31 & s.getUint8(5); if (0 === E) return p.warn("Invalid AVCDecoderConfigurationRecord: No SPS"), -1; E > 1 && p.warn("Strange AVCDecoderConfigurationRecord: SPS Count = " + E); for (var T = 6, S = 0; S < E; S++) { var P = s.getUint16(T, !1); if (T += 2, 0 !== P) { var A = new Uint8Array(a, o + T, P); T += P; var O = u.default.parseSPS(A); if (0 === S) { d = O.codec_size.width, h = O.codec_size.height, _ = O.present_size.width, m = O.present_size.height, 0 !== O.frame_rate.fps_num && 0 !== O.frame_rate.fps_den && (g = O.frame_rate), y = g.fps_den / g.fps_num * 1e3; for (var M = A.subarray(1, 4), k = "avc1.", D = 0; D < 3; D++) { var L = M[D].toString(16); L.length < 2 && (L = "0" + L), k += L } v = k } } } var x = s.getUint8(T); if (0 === x) return p.warn("Invalid AVCDecoderConfigurationRecord: No PPS"), -1; for (x > 1 && p.warn("Strange AVCDecoderConfigurationRecord: PPS Count = " + x), T++, S = 0; S < x; S++)P = s.getUint16(T, !1), T += 2, 0 !== P && (T += P); return e.naluLengthSize = i, e.codecWidth = d, e.codecHeight = h, e.presentWidth = _, e.presentHeight = m, e.refSampleDuration = y, e.detailCodec = v, e.fps = g.fps, p.debug("Parsed AVCDecoderConfigurationRecord"), 0 }, parseData: function parseData(e) { for (var t = e.data.byteLength, r = e.data.buffer, n = e.data.byteOffset, i = new DataView(r, n, t), a = 0, o = e.config.naluLengthSize; a < t;) { if (a + 4 >= t) { p.warn("Malformed Nalu"); break } var s = i.getUint32(a, !1); if (3 === o && (s >>>= 8), s > t - o) return p.warn("Malformed Nalus, NaluSize > DataSize!"), -1; var u = 31 & i.getUint8(a + o); if (5 === u) e.isKeyframe = !0, e.pureKeyframe = new Uint8Array(r, n + a, 4 + s); else if (6 === u) try { var c = new Uint8Array(r, n + a + 1 + o, s - 1), l = d.default.parseSEI(c), f = l.seiType, h = l.seiData; h && h.data && (f === d.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED && h.uuid === d.H264SeiUUIDType.CloudVideoStream && (e.extradata.seiTimestamp = h.data), e.extradata.sei || (e.extradata.sei = []), e.extradata.sei.push({ seiTimestamp: e.dts, seiType: f, seiData: h })) } catch (e) { p.warn("parse sei error, ignored!", e) } a += o + s } return 0 } } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var i = n(r(52)), a = function () { function SPSParser() { } return SPSParser._ebsp2rbsp = function (e) { for (var t = e, r = t.byteLength, n = new Uint8Array(r), i = 0, a = 0; a < r; a++)a >= 2 && 3 === t[a] && 0 === t[a - 1] && 0 === t[a - 2] || (n[i] = t[a], i++); return new Uint8Array(n.buffer, 0, i) }, SPSParser.parseSPS = function (e) { var t = SPSParser._ebsp2rbsp(e), r = new i.default(t); r.readByte(); var n = r.readByte(), a = r.readByte(), o = r.readByte(); r.readUEG(); var s, u, d = SPSParser.getProfileString(n), c = SPSParser.getLevelString(o), l = 1, p = 420, f = 8; if ((100 === n || 110 === n || 122 === n || 244 === n || 44 === n || 83 === n || 86 === n || 118 === n || 128 === n || 138 === n || 144 === n) && (3 === (l = r.readUEG()) && r.readBits(1), l <= 3 && (p = [0, 420, 422, 444][l]), f = (s = r.readUEG()) + 8, u = r.readUEG(), r.readBits(1), r.readBool())) for (var h = 3 !== l ? 8 : 12, _ = 0; _ < h; _++)r.readBool() && (_ < 6 ? SPSParser._skipScalingList(r, 16) : SPSParser._skipScalingList(r, 64)); r.readUEG(); var m = r.readUEG(); if (0 === m) r.readUEG(); else if (1 === m) { r.readBits(1), r.readSEG(), r.readSEG(); var y = r.readUEG(); for (_ = 0; _ < y; _++)r.readSEG() } r.readUEG(), r.readBits(1); var v = r.readUEG(), g = r.readUEG(), b = r.readBits(1); 0 === b && r.readBits(1), r.readBits(1); var w = 0, E = 0, T = 0, S = 0; r.readBool() && (w = r.readUEG(), E = r.readUEG(), T = r.readUEG(), S = r.readUEG()); var P = 1, A = 1, O = 0, M = !0, k = 0, D = 0; if (r.readBool()) { if (r.readBool()) { var L = r.readByte(); L > 0 && L < 16 ? (P = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2][L - 1], A = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1][L - 1]) : 255 === L && (P = r.readByte() << 8 | r.readByte(), A = r.readByte() << 8 | r.readByte()) } if (r.readBool() && r.readBool(), r.readBool() && (r.readBits(4), r.readBool() && r.readBits(24)), r.readBool() && (r.readUEG(), r.readUEG()), r.readBool()) { var x = r.readBits(32), I = r.readBits(32); M = r.readBool(), O = (k = I) / (D = 2 * x) } } var R = 1; 1 === P && 1 === A || (R = P / A); var j = 0, C = 0; 0 === l ? (j = 1, C = 2 - b) : (j = 3 === l ? 1 : 2, C = (1 === l ? 2 : 1) * (2 - b)); var B = 16 * (v + 1), F = 16 * (g + 1) * (2 - b); B -= (w + E) * j, F -= (T + S) * C; var N = Math.ceil(B * R); return r.destroy(), r = null, { profile_idc: n, profile_compatibility: a, level_idc: o, profile_string: d, level_string: c, bit_depth: f, bit_depth_luma_minus8: s, bit_depth_chroma_minus8: u, chroma_format_idc: l, chroma_format: p, chroma_format_string: SPSParser.getChromaFormatString(p), frame_rate: { fixed: M, fps: O, fps_den: D, fps_num: k }, sar_ratio: { width: P, height: A }, codec_size: { width: B, height: F }, present_size: { width: N, height: F } } }, SPSParser._skipScalingList = function (e, t) { for (var r = 8, n = 8, i = 0; i < t; i++)0 !== n && (n = (r + e.readSEG() + 256) % 256), r = 0 === n ? r : n }, SPSParser.getProfileString = function (e) { switch (e) { case 66: return "Baseline"; case 77: return "Main"; case 88: return "Extended"; case 100: return "High"; case 110: return "High10"; case 122: return "High422"; case 244: return "High444"; default: return "Unknown" } }, SPSParser.getLevelString = function (e) { return (e / 10).toFixed(1) }, SPSParser.getChromaFormatString = function (e) { switch (e) { case 420: return "4:2:0"; case 422: return "4:2:2"; case 444: return "4:4:4"; default: return "Unknown" } }, SPSParser }(); t.default = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function ExpGolomb(e) { this.TAG = "ExpGolomb", this._buffer = e, this._buffer_index = 0, this._total_bytes = e.byteLength, this._total_bits = 8 * e.byteLength, this._current_word = 0, this._current_word_bits_left = 0 } return ExpGolomb.prototype.destroy = function () { this._buffer = null }, ExpGolomb.prototype._fillCurrentWord = function () { var e = this._total_bytes - this._buffer_index; if (e <= 0) throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available"); var t = Math.min(4, e), r = new Uint8Array(4); r.set(this._buffer.subarray(this._buffer_index, this._buffer_index + t)), this._current_word = new DataView(r.buffer).getUint32(0, !1), this._buffer_index += t, this._current_word_bits_left = 8 * t }, ExpGolomb.prototype.readBits = function (e) { if (e > 32) throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!"); if (e <= this._current_word_bits_left) { var t = this._current_word >>> 32 - e; return this._current_word <<= e, this._current_word_bits_left -= e, t } var r = this._current_word_bits_left ? this._current_word : 0; r >>>= 32 - this._current_word_bits_left; var n = e - this._current_word_bits_left; this._fillCurrentWord(); var i = Math.min(n, this._current_word_bits_left), a = this._current_word >>> 32 - i; return this._current_word <<= i, this._current_word_bits_left -= i, r = r << i | a }, ExpGolomb.prototype.readBool = function () { return 1 === this.readBits(1) }, ExpGolomb.prototype.readByte = function () { return this.readBits(8) }, ExpGolomb.prototype._skipLeadingZero = function () { var e; for (e = 0; e < this._current_word_bits_left; e++)if (0 !== (this._current_word & 2147483648 >>> e)) return this._current_word <<= e, this._current_word_bits_left -= e, e; return this._fillCurrentWord(), e + this._skipLeadingZero() }, ExpGolomb.prototype.readUEG = function () { var e = this._skipLeadingZero(); return this.readBits(e + 1) - 1 }, ExpGolomb.prototype.readSEG = function () { var e = this.readUEG(); return 1 & e ? e + 1 >>> 1 : -1 * (e >>> 1) }, ExpGolomb }(); t.default = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.mp3 = void 0; var n = r(0), i = r(5), a = n.makeLogger("mp3-parser"), o = { _mpegAudioV10SampleRateTable: [44100, 48e3, 32e3, 0], _mpegAudioV20SampleRateTable: [22050, 24e3, 16e3, 0], _mpegAudioV25SampleRateTable: [11025, 12e3, 8e3, 0], _mpegAudioL1BitRateTable: [0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1], _mpegAudioL2BitRateTable: [0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1], _mpegAudioL3BitRateTable: [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, -1] }; t.mp3 = { name: i.Codec.MP3, inited: !0, parseConfig: function parseConfig(e) { if (e.bytes.byteLength < 4) return a.warn("Invalid MP3 packet, header missing!"), -1; var t = e.bytes; if (255 !== t[0]) return -1; var r = t[1] >>> 3 & 3, n = (6 & t[1]) >> 1, i = (240 & t[2]) >>> 4, s = (12 & t[2]) >>> 2, u = 3 !== (t[3] >>> 6 & 3) ? 2 : 1, d = 0, c = 0; switch (r) { case 0: d = o._mpegAudioV25SampleRateTable[s]; break; case 2: d = o._mpegAudioV20SampleRateTable[s]; break; case 3: d = o._mpegAudioV10SampleRateTable[s] }switch (n) { case 1: i < o._mpegAudioL3BitRateTable.length && (c = o._mpegAudioL3BitRateTable[i]); break; case 2: i < o._mpegAudioL2BitRateTable.length && (c = o._mpegAudioL2BitRateTable[i]); break; case 3: i < o._mpegAudioL1BitRateTable.length && (c = o._mpegAudioL1BitRateTable[i]) }return e.audioSampleRate = d, e.channelCount = u, e.detailCodec = "mp3", e.dataRate = c, e.refSampleDuration = 1152 / d * 1e3, a.log("Parsed MPEG Audio Frame Header"), 0 }, parseData: function parseData(e) { return 0 } } }, function (e, t, r) { "use strict"; var n = this && this.__createBinding || (Object.create ? function (e, t, r, n) { void 0 === n && (n = r), Object.defineProperty(e, n, { enumerable: !0, get: function () { return t[r] } }) } : function (e, t, r, n) { void 0 === n && (n = r), e[n] = t[r] }), i = this && this.__setModuleDefault || (Object.create ? function (e, t) { Object.defineProperty(e, "default", { enumerable: !0, value: t }) } : function (e, t) { e.default = t }), a = this && this.__importStar || function (e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) "default" !== r && Object.hasOwnProperty.call(e, r) && n(t, e, r); return i(t, e), t }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.h265 = void 0; var s, u = r(0), d = a(r(24)), c = r(5), l = o(r(55)), p = r(2), f = u.makeLogger("h265-parser"); t.h265 = { name: c.Codec.H265, inited: !1, parseConfig: function parseConfig(e, t) { if ("nalu" === t && (e.bytes = function writeHvcc(e) { var t = s._malloc(4096), r = e.byteLength, n = s._malloc(r); s.HEAPU8.set(e, n); var i = s._hvcC_write(t, 4096, n, r), a = null; return i < 0 ? f.warn("hvcc write error: " + i) : a = s.HEAPU8.slice(t, t + i), s._free(t), s._free(n), a }(e.bytes)), !e.bytes || e.bytes.byteLength < 7) return f.warn("Invalid HvcC, lack of data!"), -1; var r = s._malloc(128), n = s._malloc(e.bytes.byteLength); s.HEAPU8.set(e.bytes, n); var i = s._hvcC_parse(r, n, e.bytes.byteLength); if (0 === i) { var a = new Int32Array(s.HEAPU8.buffer, r, 7), o = a[0], u = a[1], d = a[2], c = a[3], l = a[4], p = a[5], h = a[6], _ = s.UTF8ToString(r + a.byteLength); e.naluLengthSize = o, e.codecWidth = u, e.codecHeight = d, e.presentWidth = c, e.presentHeight = l, e.refSampleDuration = h / p * 1e3, e.detailCodec = _, e.fps = p / h, f.log("Parsed HvcC") } return s._free(r), s._free(n), i }, parseData: function parseData(e) { for (var t = e.data.byteLength, r = e.data.buffer, n = e.data.byteOffset, i = new DataView(r, n, t), a = 0, o = e.config.naluLengthSize; a < t;) { if (a + 4 >= t) { f.warn("Malformed Nalu"); break } var s = i.getUint32(a, !1); if (3 === o && (s >>>= 8), s > t - o) return f.warn("Malformed Nalus, NaluSize > DataSize!"), -1; var u = (126 & i.getUint8(a + o)) >> 1; if (u >= 16 && u <= 23) e.isKeyframe = !0, e.pureKeyframe = new Uint8Array(r, n + a, 4 + s); else if (39 === u || 40 === u) try { var c = new Uint8Array(r, n + a + 2 + o, s - 1), l = d.default.parseSEI(c), p = l.seiType, h = l.seiData; h && h.data && (p === d.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED && h.uuid === d.H264SeiUUIDType.CloudVideoStream && (e.extradata.seiTimestamp = h.data), e.extradata.sei || (e.extradata.sei = []), e.extradata.sei.push({ seiTimestamp: e.dts, seiType: p, seiData: h })) } catch (e) { f.warn("parse sei error, ignored!", e) } a += o + s } return 0 }, init: function init(e, r) { if (p.isWasmSupported()) { var n = e.__internal.wasmHvcc; l.default({ locateFile: function () { return n }, onAbort: function (e) { f.warn("init hvcc wasm error: " + e), r(e) } }).then(function (e) { f.log("hvcc wasm inited."), t.h265.inited = !0, s = e, r() }) } else r("init hvcc wasm error: WebAssembly no supported.") } } }, function (e, t, r) { (function (t) { var r, n = (r = "undefined" !== typeof document && document.currentScript ? document.currentScript.src : void 0, function (e) { var n, i; (e = "undefined" !== typeof (e = e || {}) ? e : {}).ready = new Promise(function (e, t) { n = e, i = t }); var a, o = {}; for (a in e) e.hasOwnProperty(a) && (o[a] = e[a]); var s = [], u = "./this.program", d = !1, c = !1; d = "object" === typeof window, c = "function" === typeof importScripts, "object" === typeof t && "object" === typeof t.versions && t.versions.node; var l, p = ""; (d || c) && (c ? p = self.location.href : document.currentScript && (p = document.currentScript.src), r && (p = r), p = 0 !== p.indexOf("blob:") ? p.substr(0, p.lastIndexOf("/") + 1) : "", c && (l = function readBinary(e) { var t = new XMLHttpRequest; return t.open("GET", e, !1), t.responseType = "arraybuffer", t.send(null), new Uint8Array(t.response) })); var f, h, _ = e.print || console.log.bind(console), m = e.printErr || console.warn.bind(console); for (a in o) o.hasOwnProperty(a) && (e[a] = o[a]); o = null, e.arguments && (s = e.arguments), e.thisProgram && (u = e.thisProgram), e.quit && e.quit, e.wasmBinary && (f = e.wasmBinary), e.noExitRuntime && e.noExitRuntime, "object" !== typeof WebAssembly && abort("no native wasm support detected"); var y, v, g, b, w = new WebAssembly.Table({ initial: 14, maximum: 14, element: "anyfunc" }), E = !1, T = "undefined" !== typeof TextDecoder ? new TextDecoder("utf8") : void 0; function UTF8ArrayToString(e, t, r) { for (var n = t + r, i = t; e[i] && !(i >= n);)++i; if (i - t > 16 && e.subarray && T) return T.decode(e.subarray(t, i)); for (var a = ""; t < i;) { var o = e[t++]; if (128 & o) { var s = 63 & e[t++]; if (192 != (224 & o)) { var u = 63 & e[t++]; if ((o = 224 == (240 & o) ? (15 & o) << 12 | s << 6 | u : (7 & o) << 18 | s << 12 | u << 6 | 63 & e[t++]) < 65536) a += String.fromCharCode(o); else { var d = o - 65536; a += String.fromCharCode(55296 | d >> 10, 56320 | 1023 & d) } } else a += String.fromCharCode((31 & o) << 6 | s) } else a += String.fromCharCode(o) } return a } function UTF8ToString(e, t) { return e ? UTF8ArrayToString(g, e, t) : "" } var S = e.INITIAL_MEMORY || 16777216; function callRuntimeCallbacks(t) { for (; t.length > 0;) { var r = t.shift(); if ("function" != typeof r) { var n = r.func; "number" === typeof n ? void 0 === r.arg ? e.dynCall_v(n) : e.dynCall_vi(n, r.arg) : n(void 0 === r.arg ? null : r.arg) } else r(e) } } (h = e.wasmMemory ? e.wasmMemory : new WebAssembly.Memory({ initial: S / 65536, maximum: S / 65536 })) && (y = h.buffer), S = y.byteLength, function updateGlobalBufferAndViews(t) { y = t, e.HEAP8 = v = new Int8Array(t), e.HEAP16 = new Int16Array(t), e.HEAP32 = b = new Int32Array(t), e.HEAPU8 = g = new Uint8Array(t), e.HEAPU16 = new Uint16Array(t), e.HEAPU32 = new Uint32Array(t), e.HEAPF32 = new Float32Array(t), e.HEAPF64 = new Float64Array(t) }(y), b[12496] = 5293024; var P = [], A = [], O = [], M = [], k = 0, D = null, L = null; function abort(t) { e.onAbort && e.onAbort(t), m(t += ""), E = !0, t = "abort(" + t + "). Build with -s ASSERTIONS=1 for more info."; var r = new WebAssembly.RuntimeError(t); throw i(r), r } e.preloadedImages = {}, e.preloadedAudios = {}; var x = "data:application/octet-stream;base64,"; function isDataURI(e) { return function hasPrefix(e, t) { return String.prototype.startsWith ? e.startsWith(t) : 0 === e.indexOf(t) }(e, x) } var I = "hvcC_parser.wasm"; function getBinary() { try { if (f) return new Uint8Array(f); if (l) return l(I); throw "both async and sync fetching of the wasm failed" } catch (e) { abort(e) } } isDataURI(I) || (I = function locateFile(t) { return e.locateFile ? e.locateFile(t, p) : p + t }(I)), A.push({ func: function () { F() } }); var R = {}; function getEnvStrings() { if (!getEnvStrings.strings) { var e = { USER: "web_user", LOGNAME: "web_user", PATH: "/", PWD: "/", HOME: "/home/web_user", LANG: ("object" === typeof navigator && navigator.languages && navigator.languages[0] || "C").replace("-", "_") + ".UTF-8", _: function getExecutableName() { return u || "./this.program" }() }; for (var t in R) e[t] = R[t]; var r = []; for (var t in e) r.push(t + "=" + e[t]); getEnvStrings.strings = r } return getEnvStrings.strings } var j, C = { mappings: {}, buffers: [null, [], []], printChar: function (e, t) { var r = C.buffers[e]; 0 === t || 10 === t ? ((1 === e ? _ : m)(UTF8ArrayToString(r, 0)), r.length = 0) : r.push(t) }, varargs: void 0, get: function () { return C.varargs += 4, b[C.varargs - 4 >> 2] }, getStr: function (e) { return UTF8ToString(e) }, get64: function (e, t) { return e } }, B = { a: function _abort() { abort() }, k: function _emscripten_console_log(e) { console.log(UTF8ToString(e)) }, j: function _emscripten_console_warn(e) { console.warn(UTF8ToString(e)) }, c: function _emscripten_memcpy_big(e, t, r) { g.copyWithin(e, t, t + r) }, d: function _emscripten_resize_heap(e) { !function abortOnCannotGrowMemory(e) { abort("OOM") }() }, e: function _environ_get(e, t) { var r = 0; return getEnvStrings().forEach(function (n, i) { var a = t + r; b[e + 4 * i >> 2] = a, function writeAsciiToMemory(e, t, r) { for (var n = 0; n < e.length; ++n)v[t++ >> 0] = e.charCodeAt(n); r || (v[t >> 0] = 0) }(n, a), r += n.length + 1 }), 0 }, f: function _environ_sizes_get(e, t) { var r = getEnvStrings(); b[e >> 2] = r.length; var n = 0; return r.forEach(function (e) { n += e.length + 1 }), b[t >> 2] = n, 0 }, h: function _fd_close(e) { return 0 }, g: function _fd_fdstat_get(e, t) { var r = 1 == e || 2 == e ? 2 : abort(); return v[t >> 0] = r, 0 }, i: function _fd_seek(e, t, r, n, i) { }, b: function _fd_write(e, t, r, n) { for (var i = 0, a = 0; a < r; a++) { for (var o = b[t + 8 * a >> 2], s = b[t + (8 * a + 4) >> 2], u = 0; u < s; u++)C.printChar(e, g[o + u]); i += s } return b[n >> 2] = i, 0 }, memory: h, table: w }, F = (function createWasm() { var t = { a: B }; function receiveInstance(t, r) { var n = t.exports; e.asm = n, function removeRunDependency(t) { if (k--, e.monitorRunDependencies && e.monitorRunDependencies(k), 0 == k && (null !== D && (clearInterval(D), D = null), L)) { var r = L; L = null, r() } }() } function receiveInstantiatedSource(e) { receiveInstance(e.instance) } function instantiateArrayBuffer(e) { return function getBinaryPromise() { return f || !d && !c || "function" !== typeof fetch ? new Promise(function (e, t) { e(getBinary()) }) : fetch(I, { credentials: "same-origin" }).then(function (e) { if (!e.ok) throw "failed to load wasm binary file at '" + I + "'"; return e.arrayBuffer() }).catch(function () { return getBinary() }) }().then(function (e) { return WebAssembly.instantiate(e, t) }).then(e, function (e) { m("failed to asynchronously prepare wasm: " + e), abort(e) }) } if (function addRunDependency(t) { k++, e.monitorRunDependencies && e.monitorRunDependencies(k) }(), e.instantiateWasm) try { return e.instantiateWasm(t, receiveInstance) } catch (e) { return m("Module.instantiateWasm callback failed with error: " + e), !1 } return function instantiateAsync() { if (f || "function" !== typeof WebAssembly.instantiateStreaming || isDataURI(I) || "function" !== typeof fetch) return instantiateArrayBuffer(receiveInstantiatedSource); fetch(I, { credentials: "same-origin" }).then(function (e) { return WebAssembly.instantiateStreaming(e, t).then(receiveInstantiatedSource, function (e) { return m("wasm streaming compile failed: " + e), m("falling back to ArrayBuffer instantiation"), instantiateArrayBuffer(receiveInstantiatedSource) }) }) }(), {} }(), e.___wasm_call_ctors = function () { return (F = e.___wasm_call_ctors = e.asm.l).apply(null, arguments) }), N = (e._hvcC_write = function () { return (e._hvcC_write = e.asm.m).apply(null, arguments) }, e._hvcC_parse = function () { return (e._hvcC_parse = e.asm.n).apply(null, arguments) }, e._log_init = function () { return (e._log_init = e.asm.o).apply(null, arguments) }, e._free = function () { return (e._free = e.asm.p).apply(null, arguments) }, e._malloc = function () { return (N = e._malloc = e.asm.q).apply(null, arguments) }); function run(t) { function doRun() { j || (j = !0, e.calledRun = !0, E || (function initRuntime() { callRuntimeCallbacks(A) }(), function preMain() { callRuntimeCallbacks(O) }(), n(e), e.onRuntimeInitialized && e.onRuntimeInitialized(), function postRun() { if (e.postRun) for ("function" == typeof e.postRun && (e.postRun = [e.postRun]); e.postRun.length;)t = e.postRun.shift(), M.unshift(t); var t; callRuntimeCallbacks(M) }())) } t = t || s, k > 0 || (function preRun() { if (e.preRun) for ("function" == typeof e.preRun && (e.preRun = [e.preRun]); e.preRun.length;)t = e.preRun.shift(), P.unshift(t); var t; callRuntimeCallbacks(P) }(), k > 0 || (e.setStatus ? (e.setStatus("Running..."), setTimeout(function () { setTimeout(function () { e.setStatus("") }, 1), doRun() }, 1)) : doRun())) } if (e.UTF8ToString = UTF8ToString, e.allocateUTF8 = function allocateUTF8(e) { var t = function lengthBytesUTF8(e) { for (var t = 0, r = 0; r < e.length; ++r) { var n = e.charCodeAt(r); n >= 55296 && n <= 57343 && (n = 65536 + ((1023 & n) << 10) | 1023 & e.charCodeAt(++r)), n <= 127 ? ++t : t += n <= 2047 ? 2 : n <= 65535 ? 3 : 4 } return t }(e) + 1, r = N(t); return r && function stringToUTF8Array(e, t, r, n) { if (!(n > 0)) return 0; for (var i = r, a = r + n - 1, o = 0; o < e.length; ++o) { var s = e.charCodeAt(o); if (s >= 55296 && s <= 57343 && (s = 65536 + ((1023 & s) << 10) | 1023 & e.charCodeAt(++o)), s <= 127) { if (r >= a) break; t[r++] = s } else if (s <= 2047) { if (r + 1 >= a) break; t[r++] = 192 | s >> 6, t[r++] = 128 | 63 & s } else if (s <= 65535) { if (r + 2 >= a) break; t[r++] = 224 | s >> 12, t[r++] = 128 | s >> 6 & 63, t[r++] = 128 | 63 & s } else { if (r + 3 >= a) break; t[r++] = 240 | s >> 18, t[r++] = 128 | s >> 12 & 63, t[r++] = 128 | s >> 6 & 63, t[r++] = 128 | 63 & s } } return t[r] = 0, r - i }(e, v, r, t), r }, L = function runCaller() { j || run(), j || (L = runCaller) }, e.run = run, e.preInit) for ("function" == typeof e.preInit && (e.preInit = [e.preInit]); e.preInit.length > 0;)e.preInit.pop()(); return run(), e.ready }); e.exports = n }).call(t, r(56)) }, function (e, t) { var r, n, i = e.exports = {}; function defaultSetTimout() { throw new Error("setTimeout has not been defined") } function defaultClearTimeout() { throw new Error("clearTimeout has not been defined") } function runTimeout(e) { if (r === setTimeout) return setTimeout(e, 0); if ((r === defaultSetTimout || !r) && setTimeout) return r = setTimeout, setTimeout(e, 0); try { return r(e, 0) } catch (t) { try { return r.call(null, e, 0) } catch (t) { return r.call(this, e, 0) } } } !function () { try { r = "function" === typeof setTimeout ? setTimeout : defaultSetTimout } catch (e) { r = defaultSetTimout } try { n = "function" === typeof clearTimeout ? clearTimeout : defaultClearTimeout } catch (e) { n = defaultClearTimeout } }(); var a, o = [], s = !1, u = -1; function cleanUpNextTick() { s && a && (s = !1, a.length ? o = a.concat(o) : u = -1, o.length && drainQueue()) } function drainQueue() { if (!s) { var e = runTimeout(cleanUpNextTick); s = !0; for (var t = o.length; t;) { for (a = o, o = []; ++u < t;)a && a[u].run(); u = -1, t = o.length } a = null, s = !1, function runClearTimeout(e) { if (n === clearTimeout) return clearTimeout(e); if ((n === defaultClearTimeout || !n) && clearTimeout) return n = clearTimeout, clearTimeout(e); try { return n(e) } catch (t) { try { return n.call(null, e) } catch (t) { return n.call(this, e) } } }(e) } } function Item(e, t) { this.fun = e, this.array = t } function noop() { } i.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; o.push(new Item(e, t)), 1 !== o.length || s || runTimeout(drainQueue) }, Item.prototype.run = function () { this.fun.apply(null, this.array) }, i.title = "browser", i.browser = !0, i.env = {}, i.argv = [], i.version = "", i.versions = {}, i.on = noop, i.addListener = noop, i.once = noop, i.off = noop, i.removeListener = noop, i.removeAllListeners = noop, i.emit = noop, i.prependListener = noop, i.prependOnceListener = noop, i.listeners = function (e) { return [] }, i.binding = function (e) { throw new Error("process.binding is not supported") }, i.cwd = function () { return "/" }, i.chdir = function (e) { throw new Error("process.chdir is not supported") }, i.umask = function () { return 0 } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var o = r(15), s = r(8), u = r(5), d = r(1), c = a(r(9)), l = function (e) { function WsTranscoder(t) { var r = e.call(this) || this; return r.pendingTracks = [], r.bufferSize = 51200, r.buffer = new c.default({ autoClear: !0, initLength: r.bufferSize }), r.isEnd = !1, r.transcodedMimeType = "", r.config = t, r.ws = new WebSocket(r.config.accelerator.url), r.ws.binaryType = "arraybuffer", r.ws.onopen = r.onOpen, r.ws.onmessage = r.onMessage, r.ws.onclose = function (e) { r.isEnd || r._error(new o.DyError("accelerator closed: code=" + e.code + ", msg=" + e.reason, d.ErrorIds.AcceleratorClosed)) }, r.ws.onerror = function () { return r._error(new o.DyError("accelerator error", d.ErrorIds.AcceleratorError)) }, r } return i(WsTranscoder, e), Object.defineProperty(WsTranscoder.prototype, "isConnected", { get: function () { return !(!this.ws || 1 !== this.ws.readyState) }, enumerable: !1, configurable: !0 }), WsTranscoder.prototype.dispose = function () { e.prototype.dispose.call(this), this.ws && (this.ws.onopen = null, this.ws.onmessage = null, this.ws.onclose = null, this.ws.onerror = null, this.ws.close(), this.ws = null), this.buffer = null, this.pendingTracks = null }, WsTranscoder.prototype.append = function (e) { this._destroyed || this.isEnd || ("video" === e.type ? (e.isEnd && !this.isEnd && (this.ws.send(JSON.stringify({ type: "end" })), this.isEnd = !0), this.send(e), this.lastVideoTrack = e) : this.onData(e)) }, WsTranscoder.prototype.send = function (e) { this.isConnected ? (e.data && this.sendBuffer(e.data), delete e.data, e.codec = u.Codec.H264, e.isEnd = !1, this._dispatchVideoTrack(e)) : this.pendingTracks.push(e) }, WsTranscoder.prototype.sendBuffer = function (e) { this.buffer.write(e), this.buffer.byteAvailable >= this.bufferSize && this.flush() }, WsTranscoder.prototype.flush = function () { if (this.buffer.byteAvailable) { var e = new Uint8Array(this.buffer.readAll()); this.ws.send(e) } }, WsTranscoder.prototype.onOpen = function () { this.ws.send(JSON.stringify({ type: "S", client: location.href, codec: this.config.videoCodec, byteRate: this.config.accelerator.byteRate })), this.pendingTracks.length && this.pendingTracks.splice(0).forEach(this.send) }, WsTranscoder.prototype.onMessage = function (e) { if ("string" === typeof e.data) { var t = JSON.parse(e.data); "end" === t.type ? this._dispatchVideoTrack({ type: "video", trackLength: this.lastVideoTrack.trackLength, trackId: this.lastVideoTrack.trackId, config: this.lastVideoTrack.config, dts: this.lastVideoTrack.dts, pts: this.lastVideoTrack.pts, isKeyframe: !1, codec: u.Codec.H264, isEnd: !0 }) : t.mimeType && (this.transcodedMimeType = t.mimeType, this.pendingTracks.length && this.pendingTracks.splice(0).forEach(this._dispatchVideoTrack)) } else e.data instanceof ArrayBuffer && this._dispatchVideoTrack({ type: "video", trackLength: this.lastVideoTrack.trackLength, trackId: this.lastVideoTrack.trackId, config: this.lastVideoTrack.config, dts: this.lastVideoTrack.dts, pts: this.lastVideoTrack.pts, isKeyframe: !1, codec: u.Codec.H264, data: new Uint8Array(e.data) }) }, WsTranscoder.prototype._error = function (e) { this.onError && this.onError(e) }, WsTranscoder.prototype._dispatchVideoTrack = function (e) { this.transcodedMimeType ? (e.config.mimeType = this.transcodedMimeType, this.onData(e)) : this.pendingTracks.push(e) }, WsTranscoder }(s.BaseStream); t.default = l }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.TrackGenerator = void 0; var a = r(6), o = r(0), s = r(8), u = (o.makeLogger("track-generator"), function (e) { function TrackGenerator(t) { var r = e.call(this) || this; return r._needGenerateVideo = !1, r._config = t, r } return i(TrackGenerator, e), TrackGenerator.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._lastKeyframe = void 0, this._lastVideoTrack = void 0 }, TrackGenerator.prototype.append = function (e) { var t; if (!this._destroyed && ("RESET" === e.flag && (this._lastVideoTrack = void 0), this.onData(e), a.isFrameTrack(e))) { if (1 === e.trackLength ? this._needGenerateVideo || "audio" !== e.type || 2 !== (null === (t = this._lastKeyframe) || void 0 === t ? void 0 : t.trackLength) || (this._needGenerateVideo = !0) : this._needGenerateVideo = !1, "video" === e.type) { var r = Object.assign({}, e); this._lastVideoTrack = r, r.isKeyframe && (this._lastKeyframe = r) } if (this._needGenerateVideo && "audio" === e.type) { var n = this._lastVideoTrack; if (this._lastKeyframe && (!n || Math.abs(e.dts - n.dts) > 50)) { var i = Object.assign({}, this._lastKeyframe); i.dts = e.dts, i.pts = e.pts, i.isFake = !0, i.extradata = {}, i.pureKeyframe && (i.data = i.pureKeyframe), this.onData(i), this._lastVideoTrack = i } } } }, TrackGenerator }(s.BaseStream)); t.TrackGenerator = u }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.TimeDispatch = void 0; var n = r(3), i = r(2), a = function () { function TimeDispatch() { this.array = [], n.bindAll(this), this._timer = setInterval(this._onTimeUpdate, 100) } return TimeDispatch.prototype.destroy = function () { this.detach(), clearInterval(this._timer) }, TimeDispatch.prototype.attach = function (e) { this.video = e }, TimeDispatch.prototype.detach = function () { this.video = null, this.array = [] }, TimeDispatch.prototype.add = function (e) { i.binsert(this.array, e, function (e, t) { return e.ts - t.ts }), this._onTimeUpdate() }, TimeDispatch.prototype.clear = function () { this.array = [] }, TimeDispatch.prototype._send = function (e) { this.onSend && this.onSend(e) }, TimeDispatch.prototype._onTimeUpdate = function () { if (this.video) { for (var e = 1e3 * this.video.currentTime, t = this.array.length, r = 0; r < t; r++) { var n = this.array[r]; if (n.ts > e) break; this._send(n) } r > 0 && this.array.splice(0, r) } }, TimeDispatch }(); t.TimeDispatch = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.MediaHandler = void 0; var n = r(4), i = r(3), a = function () { function MediaHandler(e) { this._destroyed = !1, this._mediaInfo = { fps: 0, width: 100, height: 100, audioMimeType: "", videoMimeType: "", audioDataRate: 0, videoDataRate: 0, mimeType: "", metadata: {} }, this._config = e, i.bindAll(this), e.__internal.eventbus.on(n.InternalEvents.METADATA, this._onMetadata), e.__internal.eventbus.on(n.InternalEvents.VBR, this._onVbr) } return Object.defineProperty(MediaHandler.prototype, "video", { get: function () { return this._video }, enumerable: !1, configurable: !0 }), MediaHandler.prototype.dispose = function () { this._config.__internal.eventbus.off(n.InternalEvents.METADATA, this._onMetadata), this._config.__internal.eventbus.off(n.InternalEvents.VBR, this._onVbr), this.detach(), this.onMediaInfo = void 0, this.onHasKeyframe = void 0, this.onExtraData = void 0, this.onError = void 0, this._destroyed = !0 }, MediaHandler.prototype.appendData = function (e) { this._destroyed || "CFG" === e.flag && this._updateMediaInfo(e.config) }, MediaHandler.prototype.attach = function (e) { this._video = e }, MediaHandler.prototype.detach = function () { this._video = null }, MediaHandler.prototype.getStatInfo = function () { return {} }, MediaHandler.prototype.getBufferTime = function () { return 0 }, MediaHandler.prototype.getCurrentTime = function () { return 0 }, MediaHandler.prototype.getIsWaiting = function () { return !1 }, MediaHandler.prototype._updateMediaInfo = function (e) { "audio" === e.type && (void 0 !== e.dataRate && (this._mediaInfo.audioDataRate = e.dataRate), this._mediaInfo.audioMimeType = e.mimeType), "video" === e.type && (void 0 !== e.dataRate && (this._mediaInfo.videoDataRate = e.dataRate), this._mediaInfo.videoMimeType = e.mimeType, this._mediaInfo.fps = e.fps, this._mediaInfo.width = e.codecWidth, this._mediaInfo.height = e.codecHeight), this._mediaInfo.mimeType = [this._mediaInfo.audioMimeType, this._mediaInfo.videoMimeType].filter(function (e) { return e }).join(","), this.onMediaInfo && this.onMediaInfo(this._mediaInfo) }, MediaHandler.prototype.T_ADV_Timestamp = function () { return null }, MediaHandler.prototype._onExtraData = function (e) { this.onExtraData && this.onExtraData(e) }, MediaHandler.prototype._onMetadata = function (e) { this._mediaInfo.metadata = e, this.onMediaInfo && this.onMediaInfo(this._mediaInfo) }, MediaHandler.prototype._onVbr = function (e) { var t = e.data, r = t.vbr, n = t.pts; this._onExtraData({ type: "vbr", ts: n, data: r }) }, MediaHandler }(); t.MediaHandler = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.throttle = void 0, t.throttle = function (e, t, r) { var n, i, a, o, s = 0; r || (r = {}); var u = function () { s = !1 === r.leading ? 0 : performance.now(), n = null, o = e.apply(i, a), n || (i = a = null) }, d = function () { var d = performance.now(); s || !1 !== r.leading || (s = d); var c = t - (d - s); return i = this, a = arguments, c <= 0 || c > t ? (n && (clearTimeout(n), n = null), s = d, o = e.apply(i, a), n || (i = a = null)) : n || !1 === r.trailing || (n = setTimeout(u, c)), o }; return d.cancel = function () { clearTimeout(n), s = 0, n = i = a = null }, d } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.ToFile = void 0; var o = a(r(9)), s = r(11), u = r(2), d = function (e) { function ToFile(t) { var r = e.call(this, t) || this; return r._byteArray = new o.default, r } return i(ToFile, e), ToFile.prototype.dispose = function () { }, ToFile.prototype.appendData = function (e) { "video" === e.type && (this._byteArray.write(e.data), e.isEnd && this.appendEnd()) }, ToFile.prototype.appendEnd = function () { u.saveAs(new Blob([this._byteArray.buffer], { type: "octet/stream" }), "sample.mp4") }, ToFile.prototype.attach = function (e) { }, ToFile.prototype.detach = function () { }, ToFile }(s.MediaHandler); t.ToFile = d }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.ToSoftDecoder = void 0; var o = r(11), s = r(2), u = r(0), d = r(26), c = r(64), l = a(r(65)), p = r(1), f = r(71), h = u.makeLogger("soft-decoder"), _ = function (e) { function ToSoftDecoder(t) { var n = e.call(this, t) || this; return n.preTimestamp = 0, n._lowFpsTimes = 0, n._firstFrame = !1, n._keyframes = [], n._lastRenderPts = 0, n._canvasWidth = 0, n._canvasHeight = 0, n._mse = new d.ToMSE(t), n._mse.onError = n._onError, s.isPthreadsSupported() ? n._decoder = r(13)(72) : n._decoder = r(13)(27), s.connectEventbus(n._decoder, n.onMessage, n._config), n.postMessage({ name: "init", params: s.configClone(n._decoder, t) }), n._updateTimer = setInterval(n.updatePlayTime, 1e3), n._decodeFpsDetect = new c.FpsDetect, n._renderFpsDetect = new c.FpsDetect, f.PageVisibility.onChange(n.handleVisibility), n.handleVisibility(), window.T_ADV_Timestamp = n.T_ADV_Timestamp, n } return i(ToSoftDecoder, e), ToSoftDecoder.prototype.dispose = function () { e.prototype.dispose.call(this), f.PageVisibility.offChange(this.handleVisibility), clearInterval(this._updateTimer), this._pendingFrame = null, this._mse && (this._mse.dispose(), this._mse = null), this._decodeFpsDetect && (this._decodeFpsDetect.destroy(), this._decodeFpsDetect = null), this._renderFpsDetect && (this._renderFpsDetect.destroy(), this._renderFpsDetect = null), this._decoder && (this._decoder.terminate(), this._decoder = null), h.log("disposed") }, ToSoftDecoder.prototype.postMessage = function (e, t) { this._decoder.postMessage(e, t) }, ToSoftDecoder.prototype.onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "frame": this._pendingFrame || requestAnimationFrame(this.renderFrame), this._pendingFrame = n, this._decodeFpsDetect.add(); break; case "_onError": this._onError(p.errorRestore(n)); break; case "end": clearInterval(this._updateTimer) } } catch (e) { h.warn("call soft decoder " + r + " error", e) } }, ToSoftDecoder.prototype.appendData = function (t) { if (!this._destroyed) { if (e.prototype.appendData.call(this, t), "audio" === t.type) t.trackLength = 1, this._mse.appendData(t); else if ("video" === t.type) { if (t.extradata) { var r = t.extradata, n = r.seiTimestamp, i = r.aacfil, a = r.sei; n && (this.seiTimestamp = n), i && this._onExtraData({ type: "aacfil", ts: t.pts, data: i }), a && this._onExtraData({ type: "sei", ts: t.pts, data: a }) } t.pts && (this.preTimestamp = t.pts), "video" === t.type && t.isKeyframe && (this._keyframes.push(t.pts / 1e3), this.onHasKeyframe && this.onHasKeyframe()), t.data && (this.postMessage({ name: "bytes", params: t.data }, [t.data.buffer]), delete t.data) } t.isEnd && this.appendEnd() } }, ToSoftDecoder.prototype.appendEnd = function () { this.postMessage({ name: "end" }) }, ToSoftDecoder.prototype.attach = function (t) { var r = this; if (e.prototype.attach.call(this, t), this._canvas = document.getElementById(this._config.canvasId), this._canvas) { this._canvas.style.visibility = "", this._mse.attach(t); try { this._yuvCanvas = l.default.attach(this._canvas, { webGL: !0, alpha: !1, premultipliedAlpha: !1, antialias: !1, powerPreference: "default", preserveDrawingBuffer: !1 }), this._canvasUpdateTimer = setInterval(this._onCanvasUpdate, 100) } catch (e) { setTimeout(function () { r.onWebglError(e) }, 0) } } else this._onError(new p.DyError("invalid canvas id: " + this._config.canvasId, p.ErrorIds.DecoderInvalidCanvas)) }, ToSoftDecoder.prototype.detach = function () { clearInterval(this._canvasUpdateTimer), this._canvas = null, this._video = null, this._yuvCanvas = null, this._mse && this._mse.detach(), e.prototype.detach.call(this) }, ToSoftDecoder.prototype.updatePlayTime = function () { var e = this; this.postMessage({ name: "playtime", params: this._video.currentTime }), this.checkPerformance(), this._keyframes = this._keyframes.filter(function (t) { return t >= e._lastRenderPts }) }, ToSoftDecoder.prototype.renderFrame = function () { if (this._pendingFrame) { var e = this._pendingFrame, t = e.width, r = e.height, n = e.pts, i = e.stride_y, a = e.stride_u, o = e.stride_v, s = e.y, u = e.u, d = e.v, c = this._canvasWidth, l = this._canvasHeight; if (!c || !l) return; var p = t / c; r > p * l && (p = r / l); var f = p * c, h = p * l, _ = (h - r) / 2, m = (f - t) / 2; try { this._yuvCanvas.drawFrame({ format: { top: _, left: m, width: t, height: r, chromaWidth: t / 2, chromaHeight: r / 2, cropLeft: 0, cropTop: 0, cropWidth: t, cropHeight: r, displayWidth: f, displayHeight: h }, y: { stride: i, bytes: s }, u: { stride: a, bytes: u }, v: { stride: o, bytes: d } }), this._lastRenderPts = n, this._renderFpsDetect.add(), this._firstFrame || (this._firstFrame = !0, this.onHasKeyframe && this.onHasKeyframe()) } catch (e) { this.onWebglError(e) } this._pendingFrame = null } }, ToSoftDecoder.prototype.getStatInfo = function () { var e = this._decodeFpsDetect.total; return { decodedFrames: e, droppedFrames: e - this._renderFpsDetect.total, decodeFps: this._decodeFpsDetect.fps, renderFps: this._renderFpsDetect.fps } }, ToSoftDecoder.prototype.handleVisibility = function () { this.postMessage({ name: "visibility", params: f.PageVisibility.isHidden() }) }, ToSoftDecoder.prototype.checkPerformance = function () { var e; (null === (e = this._mediaInfo) || void 0 === e ? void 0 : e.fps) && this._decodeFpsDetect.fps && (this._decodeFpsDetect.fps < this._mediaInfo.fps - 2 ? this._lowFpsTimes++ : this._lowFpsTimes = 0, this._lowFpsTimes > 20 && this._video && this._video.currentTime && Math.abs(this._video.currentTime - this._lastRenderPts) > 2 && (h.warn("soft decode low performance"), this._lowFpsTimes = 0, this.onLowPerformance && this.onLowPerformance())) }, ToSoftDecoder.prototype.onWebglError = function (e) { this._onError(new p.DyError("webgl error: " + e, p.ErrorIds.RenderWebglError)) }, ToSoftDecoder.prototype.T_ADV_Timestamp = function () { if (this._video) { var e = this._video; if (0 == e.buffered.length) return; return { bufferLength: e.buffered.end(0) - e.currentTime, ptsTimestamp: this.preTimestamp, seiTimestamp: this.seiTimestamp, keyframes: this._keyframes.concat() } } }, ToSoftDecoder.prototype._onCanvasUpdate = function () { this._canvas && (this._canvasWidth = this._canvas.clientWidth, this._canvasHeight = this._canvas.clientHeight) }, ToSoftDecoder.prototype._onError = function (e) { this.onError && this.onError(e) }, ToSoftDecoder.prototype.getBufferTime = function () { return (this.preTimestamp - this._lastRenderPts) / 1e3 }, ToSoftDecoder.prototype.getCurrentTime = function () { return this.preTimestamp / 1e3 }, ToSoftDecoder.prototype.getIsWaiting = function () { return this._mse.getIsWaiting() }, ToSoftDecoder }(o.MediaHandler); t.ToSoftDecoder = _ }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.FpsDetect = void 0; var n = r(3), i = function () { function FpsDetect() { this._count = 0, this._fps = 0, this._total = 0, n.bindAll(this), this._timer = setInterval(this._onTimer, 1e3), this._lastTime = Date.now() } return Object.defineProperty(FpsDetect.prototype, "fps", { get: function () { return this._fps }, enumerable: !1, configurable: !0 }), Object.defineProperty(FpsDetect.prototype, "total", { get: function () { return this._total }, enumerable: !1, configurable: !0 }), FpsDetect.prototype.destroy = function () { clearInterval(this._timer) }, FpsDetect.prototype.add = function (e) { void 0 === e && (e = 1), this._count += e, this._total += e }, FpsDetect.prototype._onTimer = function () { var e = Date.now(), t = e - this._lastTime; this._fps = this._count / (t / 1e3), this._count = 0, this._lastTime = e, this.onFps && this.onFps(this._fps) }, FpsDetect }(); t.FpsDetect = i }, function (e, t, r) { !function () { "use strict"; var t = r(14), n = r(66), i = r(69), a = { FrameSink: t, SoftwareFrameSink: n, WebGLFrameSink: i, attach: function (e, t) { return ("webGL" in (t = t || {}) ? t.webGL : i.isAvailable()) ? new i(e, t) : new n(e, t) } }; e.exports = a }() }, function (e, t, r) { !function () { "use strict"; var t = r(14), n = r(67); function SoftwareFrameSink(e, t) { var r = e.getContext("2d", t), i = null; return this.drawFrame = function drawFrame(t) { var a = t.format; e.width === a.displayWidth && e.height === a.displayHeight || (e.width = a.displayWidth, e.height = a.displayHeight), null !== i && i.width == a.width && i.height == a.height || function initImageData(e, t) { for (var n = (i = r.createImageData(e, t)).data, a = e * t * 4, o = 0; o < a; o += 4)n[o + 3] = 255 }(a.width, a.height), n.convertYCbCr(t, i.data), r.putImageData(i, a.left, a.top, a.cropLeft, a.cropTop, a.cropWidth, a.cropHeight) }, this.clear = function () { r.clearRect(0, 0, e.width, e.height) }, this } SoftwareFrameSink.prototype = Object.create(t.prototype), e.exports = SoftwareFrameSink }() }, function (e, t, r) { !function () { "use strict"; var t = r(68); e.exports = { convertYCbCr: function convertYCbCr(e, r) { var n = 0 | e.format.width, i = 0 | e.format.height, a = 0 | t(e.format.width / e.format.chromaWidth), o = 0 | t(e.format.height / e.format.chromaHeight), s = e.y.bytes, u = e.u.bytes, d = e.v.bytes, c = 0 | e.y.stride, l = 0 | e.u.stride, p = 0 | e.v.stride, f = n << 2, h = 0, _ = 0, m = 0, y = 0, v = 0, g = 0, b = 0, w = 0, E = 0, T = 0, S = 0, P = 0, A = 0, O = 0, M = 0, k = 0, D = 0, L = 0; if (1 == a && 1 == o) for (b = 0, w = f, L = 0, k = 0; k < i; k += 2) { for (m = (_ = k * c | 0) + c | 0, y = L * l | 0, v = L * p | 0, M = 0; M < n; M += 2)E = 0 | u[y++], P = (409 * (T = 0 | d[v++]) | 0) - 57088 | 0, A = (100 * E | 0) + (208 * T | 0) - 34816 | 0, O = (516 * E | 0) - 70912 | 0, S = 298 * s[_++] | 0, r[b] = S + P >> 8, r[b + 1] = S - A >> 8, r[b + 2] = S + O >> 8, b += 4, S = 298 * s[_++] | 0, r[b] = S + P >> 8, r[b + 1] = S - A >> 8, r[b + 2] = S + O >> 8, b += 4, S = 298 * s[m++] | 0, r[w] = S + P >> 8, r[w + 1] = S - A >> 8, r[w + 2] = S + O >> 8, w += 4, S = 298 * s[m++] | 0, r[w] = S + P >> 8, r[w + 1] = S - A >> 8, r[w + 2] = S + O >> 8, w += 4; b += f, w += f, L++ } else for (g = 0, k = 0; k < i; k++)for (D = 0, h = k * c | 0, y = (L = k >> o) * l | 0, v = L * p | 0, M = 0; M < n; M++)E = 0 | u[y + (D = M >> a)], P = (409 * (T = 0 | d[v + D]) | 0) - 57088 | 0, A = (100 * E | 0) + (208 * T | 0) - 34816 | 0, O = (516 * E | 0) - 70912 | 0, S = 298 * s[h++] | 0, r[g] = S + P >> 8, r[g + 1] = S - A >> 8, r[g + 2] = S + O >> 8, g += 4 } } }() }, function (e, t) { !function () { "use strict"; e.exports = function depower(e) { for (var t = 0, r = e >> 1; 0 != r;)r >>= 1, t++; if (e !== 1 << t) throw "chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got " + e; return t } }() }, function (e, t, r) { !function () { "use strict"; var t = r(14), n = r(70); function WebGLFrameSink(e, t) { var r, i, a = this, o = WebGLFrameSink.contextForCanvas(e, t); if (null === o) throw new Error("WebGL unavailable"); function compileShader(e, t) { var r = o.createShader(e); if (o.shaderSource(r, t), o.compileShader(r), !o.getShaderParameter(r, o.COMPILE_STATUS)) { var n = o.getShaderInfoLog(r); throw o.deleteShader(r), new Error("GL shader compilation for " + e + " failed: " + n) } return r } var s, u, d, c, l, p, f, h, _, m, y = new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), v = {}, g = {}, b = {}; function createOrReuseTexture(e) { return v[e] || (v[e] = o.createTexture()), v[e] } function uploadTexture(e, t, r, n) { var i = createOrReuseTexture(e); if (o.activeTexture(o.TEXTURE0), WebGLFrameSink.stripe) { var a = !v[e + "_temp"], s = createOrReuseTexture(e + "_temp"); o.bindTexture(o.TEXTURE_2D, s), a ? (o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.NEAREST), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.NEAREST), o.texImage2D(o.TEXTURE_2D, 0, o.RGBA, t / 4, r, 0, o.RGBA, o.UNSIGNED_BYTE, n)) : o.texSubImage2D(o.TEXTURE_2D, 0, 0, 0, t / 4, r, o.RGBA, o.UNSIGNED_BYTE, n); var u = v[e + "_stripe"], d = !u; d && (u = createOrReuseTexture(e + "_stripe")), o.bindTexture(o.TEXTURE_2D, u), d && (o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.NEAREST), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.NEAREST), o.texImage2D(o.TEXTURE_2D, 0, o.RGBA, t, 1, 0, o.RGBA, o.UNSIGNED_BYTE, function buildStripe(e) { if (b[e]) return b[e]; for (var t = e, r = new Uint32Array(t), n = 0; n < t; n += 4)r[n] = 255, r[n + 1] = 65280, r[n + 2] = 16711680, r[n + 3] = 4278190080; return b[e] = new Uint8Array(r.buffer) }(t))) } else o.bindTexture(o.TEXTURE_2D, i), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.LINEAR), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.LINEAR), o.texImage2D(o.TEXTURE_2D, 0, o.LUMINANCE, t, r, 0, o.LUMINANCE, o.UNSIGNED_BYTE, n) } function unpackTexture(e, t, r) { var n = v[e]; o.useProgram(i); var a = g[e]; a || (o.activeTexture(o.TEXTURE0), o.bindTexture(o.TEXTURE_2D, n), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.LINEAR), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.LINEAR), o.texImage2D(o.TEXTURE_2D, 0, o.RGBA, t, r, 0, o.RGBA, o.UNSIGNED_BYTE, null), a = g[e] = o.createFramebuffer()), o.bindFramebuffer(o.FRAMEBUFFER, a), o.framebufferTexture2D(o.FRAMEBUFFER, o.COLOR_ATTACHMENT0, o.TEXTURE_2D, n, 0); var f = v[e + "_temp"]; o.activeTexture(o.TEXTURE1), o.bindTexture(o.TEXTURE_2D, f), o.uniform1i(p, 1); var h = v[e + "_stripe"]; o.activeTexture(o.TEXTURE2), o.bindTexture(o.TEXTURE_2D, h), o.uniform1i(l, 2), o.bindBuffer(o.ARRAY_BUFFER, s), o.enableVertexAttribArray(u), o.vertexAttribPointer(u, 2, o.FLOAT, !1, 0, 0), o.bindBuffer(o.ARRAY_BUFFER, d), o.enableVertexAttribArray(c), o.vertexAttribPointer(c, 2, o.FLOAT, !1, 0, 0), o.viewport(0, 0, t, r), o.drawArrays(o.TRIANGLES, 0, y.length / 2), o.bindFramebuffer(o.FRAMEBUFFER, null) } function attachTexture(e, t, n) { o.activeTexture(t), o.bindTexture(o.TEXTURE_2D, v[e]), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.LINEAR), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.LINEAR), o.uniform1i(o.getUniformLocation(r, e), n) } function initProgram(e, t) { var r = compileShader(o.VERTEX_SHADER, e), n = compileShader(o.FRAGMENT_SHADER, t), i = o.createProgram(); if (o.attachShader(i, r), o.attachShader(i, n), o.linkProgram(i), !o.getProgramParameter(i, o.LINK_STATUS)) { var a = o.getProgramInfoLog(i); throw o.deleteProgram(i), new Error("GL program linking failed: " + a) } return i } return a.drawFrame = function (t) { var v = t.format, g = !r || e.width !== v.displayWidth || e.height !== v.displayHeight; if (g && (e.width = v.displayWidth, e.height = v.displayHeight, a.clear()), r || function init() { if (WebGLFrameSink.stripe) { i = initProgram(n.vertexStripe, n.fragmentStripe), o.getAttribLocation(i, "aPosition"), d = o.createBuffer(); var e = new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]); o.bindBuffer(o.ARRAY_BUFFER, d), o.bufferData(o.ARRAY_BUFFER, e, o.STATIC_DRAW), c = o.getAttribLocation(i, "aTexturePosition"), l = o.getUniformLocation(i, "uStripe"), p = o.getUniformLocation(i, "uTexture") } r = initProgram(n.vertex, n.fragment), s = o.createBuffer(), o.bindBuffer(o.ARRAY_BUFFER, s), o.bufferData(o.ARRAY_BUFFER, y, o.STATIC_DRAW), u = o.getAttribLocation(r, "aPosition"), f = o.createBuffer(), h = o.getAttribLocation(r, "aLumaPosition"), _ = o.createBuffer(), m = o.getAttribLocation(r, "aChromaPosition") }(), g) { var b = function (e, t, r) { var n = v.cropLeft / r, i = (v.cropLeft + v.cropWidth) / r, a = (v.cropTop + v.cropHeight) / v.height, s = v.cropTop / v.height, u = new Float32Array([n, a, i, a, n, s, n, s, i, a, i, s]); o.bindBuffer(o.ARRAY_BUFFER, e), o.bufferData(o.ARRAY_BUFFER, u, o.STATIC_DRAW) }; b(f, 0, t.y.stride), b(_, 0, t.u.stride * v.width / v.chromaWidth) } uploadTexture("uTextureY", t.y.stride, v.height, t.y.bytes), uploadTexture("uTextureCb", t.u.stride, v.chromaHeight, t.u.bytes), uploadTexture("uTextureCr", t.v.stride, v.chromaHeight, t.v.bytes), WebGLFrameSink.stripe && (unpackTexture("uTextureY", t.y.stride, v.height), unpackTexture("uTextureCb", t.u.stride, v.chromaHeight), unpackTexture("uTextureCr", t.v.stride, v.chromaHeight)), o.useProgram(r), o.viewport(v.left, v.top, v.width, v.height), attachTexture("uTextureY", o.TEXTURE0, 0), attachTexture("uTextureCb", o.TEXTURE1, 1), attachTexture("uTextureCr", o.TEXTURE2, 2), o.bindBuffer(o.ARRAY_BUFFER, s), o.enableVertexAttribArray(u), o.vertexAttribPointer(u, 2, o.FLOAT, !1, 0, 0), o.bindBuffer(o.ARRAY_BUFFER, f), o.enableVertexAttribArray(h), o.vertexAttribPointer(h, 2, o.FLOAT, !1, 0, 0), o.bindBuffer(o.ARRAY_BUFFER, _), o.enableVertexAttribArray(m), o.vertexAttribPointer(m, 2, o.FLOAT, !1, 0, 0), o.drawArrays(o.TRIANGLES, 0, y.length / 2) }, a.clear = function () { o.viewport(0, 0, e.width, e.height), o.clearColor(0, 0, 0, 0), o.clear(o.COLOR_BUFFER_BIT) }, a.clear(), a } WebGLFrameSink.stripe = -1 !== navigator.userAgent.indexOf("Windows"), WebGLFrameSink.contextForCanvas = function (e, t) { var r = { preferLowPowerToHighPerformance: !0, powerPreference: "low-power", failIfMajorPerformanceCaveat: !0, preserveDrawingBuffer: !0 }; return Object.assign(r, t), e.getContext("webgl2", r) || e.getContext("webgl", r) || e.getContext("experimental-webgl", r) }, WebGLFrameSink.isAvailable = function () { var e, t = document.createElement("canvas"); t.width = 1, t.height = 1; try { e = WebGLFrameSink.contextForCanvas(t) } catch (e) { return !1 } if (e) { var r = e.TEXTURE0, n = e.createTexture(), i = new Uint8Array(16), a = WebGLFrameSink.stripe ? 1 : 4, o = WebGLFrameSink.stripe ? e.RGBA : e.LUMINANCE, s = WebGLFrameSink.stripe ? e.NEAREST : e.LINEAR; return e.activeTexture(r), e.bindTexture(e.TEXTURE_2D, n), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, s), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, s), e.texImage2D(e.TEXTURE_2D, 0, o, a, 4, 0, o, e.UNSIGNED_BYTE, i), !e.getError() } return !1 }, WebGLFrameSink.prototype = Object.create(t.prototype), e.exports = WebGLFrameSink }() }, function (e, t) { e.exports = { vertex: "precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n", fragment: "// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision lowp float;\n\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.\n   float fY = texture2D(uTextureY, vLumaPosition).x;\n   float fCb = texture2D(uTextureCb, vChromaPosition).x;\n   float fCr = texture2D(uTextureCr, vChromaPosition).x;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n", vertexStripe: "precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aTexturePosition;\nvarying vec2 vTexturePosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vTexturePosition = aTexturePosition;\n}\n", fragmentStripe: "// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision lowp float;\n\nuniform sampler2D uStripe;\nuniform sampler2D uTexture;\nvarying vec2 vTexturePosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn't allow LUMINANCE or ALPHA textures\n   // The stripe textures mark which channel to keep for each pixel.\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n\n   float fLuminance = dot(\n      texture2D(uStripe, vTexturePosition),\n      texture2D(uTexture, vTexturePosition)\n   );\n\n   gl_FragColor = vec4(fLuminance, fLuminance, fLuminance, 1);\n}\n" } }, function (e, t, r) { "use strict"; var n, i; Object.defineProperty(t, "__esModule", { value: !0 }), t.PageVisibility = void 0, "undefined" !== typeof document.hidden ? (n = "hidden", i = "visibilitychange") : "undefined" !== typeof document.msHidden ? (n = "msHidden", i = "msvisibilitychange") : "undefined" !== typeof document.webkitHidden && (n = "webkitHidden", i = "webkitvisibilitychange"), t.PageVisibility = { isHidden: function isHidden() { return n && document[n] }, onChange: function onChange(e) { i && document.addEventListener(i, e) }, offChange: function offChange(e) { i && document.removeEventListener(i, e) } } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var o = r(0), s = a(r(27)), u = r(2), d = r(1), c = o.makeLogger("decoder-pthreads"), l = r(73), p = URL.createObjectURL(new Blob([l], { type: "text/javascript" })), f = r(74), h = URL.createObjectURL(new Blob([f], { type: "text/javascript" })), _ = function (e) { function DecoderPthreads() { return null !== e && e.apply(this, arguments) || this } return i(DecoderPthreads, e), DecoderPthreads.prototype._initWasm = function () { var e = this; c.log("Decode with multi threads."); var t = this._config.__internal.wasmDecoderPthread, r = function () { __Decoder({ mainScriptUrlOrBlob: p, locateFile: function (e) { return -1 === e.indexOf(".wasm") ? h : t }, jsLib: { outer_read: e.outer_read, outer_close: e.outer_close, frame_out: e.frame_out, get_play_time: e.get_play_time, play_exit: e.play_exit }, onAbort: function (t) { return e._onError(new d.DyError("decode error: " + t, d.ErrorIds.DecoderDecodeError)) } }).then(function (t) { c.log("wasm load complete"), e._wasm = t, e._wasm._log_init(e._config.debug ? 32 : 16), e._wasm._set_hidden(e._hidden ? 1 : 0), e._wasm._play(t.allocateUTF8("custom:mp4")) }) }; this.inWorker ? (importScripts(p), r()) : u.loadScript(p).then(r).catch(this._onError) }, DecoderPthreads }(s.default); t.default = _ }, function (e, t) { e.exports = '\nvar __Decoder = (function() {\n  var _scriptDir = typeof document !== \'undefined\' && document.currentScript ? document.currentScript.src : undefined;\n  \n  return (\nfunction(__Decoder) {\n  __Decoder = __Decoder || {};\n\nnull;var Module=typeof __Decoder!=="undefined"?__Decoder:{};var readyPromiseResolve,readyPromiseReject;Module["ready"]=new Promise(function(resolve,reject){readyPromiseResolve=resolve;readyPromiseReject=reject});var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram="./this.program";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function";ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var ENVIRONMENT_IS_PTHREAD=Module["ENVIRONMENT_IS_PTHREAD"]||false;if(ENVIRONMENT_IS_PTHREAD){buffer=Module["buffer"];DYNAMIC_BASE=Module["DYNAMIC_BASE"];DYNAMICTOP_PTR=Module["DYNAMICTOP_PTR"]}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var read_,readAsync,readBinary,setWindowTitle;if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(document.currentScript){scriptDirectory=document.currentScript.src}if(_scriptDir){scriptDirectory=_scriptDir}if(scriptDirectory.indexOf("blob:")!==0){scriptDirectory=scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1)}else{scriptDirectory=""}{read_=function shell_read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER){readBinary=function readBinary(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=function readAsync(url,onload,onerror){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)}}setWindowTitle=function(title){document.title=title}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.warn.bind(console);for(key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];if(Module["quit"])quit_=Module["quit"];function warnOnce(text){if(!warnOnce.shown)warnOnce.shown={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;err(text)}}var tempRet0=0;var getTempRet0=function(){return tempRet0};var Atomics_load=Atomics.load;var Atomics_store=Atomics.store;var Atomics_compareExchange=Atomics.compareExchange;var wasmBinary;if(Module["wasmBinary"])wasmBinary=Module["wasmBinary"];var noExitRuntime;if(Module["noExitRuntime"])noExitRuntime=Module["noExitRuntime"];if(typeof WebAssembly!=="object"){abort("no native wasm support detected")}var wasmMemory;var wasmTable=new WebAssembly.Table({"initial":489,"maximum":489+0,"element":"anyfunc"});var wasmModule;var threadInfoStruct=0;var selfThreadId=0;var ABORT=false;var EXITSTATUS=0;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}function UTF8ArrayToString(heap,idx,maxBytesToRead){var endIdx=idx+maxBytesToRead;var str="";while(!(idx>=endIdx)){var u0=heap[idx++];if(!u0)return str;if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heap[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heap[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heap[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str}function UTF8ToString(ptr,maxBytesToRead){return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""}function stringToUTF8Array(str,heap,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6;heap[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++]=240|u>>18;heap[outIdx++]=128|u>>12&63;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}}heap[outIdx]=0;return outIdx-startIdx}function stringToUTF8(str,outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}function lengthBytesUTF8(str){var len=0;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else len+=4}return len}function allocateUTF8(str){var size=lengthBytesUTF8(str)+1;var ret=_malloc(size);if(ret)stringToUTF8Array(str,HEAP8,ret,size);return ret}function writeArrayToMemory(array,buffer){HEAP8.set(array,buffer)}function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;++i){HEAP8[buffer++>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer>>0]=0}var WASM_PAGE_SIZE=65536;var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBufferAndViews(buf){buffer=buf;Module["HEAP8"]=HEAP8=new Int8Array(buf);Module["HEAP16"]=HEAP16=new Int16Array(buf);Module["HEAP32"]=HEAP32=new Int32Array(buf);Module["HEAPU8"]=HEAPU8=new Uint8Array(buf);Module["HEAPU16"]=HEAPU16=new Uint16Array(buf);Module["HEAPU32"]=HEAPU32=new Uint32Array(buf);Module["HEAPF32"]=HEAPF32=new Float32Array(buf);Module["HEAPF64"]=HEAPF64=new Float64Array(buf)}var STACK_BASE=5568960,STACKTOP=STACK_BASE,STACK_MAX=326080,DYNAMIC_BASE=5568960,DYNAMICTOP_PTR=325152;if(ENVIRONMENT_IS_PTHREAD){}var INITIAL_INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;if(ENVIRONMENT_IS_PTHREAD){wasmMemory=Module["wasmMemory"];buffer=Module["buffer"]}else{if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{wasmMemory=new WebAssembly.Memory({"initial":INITIAL_INITIAL_MEMORY/WASM_PAGE_SIZE,"maximum":INITIAL_INITIAL_MEMORY/WASM_PAGE_SIZE,"shared":true});if(!(wasmMemory.buffer instanceof SharedArrayBuffer)){err("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag");if(ENVIRONMENT_IS_NODE){console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)")}throw Error("bad memory")}}}if(wasmMemory){buffer=wasmMemory.buffer}INITIAL_INITIAL_MEMORY=buffer.byteLength;updateGlobalBufferAndViews(buffer);if(!ENVIRONMENT_IS_PTHREAD){HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE}function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback(Module);continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){Module["dynCall_v"](func)}else{Module["dynCall_vi"](func,callback.arg)}}else{func(callback.arg===undefined?null:callback.arg)}}}var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATEXIT__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;if(ENVIRONMENT_IS_PTHREAD)runtimeInitialized=true;function preRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){if(ENVIRONMENT_IS_PTHREAD)return;callRuntimeCallbacks(__ATMAIN__)}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var Math_ceil=Math.ceil;var Math_floor=Math.floor;var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){assert(!ENVIRONMENT_IS_PTHREAD,"addRunDependency cannot be used in a pthread worker");runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};function abort(what){if(Module["onAbort"]){Module["onAbort"](what)}if(ENVIRONMENT_IS_PTHREAD)console.error("Pthread aborting at "+(new Error).stack);what+="";err(what);ABORT=true;EXITSTATUS=1;what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(what);readyPromiseReject(e);throw e}function hasPrefix(str,prefix){return String.prototype.startsWith?str.startsWith(prefix):str.indexOf(prefix)===0}var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return hasPrefix(filename,dataURIPrefix)}var wasmBinaryFile="decoder.pthreads.wasm";if(!isDataURI(wasmBinaryFile)){wasmBinaryFile=locateFile(wasmBinaryFile)}function getBinary(){try{if(wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(wasmBinaryFile)}else{throw"both async and sync fetching of the wasm failed"}}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&typeof fetch==="function"){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"]){throw"failed to load wasm binary file at \'"+wasmBinaryFile+"\'"}return response["arrayBuffer"]()}).catch(function(){return getBinary()})}return new Promise(function(resolve,reject){resolve(getBinary())})}function createWasm(){var info={"a":asmLibraryArg};function receiveInstance(instance,module){var exports=instance.exports;exports=Asyncify.instrumentWasmExports(exports);Module["asm"]=exports;wasmModule=module;if(!ENVIRONMENT_IS_PTHREAD){var numWorkersToLoad=PThread.unusedWorkers.length;PThread.unusedWorkers.forEach(function(w){PThread.loadWasmModuleToWorker(w,function(){if(!--numWorkersToLoad)removeRunDependency("wasm-instantiate")})})}}if(!ENVIRONMENT_IS_PTHREAD){addRunDependency("wasm-instantiate")}function receiveInstantiatedSource(output){receiveInstance(output["instance"],output["module"])}function instantiateArrayBuffer(receiver){return getBinaryPromise().then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason);abort(reason)})}function instantiateAsync(){if(!wasmBinary&&typeof WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&typeof fetch==="function"){fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){var result=WebAssembly.instantiateStreaming(response,info);return result.then(receiveInstantiatedSource,function(reason){err("wasm streaming compile failed: "+reason);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(receiveInstantiatedSource)})})}else{return instantiateArrayBuffer(receiveInstantiatedSource)}}if(Module["instantiateWasm"]){try{var exports=Module["instantiateWasm"](info,receiveInstance);exports=Asyncify.instrumentWasmExports(exports);return exports}catch(e){err("Module.instantiateWasm callback failed with error: "+e);return false}}instantiateAsync();return{}}var ASM_CONSTS={306944:function(){throw"Canceled!"},307164:function($0,$1){setTimeout(function(){_do_emscripten_dispatch_to_thread($0,$1)},0)}};function _emscripten_asm_const_iii(code,sigPtr,argbuf){var args=readAsmConstArgs(sigPtr,argbuf);return ASM_CONSTS[code].apply(null,args)}function initPthreadsJS(){PThread.initRuntime()}if(!ENVIRONMENT_IS_PTHREAD)__ATINIT__.push({func:function(){___wasm_call_ctors()}});var __pthread_ptr=0;var __pthread_is_main_runtime_thread=0;var __pthread_is_main_browser_thread=0;function registerPthreadPtr(pthreadPtr,isMainBrowserThread,isMainRuntimeThread){pthreadPtr=pthreadPtr|0;isMainBrowserThread=isMainBrowserThread|0;isMainRuntimeThread=isMainRuntimeThread|0;__pthread_ptr=pthreadPtr;__pthread_is_main_browser_thread=isMainBrowserThread;__pthread_is_main_runtime_thread=isMainRuntimeThread}Module["registerPthreadPtr"]=registerPthreadPtr;var ERRNO_CODES={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var __main_thread_futex_wait_address=326064;function _emscripten_futex_wake(addr,count){if(addr<=0||addr>HEAP8.length||addr&3!=0||count<0)return-28;if(count==0)return 0;if(count>=2147483647)count=Infinity;var mainThreadWaitAddress=Atomics.load(HEAP32,__main_thread_futex_wait_address>>2);var mainThreadWoken=0;if(mainThreadWaitAddress==addr){var loadedAddr=Atomics.compareExchange(HEAP32,__main_thread_futex_wait_address>>2,mainThreadWaitAddress,0);if(loadedAddr==mainThreadWaitAddress){--count;mainThreadWoken=1;if(count<=0)return 1}}var ret=Atomics.notify(HEAP32,addr>>2,count);if(ret>=0)return ret+mainThreadWoken;throw"Atomics.notify returned an unexpected value "+ret}Module["_emscripten_futex_wake"]=_emscripten_futex_wake;function killThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in killThread!";HEAP32[pthread_ptr+12>>2]=0;var pthread=PThread.pthreads[pthread_ptr];pthread.worker.terminate();PThread.freeThreadData(pthread);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(pthread.worker),1);pthread.worker.pthread=undefined}function cancelThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in cancelThread!";var pthread=PThread.pthreads[pthread_ptr];pthread.worker.postMessage({"cmd":"cancel"})}function cleanupThread(pthread_ptr){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!pthread_ptr)throw"Internal Error! Null pthread_ptr in cleanupThread!";HEAP32[pthread_ptr+12>>2]=0;var pthread=PThread.pthreads[pthread_ptr];if(pthread){var worker=pthread.worker;PThread.returnWorkerToPool(worker)}}var PThread={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initRuntime:function(){registerPthreadPtr(PThread.mainThreadBlock,!ENVIRONMENT_IS_WORKER,1);_emscripten_register_main_browser_thread_id(PThread.mainThreadBlock)},initMainThreadBlock:function(){var pthreadPoolSize=4;for(var i=0;i<pthreadPoolSize;++i){PThread.allocateUnusedWorker()}PThread.mainThreadBlock=325312;for(var i=0;i<232/4;++i)HEAPU32[PThread.mainThreadBlock/4+i]=0;HEAP32[PThread.mainThreadBlock+12>>2]=PThread.mainThreadBlock;var headPtr=PThread.mainThreadBlock+156;HEAP32[headPtr>>2]=headPtr;var tlsMemory=325552;for(var i=0;i<128;++i)HEAPU32[tlsMemory/4+i]=0;Atomics.store(HEAPU32,PThread.mainThreadBlock+104>>2,tlsMemory);Atomics.store(HEAPU32,PThread.mainThreadBlock+40>>2,PThread.mainThreadBlock);Atomics.store(HEAPU32,PThread.mainThreadBlock+44>>2,42)},initWorker:function(){},pthreads:{},threadExitHandlers:[],setThreadStatus:function(){},runExitHandlers:function(){while(PThread.threadExitHandlers.length>0){PThread.threadExitHandlers.pop()()}if(ENVIRONMENT_IS_PTHREAD&&threadInfoStruct)___pthread_tsd_run_dtors()},threadExit:function(exitCode){var tb=_pthread_self();if(tb){Atomics.store(HEAPU32,tb+4>>2,exitCode);Atomics.store(HEAPU32,tb+0>>2,1);Atomics.store(HEAPU32,tb+60>>2,1);Atomics.store(HEAPU32,tb+64>>2,0);PThread.runExitHandlers();_emscripten_futex_wake(tb+0,2147483647);registerPthreadPtr(0,0,0);threadInfoStruct=0;if(ENVIRONMENT_IS_PTHREAD){postMessage({"cmd":"exit"})}}},threadCancel:function(){PThread.runExitHandlers();Atomics.store(HEAPU32,threadInfoStruct+4>>2,-1);Atomics.store(HEAPU32,threadInfoStruct+0>>2,1);_emscripten_futex_wake(threadInfoStruct+0,2147483647);threadInfoStruct=selfThreadId=0;registerPthreadPtr(0,0,0);postMessage({"cmd":"cancelDone"})},terminateAllThreads:function(){for(var t in PThread.pthreads){var pthread=PThread.pthreads[t];if(pthread&&pthread.worker){PThread.returnWorkerToPool(pthread.worker)}}PThread.pthreads={};for(var i=0;i<PThread.unusedWorkers.length;++i){var worker=PThread.unusedWorkers[i];worker.terminate()}PThread.unusedWorkers=[];for(var i=0;i<PThread.runningWorkers.length;++i){var worker=PThread.runningWorkers[i];var pthread=worker.pthread;PThread.freeThreadData(pthread);worker.terminate()}PThread.runningWorkers=[]},freeThreadData:function(pthread){if(!pthread)return;if(pthread.threadInfoStruct){var tlsMemory=HEAP32[pthread.threadInfoStruct+104>>2];HEAP32[pthread.threadInfoStruct+104>>2]=0;_free(tlsMemory);_free(pthread.threadInfoStruct)}pthread.threadInfoStruct=0;if(pthread.allocatedOwnStack&&pthread.stackBase)_free(pthread.stackBase);pthread.stackBase=0;if(pthread.worker)pthread.worker.pthread=null},returnWorkerToPool:function(worker){delete PThread.pthreads[worker.pthread.thread];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);PThread.freeThreadData(worker.pthread);worker.pthread=undefined},receiveObjectTransfer:function(data){},loadWasmModuleToWorker:function(worker,onFinishedLoading){worker.onmessage=function(e){var d=e["data"];var cmd=d["cmd"];if(worker.pthread)PThread.currentProxiedOperationCallerThread=worker.pthread.threadInfoStruct;if(d["targetThread"]&&d["targetThread"]!=_pthread_self()){var thread=PThread.pthreads[d.targetThread];if(thread){thread.worker.postMessage(e.data,d["transferList"])}else{console.error(\'Internal error! Worker sent a message "\'+cmd+\'" to target pthread \'+d["targetThread"]+", but that thread no longer exists!")}PThread.currentProxiedOperationCallerThread=undefined;return}if(cmd==="processQueuedMainThreadWork"){_emscripten_main_thread_process_queued_calls()}else if(cmd==="spawnThread"){spawnThread(e.data)}else if(cmd==="cleanupThread"){cleanupThread(d["thread"])}else if(cmd==="killThread"){killThread(d["thread"])}else if(cmd==="cancelThread"){cancelThread(d["thread"])}else if(cmd==="loaded"){worker.loaded=true;if(onFinishedLoading)onFinishedLoading(worker);if(worker.runPthread){worker.runPthread();delete worker.runPthread}}else if(cmd==="print"){out("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="printErr"){err("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="alert"){alert("Thread "+d["threadId"]+": "+d["text"])}else if(cmd==="exit"){var detached=worker.pthread&&Atomics.load(HEAPU32,worker.pthread.thread+68>>2);if(detached){PThread.returnWorkerToPool(worker)}}else if(cmd==="cancelDone"){PThread.returnWorkerToPool(worker)}else if(cmd==="objectTransfer"){PThread.receiveObjectTransfer(e.data)}else if(e.data.target==="setimmediate"){worker.postMessage(e.data)}else{err("worker sent an unknown command "+cmd)}PThread.currentProxiedOperationCallerThread=undefined};worker.onerror=function(e){err("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)};worker.postMessage({"cmd":"load","urlOrBlob":Module["mainScriptUrlOrBlob"]||_scriptDir,"wasmMemory":wasmMemory,"wasmModule":wasmModule,"DYNAMIC_BASE":DYNAMIC_BASE,"DYNAMICTOP_PTR":DYNAMICTOP_PTR})},allocateUnusedWorker:function(){var pthreadMainJs=locateFile("decoder.pthreads.worker.js");PThread.unusedWorkers.push(new Worker(pthreadMainJs))},getNewWorker:function(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}if(PThread.unusedWorkers.length>0)return PThread.unusedWorkers.pop();else return null},busySpinWait:function(msecs){var t=performance.now()+msecs;while(performance.now()<t){}}};function establishStackSpace(stackTop,stackMax){STACK_BASE=STACKTOP=stackTop;STACK_MAX=stackMax;stackRestore(stackTop)}Module["establishStackSpace"]=establishStackSpace;function getNoExitRuntime(){return noExitRuntime}Module["getNoExitRuntime"]=getNoExitRuntime;function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+UTF8ToString(condition)+", at: "+[filename?UTF8ToString(filename):"unknown filename",line,func?UTF8ToString(func):"unknown function"])}var _emscripten_get_now;if(ENVIRONMENT_IS_PTHREAD){_emscripten_get_now=function(){return performance.now()-Module["__performance_now_clock_drift"]}}else _emscripten_get_now=function(){return performance.now()};var _emscripten_get_now_is_monotonic=true;function setErrNo(value){HEAP32[___errno_location()>>2]=value;return value}function _clock_gettime(clk_id,tp){var now;if(clk_id===0){now=Date.now()}else if((clk_id===1||clk_id===4)&&_emscripten_get_now_is_monotonic){now=_emscripten_get_now()}else{setErrNo(28);return-1}HEAP32[tp>>2]=now/1e3|0;HEAP32[tp+4>>2]=now%1e3*1e3*1e3|0;return 0}var PATH={splitPath:function(filename){var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:function(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:function(path){var isAbsolute=path.charAt(0)==="/",trailingSlash=path.substr(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:function(path){var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir},basename:function(path){if(path==="/")return"/";var lastSlash=path.lastIndexOf("/");if(lastSlash===-1)return path;return path.substr(lastSlash+1)},extname:function(path){return PATH.splitPath(path)[3]},join:function(){var paths=Array.prototype.slice.call(arguments,0);return PATH.normalize(paths.join("/"))},join2:function(l,r){return PATH.normalize(l+"/"+r)}};var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];if(curr===0||curr===10){(stream===1?out:err)(UTF8ArrayToString(buffer,0));buffer.length=0}else{buffer.push(curr)}},varargs:undefined,get:function(){SYSCALLS.varargs+=4;var ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(ptr){var ret=UTF8ToString(ptr);return ret},get64:function(low,high){return low}};function ___sys_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(1,1,fd,cmd,varargs);SYSCALLS.varargs=varargs;return 0}function ___sys_open(path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(2,1,path,flags,varargs);SYSCALLS.varargs=varargs}function ___sys_read(fd,buf,count){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(3,1,fd,buf,count)}function __emscripten_notify_thread_queue(targetThreadId,mainThreadId){if(targetThreadId==mainThreadId){postMessage({"cmd":"processQueuedMainThreadWork"})}else if(ENVIRONMENT_IS_PTHREAD){postMessage({"targetThread":targetThreadId,"cmd":"processThreadQueue"})}else{var pthread=PThread.pthreads[targetThreadId];var worker=pthread&&pthread.worker;if(!worker){return}worker.postMessage({"cmd":"processThreadQueue"})}return 1}function _abort(){abort()}function _clock(){if(_clock.start===undefined)_clock.start=Date.now();return(Date.now()-_clock.start)*(1e6/1e3)|0}function _emscripten_check_blocking_allowed(){if(ENVIRONMENT_IS_WORKER)return;warnOnce("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")}function _emscripten_conditional_set_current_thread_status(expectedStatus,newStatus){expectedStatus=expectedStatus|0;newStatus=newStatus|0}function _emscripten_console_log(str){console.log(UTF8ToString(str))}function _emscripten_console_warn(str){console.warn(UTF8ToString(str))}function _emscripten_futex_wait(addr,val,timeout){if(addr<=0||addr>HEAP8.length||addr&3!=0)return-28;if(ENVIRONMENT_IS_WORKER){var ret=Atomics.wait(HEAP32,addr>>2,val,timeout);if(ret==="timed-out")return-73;if(ret==="not-equal")return-6;if(ret==="ok")return 0;throw"Atomics.wait returned an unexpected value "+ret}else{var loadedVal=Atomics.load(HEAP32,addr>>2);if(val!=loadedVal)return-6;var tNow=performance.now();var tEnd=tNow+timeout;Atomics.store(HEAP32,__main_thread_futex_wait_address>>2,addr);var ourWaitAddress=addr;while(addr==ourWaitAddress){tNow=performance.now();if(tNow>tEnd){return-73}_emscripten_main_thread_process_queued_calls();addr=Atomics.load(HEAP32,__main_thread_futex_wait_address>>2)}return 0}}function _emscripten_is_main_browser_thread(){return __pthread_is_main_browser_thread|0}function _emscripten_is_main_runtime_thread(){return __pthread_is_main_runtime_thread|0}function _emscripten_memcpy_big(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)}function _emscripten_proxy_to_main_thread_js(index,sync){var numCallArgs=arguments.length-2;var stack=stackSave();var args=stackAlloc(numCallArgs*8);var b=args>>3;for(var i=0;i<numCallArgs;i++){HEAPF64[b+i]=arguments[2+i]}var ret=_emscripten_run_in_main_runtime_thread_js(index,numCallArgs,args,sync);stackRestore(stack);return ret}var _emscripten_receive_on_main_thread_js_callArgs=[];var readAsmConstArgsArray=[];function readAsmConstArgs(sigPtr,buf){readAsmConstArgsArray.length=0;var ch;buf>>=2;while(ch=HEAPU8[sigPtr++]){var double=ch<105;if(double&&buf&1)buf++;readAsmConstArgsArray.push(double?HEAPF64[buf++>>1]:HEAP32[buf]);++buf}return readAsmConstArgsArray}function _emscripten_receive_on_main_thread_js(index,numCallArgs,args){_emscripten_receive_on_main_thread_js_callArgs.length=numCallArgs;var b=args>>3;for(var i=0;i<numCallArgs;i++){_emscripten_receive_on_main_thread_js_callArgs[i]=HEAPF64[b+i]}var isEmAsmConst=index<0;var func=!isEmAsmConst?proxiedFunctionTable[index]:ASM_CONSTS[-index-1];return func.apply(null,_emscripten_receive_on_main_thread_js_callArgs)}function abortOnCannotGrowMemory(requestedSize){abort("OOM")}function _emscripten_resize_heap(requestedSize){requestedSize=requestedSize>>>0;abortOnCannotGrowMemory(requestedSize)}var JSEvents={inEventHandler:0,removeAllEventListeners:function(){for(var i=JSEvents.eventHandlers.length-1;i>=0;--i){JSEvents._removeHandler(i)}JSEvents.eventHandlers=[];JSEvents.deferredCalls=[]},registerRemoveEventListeners:function(){if(!JSEvents.removeEventListenersRegistered){__ATEXIT__.push(JSEvents.removeAllEventListeners);JSEvents.removeEventListenersRegistered=true}},deferredCalls:[],deferCall:function(targetFunction,precedence,argsList){function arraysHaveEqualContent(arrA,arrB){if(arrA.length!=arrB.length)return false;for(var i in arrA){if(arrA[i]!=arrB[i])return false}return true}for(var i in JSEvents.deferredCalls){var call=JSEvents.deferredCalls[i];if(call.targetFunction==targetFunction&&arraysHaveEqualContent(call.argsList,argsList)){return}}JSEvents.deferredCalls.push({targetFunction:targetFunction,precedence:precedence,argsList:argsList});JSEvents.deferredCalls.sort(function(x,y){return x.precedence<y.precedence})},removeDeferredCalls:function(targetFunction){for(var i=0;i<JSEvents.deferredCalls.length;++i){if(JSEvents.deferredCalls[i].targetFunction==targetFunction){JSEvents.deferredCalls.splice(i,1);--i}}},canPerformEventHandlerRequests:function(){return JSEvents.inEventHandler&&JSEvents.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(!JSEvents.canPerformEventHandlerRequests()){return}for(var i=0;i<JSEvents.deferredCalls.length;++i){var call=JSEvents.deferredCalls[i];JSEvents.deferredCalls.splice(i,1);--i;call.targetFunction.apply(null,call.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(target,eventTypeString){for(var i=0;i<JSEvents.eventHandlers.length;++i){if(JSEvents.eventHandlers[i].target==target&&(!eventTypeString||eventTypeString==JSEvents.eventHandlers[i].eventTypeString)){JSEvents._removeHandler(i--)}}},_removeHandler:function(i){var h=JSEvents.eventHandlers[i];h.target.removeEventListener(h.eventTypeString,h.eventListenerFunc,h.useCapture);JSEvents.eventHandlers.splice(i,1)},registerOrRemoveHandler:function(eventHandler){var jsEventHandler=function jsEventHandler(event){++JSEvents.inEventHandler;JSEvents.currentEventHandler=eventHandler;JSEvents.runDeferredCalls();eventHandler.handlerFunc(event);JSEvents.runDeferredCalls();--JSEvents.inEventHandler};if(eventHandler.callbackfunc){eventHandler.eventListenerFunc=jsEventHandler;eventHandler.target.addEventListener(eventHandler.eventTypeString,jsEventHandler,eventHandler.useCapture);JSEvents.eventHandlers.push(eventHandler);JSEvents.registerRemoveEventListeners()}else{for(var i=0;i<JSEvents.eventHandlers.length;++i){if(JSEvents.eventHandlers[i].target==eventHandler.target&&JSEvents.eventHandlers[i].eventTypeString==eventHandler.eventTypeString){JSEvents._removeHandler(i--)}}}},queueEventHandlerOnThread_iiii:function(targetThread,eventHandlerFunc,eventTypeId,eventData,userData){var stackTop=stackSave();var varargs=stackAlloc(12);HEAP32[varargs>>2]=eventTypeId;HEAP32[varargs+4>>2]=eventData;HEAP32[varargs+8>>2]=userData;__emscripten_call_on_thread(0,targetThread,637534208,eventHandlerFunc,eventData,varargs);stackRestore(stackTop)},getTargetThreadForEventCallback:function(targetThread){switch(targetThread){case 1:return 0;case 2:return PThread.currentProxiedOperationCallerThread;default:return targetThread}},getNodeNameForTarget:function(target){if(!target)return"";if(target==window)return"#window";if(target==screen)return"#screen";return target&&target.nodeName?target.nodeName:""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function stringToNewUTF8(jsString){var length=lengthBytesUTF8(jsString)+1;var cString=_malloc(length);stringToUTF8(jsString,cString,length);return cString}function _emscripten_set_offscreencanvas_size_on_target_thread_js(targetThread,targetCanvas,width,height){var stackTop=stackSave();var varargs=stackAlloc(12);var targetCanvasPtr=0;if(targetCanvas){targetCanvasPtr=stringToNewUTF8(targetCanvas)}HEAP32[varargs>>2]=targetCanvasPtr;HEAP32[varargs+4>>2]=width;HEAP32[varargs+8>>2]=height;__emscripten_call_on_thread(0,targetThread,657457152,0,targetCanvasPtr,varargs);stackRestore(stackTop)}function _emscripten_set_offscreencanvas_size_on_target_thread(targetThread,targetCanvas,width,height){targetCanvas=targetCanvas?UTF8ToString(targetCanvas):"";_emscripten_set_offscreencanvas_size_on_target_thread_js(targetThread,targetCanvas,width,height)}function maybeCStringToJsString(cString){return cString>2?UTF8ToString(cString):cString}var specialHTMLTargets=[0,typeof document!=="undefined"?document:0,typeof window!=="undefined"?window:0];function findEventTarget(target){target=maybeCStringToJsString(target);var domElement=specialHTMLTargets[target]||(typeof document!=="undefined"?document.querySelector(target):undefined);return domElement}function findCanvasEventTarget(target){return findEventTarget(target)}function _emscripten_set_canvas_element_size_calling_thread(target,width,height){var canvas=findCanvasEventTarget(target);if(!canvas)return-4;if(canvas.canvasSharedPtr){HEAP32[canvas.canvasSharedPtr>>2]=width;HEAP32[canvas.canvasSharedPtr+4>>2]=height}if(canvas.offscreenCanvas||!canvas.controlTransferredOffscreen){if(canvas.offscreenCanvas)canvas=canvas.offscreenCanvas;var autoResizeViewport=false;if(canvas.GLctxObject&&canvas.GLctxObject.GLctx){var prevViewport=canvas.GLctxObject.GLctx.getParameter(2978);autoResizeViewport=prevViewport[0]===0&&prevViewport[1]===0&&prevViewport[2]===canvas.width&&prevViewport[3]===canvas.height}canvas.width=width;canvas.height=height;if(autoResizeViewport){canvas.GLctxObject.GLctx.viewport(0,0,width,height)}}else if(canvas.canvasSharedPtr){var targetThread=HEAP32[canvas.canvasSharedPtr+8>>2];_emscripten_set_offscreencanvas_size_on_target_thread(targetThread,target,width,height);return 1}else{return-4}return 0}function _emscripten_set_canvas_element_size_main_thread(target,width,height){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(4,1,target,width,height);return _emscripten_set_canvas_element_size_calling_thread(target,width,height)}function _emscripten_set_canvas_element_size(target,width,height){var canvas=findCanvasEventTarget(target);if(canvas){return _emscripten_set_canvas_element_size_calling_thread(target,width,height)}else{return _emscripten_set_canvas_element_size_main_thread(target,width,height)}}function _emscripten_set_current_thread_status(newStatus){newStatus=newStatus|0}function _emscripten_sleep(ms){Asyncify.handleSleep(function(wakeUp){Browser.safeSetTimeout(wakeUp,ms)})}function __webgl_enable_ANGLE_instanced_arrays(ctx){var ext=ctx.getExtension("ANGLE_instanced_arrays");if(ext){ctx["vertexAttribDivisor"]=function(index,divisor){ext["vertexAttribDivisorANGLE"](index,divisor)};ctx["drawArraysInstanced"]=function(mode,first,count,primcount){ext["drawArraysInstancedANGLE"](mode,first,count,primcount)};ctx["drawElementsInstanced"]=function(mode,count,type,indices,primcount){ext["drawElementsInstancedANGLE"](mode,count,type,indices,primcount)};return 1}}function __webgl_enable_OES_vertex_array_object(ctx){var ext=ctx.getExtension("OES_vertex_array_object");if(ext){ctx["createVertexArray"]=function(){return ext["createVertexArrayOES"]()};ctx["deleteVertexArray"]=function(vao){ext["deleteVertexArrayOES"](vao)};ctx["bindVertexArray"]=function(vao){ext["bindVertexArrayOES"](vao)};ctx["isVertexArray"]=function(vao){return ext["isVertexArrayOES"](vao)};return 1}}function __webgl_enable_WEBGL_draw_buffers(ctx){var ext=ctx.getExtension("WEBGL_draw_buffers");if(ext){ctx["drawBuffers"]=function(n,bufs){ext["drawBuffersWEBGL"](n,bufs)};return 1}}var GL={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function recordError(errorCode){if(!GL.lastError){GL.lastError=errorCode}},getNewId:function(table){var ret=GL.counter++;for(var i=table.length;i<ret;i++){table[i]=null}return ret},getSource:function(shader,count,string,length){var source="";for(var i=0;i<count;++i){var len=length?HEAP32[length+i*4>>2]:-1;source+=UTF8ToString(HEAP32[string+i*4>>2],len<0?undefined:len)}return source},createContext:function(canvas,webGLContextAttributes){var ctx=canvas.getContext("webgl",webGLContextAttributes);if(!ctx)return 0;var handle=GL.registerContext(ctx,webGLContextAttributes);return handle},registerContext:function(ctx,webGLContextAttributes){var handle=_malloc(8);HEAP32[handle+4>>2]=_pthread_self();var context={handle:handle,attributes:webGLContextAttributes,version:webGLContextAttributes.majorVersion,GLctx:ctx};if(ctx.canvas)ctx.canvas.GLctxObject=context;GL.contexts[handle]=context;if(typeof webGLContextAttributes.enableExtensionsByDefault==="undefined"||webGLContextAttributes.enableExtensionsByDefault){GL.initExtensions(context)}return handle},makeContextCurrent:function(contextHandle){GL.currentContext=GL.contexts[contextHandle];Module.ctx=GLctx=GL.currentContext&&GL.currentContext.GLctx;return!(contextHandle&&!GLctx)},getContext:function(contextHandle){return GL.contexts[contextHandle]},deleteContext:function(contextHandle){if(GL.currentContext===GL.contexts[contextHandle])GL.currentContext=null;if(typeof JSEvents==="object")JSEvents.removeAllHandlersOnTarget(GL.contexts[contextHandle].GLctx.canvas);if(GL.contexts[contextHandle]&&GL.contexts[contextHandle].GLctx.canvas)GL.contexts[contextHandle].GLctx.canvas.GLctxObject=undefined;_free(GL.contexts[contextHandle].handle);GL.contexts[contextHandle]=null},initExtensions:function(context){if(!context)context=GL.currentContext;if(context.initExtensionsDone)return;context.initExtensionsDone=true;var GLctx=context.GLctx;__webgl_enable_ANGLE_instanced_arrays(GLctx);__webgl_enable_OES_vertex_array_object(GLctx);__webgl_enable_WEBGL_draw_buffers(GLctx);GLctx.disjointTimerQueryExt=GLctx.getExtension("EXT_disjoint_timer_query");var automaticallyEnabledExtensions=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];var exts=GLctx.getSupportedExtensions()||[];exts.forEach(function(ext){if(automaticallyEnabledExtensions.indexOf(ext)!=-1){GLctx.getExtension(ext)}})},populateUniformTable:function(program){var p=GL.programs[program];var ptable=GL.programInfos[program]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1};var utable=ptable.uniforms;var numUniforms=GLctx.getProgramParameter(p,35718);for(var i=0;i<numUniforms;++i){var u=GLctx.getActiveUniform(p,i);var name=u.name;ptable.maxUniformLength=Math.max(ptable.maxUniformLength,name.length+1);if(name.slice(-1)=="]"){name=name.slice(0,name.lastIndexOf("["))}var loc=GLctx.getUniformLocation(p,name);if(loc){var id=GL.getNewId(GL.uniforms);utable[name]=[u.size,id];GL.uniforms[id]=loc;for(var j=1;j<u.size;++j){var n=name+"["+j+"]";loc=GLctx.getUniformLocation(p,n);id=GL.getNewId(GL.uniforms);GL.uniforms[id]=loc}}}}};var __emscripten_webgl_power_preferences=["default","low-power","high-performance"];function _emscripten_webgl_do_create_context(target,attributes){var contextAttributes={};var a=attributes>>2;contextAttributes["alpha"]=!!HEAP32[a+(0>>2)];contextAttributes["depth"]=!!HEAP32[a+(4>>2)];contextAttributes["stencil"]=!!HEAP32[a+(8>>2)];contextAttributes["antialias"]=!!HEAP32[a+(12>>2)];contextAttributes["premultipliedAlpha"]=!!HEAP32[a+(16>>2)];contextAttributes["preserveDrawingBuffer"]=!!HEAP32[a+(20>>2)];var powerPreference=HEAP32[a+(24>>2)];contextAttributes["powerPreference"]=__emscripten_webgl_power_preferences[powerPreference];contextAttributes["failIfMajorPerformanceCaveat"]=!!HEAP32[a+(28>>2)];contextAttributes.majorVersion=HEAP32[a+(32>>2)];contextAttributes.minorVersion=HEAP32[a+(36>>2)];contextAttributes.enableExtensionsByDefault=HEAP32[a+(40>>2)];contextAttributes.explicitSwapControl=HEAP32[a+(44>>2)];contextAttributes.proxyContextToMainThread=HEAP32[a+(48>>2)];contextAttributes.renderViaOffscreenBackBuffer=HEAP32[a+(52>>2)];var canvas=findCanvasEventTarget(target);if(!canvas){return-4}if(contextAttributes.explicitSwapControl){return-1}var contextHandle=GL.createContext(canvas,contextAttributes);return contextHandle}function _emscripten_webgl_create_context(a0,a1){return _emscripten_webgl_do_create_context(a0,a1)}var ENV={};function getExecutableName(){return thisProgram||"./this.program"}function getEnvStrings(){if(!getEnvStrings.strings){var lang=(typeof navigator==="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={"USER":"web_user","LOGNAME":"web_user","PATH":"/","PWD":"/","HOME":"/home/web_user","LANG":lang,"_":getExecutableName()};for(var x in ENV){env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(x+"="+env[x])}getEnvStrings.strings=strings}return getEnvStrings.strings}function _environ_get(__environ,environ_buf){var bufSize=0;getEnvStrings().forEach(function(string,i){var ptr=environ_buf+bufSize;HEAP32[__environ+i*4>>2]=ptr;writeAsciiToMemory(string,ptr);bufSize+=string.length+1});return 0}function _environ_sizes_get(penviron_count,penviron_buf_size){var strings=getEnvStrings();HEAP32[penviron_count>>2]=strings.length;var bufSize=0;strings.forEach(function(string){bufSize+=string.length+1});HEAP32[penviron_buf_size>>2]=bufSize;return 0}function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(5,1,fd);return 0}function _fd_fdstat_get(fd,pbuf){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(6,1,fd,pbuf);var type=fd==1||fd==2?2:abort();HEAP8[pbuf>>0]=type;return 0}function _fd_seek(fd,offset_low,offset_high,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(7,1,fd,offset_low,offset_high,whence,newOffset)}function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(8,1,fd,iov,iovcnt,pnum);var num=0;for(var i=0;i<iovcnt;i++){var ptr=HEAP32[iov+i*8>>2];var len=HEAP32[iov+(i*8+4)>>2];for(var j=0;j<len;j++){SYSCALLS.printChar(fd,HEAPU8[ptr+j])}num+=len}HEAP32[pnum>>2]=num;return 0}function _frame_out(){return Module.jsLib.frame_out.apply(null,arguments)}function _getTempRet0(){return getTempRet0()|0}function _get_play_time(){return Module.jsLib.get_play_time.apply(null,arguments)}function _gettimeofday(ptr){var now=Date.now();HEAP32[ptr>>2]=now/1e3|0;HEAP32[ptr+4>>2]=now%1e3*1e3|0;return 0}var ___tm_timezone=(stringToUTF8("GMT",325216,4),325216);function _gmtime_r(time,tmPtr){var date=new Date(HEAP32[time>>2]*1e3);HEAP32[tmPtr>>2]=date.getUTCSeconds();HEAP32[tmPtr+4>>2]=date.getUTCMinutes();HEAP32[tmPtr+8>>2]=date.getUTCHours();HEAP32[tmPtr+12>>2]=date.getUTCDate();HEAP32[tmPtr+16>>2]=date.getUTCMonth();HEAP32[tmPtr+20>>2]=date.getUTCFullYear()-1900;HEAP32[tmPtr+24>>2]=date.getUTCDay();HEAP32[tmPtr+36>>2]=0;HEAP32[tmPtr+32>>2]=0;var start=Date.UTC(date.getUTCFullYear(),0,1,0,0,0,0);var yday=(date.getTime()-start)/(1e3*60*60*24)|0;HEAP32[tmPtr+28>>2]=yday;HEAP32[tmPtr+40>>2]=___tm_timezone;return tmPtr}function _tzset(){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(9,1);if(_tzset.called)return;_tzset.called=true;HEAP32[__get_timezone()>>2]=(new Date).getTimezoneOffset()*60;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);HEAP32[__get_daylight()>>2]=Number(winter.getTimezoneOffset()!=summer.getTimezoneOffset());function extractZone(date){var match=date.toTimeString().match(/\\(([A-Za-z ]+)\\)$/);return match?match[1]:"GMT"}var winterName=extractZone(winter);var summerName=extractZone(summer);var winterNamePtr=allocateUTF8(winterName);var summerNamePtr=allocateUTF8(summerName);if(summer.getTimezoneOffset()<winter.getTimezoneOffset()){HEAP32[__get_tzname()>>2]=winterNamePtr;HEAP32[__get_tzname()+4>>2]=summerNamePtr}else{HEAP32[__get_tzname()>>2]=summerNamePtr;HEAP32[__get_tzname()+4>>2]=winterNamePtr}}function _outer_close(){return Module.jsLib.outer_close.apply(null,arguments)}function _outer_read(){return Module.jsLib.outer_read.apply(null,arguments)}function _play_exit(){return Module.jsLib.play_exit.apply(null,arguments)}function _pthread_cleanup_pop(execute){var routine=PThread.threadExitHandlers.pop();if(execute)routine()}function _pthread_cleanup_push(routine,arg){PThread.threadExitHandlers.push(function(){dynCall_vi(routine,arg)})}function spawnThread(threadParams){if(ENVIRONMENT_IS_PTHREAD)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var worker=PThread.getNewWorker();if(worker.pthread!==undefined)throw"Internal error!";if(!threadParams.pthread_ptr)throw"Internal error, no pthread ptr!";PThread.runningWorkers.push(worker);var tlsMemory=_malloc(128*4);for(var i=0;i<128;++i){HEAP32[tlsMemory+i*4>>2]=0}var stackHigh=threadParams.stackBase+threadParams.stackSize;var pthread=PThread.pthreads[threadParams.pthread_ptr]={worker:worker,stackBase:threadParams.stackBase,stackSize:threadParams.stackSize,allocatedOwnStack:threadParams.allocatedOwnStack,thread:threadParams.pthread_ptr,threadInfoStruct:threadParams.pthread_ptr};var tis=pthread.threadInfoStruct>>2;Atomics.store(HEAPU32,tis+(0>>2),0);Atomics.store(HEAPU32,tis+(4>>2),0);Atomics.store(HEAPU32,tis+(8>>2),0);Atomics.store(HEAPU32,tis+(68>>2),threadParams.detached);Atomics.store(HEAPU32,tis+(104>>2),tlsMemory);Atomics.store(HEAPU32,tis+(48>>2),0);Atomics.store(HEAPU32,tis+(40>>2),pthread.threadInfoStruct);Atomics.store(HEAPU32,tis+(44>>2),42);Atomics.store(HEAPU32,tis+(108>>2),threadParams.stackSize);Atomics.store(HEAPU32,tis+(84>>2),threadParams.stackSize);Atomics.store(HEAPU32,tis+(80>>2),stackHigh);Atomics.store(HEAPU32,tis+(108+8>>2),stackHigh);Atomics.store(HEAPU32,tis+(108+12>>2),threadParams.detached);Atomics.store(HEAPU32,tis+(108+20>>2),threadParams.schedPolicy);Atomics.store(HEAPU32,tis+(108+24>>2),threadParams.schedPrio);var global_libc=_emscripten_get_global_libc();var global_locale=global_libc+40;Atomics.store(HEAPU32,tis+(176>>2),global_locale);worker.pthread=pthread;var msg={"cmd":"run","start_routine":threadParams.startRoutine,"arg":threadParams.arg,"threadInfoStruct":threadParams.pthread_ptr,"selfThreadId":threadParams.pthread_ptr,"parentThreadId":threadParams.parent_pthread_ptr,"stackBase":threadParams.stackBase,"stackSize":threadParams.stackSize};worker.runPthread=function(){msg.time=performance.now();worker.postMessage(msg,threadParams.transferList)};if(worker.loaded){worker.runPthread();delete worker.runPthread}}function _pthread_getschedparam(thread,policy,schedparam){if(!policy&&!schedparam)return ERRNO_CODES.EINVAL;if(!thread){err("pthread_getschedparam called with a null thread pointer!");return ERRNO_CODES.ESRCH}var self=HEAP32[thread+12>>2];if(self!==thread){err("pthread_getschedparam attempted on thread "+thread+", which does not point to a valid thread, or does not exist anymore!");return ERRNO_CODES.ESRCH}var schedPolicy=Atomics.load(HEAPU32,thread+108+20>>2);var schedPrio=Atomics.load(HEAPU32,thread+108+24>>2);if(policy)HEAP32[policy>>2]=schedPolicy;if(schedparam)HEAP32[schedparam>>2]=schedPrio;return 0}function _pthread_self(){return __pthread_ptr|0}Module["_pthread_self"]=_pthread_self;function _pthread_create(pthread_ptr,attr,start_routine,arg){if(typeof SharedArrayBuffer==="undefined"){err("Current environment does not support SharedArrayBuffer, pthreads are not available!");return 6}if(!pthread_ptr){err("pthread_create called with a null thread pointer!");return 28}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return _emscripten_sync_run_in_main_thread_4(687865856,pthread_ptr,attr,start_routine,arg)}if(error)return error;var stackSize=0;var stackBase=0;var detached=0;var schedPolicy=0;var schedPrio=0;if(attr){stackSize=HEAP32[attr>>2];stackSize+=81920;stackBase=HEAP32[attr+8>>2];detached=HEAP32[attr+12>>2]!==0;var inheritSched=HEAP32[attr+16>>2]===0;if(inheritSched){var prevSchedPolicy=HEAP32[attr+20>>2];var prevSchedPrio=HEAP32[attr+24>>2];var parentThreadPtr=PThread.currentProxiedOperationCallerThread?PThread.currentProxiedOperationCallerThread:_pthread_self();_pthread_getschedparam(parentThreadPtr,attr+20,attr+24);schedPolicy=HEAP32[attr+20>>2];schedPrio=HEAP32[attr+24>>2];HEAP32[attr+20>>2]=prevSchedPolicy;HEAP32[attr+24>>2]=prevSchedPrio}else{schedPolicy=HEAP32[attr+20>>2];schedPrio=HEAP32[attr+24>>2]}}else{stackSize=2097152}var allocatedOwnStack=stackBase==0;if(allocatedOwnStack){stackBase=_memalign(16,stackSize)}else{stackBase-=stackSize;assert(stackBase>0)}var threadInfoStruct=_malloc(232);for(var i=0;i<232>>2;++i)HEAPU32[(threadInfoStruct>>2)+i]=0;HEAP32[pthread_ptr>>2]=threadInfoStruct;HEAP32[threadInfoStruct+12>>2]=threadInfoStruct;var headPtr=threadInfoStruct+156;HEAP32[headPtr>>2]=headPtr;var threadParams={stackBase:stackBase,stackSize:stackSize,allocatedOwnStack:allocatedOwnStack,schedPolicy:schedPolicy,schedPrio:schedPrio,detached:detached,startRoutine:start_routine,pthread_ptr:threadInfoStruct,parent_pthread_ptr:_pthread_self(),arg:arg,transferList:transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList)}else{spawnThread(threadParams)}return 0}function __pthread_testcancel_js(){if(!ENVIRONMENT_IS_PTHREAD)return;if(!threadInfoStruct)return;var cancelDisabled=Atomics.load(HEAPU32,threadInfoStruct+60>>2);if(cancelDisabled)return;var canceled=Atomics.load(HEAPU32,threadInfoStruct+0>>2);if(canceled==2)throw"Canceled!"}function __emscripten_do_pthread_join(thread,status,block){if(!thread){err("pthread_join attempted on a null thread pointer!");return ERRNO_CODES.ESRCH}if(ENVIRONMENT_IS_PTHREAD&&selfThreadId==thread){err("PThread "+thread+" is attempting to join to itself!");return ERRNO_CODES.EDEADLK}else if(!ENVIRONMENT_IS_PTHREAD&&PThread.mainThreadBlock==thread){err("Main thread "+thread+" is attempting to join to itself!");return ERRNO_CODES.EDEADLK}var self=HEAP32[thread+12>>2];if(self!==thread){err("pthread_join attempted on thread "+thread+", which does not point to a valid thread, or does not exist anymore!");return ERRNO_CODES.ESRCH}var detached=Atomics.load(HEAPU32,thread+68>>2);if(detached){err("Attempted to join thread "+thread+", which was already detached!");return ERRNO_CODES.EINVAL}if(block){_emscripten_check_blocking_allowed()}for(;;){var threadStatus=Atomics.load(HEAPU32,thread+0>>2);if(threadStatus==1){var threadExitCode=Atomics.load(HEAPU32,thread+4>>2);if(status)HEAP32[status>>2]=threadExitCode;Atomics.store(HEAPU32,thread+68>>2,1);if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({"cmd":"cleanupThread","thread":thread});return 0}if(!block){return ERRNO_CODES.EBUSY}__pthread_testcancel_js();if(!ENVIRONMENT_IS_PTHREAD)_emscripten_main_thread_process_queued_calls();_emscripten_futex_wait(thread+0,threadStatus,ENVIRONMENT_IS_PTHREAD?100:1)}}function _pthread_join(thread,status){return __emscripten_do_pthread_join(thread,status,true)}function _round(d){d=+d;return d>=+0?+Math_floor(d+ +.5):+Math_ceil(d-+.5)}function __isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0)}function __arraySum(array,index){var sum=0;for(var i=0;i<=index;sum+=array[i++]){}return sum}var __MONTH_DAYS_LEAP=[31,29,31,30,31,30,31,31,30,31,30,31];var __MONTH_DAYS_REGULAR=[31,28,31,30,31,30,31,31,30,31,30,31];function __addDays(date,days){var newDate=new Date(date.getTime());while(days>0){var leap=__isLeapYear(newDate.getFullYear());var currentMonth=newDate.getMonth();var daysInCurrentMonth=(leap?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR)[currentMonth];if(days>daysInCurrentMonth-newDate.getDate()){days-=daysInCurrentMonth-newDate.getDate()+1;newDate.setDate(1);if(currentMonth<11){newDate.setMonth(currentMonth+1)}else{newDate.setMonth(0);newDate.setFullYear(newDate.getFullYear()+1)}}else{newDate.setDate(newDate.getDate()+days);return newDate}}return newDate}function _strftime(s,maxsize,format,tm){var tm_zone=HEAP32[tm+40>>2];var date={tm_sec:HEAP32[tm>>2],tm_min:HEAP32[tm+4>>2],tm_hour:HEAP32[tm+8>>2],tm_mday:HEAP32[tm+12>>2],tm_mon:HEAP32[tm+16>>2],tm_year:HEAP32[tm+20>>2],tm_wday:HEAP32[tm+24>>2],tm_yday:HEAP32[tm+28>>2],tm_isdst:HEAP32[tm+32>>2],tm_gmtoff:HEAP32[tm+36>>2],tm_zone:tm_zone?UTF8ToString(tm_zone):""};var pattern=UTF8ToString(format);var EXPANSION_RULES_1={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var rule in EXPANSION_RULES_1){pattern=pattern.replace(new RegExp(rule,"g"),EXPANSION_RULES_1[rule])}var WEEKDAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];function leadingSomething(value,digits,character){var str=typeof value==="number"?value.toString():value||"";while(str.length<digits){str=character[0]+str}return str}function leadingNulls(value,digits){return leadingSomething(value,digits,"0")}function compareByDay(date1,date2){function sgn(value){return value<0?-1:value>0?1:0}var compare;if((compare=sgn(date1.getFullYear()-date2.getFullYear()))===0){if((compare=sgn(date1.getMonth()-date2.getMonth()))===0){compare=sgn(date1.getDate()-date2.getDate())}}return compare}function getFirstWeekStartDate(janFourth){switch(janFourth.getDay()){case 0:return new Date(janFourth.getFullYear()-1,11,29);case 1:return janFourth;case 2:return new Date(janFourth.getFullYear(),0,3);case 3:return new Date(janFourth.getFullYear(),0,2);case 4:return new Date(janFourth.getFullYear(),0,1);case 5:return new Date(janFourth.getFullYear()-1,11,31);case 6:return new Date(janFourth.getFullYear()-1,11,30)}}function getWeekBasedYear(date){var thisDate=__addDays(new Date(date.tm_year+1900,0,1),date.tm_yday);var janFourthThisYear=new Date(thisDate.getFullYear(),0,4);var janFourthNextYear=new Date(thisDate.getFullYear()+1,0,4);var firstWeekStartThisYear=getFirstWeekStartDate(janFourthThisYear);var firstWeekStartNextYear=getFirstWeekStartDate(janFourthNextYear);if(compareByDay(firstWeekStartThisYear,thisDate)<=0){if(compareByDay(firstWeekStartNextYear,thisDate)<=0){return thisDate.getFullYear()+1}else{return thisDate.getFullYear()}}else{return thisDate.getFullYear()-1}}var EXPANSION_RULES_2={"%a":function(date){return WEEKDAYS[date.tm_wday].substring(0,3)},"%A":function(date){return WEEKDAYS[date.tm_wday]},"%b":function(date){return MONTHS[date.tm_mon].substring(0,3)},"%B":function(date){return MONTHS[date.tm_mon]},"%C":function(date){var year=date.tm_year+1900;return leadingNulls(year/100|0,2)},"%d":function(date){return leadingNulls(date.tm_mday,2)},"%e":function(date){return leadingSomething(date.tm_mday,2," ")},"%g":function(date){return getWeekBasedYear(date).toString().substring(2)},"%G":function(date){return getWeekBasedYear(date)},"%H":function(date){return leadingNulls(date.tm_hour,2)},"%I":function(date){var twelveHour=date.tm_hour;if(twelveHour==0)twelveHour=12;else if(twelveHour>12)twelveHour-=12;return leadingNulls(twelveHour,2)},"%j":function(date){return leadingNulls(date.tm_mday+__arraySum(__isLeapYear(date.tm_year+1900)?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,date.tm_mon-1),3)},"%m":function(date){return leadingNulls(date.tm_mon+1,2)},"%M":function(date){return leadingNulls(date.tm_min,2)},"%n":function(){return"\\n"},"%p":function(date){if(date.tm_hour>=0&&date.tm_hour<12){return"AM"}else{return"PM"}},"%S":function(date){return leadingNulls(date.tm_sec,2)},"%t":function(){return"\\t"},"%u":function(date){return date.tm_wday||7},"%U":function(date){var janFirst=new Date(date.tm_year+1900,0,1);var firstSunday=janFirst.getDay()===0?janFirst:__addDays(janFirst,7-janFirst.getDay());var endDate=new Date(date.tm_year+1900,date.tm_mon,date.tm_mday);if(compareByDay(firstSunday,endDate)<0){var februaryFirstUntilEndMonth=__arraySum(__isLeapYear(endDate.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,endDate.getMonth()-1)-31;var firstSundayUntilEndJanuary=31-firstSunday.getDate();var days=firstSundayUntilEndJanuary+februaryFirstUntilEndMonth+endDate.getDate();return leadingNulls(Math.ceil(days/7),2)}return compareByDay(firstSunday,janFirst)===0?"01":"00"},"%V":function(date){var janFourthThisYear=new Date(date.tm_year+1900,0,4);var janFourthNextYear=new Date(date.tm_year+1901,0,4);var firstWeekStartThisYear=getFirstWeekStartDate(janFourthThisYear);var firstWeekStartNextYear=getFirstWeekStartDate(janFourthNextYear);var endDate=__addDays(new Date(date.tm_year+1900,0,1),date.tm_yday);if(compareByDay(endDate,firstWeekStartThisYear)<0){return"53"}if(compareByDay(firstWeekStartNextYear,endDate)<=0){return"01"}var daysDifference;if(firstWeekStartThisYear.getFullYear()<date.tm_year+1900){daysDifference=date.tm_yday+32-firstWeekStartThisYear.getDate()}else{daysDifference=date.tm_yday+1-firstWeekStartThisYear.getDate()}return leadingNulls(Math.ceil(daysDifference/7),2)},"%w":function(date){return date.tm_wday},"%W":function(date){var janFirst=new Date(date.tm_year,0,1);var firstMonday=janFirst.getDay()===1?janFirst:__addDays(janFirst,janFirst.getDay()===0?1:7-janFirst.getDay()+1);var endDate=new Date(date.tm_year+1900,date.tm_mon,date.tm_mday);if(compareByDay(firstMonday,endDate)<0){var februaryFirstUntilEndMonth=__arraySum(__isLeapYear(endDate.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,endDate.getMonth()-1)-31;var firstMondayUntilEndJanuary=31-firstMonday.getDate();var days=firstMondayUntilEndJanuary+februaryFirstUntilEndMonth+endDate.getDate();return leadingNulls(Math.ceil(days/7),2)}return compareByDay(firstMonday,janFirst)===0?"01":"00"},"%y":function(date){return(date.tm_year+1900).toString().substring(2)},"%Y":function(date){return date.tm_year+1900},"%z":function(date){var off=date.tm_gmtoff;var ahead=off>=0;off=Math.abs(off)/60;off=off/60*100+off%60;return(ahead?"+":"-")+String("0000"+off).slice(-4)},"%Z":function(date){return date.tm_zone},"%%":function(){return"%"}};for(var rule in EXPANSION_RULES_2){if(pattern.indexOf(rule)>=0){pattern=pattern.replace(new RegExp(rule,"g"),EXPANSION_RULES_2[rule](date))}}var bytes=intArrayFromString(pattern,false);if(bytes.length>maxsize){return 0}writeArrayToMemory(bytes,s);return bytes.length-1}function _sysconf(name){if(ENVIRONMENT_IS_PTHREAD)return _emscripten_proxy_to_main_thread_js(10,1,name);switch(name){case 30:return 16384;case 85:var maxHeapSize=HEAPU8.length;return maxHeapSize/16384;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:{if(typeof navigator==="object")return navigator["hardwareConcurrency"]||1;return 1}}setErrNo(28);return-1}function _emscripten_set_main_loop_timing(mode,value){Browser.mainLoop.timingMode=mode;Browser.mainLoop.timingValue=value;if(!Browser.mainLoop.func){return 1}if(mode==0){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setTimeout(){var timeUntilNextTick=Math.max(0,Browser.mainLoop.tickStartTime+value-_emscripten_get_now())|0;setTimeout(Browser.mainLoop.runner,timeUntilNextTick)};Browser.mainLoop.method="timeout"}else if(mode==1){Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_rAF(){Browser.requestAnimationFrame(Browser.mainLoop.runner)};Browser.mainLoop.method="rAF"}else if(mode==2){if(typeof setImmediate==="undefined"){var setImmediates=[];var emscriptenMainLoopMessageId="setimmediate";var Browser_setImmediate_messageHandler=function(event){if(event.data===emscriptenMainLoopMessageId||event.data.target===emscriptenMainLoopMessageId){event.stopPropagation();setImmediates.shift()()}};addEventListener("message",Browser_setImmediate_messageHandler,true);setImmediate=function Browser_emulated_setImmediate(func){setImmediates.push(func);if(ENVIRONMENT_IS_WORKER){if(Module["setImmediates"]===undefined)Module["setImmediates"]=[];Module["setImmediates"].push(func);postMessage({target:emscriptenMainLoopMessageId})}else postMessage(emscriptenMainLoopMessageId,"*")}}Browser.mainLoop.scheduler=function Browser_mainLoop_scheduler_setImmediate(){setImmediate(Browser.mainLoop.runner)};Browser.mainLoop.method="immediate"}return 0}function _emscripten_set_main_loop(func,fps,simulateInfiniteLoop,arg,noSetTiming){noExitRuntime=true;assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters.");Browser.mainLoop.func=func;Browser.mainLoop.arg=arg;var browserIterationFunc;if(typeof arg!=="undefined"){browserIterationFunc=function(){Module["dynCall_vi"](func,arg)}}else{browserIterationFunc=function(){Module["dynCall_v"](func)}}var thisMainLoopId=Browser.mainLoop.currentlyRunningMainloop;Browser.mainLoop.runner=function Browser_mainLoop_runner(){if(ABORT)return;if(Browser.mainLoop.queue.length>0){var start=Date.now();var blocker=Browser.mainLoop.queue.shift();blocker.func(blocker.arg);if(Browser.mainLoop.remainingBlockers){var remaining=Browser.mainLoop.remainingBlockers;var next=remaining%1==0?remaining-1:Math.floor(remaining);if(blocker.counted){Browser.mainLoop.remainingBlockers=next}else{next=next+.5;Browser.mainLoop.remainingBlockers=(8*remaining+next)/9}}console.log(\'main loop blocker "\'+blocker.name+\'" took \'+(Date.now()-start)+" ms");Browser.mainLoop.updateStatus();if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;setTimeout(Browser.mainLoop.runner,0);return}if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0;if(Browser.mainLoop.timingMode==1&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0){Browser.mainLoop.scheduler();return}else if(Browser.mainLoop.timingMode==0){Browser.mainLoop.tickStartTime=_emscripten_get_now()}Browser.mainLoop.runIter(browserIterationFunc);if(thisMainLoopId<Browser.mainLoop.currentlyRunningMainloop)return;if(typeof SDL==="object"&&SDL.audio&&SDL.audio.queueNewAudioData)SDL.audio.queueNewAudioData();Browser.mainLoop.scheduler()};if(!noSetTiming){if(fps&&fps>0)_emscripten_set_main_loop_timing(0,1e3/fps);else _emscripten_set_main_loop_timing(1,1);Browser.mainLoop.scheduler()}if(simulateInfiniteLoop){throw"unwind"}}var Browser={mainLoop:{scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null;Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var timingMode=Browser.mainLoop.timingMode;var timingValue=Browser.mainLoop.timingValue;var func=Browser.mainLoop.func;Browser.mainLoop.func=null;_emscripten_set_main_loop(func,0,false,Browser.mainLoop.arg,true);_emscripten_set_main_loop_timing(timingMode,timingValue);Browser.mainLoop.scheduler()},updateStatus:function(){if(Module["setStatus"]){var message=Module["statusMessage"]||"Please wait...";var remaining=Browser.mainLoop.remainingBlockers;var expected=Browser.mainLoop.expectedBlockers;if(remaining){if(remaining<expected){Module["setStatus"](message+" ("+(expected-remaining)+"/"+expected+")")}else{Module["setStatus"](message)}}else{Module["setStatus"]("")}}},runIter:function(func){if(ABORT)return;if(Module["preMainLoop"]){var preRet=Module["preMainLoop"]();if(preRet===false){return}}try{func()}catch(e){if(e instanceof ExitStatus){return}else{if(e&&typeof e==="object"&&e.stack)err("exception thrown: "+[e,e.stack]);throw e}}if(Module["postMainLoop"])Module["postMainLoop"]()}},isFullscreen:false,pointerLock:false,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(!Module["preloadPlugins"])Module["preloadPlugins"]=[];if(Browser.initted)return;Browser.initted=true;try{new Blob;Browser.hasBlobConstructor=true}catch(e){Browser.hasBlobConstructor=false;console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:!Browser.hasBlobConstructor?console.log("warning: no BlobBuilder"):null;Browser.URLObject=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:undefined;if(!Module.noImageDecoding&&typeof Browser.URLObject==="undefined"){console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available.");Module.noImageDecoding=true}var imagePlugin={};imagePlugin["canHandle"]=function imagePlugin_canHandle(name){return!Module.noImageDecoding&&/\\.(jpg|jpeg|png|bmp)$/i.test(name)};imagePlugin["handle"]=function imagePlugin_handle(byteArray,name,onload,onerror){var b=null;if(Browser.hasBlobConstructor){try{b=new Blob([byteArray],{type:Browser.getMimetype(name)});if(b.size!==byteArray.length){b=new Blob([new Uint8Array(byteArray).buffer],{type:Browser.getMimetype(name)})}}catch(e){warnOnce("Blob constructor present but fails: "+e+"; falling back to blob builder")}}if(!b){var bb=new Browser.BlobBuilder;bb.append(new Uint8Array(byteArray).buffer);b=bb.getBlob()}var url=Browser.URLObject.createObjectURL(b);var img=new Image;img.onload=function img_onload(){assert(img.complete,"Image "+name+" could not be decoded");var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);Module["preloadedImages"][name]=canvas;Browser.URLObject.revokeObjectURL(url);if(onload)onload(byteArray)};img.onerror=function img_onerror(event){console.log("Image "+url+" could not be decoded");if(onerror)onerror()};img.src=url};Module["preloadPlugins"].push(imagePlugin);var audioPlugin={};audioPlugin["canHandle"]=function audioPlugin_canHandle(name){return!Module.noAudioDecoding&&name.substr(-4)in{".ogg":1,".wav":1,".mp3":1}};audioPlugin["handle"]=function audioPlugin_handle(byteArray,name,onload,onerror){var done=false;function finish(audio){if(done)return;done=true;Module["preloadedAudios"][name]=audio;if(onload)onload(byteArray)}function fail(){if(done)return;done=true;Module["preloadedAudios"][name]=new Audio;if(onerror)onerror()}if(Browser.hasBlobConstructor){try{var b=new Blob([byteArray],{type:Browser.getMimetype(name)})}catch(e){return fail()}var url=Browser.URLObject.createObjectURL(b);var audio=new Audio;audio.addEventListener("canplaythrough",function(){finish(audio)},false);audio.onerror=function audio_onerror(event){if(done)return;console.log("warning: browser could not fully decode audio "+name+", trying slower base64 approach");function encode64(data){var BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var PAD="=";var ret="";var leftchar=0;var leftbits=0;for(var i=0;i<data.length;i++){leftchar=leftchar<<8|data[i];leftbits+=8;while(leftbits>=6){var curr=leftchar>>leftbits-6&63;leftbits-=6;ret+=BASE[curr]}}if(leftbits==2){ret+=BASE[(leftchar&3)<<4];ret+=PAD+PAD}else if(leftbits==4){ret+=BASE[(leftchar&15)<<2];ret+=PAD}return ret}audio.src="data:audio/x-"+name.substr(-3)+";base64,"+encode64(byteArray);finish(audio)};audio.src=url;Browser.safeSetTimeout(function(){finish(audio)},1e4)}else{return fail()}};Module["preloadPlugins"].push(audioPlugin);function pointerLockChange(){Browser.pointerLock=document["pointerLockElement"]===Module["canvas"]||document["mozPointerLockElement"]===Module["canvas"]||document["webkitPointerLockElement"]===Module["canvas"]||document["msPointerLockElement"]===Module["canvas"]}var canvas=Module["canvas"];if(canvas){canvas.requestPointerLock=canvas["requestPointerLock"]||canvas["mozRequestPointerLock"]||canvas["webkitRequestPointerLock"]||canvas["msRequestPointerLock"]||function(){};canvas.exitPointerLock=document["exitPointerLock"]||document["mozExitPointerLock"]||document["webkitExitPointerLock"]||document["msExitPointerLock"]||function(){};canvas.exitPointerLock=canvas.exitPointerLock.bind(document);document.addEventListener("pointerlockchange",pointerLockChange,false);document.addEventListener("mozpointerlockchange",pointerLockChange,false);document.addEventListener("webkitpointerlockchange",pointerLockChange,false);document.addEventListener("mspointerlockchange",pointerLockChange,false);if(Module["elementPointerLock"]){canvas.addEventListener("click",function(ev){if(!Browser.pointerLock&&Module["canvas"].requestPointerLock){Module["canvas"].requestPointerLock();ev.preventDefault()}},false)}}},createContext:function(canvas,useWebGL,setInModule,webGLContextAttributes){if(useWebGL&&Module.ctx&&canvas==Module.canvas)return Module.ctx;var ctx;var contextHandle;if(useWebGL){var contextAttributes={antialias:false,alpha:false,majorVersion:1};if(webGLContextAttributes){for(var attribute in webGLContextAttributes){contextAttributes[attribute]=webGLContextAttributes[attribute]}}if(typeof GL!=="undefined"){contextHandle=GL.createContext(canvas,contextAttributes);if(contextHandle){ctx=GL.getContext(contextHandle).GLctx}}}else{ctx=canvas.getContext("2d")}if(!ctx)return null;if(setInModule){if(!useWebGL)assert(typeof GLctx==="undefined","cannot set in module if GLctx is used, but we are a non-GL context that would replace it");Module.ctx=ctx;if(useWebGL)GL.makeContextCurrent(contextHandle);Module.useWebGL=useWebGL;Browser.moduleContextCreatedCallbacks.forEach(function(callback){callback()});Browser.init()}return ctx},destroyContext:function(canvas,useWebGL,setInModule){},fullscreenHandlersInstalled:false,lockPointer:undefined,resizeCanvas:undefined,requestFullscreen:function(lockPointer,resizeCanvas){Browser.lockPointer=lockPointer;Browser.resizeCanvas=resizeCanvas;if(typeof Browser.lockPointer==="undefined")Browser.lockPointer=true;if(typeof Browser.resizeCanvas==="undefined")Browser.resizeCanvas=false;var canvas=Module["canvas"];function fullscreenChange(){Browser.isFullscreen=false;var canvasContainer=canvas.parentNode;if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvasContainer){canvas.exitFullscreen=Browser.exitFullscreen;if(Browser.lockPointer)canvas.requestPointerLock();Browser.isFullscreen=true;if(Browser.resizeCanvas){Browser.setFullscreenCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}else{canvasContainer.parentNode.insertBefore(canvas,canvasContainer);canvasContainer.parentNode.removeChild(canvasContainer);if(Browser.resizeCanvas){Browser.setWindowedCanvasSize()}else{Browser.updateCanvasDimensions(canvas)}}if(Module["onFullScreen"])Module["onFullScreen"](Browser.isFullscreen);if(Module["onFullscreen"])Module["onFullscreen"](Browser.isFullscreen)}if(!Browser.fullscreenHandlersInstalled){Browser.fullscreenHandlersInstalled=true;document.addEventListener("fullscreenchange",fullscreenChange,false);document.addEventListener("mozfullscreenchange",fullscreenChange,false);document.addEventListener("webkitfullscreenchange",fullscreenChange,false);document.addEventListener("MSFullscreenChange",fullscreenChange,false)}var canvasContainer=document.createElement("div");canvas.parentNode.insertBefore(canvasContainer,canvas);canvasContainer.appendChild(canvas);canvasContainer.requestFullscreen=canvasContainer["requestFullscreen"]||canvasContainer["mozRequestFullScreen"]||canvasContainer["msRequestFullscreen"]||(canvasContainer["webkitRequestFullscreen"]?function(){canvasContainer["webkitRequestFullscreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null)||(canvasContainer["webkitRequestFullScreen"]?function(){canvasContainer["webkitRequestFullScreen"](Element["ALLOW_KEYBOARD_INPUT"])}:null);canvasContainer.requestFullscreen()},exitFullscreen:function(){if(!Browser.isFullscreen){return false}var CFS=document["exitFullscreen"]||document["cancelFullScreen"]||document["mozCancelFullScreen"]||document["msExitFullscreen"]||document["webkitCancelFullScreen"]||function(){};CFS.apply(document,[]);return true},nextRAF:0,fakeRequestAnimationFrame:function(func){var now=Date.now();if(Browser.nextRAF===0){Browser.nextRAF=now+1e3/60}else{while(now+2>=Browser.nextRAF){Browser.nextRAF+=1e3/60}}var delay=Math.max(Browser.nextRAF-now,0);setTimeout(func,delay)},requestAnimationFrame:function(func){if(typeof requestAnimationFrame==="function"){requestAnimationFrame(func);return}var RAF=Browser.fakeRequestAnimationFrame;RAF(func)},safeCallback:function(func){return function(){if(!ABORT)return func.apply(null,arguments)}},allowAsyncCallbacks:true,queuedAsyncCallbacks:[],pauseAsyncCallbacks:function(){Browser.allowAsyncCallbacks=false},resumeAsyncCallbacks:function(){Browser.allowAsyncCallbacks=true;if(Browser.queuedAsyncCallbacks.length>0){var callbacks=Browser.queuedAsyncCallbacks;Browser.queuedAsyncCallbacks=[];callbacks.forEach(function(func){func()})}},safeRequestAnimationFrame:function(func){return Browser.requestAnimationFrame(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}})},safeSetTimeout:function(func,timeout){noExitRuntime=true;return setTimeout(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}else{Browser.queuedAsyncCallbacks.push(func)}},timeout)},safeSetInterval:function(func,timeout){noExitRuntime=true;return setInterval(function(){if(ABORT)return;if(Browser.allowAsyncCallbacks){func()}},timeout)},getMimetype:function(name){return{"jpg":"image/jpeg","jpeg":"image/jpeg","png":"image/png","bmp":"image/bmp","ogg":"audio/ogg","wav":"audio/wav","mp3":"audio/mpeg"}[name.substr(name.lastIndexOf(".")+1)]},getUserMedia:function(func){if(!window.getUserMedia){window.getUserMedia=navigator["getUserMedia"]||navigator["mozGetUserMedia"]}window.getUserMedia(func)},getMovementX:function(event){return event["movementX"]||event["mozMovementX"]||event["webkitMovementX"]||0},getMovementY:function(event){return event["movementY"]||event["mozMovementY"]||event["webkitMovementY"]||0},getMouseWheelDelta:function(event){var delta=0;switch(event.type){case"DOMMouseScroll":delta=event.detail/3;break;case"mousewheel":delta=event.wheelDelta/120;break;case"wheel":delta=event.deltaY;switch(event.deltaMode){case 0:delta/=100;break;case 1:delta/=3;break;case 2:delta*=80;break;default:throw"unrecognized mouse wheel delta mode: "+event.deltaMode}break;default:throw"unrecognized mouse wheel event: "+event.type}return delta},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(event){if(Browser.pointerLock){if(event.type!="mousemove"&&"mozMovementX"in event){Browser.mouseMovementX=Browser.mouseMovementY=0}else{Browser.mouseMovementX=Browser.getMovementX(event);Browser.mouseMovementY=Browser.getMovementY(event)}if(typeof SDL!="undefined"){Browser.mouseX=SDL.mouseX+Browser.mouseMovementX;Browser.mouseY=SDL.mouseY+Browser.mouseMovementY}else{Browser.mouseX+=Browser.mouseMovementX;Browser.mouseY+=Browser.mouseMovementY}}else{var rect=Module["canvas"].getBoundingClientRect();var cw=Module["canvas"].width;var ch=Module["canvas"].height;var scrollX=typeof window.scrollX!=="undefined"?window.scrollX:window.pageXOffset;var scrollY=typeof window.scrollY!=="undefined"?window.scrollY:window.pageYOffset;if(event.type==="touchstart"||event.type==="touchend"||event.type==="touchmove"){var touch=event.touch;if(touch===undefined){return}var adjustedX=touch.pageX-(scrollX+rect.left);var adjustedY=touch.pageY-(scrollY+rect.top);adjustedX=adjustedX*(cw/rect.width);adjustedY=adjustedY*(ch/rect.height);var coords={x:adjustedX,y:adjustedY};if(event.type==="touchstart"){Browser.lastTouches[touch.identifier]=coords;Browser.touches[touch.identifier]=coords}else if(event.type==="touchend"||event.type==="touchmove"){var last=Browser.touches[touch.identifier];if(!last)last=coords;Browser.lastTouches[touch.identifier]=last;Browser.touches[touch.identifier]=coords}return}var x=event.pageX-(scrollX+rect.left);var y=event.pageY-(scrollY+rect.top);x=x*(cw/rect.width);y=y*(ch/rect.height);Browser.mouseMovementX=x-Browser.mouseX;Browser.mouseMovementY=y-Browser.mouseY;Browser.mouseX=x;Browser.mouseY=y}},asyncLoad:function(url,onload,onerror,noRunDep){var dep=!noRunDep?getUniqueRunDependency("al "+url):"";readAsync(url,function(arrayBuffer){assert(arrayBuffer,\'Loading data file "\'+url+\'" failed (no arrayBuffer).\');onload(new Uint8Array(arrayBuffer));if(dep)removeRunDependency(dep)},function(event){if(onerror){onerror()}else{throw\'Loading data file "\'+url+\'" failed.\'}});if(dep)addRunDependency(dep)},resizeListeners:[],updateResizeListeners:function(){var canvas=Module["canvas"];Browser.resizeListeners.forEach(function(listener){listener(canvas.width,canvas.height)})},setCanvasSize:function(width,height,noUpdates){var canvas=Module["canvas"];Browser.updateCanvasDimensions(canvas,width,height);if(!noUpdates)Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags|8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if(typeof SDL!="undefined"){var flags=HEAPU32[SDL.screen>>2];flags=flags&~8388608;HEAP32[SDL.screen>>2]=flags}Browser.updateCanvasDimensions(Module["canvas"]);Browser.updateResizeListeners()},updateCanvasDimensions:function(canvas,wNative,hNative){if(wNative&&hNative){canvas.widthNative=wNative;canvas.heightNative=hNative}else{wNative=canvas.widthNative;hNative=canvas.heightNative}var w=wNative;var h=hNative;if(Module["forcedAspectRatio"]&&Module["forcedAspectRatio"]>0){if(w/h<Module["forcedAspectRatio"]){w=Math.round(h*Module["forcedAspectRatio"])}else{h=Math.round(w/Module["forcedAspectRatio"])}}if((document["fullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"]||document["webkitFullscreenElement"]||document["webkitCurrentFullScreenElement"])===canvas.parentNode&&typeof screen!="undefined"){var factor=Math.min(screen.width/w,screen.height/h);w=Math.round(w*factor);h=Math.round(h*factor)}if(Browser.resizeCanvas){if(canvas.width!=w)canvas.width=w;if(canvas.height!=h)canvas.height=h;if(typeof canvas.style!="undefined"){canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}else{if(canvas.width!=wNative)canvas.width=wNative;if(canvas.height!=hNative)canvas.height=hNative;if(typeof canvas.style!="undefined"){if(w!=wNative||h!=hNative){canvas.style.setProperty("width",w+"px","important");canvas.style.setProperty("height",h+"px","important")}else{canvas.style.removeProperty("width");canvas.style.removeProperty("height")}}}},wgetRequests:{},nextWgetRequestHandle:0,getNextWgetRequestHandle:function(){var handle=Browser.nextWgetRequestHandle;Browser.nextWgetRequestHandle++;return handle}};function runAndAbortIfError(func){try{return func()}catch(e){abort(e)}}var Asyncify={State:{Normal:0,Unwinding:1,Rewinding:2},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToFunc:{},callStackId:0,afterUnwind:null,asyncFinalizers:[],sleepCallbacks:[],getCallStackId:function(funcName){var id=Asyncify.callStackNameToId[funcName];if(id===undefined){id=Asyncify.callStackId++;Asyncify.callStackNameToId[funcName]=id;Asyncify.callStackIdToFunc[id]=Module["asm"][funcName]}return id},instrumentWasmExports:function(exports){var ret={};for(var x in exports){(function(x){var original=exports[x];if(typeof original==="function"){ret[x]=function(){Asyncify.exportCallStack.push(x);try{return original.apply(null,arguments)}finally{if(ABORT)return;var y=Asyncify.exportCallStack.pop(x);assert(y===x);if(Asyncify.currData&&Asyncify.state===Asyncify.State.Unwinding&&Asyncify.exportCallStack.length===0){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(Module["_asyncify_stop_unwind"]);if(typeof Fibers!=="undefined"){Fibers.trampoline()}if(Asyncify.afterUnwind){Asyncify.afterUnwind();Asyncify.afterUnwind=null}}}}}else{ret[x]=original}})(x)}return ret},allocateData:function(){var ptr=_malloc(12+Asyncify.StackSize);Asyncify.setDataHeader(ptr,ptr+12,Asyncify.StackSize);Asyncify.setDataRewindFunc(ptr);return ptr},setDataHeader:function(ptr,stack,stackSize){HEAP32[ptr>>2]=stack;HEAP32[ptr+4>>2]=stack+stackSize},setDataRewindFunc:function(ptr){var bottomOfCallStack=Asyncify.exportCallStack[0];var rewindId=Asyncify.getCallStackId(bottomOfCallStack);HEAP32[ptr+8>>2]=rewindId},getDataRewindFunc:function(ptr){var id=HEAP32[ptr+8>>2];var func=Asyncify.callStackIdToFunc[id];return func},handleSleep:function(startAsync){if(ABORT)return;noExitRuntime=true;if(Asyncify.state===Asyncify.State.Normal){var reachedCallback=false;var reachedAfterCallback=false;startAsync(function(handleSleepReturnValue){if(ABORT)return;Asyncify.handleSleepReturnValue=handleSleepReturnValue||0;reachedCallback=true;if(!reachedAfterCallback){return}Asyncify.state=Asyncify.State.Rewinding;runAndAbortIfError(function(){Module["_asyncify_start_rewind"](Asyncify.currData)});if(Browser.mainLoop.func){Browser.mainLoop.resume()}var start=Asyncify.getDataRewindFunc(Asyncify.currData);var asyncWasmReturnValue=start();if(!Asyncify.currData){var asyncFinalizers=Asyncify.asyncFinalizers;Asyncify.asyncFinalizers=[];asyncFinalizers.forEach(function(func){func(asyncWasmReturnValue)})}});reachedAfterCallback=true;if(!reachedCallback){Asyncify.state=Asyncify.State.Unwinding;Asyncify.currData=Asyncify.allocateData();runAndAbortIfError(function(){Module["_asyncify_start_unwind"](Asyncify.currData)});if(Browser.mainLoop.func){Browser.mainLoop.pause()}}}else if(Asyncify.state===Asyncify.State.Rewinding){Asyncify.state=Asyncify.State.Normal;runAndAbortIfError(Module["_asyncify_stop_rewind"]);_free(Asyncify.currData);Asyncify.currData=null;Asyncify.sleepCallbacks.forEach(function(func){func()})}else{abort("invalid state: "+Asyncify.state)}return Asyncify.handleSleepReturnValue},handleAsync:function(startAsync){return Asyncify.handleSleep(function(wakeUp){startAsync().then(wakeUp)})}};if(!ENVIRONMENT_IS_PTHREAD)PThread.initMainThreadBlock();else PThread.initWorker();var GLctx;Module["requestFullscreen"]=function Module_requestFullscreen(lockPointer,resizeCanvas){Browser.requestFullscreen(lockPointer,resizeCanvas)};Module["requestAnimationFrame"]=function Module_requestAnimationFrame(func){Browser.requestAnimationFrame(func)};Module["setCanvasSize"]=function Module_setCanvasSize(width,height,noUpdates){Browser.setCanvasSize(width,height,noUpdates)};Module["pauseMainLoop"]=function Module_pauseMainLoop(){Browser.mainLoop.pause()};Module["resumeMainLoop"]=function Module_resumeMainLoop(){Browser.mainLoop.resume()};Module["getUserMedia"]=function Module_getUserMedia(){Browser.getUserMedia()};Module["createContext"]=function Module_createContext(canvas,useWebGL,setInModule,webGLContextAttributes){return Browser.createContext(canvas,useWebGL,setInModule,webGLContextAttributes)};var proxiedFunctionTable=[null,___sys_fcntl64,___sys_open,___sys_read,_emscripten_set_canvas_element_size_main_thread,_fd_close,_fd_fdstat_get,_fd_seek,_fd_write,_tzset,_sysconf];function intArrayFromString(stringy,dontAddNull,length){var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array}var asmLibraryArg={"d":___assert_fail,"V":___sys_fcntl64,"T":___sys_open,"U":___sys_read,"P":__emscripten_notify_thread_queue,"a":_abort,"O":_clock,"N":_clock_gettime,"n":_emscripten_asm_const_iii,"M":_emscripten_check_blocking_allowed,"m":_emscripten_conditional_set_current_thread_status,"L":_emscripten_console_log,"K":_emscripten_console_warn,"e":_emscripten_futex_wait,"c":_emscripten_futex_wake,"g":_emscripten_get_now,"f":_emscripten_is_main_browser_thread,"J":_emscripten_is_main_runtime_thread,"I":_emscripten_memcpy_big,"H":_emscripten_receive_on_main_thread_js,"G":_emscripten_resize_heap,"F":_emscripten_set_canvas_element_size,"l":_emscripten_set_current_thread_status,"k":_emscripten_sleep,"E":_emscripten_webgl_create_context,"S":_environ_get,"R":_environ_sizes_get,"p":_fd_close,"Q":_fd_fdstat_get,"y":_fd_seek,"o":_fd_write,"D":_frame_out,"C":_getTempRet0,"x":_get_play_time,"B":_gettimeofday,"A":_gmtime_r,"z":initPthreadsJS,"memory":wasmMemory||Module["wasmMemory"],"w":_outer_close,"j":_outer_read,"v":_play_exit,"u":_pthread_cleanup_pop,"t":_pthread_cleanup_push,"h":_pthread_create,"i":_pthread_join,"b":_pthread_self,"s":_round,"r":_strftime,"q":_sysconf,"table":wasmTable};var asm=createWasm();var ___wasm_call_ctors=Module["___wasm_call_ctors"]=function(){return(___wasm_call_ctors=Module["___wasm_call_ctors"]=Module["asm"]["W"]).apply(null,arguments)};var _decode_abort=Module["_decode_abort"]=function(){return(_decode_abort=Module["_decode_abort"]=Module["asm"]["X"]).apply(null,arguments)};var _set_hidden=Module["_set_hidden"]=function(){return(_set_hidden=Module["_set_hidden"]=Module["asm"]["Y"]).apply(null,arguments)};var _play=Module["_play"]=function(){return(_play=Module["_play"]=Module["asm"]["Z"]).apply(null,arguments)};var _log_init=Module["_log_init"]=function(){return(_log_init=Module["_log_init"]=Module["asm"]["_"]).apply(null,arguments)};var ___errno_location=Module["___errno_location"]=function(){return(___errno_location=Module["___errno_location"]=Module["asm"]["$"]).apply(null,arguments)};var _free=Module["_free"]=function(){return(_free=Module["_free"]=Module["asm"]["aa"]).apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return(_malloc=Module["_malloc"]=Module["asm"]["ba"]).apply(null,arguments)};var _emscripten_get_global_libc=Module["_emscripten_get_global_libc"]=function(){return(_emscripten_get_global_libc=Module["_emscripten_get_global_libc"]=Module["asm"]["ca"]).apply(null,arguments)};var __get_tzname=Module["__get_tzname"]=function(){return(__get_tzname=Module["__get_tzname"]=Module["asm"]["da"]).apply(null,arguments)};var __get_daylight=Module["__get_daylight"]=function(){return(__get_daylight=Module["__get_daylight"]=Module["asm"]["ea"]).apply(null,arguments)};var __get_timezone=Module["__get_timezone"]=function(){return(__get_timezone=Module["__get_timezone"]=Module["asm"]["fa"]).apply(null,arguments)};var stackSave=Module["stackSave"]=function(){return(stackSave=Module["stackSave"]=Module["asm"]["ga"]).apply(null,arguments)};var stackRestore=Module["stackRestore"]=function(){return(stackRestore=Module["stackRestore"]=Module["asm"]["ha"]).apply(null,arguments)};var stackAlloc=Module["stackAlloc"]=function(){return(stackAlloc=Module["stackAlloc"]=Module["asm"]["ia"]).apply(null,arguments)};var _memalign=Module["_memalign"]=function(){return(_memalign=Module["_memalign"]=Module["asm"]["ja"]).apply(null,arguments)};var _emscripten_main_browser_thread_id=Module["_emscripten_main_browser_thread_id"]=function(){return(_emscripten_main_browser_thread_id=Module["_emscripten_main_browser_thread_id"]=Module["asm"]["ka"]).apply(null,arguments)};var ___pthread_tsd_run_dtors=Module["___pthread_tsd_run_dtors"]=function(){return(___pthread_tsd_run_dtors=Module["___pthread_tsd_run_dtors"]=Module["asm"]["la"]).apply(null,arguments)};var _emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=function(){return(_emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=Module["asm"]["ma"]).apply(null,arguments)};var _emscripten_current_thread_process_queued_calls=Module["_emscripten_current_thread_process_queued_calls"]=function(){return(_emscripten_current_thread_process_queued_calls=Module["_emscripten_current_thread_process_queued_calls"]=Module["asm"]["na"]).apply(null,arguments)};var _emscripten_register_main_browser_thread_id=Module["_emscripten_register_main_browser_thread_id"]=function(){return(_emscripten_register_main_browser_thread_id=Module["_emscripten_register_main_browser_thread_id"]=Module["asm"]["oa"]).apply(null,arguments)};var _do_emscripten_dispatch_to_thread=Module["_do_emscripten_dispatch_to_thread"]=function(){return(_do_emscripten_dispatch_to_thread=Module["_do_emscripten_dispatch_to_thread"]=Module["asm"]["pa"]).apply(null,arguments)};var _emscripten_async_run_in_main_thread=Module["_emscripten_async_run_in_main_thread"]=function(){return(_emscripten_async_run_in_main_thread=Module["_emscripten_async_run_in_main_thread"]=Module["asm"]["qa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread=Module["_emscripten_sync_run_in_main_thread"]=function(){return(_emscripten_sync_run_in_main_thread=Module["_emscripten_sync_run_in_main_thread"]=Module["asm"]["ra"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_0=Module["_emscripten_sync_run_in_main_thread_0"]=function(){return(_emscripten_sync_run_in_main_thread_0=Module["_emscripten_sync_run_in_main_thread_0"]=Module["asm"]["sa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_1=Module["_emscripten_sync_run_in_main_thread_1"]=function(){return(_emscripten_sync_run_in_main_thread_1=Module["_emscripten_sync_run_in_main_thread_1"]=Module["asm"]["ta"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_2=Module["_emscripten_sync_run_in_main_thread_2"]=function(){return(_emscripten_sync_run_in_main_thread_2=Module["_emscripten_sync_run_in_main_thread_2"]=Module["asm"]["ua"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_xprintf_varargs=Module["_emscripten_sync_run_in_main_thread_xprintf_varargs"]=function(){return(_emscripten_sync_run_in_main_thread_xprintf_varargs=Module["_emscripten_sync_run_in_main_thread_xprintf_varargs"]=Module["asm"]["va"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_3=Module["_emscripten_sync_run_in_main_thread_3"]=function(){return(_emscripten_sync_run_in_main_thread_3=Module["_emscripten_sync_run_in_main_thread_3"]=Module["asm"]["wa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_4=Module["_emscripten_sync_run_in_main_thread_4"]=function(){return(_emscripten_sync_run_in_main_thread_4=Module["_emscripten_sync_run_in_main_thread_4"]=Module["asm"]["xa"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_5=Module["_emscripten_sync_run_in_main_thread_5"]=function(){return(_emscripten_sync_run_in_main_thread_5=Module["_emscripten_sync_run_in_main_thread_5"]=Module["asm"]["ya"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_6=Module["_emscripten_sync_run_in_main_thread_6"]=function(){return(_emscripten_sync_run_in_main_thread_6=Module["_emscripten_sync_run_in_main_thread_6"]=Module["asm"]["za"]).apply(null,arguments)};var _emscripten_sync_run_in_main_thread_7=Module["_emscripten_sync_run_in_main_thread_7"]=function(){return(_emscripten_sync_run_in_main_thread_7=Module["_emscripten_sync_run_in_main_thread_7"]=Module["asm"]["Aa"]).apply(null,arguments)};var _emscripten_run_in_main_runtime_thread_js=Module["_emscripten_run_in_main_runtime_thread_js"]=function(){return(_emscripten_run_in_main_runtime_thread_js=Module["_emscripten_run_in_main_runtime_thread_js"]=Module["asm"]["Ba"]).apply(null,arguments)};var __emscripten_call_on_thread=Module["__emscripten_call_on_thread"]=function(){return(__emscripten_call_on_thread=Module["__emscripten_call_on_thread"]=Module["asm"]["Ca"]).apply(null,arguments)};var _emscripten_tls_init=Module["_emscripten_tls_init"]=function(){return(_emscripten_tls_init=Module["_emscripten_tls_init"]=Module["asm"]["Da"]).apply(null,arguments)};var dynCall_ii=Module["dynCall_ii"]=function(){return(dynCall_ii=Module["dynCall_ii"]=Module["asm"]["Ea"]).apply(null,arguments)};var dynCall_v=Module["dynCall_v"]=function(){return(dynCall_v=Module["dynCall_v"]=Module["asm"]["Fa"]).apply(null,arguments)};var dynCall_vi=Module["dynCall_vi"]=function(){return(dynCall_vi=Module["dynCall_vi"]=Module["asm"]["Ga"]).apply(null,arguments)};var _asyncify_start_unwind=Module["_asyncify_start_unwind"]=function(){return(_asyncify_start_unwind=Module["_asyncify_start_unwind"]=Module["asm"]["Ha"]).apply(null,arguments)};var _asyncify_stop_unwind=Module["_asyncify_stop_unwind"]=function(){return(_asyncify_stop_unwind=Module["_asyncify_stop_unwind"]=Module["asm"]["Ia"]).apply(null,arguments)};var _asyncify_start_rewind=Module["_asyncify_start_rewind"]=function(){return(_asyncify_start_rewind=Module["_asyncify_start_rewind"]=Module["asm"]["Ja"]).apply(null,arguments)};var _asyncify_stop_rewind=Module["_asyncify_stop_rewind"]=function(){return(_asyncify_stop_rewind=Module["_asyncify_stop_rewind"]=Module["asm"]["Ka"]).apply(null,arguments)};Module["_ff_h264_cabac_tables"]=130841;Module["UTF8ToString"]=UTF8ToString;Module["PThread"]=PThread;Module["allocateUTF8"]=allocateUTF8;Module["PThread"]=PThread;Module["_pthread_self"]=_pthread_self;Module["wasmMemory"]=wasmMemory;Module["ExitStatus"]=ExitStatus;var calledRun;function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function run(args){args=args||arguments_;if(runDependencies>0){return}preRun();if(runDependencies>0)return;function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();readyPromiseResolve(Module);if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else{doRun()}}Module["run"]=run;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}if(!ENVIRONMENT_IS_PTHREAD)noExitRuntime=true;if(!ENVIRONMENT_IS_PTHREAD){run()}else{readyPromiseResolve(Module)}\n\n\n  return __Decoder.ready\n}\n);\n})();\nif (typeof exports === \'object\' && typeof module === \'object\')\n      module.exports = __Decoder;\n    else if (typeof define === \'function\' && define[\'amd\'])\n      define([], function() { return __Decoder; });\n    else if (typeof exports === \'object\')\n      exports["__Decoder"] = __Decoder;\n    ' }, function (e, t) { e.exports = 'var threadInfoStruct=0;var selfThreadId=0;var parentThreadId=0;var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:selfThreadId})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["DYNAMIC_BASE"]=e.data.DYNAMIC_BASE;Module["DYNAMICTOP_PTR"]=e.data.DYNAMICTOP_PTR;Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}__Decoder(Module).then(function(instance){Module=instance;postMessage({"cmd":"loaded"})})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;threadInfoStruct=e.data.threadInfoStruct;Module["registerPthreadPtr"](threadInfoStruct,0,0);selfThreadId=e.data.selfThreadId;parentThreadId=e.data.parentThreadId;var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["dynCall_ii"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){Atomics.store(Module["HEAPU32"],threadInfoStruct+4>>2,ex instanceof Module["ExitStatus"]?ex.status:-2);Atomics.store(Module["HEAPU32"],threadInfoStruct+0>>2,1);Module["_emscripten_futex_wake"](threadInfoStruct+0,2147483647);if(!(ex instanceof Module["ExitStatus"]))throw ex}}}else if(e.data.cmd==="cancel"){if(threadInfoStruct){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(threadInfoStruct){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex.stack)err(ex.stack);throw ex}};\n' }, function (e, t, r) { e.exports = r(76) }, function (e, t) { e.exports = r("db265") }, function (e, t, r) { e.exports = r(78) }, function (e, t) { e.exports = r("1cce9") }]) }, "1b384": function (e, t, r) { e.exports = function (e) { var t = {}; function __webpack_require__(r) { if (t[r]) return t[r].exports; var n = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(n.exports, n, n.exports, __webpack_require__), n.l = !0, n.exports } return __webpack_require__.m = e, __webpack_require__.c = t, __webpack_require__.d = function (e, t, r) { __webpack_require__.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: r }) }, __webpack_require__.n = function (e) { var t = e && e.__esModule ? function getDefault() { return e.default } : function getModuleExports() { return e }; return __webpack_require__.d(t, "a", t), t }, __webpack_require__.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, __webpack_require__.p = "", __webpack_require__(__webpack_require__.s = 13) }([function (e, t, r) { "use strict"; var n = this && this.__spreadArrays || function () { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; var n = Array(e), i = 0; for (t = 0; t < r; t++)for (var a = arguments[t], o = 0, s = a.length; o < s; o++, i++)n[i] = a[o]; return n }; Object.defineProperty(t, "__esModule", { value: !0 }), t.makeLogger = void 0; var i = !1; function setEnable(e) { i = e } function customize(e) { for (var t = [], r = 1; r < arguments.length; r++)t[r - 1] = arguments[r]; var a = n(["[html5 player]", "[dylive]"], t.map(function (e) { return "[" + e + "]" })); return function () { for (var t = [], r = 0; r < arguments.length; r++)t[r] = arguments[r]; i && e.call.apply(e, n([console], a, t)) } } function makeLogger() { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; return { log: customize.apply(void 0, n([console.log], e)), debug: customize.apply(void 0, n([console.debug], e)), info: customize.apply(void 0, n([console.info], e)), warn: customize.apply(void 0, n([console.warn], e)), error: customize.apply(void 0, n([console.error], e)), setEnable: setEnable } } t.makeLogger = makeLogger, t.default = makeLogger() }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.ErrorIds = t.errorRestore = t.errorClone = t.DyDemuxError = t.DyMediaError = t.DyNetworkError = t.DyError = void 0; var a = function (e) { function DyError(t, r, n) { void 0 === n && (n = !0); var i = e.call(this, t) || this; return i.errorId = 0, i.fatal = !0, i.updatedSource = !1, i.errorId = r || d.Unknown, i.name = "DyError", i.fatal = n, i } return i(DyError, e), DyError }(Error); t.DyError = a; var o = function (e) { function DyNetworkError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyNetworkError", n } return i(DyNetworkError, e), DyNetworkError }(a); t.DyNetworkError = o; var s = function (e) { function DyMediaError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyMediaError", n } return i(DyMediaError, e), DyMediaError }(a); t.DyMediaError = s; var u = function (e) { function DyDemuxError(t, r) { var n = e.call(this, t, r) || this; return n.name = "DyDemuxError", n } return i(DyDemuxError, e), DyDemuxError }(a); t.DyDemuxError = u, t.errorClone = function errorClone(e) { return { name: e.name, message: e.message, errorId: e.errorId, stack: e.stack, fatal: e.fatal } }; var d, c = { Error: a, DyError: a, DyNetworkError: o, DyMediaError: s, DyDemuxError: u }; t.errorRestore = function errorRestore(e) { var t = c[e.name]; if (t) { var r = new t(e.message, e.errorId, e.fatal); return r.stack = e.stack, r } return null }, function (e) { e[e.Unknown = 100] = "Unknown", e[e.ParserInitError = 101] = "ParserInitError", e[e.ParserConfigMiss = 102] = "ParserConfigMiss", e[e.ParserConfigError = 103] = "ParserConfigError", e[e.ParserDataError = 104] = "ParserDataError", e[e.ParserCodecUnsupport = 105] = "ParserCodecUnsupport", e[e.DecoderWasmError = 106] = "DecoderWasmError", e[e.DecoderInvalidCanvas = 107] = "DecoderInvalidCanvas", e[e.DecoderDecodeError = 108] = "DecoderDecodeError", e[e.RenderWebglError = 109] = "RenderWebglError", e[e.NetworkError = 110] = "NetworkError", e[e.MediaError = 111] = "MediaError", e[e.MediaAddSourceBufferError = 112] = "MediaAddSourceBufferError", e[e.MediaUnsupportCodec = 113] = "MediaUnsupportCodec", e[e.MediaAppendError = 114] = "MediaAppendError", e[e.WasmUnsupportError = 115] = "WasmUnsupportError", e[e.NoSupportedLoader = 116] = "NoSupportedLoader", e[e.NoSupportedMediaHandler = 117] = "NoSupportedMediaHandler", e[e.InvalidFlv = 118] = "InvalidFlv", e[e.UnsupportedFlvAudio = 119] = "UnsupportedFlvAudio", e[e.UnsupportedFlvVideo = 120] = "UnsupportedFlvVideo", e[e.InvalidFlvVideoPacket = 121] = "InvalidFlvVideoPacket", e[e.WorkerError = 122] = "WorkerError", e[e.HlsM3u8ParseError = 123] = "HlsM3u8ParseError", e[e.HlsTsNetworkError = 124] = "HlsTsNetworkError", e[e.HlsM3u8LoadError = 125] = "HlsM3u8LoadError", e[e.HlsTsCustomError = 126] = "HlsTsCustomError", e[e.TransmuxerError = 127] = "TransmuxerError", e[e.UnsupportDemux = 128] = "UnsupportDemux", e[e.UnsupportRemux = 129] = "UnsupportRemux", e[e.CustomLoaderError = 130] = "CustomLoaderError", e[e.UnsupportedError = 131] = "UnsupportedError", e[e.AcceleratorClosed = 132] = "AcceleratorClosed", e[e.AcceleratorError = 133] = "AcceleratorError" }(d = t.ErrorIds || (t.ErrorIds = {})) }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.concatUrl = t.resolveUrl = t.isPlayerSupported = t.isMediaSupported = t.isBrowserSupported = t.getRandomId = t.binsert = t.binsearch = t.numberCompare = t.connectEventbus = t.isHls = t.saveAs = t.isH265Supported = t.loadScript = t.isPthreadsSupported = t.isWasmSupported = t.bufferConcat = t.timescaledTime64 = t.timescaledTime = t.u8aClone = t.safeClone = t.configClone = t.isBufferEqual = void 0; var i = n(r(29)), a = r(3), o = n(r(7)); function safeClone(e) { if ("object" !== typeof e) return e; var t = {}; return Object.keys(e).forEach(function (r) { var n = e[r]; n && "object" === typeof n ? Object.getPrototypeOf(n) === Object.prototype && (t[r] = safeClone(n)) : "function" !== typeof n && (t[r] = n) }), t } function isWasmSupported() { return "object" === typeof WebAssembly } function pipeEventbus(e, t) { return function (r) { var n, i = r.data; if ("internalevents" !== i.name) return e(r); (n = t.__internal.eventbus).emit.apply(n, i.params) } } function numberCompare(e, t) { return +e - +t } function binsearch(e, t, r) { if (0 === e.length) return 0; if (r || (r = numberCompare), r(t, e[0]) <= 0) return 0; if (r(t, e[e.length - 1]) >= 0) return e.length; var n, i; for (n = 0, i = e.length - 1; i - n > 1;) { var a = n + i >> 1, o = r(t, e[a]); if (o < 0) i = a; else { if (!(o > 0)) return a; n = a } } return i } function isBrowserSupported() { return o.default.chrome && o.default.version.major >= 43 || o.default.firefox && o.default.version.major >= 43 || o.default.msedge || "mac" === o.default.platform && o.default.safari && o.default.version.major >= 11 } function isMediaSupported() { return MediaSource.isTypeSupported('video/mp4; codecs="avc1.640028, mp4a.40.2"') } t.isBufferEqual = function isBufferEqual(e, t) { if (e === t) return !0; if (!e || !t) return !1; if (e.length !== t.length) return !1; for (var r = 0, n = e.length; r < n; r++)if (e[r] !== t[r]) return !1; return !0 }, t.configClone = function configClone(e, t) { return self.Worker && e instanceof self.Worker ? safeClone(t) : t }, t.safeClone = safeClone, t.u8aClone = function u8aClone(e) { var t = new Uint8Array(e.byteLength); return t.set(e, 0), t }, t.timescaledTime = function timescaledTime(e, t) { return Math.round(e * t / 1e3) }, t.timescaledTime64 = function timescaledTime64(e, t) { return i.default.fromNumber(Math.round(e / 1e3 * t), !0) }, t.bufferConcat = function bufferConcat(e) { var t = e.reduce(function (e, t) { return e + t.length }, 0), r = new Uint8Array(t), n = 0; return e.forEach(function (e) { r.set(e, n), n += e.length }), r }, t.isWasmSupported = isWasmSupported, t.isPthreadsSupported = function isPthreadsSupported() { return !!(isWasmSupported() && self.SharedArrayBuffer && self.Atomics && new WebAssembly.Memory({ initial: 1, maximum: 1, shared: !0 }).buffer instanceof SharedArrayBuffer) }, t.loadScript = function loadScript(e) { return new Promise(function (t, r) { var n = document.createElement("script"); n.onload = t, n.onerror = r, n.src = e, document.head.appendChild(n) }) }, t.isH265Supported = function isH265Supported() { return MediaSource.isTypeSupported("video/mp4; codecs=hvc1.1.6.L93") }, t.saveAs = function saveAs(e, t) { var r = window.URL.createObjectURL(e), n = document.createElement("a"); n.style.display = "none", n.href = r, n.download = t, document.body.appendChild(n), n.click(), document.body.removeChild(n), setTimeout(function () { window.URL.revokeObjectURL(r) }, 1e3) }, t.isHls = function isHls(e) { return -1 !== e.toLowerCase().indexOf(".m3u8") }, t.connectEventbus = function connectEventbus(e, t, r) { self.Worker && e instanceof self.Worker ? (r.__internal.eventbus.pipe = function (t, r) { return e.postMessage({ name: "internalevents", params: [t, r] }) }, e.onmessage = pipeEventbus(t, r)) : e.inWorker ? (r.__internal.eventbus = new a.InternalEventBus, r.__internal.eventbus.pipe = function (t, r) { return e.dispatchMessage({ name: "internalevents", params: [t, r] }) }, self.onmessage = pipeEventbus(t, r)) : e.onmessage = t }, t.numberCompare = numberCompare, t.binsearch = binsearch, t.binsert = function binsert(e, t, r) { e.splice(binsearch(e, t, r), 0, t) }, t.getRandomId = function getRandomId() { return Date.now() + "-" + Math.floor(Math.random() * (Math.floor(999999999) - Math.ceil(1))) + Math.ceil(1) }, t.isBrowserSupported = isBrowserSupported, t.isMediaSupported = isMediaSupported, t.isPlayerSupported = function isPlayerSupported() { return isBrowserSupported() && isMediaSupported() }, t.resolveUrl = function resolveUrl(e, t) { return new URL(e, t).href }, t.concatUrl = function concatUrl(e, t) { return t && (e = e + (-1 === e.indexOf("?") ? "?" : "&") + t), e } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.InternalEvents = t.InternalEventBus = void 0; var o = a(r(15)), s = r(2), u = function (e) { function InternalEventBus() { var t = null !== e && e.apply(this, arguments) || this; return t.id = s.getRandomId(), t } return i(InternalEventBus, e), InternalEventBus.prototype.emit = function (t, r) { return (null === r || void 0 === r ? void 0 : r.__sourceId) !== this.id && (r || (r = {}), r.__sourceId || (r.__sourceId = this.id), this.pipe && this.pipe(t, r), e.prototype.emit.call(this, t, r)) }, InternalEventBus }(o.default); t.InternalEventBus = u, function (e) { e.METADATA = "METADATA", e.VBR = "VBR", e.SEEK = "SEEK", e.FIRST_FRAME = "FIRST_FRAME", e.BASE_TS = "BASE_TS", e.STAT = "STAT", e.M3U8TIME = "M3U8TIME", e.GET_SMOOTH_SWITCH_TIME = "GET_SMOOTH_SWITCH_TIME", e.SWITCH_SOURCE_SUCCESS = "SWITCH_SOURCE_SUCCESS", e.SWITCH_SOURCE_FAIL = "SWITCH_SOURCE_FAIL" }(t.InternalEvents || (t.InternalEvents = {})) }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.bindAll = void 0, t.bindAll = function bindAll(e) { for (var t = e, r = {}; e && e !== Object.prototype;)Object.getOwnPropertyNames(e).forEach(function (n) { var i = Object.getOwnPropertyDescriptor(e, n); if (i) { if (i.get || i.set) return; "function" === typeof t[n] && (r[n] = !0) } }), e = Object.getPrototypeOf(e); Object.keys(r).forEach(function (e) { t[e] = t[e].bind(t) }) } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.Codec = t.TimeDispatchType = t.VERSION = void 0, t.VERSION = "dylive_202103250306", function (e) { e.H264_SEI = "H264_SEI", e.AAC_FIL = "AAC_FIL", e.EXTRA_DATA = "EXTRA_DATA" }(t.TimeDispatchType || (t.TimeDispatchType = {})), function (e) { e.H264 = "h264", e.H265 = "h265", e.AAC = "aac", e.MP3 = "mp3" }(t.Codec || (t.Codec = {})) }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.isFrameTrack = t.MediaAction = void 0, function (e) { e[e.END = 0] = "END", e[e.FIRST_FRAME = 1] = "FIRST_FRAME", e[e.RESET = 2] = "RESET", e[e.GET_DURATION = 3] = "GET_DURATION" }(t.MediaAction || (t.MediaAction = {})), t.isFrameTrack = function isFrameTrack(e) { return !e.flag || "KEY" === e.flag } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = {}; !function detect() { var e = self.navigator.userAgent.toLowerCase(), t = /(edge)\/([\w.]+)/.exec(e) || /(chrome)[ \/]([\w.]+)/.exec(e) || /(iemobile)[\/]([\w.]+)/.exec(e) || /(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e) || /(webkit)[ \/]([\w.]+)/.exec(e) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e) || /(msie) ([\w.]+)/.exec(e) || e.indexOf("trident") >= 0 && /(rv)(?::| )([\w.]+)/.exec(e) || e.indexOf("compatible") < 0 && /(firefox)[ \/]([\w.]+)/.exec(e) || [], r = /(ipad)/.exec(e) || /(ipod)/.exec(e) || /(windows phone)/.exec(e) || /(iphone)/.exec(e) || /(kindle)/.exec(e) || /(android)/.exec(e) || /(windows)/.exec(e) || /(mac)/.exec(e) || /(linux)/.exec(e) || /(cros)/.exec(e) || [], i = { browser: t[5] || t[3] || t[1] || "", version: t[2] || t[4] || "0", majorVersion: t[4] || t[2] || "0", platform: r[0] || "" }, a = {}; if (i.browser) { a[i.browser] = !0; var o = i.majorVersion.split("."); a.version = { major: parseInt(i.majorVersion, 10), string: i.version }, o.length > 1 && (a.version.minor = parseInt(o[1], 10)), o.length > 2 && (a.version.build = parseInt(o[2], 10)) } i.platform && (a[i.platform] = !0), (a.chrome || a.opr || a.safari) && (a.webkit = !0), (a.rv || a.iemobile) && (a.rv && delete a.rv, i.browser = "msie", a.msie = !0); a.edge && (delete a.edge, i.browser = "msedge", a.msedge = !0); a.opr && (i.browser = "opera", a.opera = !0); a.safari && a.android && (i.browser = "android", a.android = !0); for (var s in a.name = i.browser, a.platform = i.platform, n) n.hasOwnProperty(s) && delete n[s]; Object.assign(n, a) }(), t.default = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BaseStream = void 0; var n = r(4), i = function () { function BaseStream() { this._destroyed = !1, n.bindAll(this) } return BaseStream.prototype.dispose = function () { this._destroyed = !0, this.onData = null, this.onError = null }, BaseStream.prototype.error = function (e) { this.onError(e), this.dispose() }, BaseStream.prototype.catch = function (e) { return this.onError = e, this }, BaseStream.prototype.pipe = function (e) { return this.onData = e.append, this.onError = e.error, e }, BaseStream.prototype.out = function (e) { return this.onData = e, this }, BaseStream }(); t.BaseStream = i }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BaseLoader = void 0; var n = r(4), i = r(6), a = function () { function BaseLoader() { this._destroyed = !1, this._loaderBytes = 0, this._loadStartTime = 0, this._loadEndTime = 0, this._speed = 0, this._status = 0, n.bindAll(this) } return Object.defineProperty(BaseLoader.prototype, "url", { get: function () { return this._url }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "redirectUrl", { get: function () { return this._redirectUrl }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "supportSmooth", { get: function () { return !1 }, enumerable: !1, configurable: !0 }), Object.defineProperty(BaseLoader.prototype, "format", { get: function () { return "flv" }, enumerable: !1, configurable: !0 }), BaseLoader.prototype.load = function (e, t, r) { this._loaderBytes = 0, this._url = e, this._config = t, this._loadStartTime = Date.now() }, BaseLoader.prototype.dispose = function () { this._destroyed = !0, this.onData = null, this.onEnd = null, this.onError = null }, BaseLoader.prototype.getStatistics = function () { return { loaderBytes: this._loaderBytes, cdnBytes: this._loaderBytes, p2pBytes: 0, totalDropBytes: 0, uploadBytes: 0, speed: this._speed, url: this._url, status: this._status } }, BaseLoader.prototype.attachMedia = function (e) { this._media = e }, BaseLoader.prototype.updateSource = function (e) { }, BaseLoader.prototype.endOfStream = function () { this._onEnd() }, BaseLoader.prototype.reset = function (e) { this.onData && this.onData({ action: i.MediaAction.RESET, actionData: e }) }, BaseLoader.prototype._onData = function (e) { e && (e instanceof ArrayBuffer ? this._loaderBytes += e.byteLength : e.data && (this._loaderBytes += e.data.byteLength), this.onData && this.onData(e)) }, BaseLoader.prototype._onRedirectUrl = function (e) { this._redirectUrl = e }, BaseLoader.prototype._onError = function (e) { this._calcSpeed(), this.onError && this.onError(e) }, BaseLoader.prototype._onEnd = function () { this._calcSpeed(), this.onEnd && this.onEnd() }, BaseLoader.prototype._calcSpeed = function () { this._loadEndTime = Date.now(), this._speed = this._loaderBytes / 1024 / ((this._loadEndTime - this._loadStartTime) / 1e3) }, BaseLoader }(); t.BaseLoader = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function ByteArray(e) { var t = void 0 === e ? {} : e, r = t.buffer, n = t.initLength, i = void 0 === n ? 1024 : n, a = t.autoClear, o = void 0 !== a && a, s = t.increase, u = void 0 === s ? 0 : s, d = t.littleEndian, c = void 0 === d ? ByteArray.littleEndian : d; this._rposition = 0, this._wposition = 0, this._count = 0, this._autoClear = o, this.increase = u, this.littleEndian = c, r ? (this._buffer = r, this._wposition = r.byteLength) : this._buffer = new ArrayBuffer(i) } return ByteArray.fromArray = function (e) { var t = 0; e.forEach(function (e) { return t += e.byteLength }); var r = new ByteArray({ initLength: t }); return e.forEach(function (e) { return r.write(e) }), r }, Object.defineProperty(ByteArray.prototype, "buffer", { get: function () { return this._buffer.slice(0, this._wposition) }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "byteAvailable", { get: function () { return this._wposition - this._rposition }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "byteLength", { get: function () { return this._wposition }, enumerable: !1, configurable: !0 }), Object.defineProperty(ByteArray.prototype, "bytePosition", { get: function () { return this._rposition }, enumerable: !1, configurable: !0 }), ByteArray.prototype.read = function (e) { if (e > this.byteAvailable) throw new Error("[" + ByteArray.TAG + "] not enough data for read."); var t = this._buffer.slice(this._rposition, this._rposition + e); return this._rposition += e, t }, ByteArray.prototype.readAll = function () { return this.read(this.byteAvailable) }, ByteArray.prototype.readUint8 = function () { return new DataView(this.read(1)).getUint8(0) }, ByteArray.prototype.readUint16 = function () { return new DataView(this.read(2)).getUint16(0, this.littleEndian) }, ByteArray.prototype.readUint24 = function () { var e = new Uint8Array(this.read(3)); return this.littleEndian && e.reverse(), e[0] << 16 | e[1] << 8 | e[2] }, ByteArray.prototype.readUint32 = function () { return new DataView(this.read(4)).getUint32(0, this.littleEndian) }, ByteArray.prototype.readString = function (e) { return String.fromCharCode.apply(null, new Uint8Array(this.read(e))) }, ByteArray.prototype.write = function (e) { if (e && e.byteLength > 0) { var t = e.byteLength, r = this._wposition + t; if (r > this._buffer.byteLength) { var n = this._autoClear ? this._rposition : 0, i = r - n, a = this._buffer.slice(n, this._wposition), o = void 0; i > this._buffer.byteLength ? (this.increase ? i += this.increase : i = 2 * (this.buffer.byteLength + t), this._count++, o = new ArrayBuffer(i)) : o = this._buffer, new Uint8Array(o).set(new Uint8Array(a), 0), this._rposition -= n, this._wposition = a.byteLength, this._buffer = o } new Uint8Array(this._buffer).set(e instanceof ArrayBuffer ? new Uint8Array(e) : e, this._wposition), this._wposition += t } }, ByteArray.prototype.peekBytes = function (e, t) { if (void 0 === e && (e = this.byteAvailable), void 0 === t && (t = 0), t + e > this.byteAvailable) throw new Error("[" + ByteArray.TAG + "] not enough data for read."); return new Uint8Array(this._buffer, this._rposition + t, e) }, ByteArray.prototype.skip = function (e) { this._rposition += e }, ByteArray.prototype.back = function (e) { this._rposition -= e }, ByteArray.prototype.reset = function () { this._wposition = 0, this._rposition = 0 }, ByteArray.TAG = "ByteArray", ByteArray.littleEndian = !1, ByteArray }(); t.default = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.createLoader = void 0; var n = r(23), i = r(24), a = r(25), o = r(2), s = r(9); Object.defineProperty(t, "BaseLoader", { enumerable: !0, get: function () { return s.BaseLoader } }), t.createLoader = function createLoader(e) { return o.isHls(e.url) ? new a.HlsLoader : n.FetchStreamLoader.isSupported() ? new n.FetchStreamLoader : i.MozChunkedLoader.isSupported() ? new i.MozChunkedLoader : void 0 } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.createMediaHandler = t.MediaHandler = void 0; var n = r(54); Object.defineProperty(t, "MediaHandler", { enumerable: !0, get: function () { return n.MediaHandler } }); var i = r(55), a = r(57); t.createMediaHandler = function createMediaHandler(e) { switch (e.mediaHandle) { case "mse": return new i.ToMSE(e); case "file": return new a.ToFile(e); case "soft": default: return null } } }, function (e, t, r) { "use strict"; var n = this && this.__createBinding || (Object.create ? function (e, t, r, n) { void 0 === n && (n = r), Object.defineProperty(e, n, { enumerable: !0, get: function () { return t[r] } }) } : function (e, t, r, n) { void 0 === n && (n = r), e[n] = t[r] }), i = this && this.__exportStar || function (e, t) { for (var r in e) "default" === r || t.hasOwnProperty(r) || n(t, e, r) }; Object.defineProperty(t, "__esModule", { value: !0 }), i(r(22), t), i(r(1), t), i(r(11), t) }, function (e, t) { "function" != typeof Object.assign && Object.defineProperty(Object, "assign", { value: function assign(e, t) { "use strict"; if (null == e) throw new TypeError("Cannot convert undefined or null to object"); for (var r = Object(e), n = 1; n < arguments.length; n++) { var i = arguments[n]; if (null != i) for (var a in i) Object.prototype.hasOwnProperty.call(i, a) && (r[a] = i[a]) } return r }, writable: !0, configurable: !0 }), Array.prototype.find || Object.defineProperty(Array.prototype, "find", { value: function (e) { if (null == this) throw new TypeError('"this" is null or not defined'); var t = Object(this), r = t.length >>> 0; if ("function" !== typeof e) throw new TypeError("predicate must be a function"); for (var n = arguments[1], i = 0; i < r;) { var a = t[i]; if (e.call(n, a, i, t)) return a; i++ } } }) }, function (e, t, r) { "use strict"; var n = Object.prototype.hasOwnProperty, i = "~"; function Events() { } function addListener(e, t, r, n, a) { if ("function" !== typeof r) throw new TypeError("The listener must be a function"); var o = new function EE(e, t, r) { this.fn = e, this.context = t, this.once = r || !1 }(r, n || e, a), s = i ? i + t : t; return e._events[s] ? e._events[s].fn ? e._events[s] = [e._events[s], o] : e._events[s].push(o) : (e._events[s] = o, e._eventsCount++), e } function clearEvent(e, t) { 0 === --e._eventsCount ? e._events = new Events : delete e._events[t] } function EventEmitter() { this._events = new Events, this._eventsCount = 0 } Object.create && (Events.prototype = Object.create(null), (new Events).__proto__ || (i = !1)), EventEmitter.prototype.eventNames = function eventNames() { var e, t, r = []; if (0 === this._eventsCount) return r; for (t in e = this._events) n.call(e, t) && r.push(i ? t.slice(1) : t); return Object.getOwnPropertySymbols ? r.concat(Object.getOwnPropertySymbols(e)) : r }, EventEmitter.prototype.listeners = function listeners(e) { var t = i ? i + e : e, r = this._events[t]; if (!r) return []; if (r.fn) return [r.fn]; for (var n = 0, a = r.length, o = new Array(a); n < a; n++)o[n] = r[n].fn; return o }, EventEmitter.prototype.listenerCount = function listenerCount(e) { var t = i ? i + e : e, r = this._events[t]; return r ? r.fn ? 1 : r.length : 0 }, EventEmitter.prototype.emit = function emit(e, t, r, n, a, o) { var s = i ? i + e : e; if (!this._events[s]) return !1; var u, d, c = this._events[s], l = arguments.length; if (c.fn) { switch (c.once && this.removeListener(e, c.fn, void 0, !0), l) { case 1: return c.fn.call(c.context), !0; case 2: return c.fn.call(c.context, t), !0; case 3: return c.fn.call(c.context, t, r), !0; case 4: return c.fn.call(c.context, t, r, n), !0; case 5: return c.fn.call(c.context, t, r, n, a), !0; case 6: return c.fn.call(c.context, t, r, n, a, o), !0 }for (d = 1, u = new Array(l - 1); d < l; d++)u[d - 1] = arguments[d]; c.fn.apply(c.context, u) } else { var p, f = c.length; for (d = 0; d < f; d++)switch (c[d].once && this.removeListener(e, c[d].fn, void 0, !0), l) { case 1: c[d].fn.call(c[d].context); break; case 2: c[d].fn.call(c[d].context, t); break; case 3: c[d].fn.call(c[d].context, t, r); break; case 4: c[d].fn.call(c[d].context, t, r, n); break; default: if (!u) for (p = 1, u = new Array(l - 1); p < l; p++)u[p - 1] = arguments[p]; c[d].fn.apply(c[d].context, u) } } return !0 }, EventEmitter.prototype.on = function on(e, t, r) { return addListener(this, e, t, r, !1) }, EventEmitter.prototype.once = function once(e, t, r) { return addListener(this, e, t, r, !0) }, EventEmitter.prototype.removeListener = function removeListener(e, t, r, n) { var a = i ? i + e : e; if (!this._events[a]) return this; if (!t) return clearEvent(this, a), this; var o = this._events[a]; if (o.fn) o.fn !== t || n && !o.once || r && o.context !== r || clearEvent(this, a); else { for (var s = 0, u = [], d = o.length; s < d; s++)(o[s].fn !== t || n && !o[s].once || r && o[s].context !== r) && u.push(o[s]); u.length ? this._events[a] = 1 === u.length ? u[0] : u : clearEvent(this, a) } return this }, EventEmitter.prototype.removeAllListeners = function removeAllListeners(e) { var t; return e ? (t = i ? i + e : e, this._events[t] && clearEvent(this, t)) : (this._events = new Events, this._eventsCount = 0), this }, EventEmitter.prototype.off = EventEmitter.prototype.removeListener, EventEmitter.prototype.addListener = EventEmitter.prototype.on, EventEmitter.prefixed = i, EventEmitter.EventEmitter = EventEmitter, e.exports = EventEmitter }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), r(14); var o = r(6), s = r(17), u = r(21), d = r(0), c = r(42), l = r(49), p = r(3), f = r(1), h = a(r(50)), _ = r(51), m = d.makeLogger("tranmuxer-worker"), y = function (e) { function TransmuxerWorkerable() { var t = null !== e && e.apply(this, arguments) || this; return t.destroyed = !1, t } return i(TransmuxerWorkerable, e), TransmuxerWorkerable.prototype.terminate = function () { e.prototype.terminate.call(this), this.destroyed = !0, this._demux && (this._demux.dispose(), this._demux = null), this._remux && (this._remux.dispose(), this._remux = null), this._parser && (this._parser.dispose(), this._parser = null), this._wsTranscoder && (this._wsTranscoder.dispose(), this._wsTranscoder = null), this._trackGenerator && (this._trackGenerator.dispose(), this._trackGenerator = null) }, TransmuxerWorkerable.prototype.init = function (t) { e.prototype.init.call(this, t), this._config.__internal.eventbus.on(p.InternalEvents.FIRST_FRAME, this.firstFrame), this._demux = s.createDemuxer(t), this._demux ? (this._remux = u.createRemuxer(t), this._remux ? (this._parser = new c.TrackParser(t), this._trackGenerator = new _.TrackGenerator(t), this.pipeline()) : this._onError(new f.DyError("unsupport remux format: " + t.format, f.ErrorIds.UnsupportRemux))) : this._onError(new f.DyError("unsupport demxu format: " + t.format, f.ErrorIds.UnsupportDemux)) }, TransmuxerWorkerable.prototype.pipeline = function () { var e = this._config, t = this._demux.pipe(this._trackGenerator).pipe(this._parser).pipe(this._remux); e.accelerator.enable && "h265" === e.videoCodec && (this._wsTranscoder = new h.default(e), t = t.pipe(this._wsTranscoder)), t.out(this._onRemuxData).catch(this._onError) }, TransmuxerWorkerable.prototype.appendData = function (e) { this.destroyed || this._demux.append(e) }, TransmuxerWorkerable.prototype.appendEnd = function () { this.destroyed || this._demux.append(o.MediaAction.END) }, TransmuxerWorkerable.prototype.firstFrame = function () { this.destroyed || this._demux.append(o.MediaAction.FIRST_FRAME) }, TransmuxerWorkerable.prototype._onRemuxData = function (e) { var t = []; e.data && t.push(e.data.buffer), this.dispatchMessage({ name: "_onRemuxData", params: e }, t) }, TransmuxerWorkerable.prototype.setLoggerEnable = function (e) { m.setEnable(e) }, TransmuxerWorkerable.prototype._onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "init": this.init(n); break; case "appendData": this.appendData(n); break; case "appendEnd": this.appendEnd(); break; case "setLoggerEnable": this.setLoggerEnable(n); break; case "changeFormat": this._changeFormat(n); break; default: m.warn("unknown function: transmuxer." + r) } } catch (e) { this._onError(new f.DyError("call transmuxer worker " + r + " error: " + e, f.ErrorIds.TransmuxerError)) } }, TransmuxerWorkerable.prototype._changeFormat = function (e) { this._config.format = e; var t = s.createDemuxer(this._config); t || this._onError(new f.DyError("unsupport demxu format: " + e, f.ErrorIds.UnsupportDemux)), this._demux && (this._demux.transfer(t), this._demux.dispose()), this._demux = t, this.pipeline() }, TransmuxerWorkerable }(l.Workerable); t.default = y }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.createDemuxer = t.Demuxer = void 0; var i = r(18); Object.defineProperty(t, "Demuxer", { enumerable: !0, get: function () { return i.Demuxer } }); var a = n(r(33)), o = r(36); t.createDemuxer = function createDemuxer(e) { switch (e.format) { case "flv": return new a.default(e); case "raw": return new i.Demuxer(e); case "ts": return new o.TsDemuxer(e); default: return null } } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.Demuxer = void 0; var a = r(8), o = r(6), s = r(0), u = r(3), d = s.makeLogger("demuxer"), c = function (e) { function Demuxer(t) { var r = e.call(this) || this; return r._audioConfig = r._generateTrackConfig("audio"), r._videoConfig = r._generateTrackConfig("video"), r._lastTracks = {}, r._hasFirstFrame = !1, r._trackLength = 2, r._duration = 0, r._baseTs = -1, r._pengdingTracks = [], r._config = t, !1 !== t.hasAudio && !1 !== t.hasVideo || (r._trackLength = 1), r } return i(Demuxer, e), Demuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._lastTracks = void 0, this._pengdingTracks = void 0 }, Demuxer.prototype.append = function (e) { if (!this._destroyed) if (e instanceof ArrayBuffer) this._appendArrayBuffer(e); else if (e.type) this._appendTrack(e); else if (e.action) { var t = e; t.action === o.MediaAction.GET_DURATION ? this._duration = t.actionData : t.action === o.MediaAction.RESET && this._resetTrack(t.actionData) } else e === o.MediaAction.END ? this._appendEnd() : e === o.MediaAction.FIRST_FRAME ? this._hasFirstFrame = !0 : d.warn("unknown append data: ", e) }, Demuxer.prototype.transfer = function (e) { Object.assign(e, { _audioConfig: this._audioConfig, _videoConfig: this._videoConfig, _lastTracks: this._lastTracks }) }, Demuxer.prototype._appendArrayBuffer = function (e) { }, Demuxer.prototype._appendTrack = function (e) { if ("audio" === e.type || "video" === e.type) { if (("audio" !== e.type || !1 !== this._config.hasAudio) && ("video" !== e.type || !1 !== this._config.hasVideo)) { if (e.trackLength ? this._trackLength = e.trackLength : e.trackLength = this._trackLength, -1 === this._baseTs && o.isFrameTrack(e)) { if (e.dts < 0 && !this._config.startFromZero && (d.warn("negative dts detected: " + e.type + " " + e.dts + ", use relative time."), this._config.startFromZero = !0), this._config.startFromZero && 2 === e.trackLength) { if (d.log("detecting first audio/video pts: " + e.type + " " + e.pts), void 0 === this._firstAudioTs && "audio" === e.type && (this._firstAudioTs = e.pts), void 0 === this._firstVideoTs && "video" === e.type && (this._firstVideoTs = e.pts), void 0 === this._firstAudioTs || void 0 === this._firstVideoTs) return void this._pengdingTracks.push(e); d.log("detected first audio/video pts: " + this._firstAudioTs + "/" + this._firstVideoTs), this._baseTs = Math.max(this._firstAudioTs, this._firstVideoTs) } else this._baseTs = e.pts; this._config.__internal.eventbus.emit(u.InternalEvents.BASE_TS, { data: this._config.startFromZero ? 0 : this._baseTs }), d.log("baseTs = " + this._baseTs), this._pengdingTracks.length && this._pengdingTracks.splice(0).forEach(this._appendTrack) } if ("live" === this._config.mode) { var t = this._lastTracks[e.trackId]; t && o.isFrameTrack(e) && t.dts - e.dts > 5 && d.warn("Dts error: " + e.type + " track dts rollback, last=" + t.dts + ", now=" + e.dts + ", delta=" + (e.dts - t.dts)) } e.extradata || (e.extradata = {}); var r = e.config; if (r || ("audio" === e.type ? r = this._audioConfig : "video" === e.type && (r = this._videoConfig)), r) return e.trackId >= 0 && (r.trackId = e.trackId), r.codec || (r.codec = e.codec), this._config.startFromZero && -1 !== this._baseTs && (e.pts = Math.max(e.pts - this._baseTs, 0), e.dts = Math.max(e.dts - this._baseTs, 0)), this._duration && !r.duration && (r.duration = this._duration, this._config.startFromZero || (r.duration += this._baseTs)), e.config = r, "audio" === e.type ? this._audioConfig = r : "video" === e.type && (this._videoConfig = r), this.onData(e), o.isFrameTrack(e) && (this._lastTracks[e.trackId] = e), !0; d.warn("unable to generate track config, type=" + e.type) } } else d.warn("unknown track type=" + e.type) }, Demuxer.prototype._appendEnd = function () { var e = this; Object.keys(this._lastTracks).forEach(function (t) { var r = e._lastTracks[t]; e._appendTrack({ type: r.type, trackId: r.trackId, dts: r.dts, pts: r.pts, codec: r.codec, isEnd: !0 }) }) }, Demuxer.prototype._generateTrackConfig = function (e) { return "audio" === e ? { type: "audio", trackId: 1, codec: void 0, detailCodec: "", timescale: 9e4, duration: 0, refSampleDuration: 0, bytes: void 0, mimeType: "", channelCount: 0, audioSampleRate: 0 } : "video" === e ? { type: "video", trackId: 2, codec: void 0, detailCodec: "", timescale: 9e4, duration: 0, refSampleDuration: 0, bytes: void 0, mimeType: "", presentWidth: 0, presentHeight: 0, codecWidth: 0, codecHeight: 0 } : null }, Demuxer.prototype._resetTrack = function (e) { var t = this; Object.keys(this._lastTracks).forEach(function (r, n, i) { var a = t._lastTracks[r]; t._appendTrack({ type: a.type, trackId: a.trackId, dts: 0, pts: 0, codec: a.codec, flag: "RESET", extradata: n === i.length - 1 ? e : void 0 }) }), this._trackLength = 2, this._duration = 0, this._baseTs = -1, this._pengdingTracks = [], this._firstAudioTs = void 0, this._firstVideoTs = void 0 }, Demuxer }(a.BaseStream); t.Demuxer = c }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.parseNal = void 0; var n = r(5); function findStartCode(e, t) { for (var r = e.byteLength; t < r - 2;) { if (0 === e[t] && 0 === e[t + 1]) { if (1 === e[t + 2]) return [t, t + 3]; if (0 === e[t + 2] && 1 === e[t + 3]) return [t, t + 4] } t++ } return [-1, -1] } function addNalu(e, t, r) { 9 !== t && (e.codec === n.Codec.H264 ? (7 !== t && 8 !== t || e.configNalus.push({ naluType: t, naluData: r }), e.nals.push({ naluType: t, naluData: r }), e.nalsLength += r.byteLength) : e.codec === n.Codec.H265 && (32 !== t && 33 !== t && 34 !== t || e.configNalus.push({ naluType: t, naluData: r }), e.nals.push({ naluType: t, naluData: r }), e.nalsLength += r.byteLength)) } t.parseNal = function parseNal(e) { for (var t, r, i, a = e.codec, o = e.bytes, s = { configNalus: [], nals: [], nalsLength: 0, codec: a }, u = findStartCode(o, 0), d = u[0], c = u[1]; -1 !== d;)r && addNalu(s, i, o.subarray(r, d)), r = c, i = s.codec === n.Codec.H265 ? (126 & o[r]) >> 1 : 31 & o[r], d = (t = findStartCode(o, c + 1))[0], c = t[1]; return r && addNalu(s, i, o.subarray(r, o.byteLength)), s } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.aac = t.reference = void 0; var i = r(0), a = n(r(38)), o = n(r(7)), s = r(5), u = i.makeLogger("aac-parser"); t.reference = { mpegSamplingRates: [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350] }, t.aac = { name: s.Codec.AAC, inited: !0, parseConfig: function parseConfig(e) { var r, n, i = e.bytes, a = 0, o = null; if (a = i[0] >>> 3, (n = (7 & i[0]) << 1 | i[1] >>> 7) < 0 || n >= t.reference.mpegSamplingRates.length) return u.warn("AAC invalid sampling frequency index!"), -1; var s = t.reference.mpegSamplingRates[n], d = (120 & i[1]) >>> 3; if (d < 0 || d >= 8) return u.warn("AAC invalid channel configuration"), -1; 5 === a && (o = (7 & i[1]) << 1 | i[2] >>> 7, i[2]); var c = self.navigator.userAgent.toLowerCase(); return -1 !== c.indexOf("firefox") ? n >= 6 ? (a = 5, r = new Array(4), o = n - 3) : (a = 2, r = new Array(2), o = n) : -1 !== c.indexOf("android") ? (a = 2, r = new Array(2), o = n) : (a = 5, o = n, r = new Array(4), n >= 6 ? o = n - 3 : 1 === d && (a = 2, r = new Array(2), o = n)), r[0] = a << 3, r[0] |= (15 & n) >>> 1, r[1] = (15 & n) << 7, r[1] |= (15 & d) << 3, 5 === a && (r[1] |= (15 & o) >>> 1, r[2] = (1 & o) << 7, r[2] |= 8, r[3] = 0), e.bytes = new Uint8Array(r), e.audioSampleRate = s, e.channelCount = d, e.detailCodec = "mp4a.40." + a, e.refSampleDuration = 1024 / s * 1e3, 0 }, parseData: function parseData(e) { var t = e.data; if (32 === t.byteLength && 33 === t[0] && 31 === t[1] && 16 === t[2]) return u.warn("private aac data, ignore!"), delete e.data, -1; if (6 === (t[0] >> 5 & 7)) { var r = a.default.getDbData(a.default.parseAacFilData(t)); r && (e.extradata.aacfil = { aacTimestamp: e.dts, data: r }, delete e.data), o.default.msedge && delete e.data } return 0 } } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.createRemuxer = t.Remuxer = void 0; var i = r(39); Object.defineProperty(t, "Remuxer", { enumerable: !0, get: function () { return i.Remuxer } }); var a = n(r(40)); t.createRemuxer = function createRemuxer(e) { switch (e.outputFormat) { case "mp4": return new a.default(e); default: return null } } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.LivePlayer = t.PlayerEvents = void 0, r(14); var o = a(r(15)), s = r(4), u = r(11), d = r(32), c = r(1), l = r(53), p = r(5), f = r(0), h = r(12), _ = r(2), m = r(3), y = f.makeLogger("live-player"); t.PlayerEvents = { ON_MEDIA_INFO: "mediaInfo", ON_FIRST_FRAME: "firstFrame", ON_ERROR: "player_error", ON_SEI: "sei", ON_LOAD_SEI: "loadSei", ON_AAC_DATA: "aacData", ON_EXTRA_DATA_LOAD: "extra_data_load", ON_EXTRA_DATA_PLAY: "extra_data_play", ON_LOW_PERFORMANCE: "low_performance", ON_STAT: "on_stat", ON_M3U8: "ON_M3U8", ON_SWITCH_SUCCESS: "ON_SWITCH_SUCCESS", ON_SWITCH_FAIL: "ON_SWITCH_FAIL" }; var v = { url: "", mode: "live", format: "flv", outputFormat: "mp4", mediaHandle: "mse", videoCodec: "h264", enableWorker: !0, debug: !1, stashBuffer: 65536, stashTime: 200, videoBackTime: 10, videoBackTimeThreshold: 15, enableJitterBuffer: !1, minBuffer: 2, maxBuffer: 6, slowRate: .95, fastRate: 1.05, audioDurationThreshold: 200, videoDurationThreshold: 100, startFromZero: !1, smoothSwitchTime: 2, hls: { m3u8LoadInterval: 1e3, m3u8LoadTimeout: 3e3, maxBufferTime: 20, seekThreshold: 10, tsRetryTimes: 4, maxRemainFragments: 50, upLevelThreshold: 8, enableM3u8Cache: !0 }, accelerator: { enable: !1, byteRate: 6e3 } }, g = function (e) { function LivePlayer(t) { var r = e.call(this) || this; return r._destroyed = !1, r._isFirstFrameEmitted = !1, r._vbr = 0, r._isUpdatingSource = !1, s.bindAll(r), t.hls = Object.assign({}, v.hls, t.hls), t.accelerator = Object.assign({}, v.accelerator, t.accelerator), t.__internal = { eventbus: new m.InternalEventBus }, r._config = t = Object.assign({}, v, t), y.setEnable(t.debug), y.log("version=" + p.VERSION), r._config.loader ? r._loader = r._config.loader : r._loader = u.createLoader(r._config), r._loader ? (t.format = r._loader.format, r._mediaHandler = h.createMediaHandler(t), r._mediaHandler ? (r._mediaHandler.onHasKeyframe = r._onFirstFrame, r._mediaHandler.onExtraData = r._onExtraData, r._mediaHandler.onMediaInfo = r._onMediaInfo, r._mediaHandler.onLowPerformance = r._onLowPerformance, r._timeDispatch = new l.TimeDispatch, r._timeDispatch.onSend = r._onTimeDispatch, r._mediaManager = new d.MediaManager(r._loader, r._mediaHandler, r._config), r._mediaManager.onError = r._onError, r._mediaManager.init(), r._config.__internal.eventbus.on(m.InternalEvents.SEEK, r._onSeek), r._config.__internal.eventbus.on(m.InternalEvents.STAT, r._onStat), r._config.__internal.eventbus.on(m.InternalEvents.M3U8TIME, r._outM3u8Time), r._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_SUCCESS, r._onSwitchSourceSuccess), r._config.__internal.eventbus.on(m.InternalEvents.SWITCH_SOURCE_FAIL, r._onSwitchSourceFail), y.log("init"), r) : (setTimeout(function () { r._onError(new c.DyError("Do not has supported media-handler.", c.ErrorIds.NoSupportedMediaHandler)) }, 0), r)) : (setTimeout(function () { r._onError(new c.DyError("Do not has supported loader.", c.ErrorIds.NoSupportedLoader)) }, 0), r) } return i(LivePlayer, e), LivePlayer.isSupported = function () { return _.isPlayerSupported() }, LivePlayer.isH265Supported = function () { return !1 }, Object.defineProperty(LivePlayer.prototype, "mediaHandle", { get: function () { return this._config.mediaHandle }, enumerable: !1, configurable: !0 }), LivePlayer.prototype.dispose = function () { var e, t; this._destroyed || (this.pause(), this.detach(), this._mediaManager && (this._mediaManager.dispose(), this._mediaManager = null), this._loader && (this._loader.dispose(), this._loader = null), this._mediaHandler && (this._mediaHandler.dispose(), this._mediaHandler = null), this._timeDispatch && (this._timeDispatch.destroy(), this._timeDispatch = null), this.removeAllListeners(), this._config && (null === (t = null === (e = this._config.__internal) || void 0 === e ? void 0 : e.eventbus) || void 0 === t || t.removeAllListeners(), this._config = null), this._destroyed = !0, y.log("disposed")) }, LivePlayer.prototype.load = function () { this._destroyed || (this._loader ? (y.log("loading..."), this._loader.load(this._config.url, this._config)) : y.warn("can't load because there is no available loader")) }, LivePlayer.prototype.attach = function (e) { this._mediaHandler && (this._timeDispatch.attach(e), this._video = e, this._video.addEventListener("loadedmetadata", this._onFirstFrameFromMeta), this._video.addEventListener("canplay", this._onCanplay), this._mediaHandler.attach(e)) }, LivePlayer.prototype.detach = function () { this._mediaHandler && this._mediaHandler.detach(), this._timeDispatch && this._timeDispatch.detach(), this._video && (this._video.removeEventListener("loadedmetadata", this._onFirstFrameFromMeta), this._video.removeEventListener("canplay", this._onCanplay), this._video = null) }, LivePlayer.prototype.play = function () { this._video && this._video.play() }, LivePlayer.prototype.pause = function () { this._video && this._video.pause() }, LivePlayer.prototype.getMediaInfo = function () { return this._mediaInfo }, LivePlayer.prototype.getStatInfo = function () { var e = { url: "", redirectedURL: "", loaderBytes: 0, decodedFrames: 0, droppedFrames: 0, cdnBytes: 0, p2pBytes: 0, totalDropBytes: 0, uploadBytes: 0, fps: 0, decodeFps: 0, renderFps: 0, vbr: this._vbr }; if (this._loader) { var t = this._loader.getStatistics(), r = t.loaderBytes, n = t.cdnBytes, i = t.p2pBytes, a = t.totalDropBytes, o = t.uploadBytes; e.url = this._loader.url, e.redirectedURL = this._loader.redirectUrl, e.loaderBytes = r, e.cdnBytes = n, e.p2pBytes = i, e.totalDropBytes = a || 0, e.uploadBytes = o || 0 } if (this._video) if ("function" === typeof this._video.getVideoPlaybackQuality) { var s = this._video.getVideoPlaybackQuality(); e.decodedFrames = s.totalVideoFrames, e.droppedFrames = s.droppedVideoFrames } else void 0 !== this._video.webkitDecodedFrameCount && (e.decodedFrames = this._video.webkitDecodedFrameCount, e.droppedFrames = this._video.webkitDroppedFrameCount); return this._mediaInfo && (e.fps = this._mediaInfo.fps), this._mediaHandler && Object.assign(e, this._mediaHandler.getStatInfo()), e }, LivePlayer.prototype.T_ADV_Timestamp = function () { return this._mediaHandler && this._mediaHandler.T_ADV_Timestamp() }, LivePlayer.prototype.updateSource = function (e) { var t; if (!this._destroyed) if (this._isUpdatingSource = !0, y.log("update source: ", e), null !== (t = this._loader) && void 0 !== t && t.supportSmooth) this._loader.updateSource(e); else { var r = e.loader || u.createLoader(Object.assign({}, this._config, { url: e.url })); r ? (delete e.loader, this._loader && (this._loader.format !== r.format && (y.log("format changed: " + this._loader.format + " -> " + r.format), this._config.format = r.format, this._mediaManager.changeFormat(r.format)), this._loader.reset({ switchSource: e }), this._loader.dispose()), this._loader = r, this._mediaManager.attachLoader(this._loader), this._loader.load(e.url, this._config)) : y.warn("unsupport source: ", e) } }, LivePlayer.prototype.endOfStream = function () { this._loader && this._loader.endOfStream() }, LivePlayer.prototype._onMediaInfo = function (e) { y.log("onMediaInfo: ", e), this._mediaInfo = e, this.emit(t.PlayerEvents.ON_MEDIA_INFO, e) }, LivePlayer.prototype._onFirstFrameFromMeta = function () { this._onFirstFrame("meta") }, LivePlayer.prototype._onFirstFrame = function (e) { void 0 === e && (e = "keyframe"), this._isFirstFrameEmitted || (this._isFirstFrameEmitted = !0, this.emit(t.PlayerEvents.ON_FIRST_FRAME), y.log("first frame from " + e)) }, LivePlayer.prototype._onExtraData = function (e) { if ("sei" === e.type) { var r = e.data; r && r.length > 0 && r.forEach(this._onSei) } else "aacfil" === e.type ? this._onAACData(e.data) : "vbr" === e.type && (this._vbr = e.data); this._timeDispatch.add({ type: p.TimeDispatchType.EXTRA_DATA, ts: e.ts, data: e }), this.emit(t.PlayerEvents.ON_EXTRA_DATA_LOAD, e) }, LivePlayer.prototype._onCanplay = function () { this._config.__internal.eventbus.emit(m.InternalEvents.FIRST_FRAME) }, LivePlayer.prototype._onError = function (e) { e && e.errorId || (e = new c.DyError("unknown error: " + e, c.ErrorIds.Unknown)), e.updatedSource = this._isUpdatingSource, y.warn("player error: " + e.name + " fatal=" + e.fatal + " updatedSource=" + e.updatedSource + " errorId=" + e.errorId + " " + e.message), this._isUpdatingSource && this._onSwitchSourceFail({ data: {} }), this.emit(t.PlayerEvents.ON_ERROR, e), e.fatal && this.dispose() }, LivePlayer.prototype._onSei = function (e) { this._timeDispatch.add({ type: p.TimeDispatchType.H264_SEI, ts: e.seiTimestamp, data: e }), this.emit(t.PlayerEvents.ON_LOAD_SEI, e) }, LivePlayer.prototype._onAACData = function (e) { this.emit(t.PlayerEvents.ON_AAC_DATA, e.data) }, LivePlayer.prototype._onTimeDispatch = function (e) { switch (e.type) { case p.TimeDispatchType.H264_SEI: this.emit(t.PlayerEvents.ON_SEI, e.data); break; case p.TimeDispatchType.EXTRA_DATA: this.emit(t.PlayerEvents.ON_EXTRA_DATA_PLAY, e.data) } }, LivePlayer.prototype._onLowPerformance = function () { this.emit(t.PlayerEvents.ON_LOW_PERFORMANCE) }, LivePlayer.prototype._onSeek = function () { this._timeDispatch && this._timeDispatch.clear() }, LivePlayer.prototype._onStat = function (e) { var r = e.data; this.emit(t.PlayerEvents.ON_STAT, r) }, LivePlayer.prototype._outM3u8Time = function (e) { var r = e.data; this.emit(t.PlayerEvents.ON_M3U8, r) }, LivePlayer.prototype._onSwitchSourceSuccess = function (e) { var r = e.data; this._isUpdatingSource && this.emit(t.PlayerEvents.ON_SWITCH_SUCCESS, r), this._isUpdatingSource = !1 }, LivePlayer.prototype._onSwitchSourceFail = function (e) { var r = e.data; this._isUpdatingSource && this.emit(t.PlayerEvents.ON_SWITCH_FAIL, r), this._isUpdatingSource = !1 }, LivePlayer }(o.default); t.LivePlayer = g }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.FetchStreamLoader = void 0; var o = r(9), s = r(1), u = a(r(7)), d = function (e) { function FetchStreamLoader() { return null !== e && e.apply(this, arguments) || this } return i(FetchStreamLoader, e), FetchStreamLoader.isSupported = function () { try { var e = u.default.msedge && u.default.version.minor >= 15048, t = !u.default.msedge || e; return self.fetch && self.ReadableStream && t } catch (e) { return !1 } }, FetchStreamLoader.prototype.load = function (t, r, n) { var i, a = this; e.prototype.load.call(this, t, r), (null === n || void 0 === n ? void 0 : n.headers) && (i = { headers: n.headers }), fetch(t, i).then(function (e) { if (a._status = null === e || void 0 === e ? void 0 : e.status, e && e.ok) return t !== e.url && a._onRedirectUrl(e.url), e.body.getReader(); throw e ? new Error("err: " + e.status + " " + e.statusText) : new Error("err: no response, maybe blocked.") }).then(function (e) { if (a._reader = e, a._destroyed) a.dispose(); else { var t = function (r) { var n = r.done, i = r.value; n ? a._onEnd() : (a._onData(i.buffer), e.read().then(t).catch(a._onError)) }; e.read().then(t).catch(a._onError) } }).catch(function (e) { e && 11 === e.code && u.default.msedge || a._onError(new s.DyNetworkError("fetch stream failed: " + e, s.ErrorIds.NetworkError)) }) }, FetchStreamLoader.prototype.dispose = function () { this._reader && (this._reader.cancel().catch(function (e) { }), this._reader = null), e.prototype.dispose.call(this) }, FetchStreamLoader.prototype._onEnd = function () { this._reader = null, e.prototype._onEnd.call(this) }, FetchStreamLoader }(o.BaseLoader); t.FetchStreamLoader = d }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.MozChunkedLoader = void 0; var a = r(9), o = r(1), s = function (e) { function MozChunkedLoader() { var t = e.call(this) || this; return t._xhr = null, t._requestAbort = !1, t } return i(MozChunkedLoader, e), MozChunkedLoader.isSupported = function () { try { var e = new XMLHttpRequest; return e.open("GET", "https://example.com", !0), e.responseType = "moz-chunked-arraybuffer", "moz-chunked-arraybuffer" === e.responseType } catch (e) { return !1 } }, MozChunkedLoader.prototype.load = function (t, r, n) { e.prototype.load.call(this, t, r), this._requestURL = t; var i = this._xhr = new XMLHttpRequest; i.open("GET", t, !0), i.responseType = "moz-chunked-arraybuffer", (null === n || void 0 === n ? void 0 : n.headers) && Object.keys(n.headers).forEach(function (e) { return i.setRequestHeader(e, n.headers[e]) }), i.onreadystatechange = this._onReadyStateChange.bind(this), i.onprogress = this._onProgress.bind(this), i.onloadend = this._onLoadEnd.bind(this), i.onerror = this._onXhrError.bind(this), i.send() }, MozChunkedLoader.prototype.dispose = function () { this.abort(), this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onloadend = null, this._xhr.onerror = null, this._xhr = null), e.prototype.dispose.call(this) }, MozChunkedLoader.prototype.abort = function () { this._requestAbort = !0, this._xhr && this._xhr.abort() }, MozChunkedLoader.prototype._onReadyStateChange = function (e) { var t = e.target; 2 === t.readyState && (void 0 != t.responseURL && t.responseURL !== this._requestURL && this._onRedirectUrl(t.responseURL), this._status = t.status, 0 !== t.status && (t.status < 200 || t.status > 299) && this._onError(new o.DyNetworkError("MozChunkedLoader: Http code invalid, " + t.status + " " + t.statusText, o.ErrorIds.NetworkError))) }, MozChunkedLoader.prototype._onProgress = function (e) { var t = e.target.response; this._onData(t) }, MozChunkedLoader.prototype._onLoadEnd = function (e) { !0 !== this._requestAbort ? this._onEnd() : this._requestAbort = !1 }, MozChunkedLoader.prototype._onXhrError = function (e) { this._onError("xhr load exit") }, MozChunkedLoader }(a.BaseLoader); t.MozChunkedLoader = s }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }; Object.defineProperty(t, "__esModule", { value: !0 }), t.HlsLoader = void 0; var o = r(9), s = r(1), u = r(26), d = r(0), c = r(27), l = r(3), p = r(2), f = r(6), h = r(30), _ = r(31), m = d.makeLogger("hls-loader"), y = function (e) { function HlsLoader() { var t = null !== e && e.apply(this, arguments) || this; return t._fragments = {}, t._lastSequence = -1, t._baseTime = 0, t._m3u8HasEnd = !1, t._isTsLoading = !1, t._beginDownLoadM3u8Time = 0, t._endDownLoadM3u8Time = 0, t._m3u8Streams = [], t._waitingForSmoothSwitch = !1, t._m3u8Cache = {}, t } return i(HlsLoader, e), Object.defineProperty(HlsLoader.prototype, "supportSmooth", { get: function () { return !0 }, enumerable: !1, configurable: !0 }), Object.defineProperty(HlsLoader.prototype, "format", { get: function () { return "ts" }, enumerable: !1, configurable: !0 }), HlsLoader.prototype.load = function (t, r) { e.prototype.load.call(this, t, r), this._config.__internal.eventbus.on(l.InternalEvents.SEEK, this._onSeeking), this._config.__internal.eventbus.on(l.InternalEvents.BASE_TS, this._onBaseTs); var n = a({ getBufferTime: this._getBufferTime, CdnLoader: c.TsLoader }, r); this._config.hls.TsLoader ? this._tsLoader = new this._config.hls.TsLoader(n) : this._tsLoader = new c.TsLoader(n), this._tsLoader.onData = this._onTsData, this._tsLoader.onEnd = this._onTsEnd, this._tsLoader.onError = this._onTsError, this._m3u8Load(), this._checkLoadTimer = setInterval(this._checkLoad, 2e3), "live" === this._config.mode && (this._reloadTimer = setInterval(this._m3u8Load, this._config.hls.m3u8LoadInterval)), this._bitrateControl = new _.BitrateControl, this._bitrateControl.onBitrate = this._onBitrate }, HlsLoader.prototype.dispose = function () { e.prototype.dispose.call(this), this._config.__internal.eventbus.off(l.InternalEvents.SEEK, this._onSeeking), this._config.__internal.eventbus.off(l.InternalEvents.BASE_TS, this._onBaseTs), this._tsLoader && (this._tsLoader.dispose(), this._tsLoader = null), this._fragments = null, this._tsLoadError = null, this._m3u8Request && (this._m3u8Request.cancel(), this._m3u8Request = null), this._updateRequest && (this._updateRequest.cancel(), this._updateRequest = null), clearInterval(this._reloadTimer), clearInterval(this._checkLoadTimer), this._bitrateControl = null, this._m3u8Streams = null, this._currentStream = null, this._m3u8Cache = null, m.log("disposed") }, HlsLoader.prototype.updateSource = function (e, t) { var r = this; p.isHls(e.url) ? (this._updateRequest && (this._updateRequest.cancel(), this._updateRequest = null), this._requestM3u8(e.url, function (e) { return r._updateRequest = e }).then(function (n) { r._url = e.url, r._updateFragments(n, !0), m.log("update source success, total length: " + n.fragments.length), t && t(), "smooth" === e.switch && (r._waitingForSmoothSwitch = !0, r._checkLoad()) }).catch(function (t) { m.warn("update source error: " + t), "smooth" === e.switch && r._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_FAIL) }).then(function () { r._updateRequest = null })) : m.warn("can't update source: " + e.url) }, HlsLoader.prototype.endOfStream = function () { if (this._m3u8HasEnd = !0, "vod" === this._config.mode) { var e = Object.keys(this._fragments).sort(p.numberCompare); if (e.length > 0) { var t = this._fragments[e[e.length - 1]].endTime; this._onData({ action: f.MediaAction.GET_DURATION, actionData: 1e3 * t }) } } clearInterval(this._reloadTimer), m.log("m3u8 reached end") }, HlsLoader.prototype.reset = function (t) { this._tsLoadError = null, e.prototype.reset.call(this, t) }, HlsLoader.prototype._m3u8Load = function () { var e = this; if (!this._m3u8Request) { var t = this._url; this._beginDownLoadM3u8Time = (new Date).getTime(), this._requestM3u8(t, function (t) { return e._m3u8Request = t }).then(this._parseM3u8).catch(function (t) { e._media.getIsWaiting() && e._onError(new s.DyNetworkError("load m3u8 error: " + t, s.ErrorIds.HlsM3u8LoadError)) }).then(function () { e._m3u8Request = null }) } }, HlsLoader.prototype._parseM3u8 = function (e) { var t, r = this; if (e) { this._endDownLoadM3u8Time = (new Date).getTime(); var n = this._endDownLoadM3u8Time - this._beginDownLoadM3u8Time; if (n && this._config.__internal.eventbus.emit(l.InternalEvents.M3U8TIME, { data: n }), null === (t = e.streams) || void 0 === t ? void 0 : t.length) return this._m3u8Streams = e.streams.sort(function (e, t) { return t.bitrate - e.bitrate }), this._m3u8Streams.forEach(function (e) { return e.url = p.resolveUrl(e.url, r._url) }), this._config.hls.streamFilter && (this._m3u8Streams = this._m3u8Streams.filter(this._config.hls.streamFilter)), this._currentStream = this._m3u8Streams[this._m3u8Streams.length - 1], this._url = this._currentStream.url, void setTimeout(this._m3u8Load, 0); this._updateFragments(e), e.hasEnd && this.endOfStream(), this._isTsLoading || this._checkLoad() } }, HlsLoader.prototype._checkLoad = function (e) { var t = this; if (void 0 === e && (e = !1), !this._destroyed) { if (this._media.getIsWaiting() && this._tsLoadError) return this._tsLoadError.fatal = !0, void this._onError(this._tsLoadError); if (this._waitingForSmoothSwitch) { if (!this._smoothSwitch()) return; this._waitingForSmoothSwitch = !1, this._currentIndex >= this._nextIndex && (e = !0) } if ((!this._isTsLoading || e) && ("live" === this._config.mode || e || this._getBufferTime() < this._config.hls.maxBufferTime)) { var r = -1; if (this._tsLoadError) return; if (void 0 === this._nextIndex) { var n = Object.keys(this._fragments).sort(p.numberCompare); if ("live" === this._config.mode && this._config.liveDelay) for (var i = 0, a = n.length - 1; a >= 0; a--)if ((i += this._fragments[n[a]].duration) >= this._config.liveDelay) { r = +n[a]; break } -1 === r && (r = +n[0]) } else r = this._nextIndex; var o = this._fragments[r]; o || Object.keys(this._fragments).sort(p.numberCompare).some(function (e) { if (+e > r) return m.warn("fragment[" + r + "] can't find in list, seek to " + e), o = t._fragments[e], !0 }), o && this._loadTs(o) } } }, HlsLoader.prototype._onSeeking = function (e) { var t = e.data, r = this._getFragmentIndex(t); if (-1 !== r) { var n = this._fragments[r]; m.log("out-buffer seek " + t + " success: base=" + this._baseTime + " frag index=" + r + ", start=" + (this._baseTime + n.startTime) + ", end=" + (this._baseTime + n.endTime)), this._nextIndex = r, this._checkLoad(!0) } else m.warn("out-buffer seek can't find fragment with time=" + (t - 2) + ", seeking " + t + " failed.") }, HlsLoader.prototype._onTsData = function (e) { this._bitrateControl.receiveData(e), this._onData(e) }, HlsLoader.prototype._onTsEnd = function () { this._isTsLoading = !1, this._bitrateControl.endDownload(), !this._m3u8HasEnd || this._fragments[this._nextIndex] ? this._checkLoad() : this._onEnd() }, HlsLoader.prototype._onTsError = function (e) { this._isTsLoading = !1, "string" === typeof e && (e = new s.DyError(e, s.ErrorIds.HlsTsCustomError, !1)), this._tsLoadError = e, this._onError(e) }, HlsLoader.prototype._getFragmentIndex = function (e) { var t = this, r = -1; return Object.keys(this._fragments).sort(p.numberCompare).some(function (n) { var i = t._fragments[n]; if (t._baseTime + i.endTime >= e) return r = +n, !0 }), r }, HlsLoader.prototype._onBaseTs = function (e) { var t = e.data; this._baseTime = +t / 1e3 }, HlsLoader.prototype._smoothSwitch = function () { m.log("smooth switching..."); var e, t = this._media.getCurrentTime(), r = this._getFragmentIndex(t); if (!this._media.video.paused) { for (e = this._fragments[++r]; e && this._baseTime + e.startTime - t < this._config.smoothSwitchTime;)e = this._fragments[++r]; if (!e) return m.log("smooth switch failed, can't find proper fragment, current=" + (t - this._baseTime) + "(" + t + "-" + this._baseTime + ")", this._fragments), !1; r = e.index, this._fragments[this._nextIndex] && (r = Math.min(this._nextIndex, r)) } return !!(e = this._fragments[r]) && (m.log("smooth switch will start from " + (this._baseTime + e.startTime) + ", currentTime=" + t + ", currentIndex=" + this._currentIndex + ", nextIndex=" + r), this._nextIndex = r, this._config.__internal.eventbus.emit(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, { data: { time: this._baseTime + e.startTime } }), !0) }, HlsLoader.prototype._getBufferTime = function () { if (this._fragments[this._nextIndex]) { var e = this._media.getCurrentTime(); return this._fragments[this._nextIndex].startTime + this._baseTime - e } return 0 }, HlsLoader.prototype._onBitrate = function (e) { var t = this; if (this._m3u8Streams.length && !this._updateRequest) { m.log("target bitrate: " + e); var r = this._m3u8Streams[this._m3u8Streams.length - 1]; this._m3u8Streams.some(function (t) { if (e >= t.bitrate) return r = t, !0 }), r && r.bitrate !== this._currentStream.bitrate && (m.log("bitrate change from " + this._currentStream.bitrate + " to " + r.bitrate), this.updateSource({ url: r.url, switch: "smooth" }, function () { t._currentStream = r })) } }, HlsLoader.prototype._loadTs = function (e) { void 0 !== this._currentIndex && e.index !== this._currentIndex + 1 && (m.warn("fragment load discontinue, current=" + this._currentIndex + ", next=" + e.index), this.reset()); var t = { url: p.concatUrl(e.url, this._config.hls.extraQuery), m3u8: p.concatUrl(this._url, this._config.hls.extraQuery), urlRaw: e.urlRaw, retryTimes: this._config.hls.tsRetryTimes, retryInterval: 1e3, timeout: e.duration ? Math.max(2e3 * e.duration, 1e4) : 0 }; (e.startBytes || e.endBytes) && (t.extra = { headers: { Range: "bytes=" + e.startBytes + "-" + e.endBytes } }), this._tsLoader.load(t), this._isTsLoading = !0, this._currentIndex = e.index, this._nextIndex = e.index + 1, this._bitrateControl.startDownload(e), this._currentStream ? m.log("load ts: index=" + e.index + ", start=" + (this._baseTime + e.startTime) + ", end=" + (this._baseTime + e.endTime) + ", bitrate=" + this._currentStream.bitrate) : m.log("load ts: index=" + e.index + ", start=" + (this._baseTime + e.startTime) + ", end=" + (this._baseTime + e.endTime)) }, HlsLoader.prototype._updateFragments = function (e, t) { var r = this; void 0 === t && (t = !1); var n = e.fragments; if (n.length > 0 && (this._lastSequence !== e.sequence || t)) { this._lastSequence = e.sequence; var i = this._fragments; this._fragments = {}; var a = Object.keys(i).sort(p.numberCompare); n.forEach(function (t) { if (t.url = p.resolveUrl(t.urlRaw, r._url), i[t.index - 1]) t.startTime = i[t.index - 1].endTime; else if (t.startTime = 0, a.length && t.index > 0) { m.warn("fragment index discontinue. missing " + (t.index - 1), e); var n = i[a[0]]; n.programDateTime && t.programDateTime && (t.startTime = n.startTime + (t.programDateTime - n.programDateTime) / 1e3, m.log("adjust fragment start time with program date time: index=" + t.index + ", start=" + t.startTime)) } t.endTime = t.startTime + t.duration, r._fragments[t.index] = i[t.index] = t }) } }, HlsLoader.prototype._requestM3u8 = function (e, t) { var r = this; return void 0 === t && (t = null), Promise.resolve().then(function () { var n = r._m3u8Cache[e]; if (n) return n; var i = h.request({ method: "get", url: p.concatUrl(e, r._config.hls.extraQuery), timeout: r._config.hls.m3u8LoadTimeout, retryTimes: 2, retryDelay: 500 }); return t && t(i), i.then(function (e) { return e.data }).then(function (t) { if (!r._destroyed) return n = u.parseM3u8(t), r._config.hls.enableM3u8Cache && "vod" === r._config.mode && (r._m3u8Cache[e] = n), n }) }) }, HlsLoader }(o.BaseLoader); t.HlsLoader = y }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.parseM3u8 = void 0; var n = r(0).makeLogger("m3u8-parser"), i = /#EXTINF:([\d.]+)/, a = /^(?!#)(\S+)/, o = /#EXT-X-BYTERANGE:(\d+)@*(\d*)/, s = /#EXT-X-MEDIA-SEQUENCE:(\d+)/, u = /#EXT-X-ENDLIST/, d = /#EXT-X-PREFETCH:(\S+)/, c = /#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+)/, l = /#EXT-X-PROGRAM-DATE-TIME:(\S+)/; t.parseM3u8 = function parseM3u8(e) { if (!e) throw new Error("no m3u8 data: " + e); return c.test(e) ? function parseStream(e) { var t, r, n = { streams: [] }; return e.split(/\s/).forEach(function (e) { if (!(t = e.match(c))) return (t = e.match(a)) ? (r.url = t[1], void n.streams.push(r)) : void 0; r = { bitrate: parseInt(t[1], 10), streamInfo: e } }), n }(e) : function parseContent(e) { var t, r, c; (c = s.exec(e)) ? t = parseInt(c[1], 10) : (n.warn("no sequence tag, use default sequence=0"), t = 0), r = !!u.exec(e); var p = { sequence: t, hasEnd: r, fragments: [] }, f = { index: t++ }; return e.split(/\n/).forEach(function (e) { if (c = e.match(d)) return f.url = c[1], f.urlRaw = c[1], f.duration = 0, p.fragments.push(f), void (f = { index: t++ }); if (c = e.match(l)) f.programDateTime = Date.parse(c[1]); else { if (!(c = e.match(i))) { if (c = e.match(o)) { var r = parseInt(c[1]), n = void 0; return n = c[2] ? parseInt(c[2]) : p.fragments[f.index - 1].endBytes + 1, f.startBytes = n, void (f.endBytes = n + r - 1) } return (c = e.match(a)) ? (f.url = f.urlRaw = c[1], p.fragments.push(f), void (f = { index: t++ })) : void 0 } f.duration = parseFloat(c[1]) } }), p }(e) } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.TsLoader = void 0; var n = r(28), i = r(1), a = r(4), o = r(0), s = r(3), u = o.makeLogger("ts-loader"), d = function () { function TsLoader(e) { this._config = e, a.bindAll(this) } return TsLoader.prototype.load = function (e) { this._request && (u.log("abort last ts request, need reset player: " + this._request.url), this._request.dispose(), this._request = null), this._request = new n.StreamRequest(this._config), this._request.onData = this.onData, this._request.onEnd = this._onEnd, this._request.onError = this._onError, this._request.load(e) }, TsLoader.prototype.dispose = function () { this._request && (this._request.dispose(), this._request = null), this.onData = null, this.onEnd = null, this.onError = null }, TsLoader.prototype._onEnd = function () { this._finish(), this.onEnd() }, TsLoader.prototype._onError = function (e) { this._finish(), this.onError(new i.DyError(e, i.ErrorIds.HlsTsNetworkError, !1)) }, TsLoader.prototype._finish = function () { this._request && (this._config.__internal.eventbus.emit(s.InternalEvents.STAT, { data: this._request.getStatistics() }), this._request.dispose(), this._request = null) }, TsLoader }(); t.TsLoader = d }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.StreamRequest = void 0; var n = r(11), i = r(0), a = r(4), o = i.makeLogger("stream-request"), s = { timeout: 0, retryTimes: 0, retryInterval: 200 }, u = function () { function StreamRequest(e) { this._retryTimes = 0, this._continueBytes = 0, this._loadedBytes = 0, this._config = e, a.bindAll(this) } return Object.defineProperty(StreamRequest.prototype, "url", { get: function () { return this._options.url }, enumerable: !1, configurable: !0 }), StreamRequest.prototype.dispose = function () { clearTimeout(this._delayTimer), clearTimeout(this._timeoutTimer), this.onData = null, this.onEnd = null, this.onError = null, this._loader && (this._loader.dispose(), this._loader = null) }, StreamRequest.prototype.load = function (e) { clearTimeout(this._delayTimer), clearTimeout(this._timeoutTimer), this._loader && (this._loader.dispose(), this._loader = null), this._options = Object.assign({}, s, e), this._loader = n.createLoader({ url: this._options.url }), this._loader.onData = this._onLoadData, this._loader.onEnd = this._onLoadEnd, this._loader.onError = this._onLoadError, this._loader.load(this._options.url, this._config, this._options.extra), this._options.timeout > 0 && (this._timeoutTimer = setTimeout(this._onTimeout, this._options.timeout)), this._continueBytes = this._loadedBytes, this._loadedBytes = 0, o.log("request " + this._options.url + ", extra=" + JSON.stringify(this._options.extra) + ", timeout=" + this._options.timeout) }, StreamRequest.prototype.getStatistics = function () { var e; return null === (e = this._loader) || void 0 === e ? void 0 : e.getStatistics() }, StreamRequest.prototype._onLoadData = function (e) { if (this._loadedBytes += e.byteLength, this._continueBytes) { if (this._loadedBytes <= this._continueBytes) return; var t = e.byteLength + this._continueBytes - this._loadedBytes; t > 0 && (e = e.slice(t)), this._continueBytes = 0 } this.onData(e) }, StreamRequest.prototype._onTimeout = function () { this._onError("request " + this._options.url + " timeout, exceed " + this._options.timeout + "ms") }, StreamRequest.prototype._onLoadError = function (e) { clearTimeout(this._timeoutTimer), this._onError("request " + this._options.url + " error: " + e) }, StreamRequest.prototype._onLoadEnd = function () { clearTimeout(this._timeoutTimer), this.onEnd() }, StreamRequest.prototype._onError = function (e) { var t = this; if (o.log(e), this._retryTimes >= this._options.retryTimes) { var r = "request failed: " + e; return o.warn(r), void (this.onError && this.onError(r)) } this._delayTimer = setTimeout(function () { t._retryTimes++, t.load(t._options), o.log("retry request " + t._options.url + " " + t._retryTimes + " times.") }, this._options.retryInterval) }, StreamRequest }(); t.StreamRequest = u }, function (e, t) { e.exports = Long; var r = null; try { r = new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 13, 2, 96, 0, 1, 127, 96, 4, 127, 127, 127, 127, 1, 127, 3, 7, 6, 0, 1, 1, 1, 1, 1, 6, 6, 1, 127, 1, 65, 0, 11, 7, 50, 6, 3, 109, 117, 108, 0, 1, 5, 100, 105, 118, 95, 115, 0, 2, 5, 100, 105, 118, 95, 117, 0, 3, 5, 114, 101, 109, 95, 115, 0, 4, 5, 114, 101, 109, 95, 117, 0, 5, 8, 103, 101, 116, 95, 104, 105, 103, 104, 0, 0, 10, 191, 1, 6, 4, 0, 35, 0, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 126, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 127, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 128, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 129, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 130, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11])), {}).exports } catch (e) { } function Long(e, t, r) { this.low = 0 | e, this.high = 0 | t, this.unsigned = !!r } function isLong(e) { return !0 === (e && e.__isLong__) } Long.prototype.__isLong__, Object.defineProperty(Long.prototype, "__isLong__", { value: !0 }), Long.isLong = isLong; var n = {}, i = {}; function fromInt(e, t) { var r, a, o; return t ? (o = 0 <= (e >>>= 0) && e < 256) && (a = i[e]) ? a : (r = fromBits(e, (0 | e) < 0 ? -1 : 0, !0), o && (i[e] = r), r) : (o = -128 <= (e |= 0) && e < 128) && (a = n[e]) ? a : (r = fromBits(e, e < 0 ? -1 : 0, !1), o && (n[e] = r), r) } function fromNumber(e, t) { if (isNaN(e)) return t ? l : c; if (t) { if (e < 0) return l; if (e >= s) return m } else { if (e <= -u) return y; if (e + 1 >= u) return _ } return e < 0 ? fromNumber(-e, t).neg() : fromBits(e % o | 0, e / o | 0, t) } function fromBits(e, t, r) { return new Long(e, t, r) } Long.fromInt = fromInt, Long.fromNumber = fromNumber, Long.fromBits = fromBits; var a = Math.pow; function fromString(e, t, r) { if (0 === e.length) throw Error("empty string"); if ("NaN" === e || "Infinity" === e || "+Infinity" === e || "-Infinity" === e) return c; if ("number" === typeof t ? (r = t, t = !1) : t = !!t, (r = r || 10) < 2 || 36 < r) throw RangeError("radix"); var n; if ((n = e.indexOf("-")) > 0) throw Error("interior hyphen"); if (0 === n) return fromString(e.substring(1), t, r).neg(); for (var i = fromNumber(a(r, 8)), o = c, s = 0; s < e.length; s += 8) { var u = Math.min(8, e.length - s), d = parseInt(e.substring(s, s + u), r); if (u < 8) { var l = fromNumber(a(r, u)); o = o.mul(l).add(fromNumber(d)) } else o = (o = o.mul(i)).add(fromNumber(d)) } return o.unsigned = t, o } function fromValue(e, t) { return "number" === typeof e ? fromNumber(e, t) : "string" === typeof e ? fromString(e, t) : fromBits(e.low, e.high, "boolean" === typeof t ? t : e.unsigned) } Long.fromString = fromString, Long.fromValue = fromValue; var o = 4294967296, s = o * o, u = s / 2, d = fromInt(1 << 24), c = fromInt(0); Long.ZERO = c; var l = fromInt(0, !0); Long.UZERO = l; var p = fromInt(1); Long.ONE = p; var f = fromInt(1, !0); Long.UONE = f; var h = fromInt(-1); Long.NEG_ONE = h; var _ = fromBits(-1, 2147483647, !1); Long.MAX_VALUE = _; var m = fromBits(-1, -1, !0); Long.MAX_UNSIGNED_VALUE = m; var y = fromBits(0, -2147483648, !1); Long.MIN_VALUE = y; var v = Long.prototype; v.toInt = function toInt() { return this.unsigned ? this.low >>> 0 : this.low }, v.toNumber = function toNumber() { return this.unsigned ? (this.high >>> 0) * o + (this.low >>> 0) : this.high * o + (this.low >>> 0) }, v.toString = function toString(e) { if ((e = e || 10) < 2 || 36 < e) throw RangeError("radix"); if (this.isZero()) return "0"; if (this.isNegative()) { if (this.eq(y)) { var t = fromNumber(e), r = this.div(t), n = r.mul(t).sub(this); return r.toString(e) + n.toInt().toString(e) } return "-" + this.neg().toString(e) } for (var i = fromNumber(a(e, 6), this.unsigned), o = this, s = ""; ;) { var u = o.div(i), d = (o.sub(u.mul(i)).toInt() >>> 0).toString(e); if ((o = u).isZero()) return d + s; for (; d.length < 6;)d = "0" + d; s = "" + d + s } }, v.getHighBits = function getHighBits() { return this.high }, v.getHighBitsUnsigned = function getHighBitsUnsigned() { return this.high >>> 0 }, v.getLowBits = function getLowBits() { return this.low }, v.getLowBitsUnsigned = function getLowBitsUnsigned() { return this.low >>> 0 }, v.getNumBitsAbs = function getNumBitsAbs() { if (this.isNegative()) return this.eq(y) ? 64 : this.neg().getNumBitsAbs(); for (var e = 0 != this.high ? this.high : this.low, t = 31; t > 0 && 0 == (e & 1 << t); t--); return 0 != this.high ? t + 33 : t + 1 }, v.isZero = function isZero() { return 0 === this.high && 0 === this.low }, v.eqz = v.isZero, v.isNegative = function isNegative() { return !this.unsigned && this.high < 0 }, v.isPositive = function isPositive() { return this.unsigned || this.high >= 0 }, v.isOdd = function isOdd() { return 1 === (1 & this.low) }, v.isEven = function isEven() { return 0 === (1 & this.low) }, v.equals = function equals(e) { return isLong(e) || (e = fromValue(e)), (this.unsigned === e.unsigned || this.high >>> 31 !== 1 || e.high >>> 31 !== 1) && (this.high === e.high && this.low === e.low) }, v.eq = v.equals, v.notEquals = function notEquals(e) { return !this.eq(e) }, v.neq = v.notEquals, v.ne = v.notEquals, v.lessThan = function lessThan(e) { return this.comp(e) < 0 }, v.lt = v.lessThan, v.lessThanOrEqual = function lessThanOrEqual(e) { return this.comp(e) <= 0 }, v.lte = v.lessThanOrEqual, v.le = v.lessThanOrEqual, v.greaterThan = function greaterThan(e) { return this.comp(e) > 0 }, v.gt = v.greaterThan, v.greaterThanOrEqual = function greaterThanOrEqual(e) { return this.comp(e) >= 0 }, v.gte = v.greaterThanOrEqual, v.ge = v.greaterThanOrEqual, v.compare = function compare(e) { if (isLong(e) || (e = fromValue(e)), this.eq(e)) return 0; var t = this.isNegative(), r = e.isNegative(); return t && !r ? -1 : !t && r ? 1 : this.unsigned ? e.high >>> 0 > this.high >>> 0 || e.high === this.high && e.low >>> 0 > this.low >>> 0 ? -1 : 1 : this.sub(e).isNegative() ? -1 : 1 }, v.comp = v.compare, v.negate = function negate() { return !this.unsigned && this.eq(y) ? y : this.not().add(p) }, v.neg = v.negate, v.add = function add(e) { isLong(e) || (e = fromValue(e)); var t = this.high >>> 16, r = 65535 & this.high, n = this.low >>> 16, i = 65535 & this.low, a = e.high >>> 16, o = 65535 & e.high, s = e.low >>> 16, u = 0, d = 0, c = 0, l = 0; return c += (l += i + (65535 & e.low)) >>> 16, d += (c += n + s) >>> 16, u += (d += r + o) >>> 16, u += t + a, fromBits((c &= 65535) << 16 | (l &= 65535), (u &= 65535) << 16 | (d &= 65535), this.unsigned) }, v.subtract = function subtract(e) { return isLong(e) || (e = fromValue(e)), this.add(e.neg()) }, v.sub = v.subtract, v.multiply = function multiply(e) { if (this.isZero()) return c; if (isLong(e) || (e = fromValue(e)), r) return fromBits(r.mul(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned); if (e.isZero()) return c; if (this.eq(y)) return e.isOdd() ? y : c; if (e.eq(y)) return this.isOdd() ? y : c; if (this.isNegative()) return e.isNegative() ? this.neg().mul(e.neg()) : this.neg().mul(e).neg(); if (e.isNegative()) return this.mul(e.neg()).neg(); if (this.lt(d) && e.lt(d)) return fromNumber(this.toNumber() * e.toNumber(), this.unsigned); var t = this.high >>> 16, n = 65535 & this.high, i = this.low >>> 16, a = 65535 & this.low, o = e.high >>> 16, s = 65535 & e.high, u = e.low >>> 16, l = 65535 & e.low, p = 0, f = 0, h = 0, _ = 0; return h += (_ += a * l) >>> 16, f += (h += i * l) >>> 16, h &= 65535, f += (h += a * u) >>> 16, p += (f += n * l) >>> 16, f &= 65535, p += (f += i * u) >>> 16, f &= 65535, p += (f += a * s) >>> 16, p += t * l + n * u + i * s + a * o, fromBits((h &= 65535) << 16 | (_ &= 65535), (p &= 65535) << 16 | (f &= 65535), this.unsigned) }, v.mul = v.multiply, v.divide = function divide(e) { if (isLong(e) || (e = fromValue(e)), e.isZero()) throw Error("division by zero"); var t, n, i; if (r) return this.unsigned || -2147483648 !== this.high || -1 !== e.low || -1 !== e.high ? fromBits((this.unsigned ? r.div_u : r.div_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this; if (this.isZero()) return this.unsigned ? l : c; if (this.unsigned) { if (e.unsigned || (e = e.toUnsigned()), e.gt(this)) return l; if (e.gt(this.shru(1))) return f; i = l } else { if (this.eq(y)) return e.eq(p) || e.eq(h) ? y : e.eq(y) ? p : (t = this.shr(1).div(e).shl(1)).eq(c) ? e.isNegative() ? p : h : (n = this.sub(e.mul(t)), i = t.add(n.div(e))); else if (e.eq(y)) return this.unsigned ? l : c; if (this.isNegative()) return e.isNegative() ? this.neg().div(e.neg()) : this.neg().div(e).neg(); if (e.isNegative()) return this.div(e.neg()).neg(); i = c } for (n = this; n.gte(e);) { t = Math.max(1, Math.floor(n.toNumber() / e.toNumber())); for (var o = Math.ceil(Math.log(t) / Math.LN2), s = o <= 48 ? 1 : a(2, o - 48), u = fromNumber(t), d = u.mul(e); d.isNegative() || d.gt(n);)d = (u = fromNumber(t -= s, this.unsigned)).mul(e); u.isZero() && (u = p), i = i.add(u), n = n.sub(d) } return i }, v.div = v.divide, v.modulo = function modulo(e) { return isLong(e) || (e = fromValue(e)), r ? fromBits((this.unsigned ? r.rem_u : r.rem_s)(this.low, this.high, e.low, e.high), r.get_high(), this.unsigned) : this.sub(this.div(e).mul(e)) }, v.mod = v.modulo, v.rem = v.modulo, v.not = function not() { return fromBits(~this.low, ~this.high, this.unsigned) }, v.and = function and(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low & e.low, this.high & e.high, this.unsigned) }, v.or = function or(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low | e.low, this.high | e.high, this.unsigned) }, v.xor = function xor(e) { return isLong(e) || (e = fromValue(e)), fromBits(this.low ^ e.low, this.high ^ e.high, this.unsigned) }, v.shiftLeft = function shiftLeft(e) { return isLong(e) && (e = e.toInt()), 0 === (e &= 63) ? this : e < 32 ? fromBits(this.low << e, this.high << e | this.low >>> 32 - e, this.unsigned) : fromBits(0, this.low << e - 32, this.unsigned) }, v.shl = v.shiftLeft, v.shiftRight = function shiftRight(e) { return isLong(e) && (e = e.toInt()), 0 === (e &= 63) ? this : e < 32 ? fromBits(this.low >>> e | this.high << 32 - e, this.high >> e, this.unsigned) : fromBits(this.high >> e - 32, this.high >= 0 ? 0 : -1, this.unsigned) }, v.shr = v.shiftRight, v.shiftRightUnsigned = function shiftRightUnsigned(e) { if (isLong(e) && (e = e.toInt()), 0 === (e &= 63)) return this; var t = this.high; return e < 32 ? fromBits(this.low >>> e | t << 32 - e, t >>> e, this.unsigned) : fromBits(32 === e ? t : t >>> e - 32, 0, this.unsigned) }, v.shru = v.shiftRightUnsigned, v.shr_u = v.shiftRightUnsigned, v.toSigned = function toSigned() { return this.unsigned ? fromBits(this.low, this.high, !1) : this }, v.toUnsigned = function toUnsigned() { return this.unsigned ? this : fromBits(this.low, this.high, !0) }, v.toBytes = function toBytes(e) { return e ? this.toBytesLE() : this.toBytesBE() }, v.toBytesLE = function toBytesLE() { var e = this.high, t = this.low; return [255 & t, t >>> 8 & 255, t >>> 16 & 255, t >>> 24, 255 & e, e >>> 8 & 255, e >>> 16 & 255, e >>> 24] }, v.toBytesBE = function toBytesBE() { var e = this.high, t = this.low; return [e >>> 24, e >>> 16 & 255, e >>> 8 & 255, 255 & e, t >>> 24, t >>> 16 & 255, t >>> 8 & 255, 255 & t] }, Long.fromBytes = function fromBytes(e, t, r) { return r ? Long.fromBytesLE(e, t) : Long.fromBytesBE(e, t) }, Long.fromBytesLE = function fromBytesLE(e, t) { return new Long(e[0] | e[1] << 8 | e[2] << 16 | e[3] << 24, e[4] | e[5] << 8 | e[6] << 16 | e[7] << 24, t) }, Long.fromBytesBE = function fromBytesBE(e, t) { return new Long(e[4] << 24 | e[5] << 16 | e[6] << 8 | e[7], e[0] << 24 | e[1] << 16 | e[2] << 8 | e[3], t) } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.request = t.RequestError = void 0; var a = r(0).makeLogger("request"), o = function (e) { function RequestError(t, r) { var n = e.call(this, t) || this; return n.response = r, n } return i(RequestError, e), RequestError }(Error); t.RequestError = o; var s = { method: "get", type: "text", retryTimes: 0, retryDelay: 200 }; function setResponse(e, t) { e.status = t.status, e.statusText = t.statusText, e.data = t.response } t.request = function request(e) { var t, r, n, i = Object.assign({}, s, e), u = i.url, d = i.method, c = i.type, l = i.timeout, p = i.retryTimes, f = i.retryDelay, h = new Promise(function (i, s) { var h = {}, _ = function (d) { if (p < 1) return a.warn("request " + u + " failed"), setResponse(h, t), void s(new o(d, h)); r = setTimeout(function () { a.log("retry request " + u + ", remain times: " + (p - 1)), (n = request(Object.assign({}, e, { retryTimes: p - 1 }))).then(i).catch(s) }, f) }; (t = new XMLHttpRequest).responseType = c, t.open(d.toUpperCase(), u, !0), l && (t.timeout = l), t.onerror = function () { return _("Network error, status=" + t.status + ", statusText=" + t.statusText) }, t.ontimeout = function () { return _("Network timeout exceed " + l + "ms, , status=" + t.status + ", statusText=" + t.statusText) }, t.onload = function () { setResponse(h, t), t.status >= 200 && t.status < 300 ? i(h) : _("Network error, status=" + t.status + ", statusText=" + t.statusText) }, t.send(null) }); return h.cancel = function (e) { void 0 === e && (e = "cancel"), clearTimeout(r), n && n.cancel(e), t && t.abort() }, h.url = u, h } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BitrateControl = void 0; r(0).makeLogger("bitrate-control"); var n = function () { function BitrateControl() { this._byteLength = 0, this._startTime = 0, this._endTime = 0, this._dispatchTime = 0 } return BitrateControl.prototype.startDownload = function (e) { this._fragment = e, this._startTime = Date.now(), this._byteLength = 0 }, BitrateControl.prototype.receiveData = function (e) { e instanceof ArrayBuffer && (this._byteLength += e.byteLength) }, BitrateControl.prototype.endDownload = function () { this._endTime = Date.now(); var e = (this._endTime - this._startTime) / 1e3, t = 8 * this._byteLength / e, r = Date.now(); r - this._dispatchTime > 3e4 && (this.onBitrate(t), this._dispatchTime = r) }, BitrateControl }(); t.BitrateControl = n }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.MediaManager = void 0; var i = r(4), a = r(2), o = r(0), s = r(1), u = n(r(16)), d = o.makeLogger("media-manager"), c = function () { function MediaManager(e, t, n) { this._destroyed = !1, i.bindAll(this), this._config = n; var o = n.enableWorker, s = n.debug; this._mediaHandler = t, this._mediaHandler.onError = this._onError, this.attachLoader(e), o ? (this._transmuxer = r(52)(16), this._transmuxer.postMessage({ name: "setLoggerEnable", params: s }, void 0), d.log("transmuxe with worker")) : (this._transmuxer = new u.default, d.log("transmuxe with no worker")), a.connectEventbus(this._transmuxer, this._onMessage, this._config) } return MediaManager.prototype.init = function () { this._transmuxer.postMessage({ name: "init", params: a.configClone(this._transmuxer, this._config) }) }, MediaManager.prototype.dispose = function () { this._destroyed = !0, this.onError = null, this._mediaHandler = null, this._loader = null, this._transmuxer.terminate(), this._transmuxer = null }, MediaManager.prototype.attachLoader = function (e) { this._loader = e, this._loader.onData = this.appendData, this._loader.onEnd = this.appendEnd, this._loader.onError = this._onLoaderError, this._loader.attachMedia(this._mediaHandler) }, MediaManager.prototype.appendData = function (e) { if (!this._destroyed) if (e instanceof ArrayBuffer) this._transmuxer.postMessage({ name: "appendData", params: e }, [e]); else { var t = []; this._config.enableWorker && e.data && (e.data = a.u8aClone(e.data), t.push(e.data.buffer)), this._transmuxer.postMessage({ name: "appendData", params: e }, t) } }, MediaManager.prototype.appendEnd = function () { d.log("loader end"), this._transmuxer.postMessage({ name: "appendEnd" }, void 0) }, MediaManager.prototype.changeFormat = function (e) { this._transmuxer.postMessage({ name: "changeFormat", params: e }, void 0) }, MediaManager.prototype._onRemuxData = function (e) { this._mediaHandler && this._mediaHandler.appendData(e) }, MediaManager.prototype._onError = function (e) { this.onError && (!e || e instanceof Error || !e.name || (e = s.errorRestore(e)), this.onError(e)) }, MediaManager.prototype._onMessage = function (e) { var t = e.data, r = t.name, n = t.params; try { switch (r) { case "_onRemuxData": this._onRemuxData(n); break; case "_onError": this._onError(n) } } catch (e) { d.warn("call " + r + " error", e) } }, MediaManager.prototype._onLoaderError = function (e) { e instanceof Error ? void 0 === e.errorId && (e.errorId = s.ErrorIds.CustomLoaderError, e.fatal = !0) : e = new s.DyError("custom loader error: " + e, s.ErrorIds.CustomLoaderError), this._onError(e) }, MediaManager }(); t.MediaManager = c }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__generator || function (e, t) { var r, n, i, a, o = { label: 0, sent: function () { if (1 & i[0]) throw i[1]; return i[1] }, trys: [], ops: [] }; return a = { next: verb(0), throw: verb(1), return: verb(2) }, "function" === typeof Symbol && (a[Symbol.iterator] = function () { return this }), a; function verb(a) { return function (s) { return function step(a) { if (r) throw new TypeError("Generator is already executing."); for (; o;)try { if (r = 1, n && (i = 2 & a[0] ? n.return : a[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, a[1])).done) return i; switch (n = 0, i && (a = [2 & a[0], i.value]), a[0]) { case 0: case 1: i = a; break; case 4: return o.label++, { value: a[1], done: !1 }; case 5: o.label++, n = a[1], a = [0]; continue; case 7: a = o.ops.pop(), o.trys.pop(); continue; default: if (!(i = (i = o.trys).length > 0 && i[i.length - 1]) && (6 === a[0] || 2 === a[0])) { o = 0; continue } if (3 === a[0] && (!i || a[1] > i[0] && a[1] < i[3])) { o.label = a[1]; break } if (6 === a[0] && o.label < i[1]) { o.label = i[1], i = a; break } if (i && o.label < i[2]) { o.label = i[2], o.ops.push(a); break } i[2] && o.ops.pop(), o.trys.pop(); continue }a = t.call(e, o) } catch (e) { a = [6, e], n = 0 } finally { r = i = 0 } if (5 & a[0]) throw a[1]; return { value: a[0] ? a[1] : void 0, done: !0 } }([a, s]) } } }, s = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var u, d = s(r(10)), c = s(r(34)), l = r(18), p = r(5), f = r(1), h = r(0), _ = r(3), m = h.makeLogger("flv-demuxer"); !function (e) { e[e.WAIT_FLV_FLAG = 0] = "WAIT_FLV_FLAG", e[e.WAIT_PRE_TAG_SIZE = 1] = "WAIT_PRE_TAG_SIZE", e[e.WAIT_TAG = 2] = "WAIT_TAG" }(u || (u = {})); var y = function (e) { function FlvDemuxer(t) { var r = e.call(this, t) || this; return r.TAG = "FlvDemuxer", r._destroyed = !1, r._flvSoundRateTable = [5500, 11025, 22050, 44100, 48e3], r._status = u.WAIT_FLV_FLAG, r._lastParseTime = 0, r._tracks = [], r._needMp3Header = !0, r._byteArray = new d.default({ initLength: r._config.stashBuffer, autoClear: !0 }), r } return i(FlvDemuxer, e), FlvDemuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._parser && (this._parser.return("dispose"), this._parser = null), this._byteArray = null, this._audioConfig = null, this._videoConfig = null, this._tracks = [], this._destroyed = !0, m.log("disposed") }, FlvDemuxer.prototype._appendArrayBuffer = function (e) { this._byteArray.write(e), this._parseData() }, FlvDemuxer.prototype._appendEnd = function () { this._parseData(!0), this._parser && this._parser.return("end"), e.prototype._appendEnd.call(this) }, FlvDemuxer.prototype._parseData = function (e) { if (void 0 === e && (e = !1), this._byteArray.byteAvailable > 0) { this._parser || (this._parser = this._parse()); var t = Date.now(); if (e || !this._hasFirstFrame || this._byteArray.byteAvailable > this._config.stashBuffer || t - this._lastParseTime > this._config.stashTime) { this._lastParseTime = t; var r = this._parser.next().value; if (r && r.name === f.DyDemuxError.name) return void this._error(r); this._tracks.splice(0).forEach(this._dispatchTrack) } } }, FlvDemuxer.prototype._parse = function () { var e, t, r, n, i, a, s, d, c, l; return o(this, function (o) { switch (o.label) { case 0: switch (this._status) { case u.WAIT_FLV_FLAG: return [3, 1]; case u.WAIT_PRE_TAG_SIZE: return [3, 4]; case u.WAIT_TAG: return [3, 7] }return [3, 13]; case 1: return this._byteArray.byteAvailable < 9 ? [4] : [3, 3]; case 2: return o.sent(), [3, 1]; case 3: return "FLV" !== (e = this._byteArray.readString(3)) ? [2, new f.DyDemuxError("Not valid flv file : " + e, f.ErrorIds.InvalidFlv)] : (this._byteArray.readUint8(), t = this._byteArray.readUint8(), !!(4 & t) && !!(1 & t) || (this._trackLength = 1), this._byteArray.read(4), this._status = u.WAIT_PRE_TAG_SIZE, [3, 13]); case 4: return this._byteArray.byteAvailable < 4 ? [4] : [3, 6]; case 5: return o.sent(), [3, 4]; case 6: return this._byteArray.read(4), this._status = u.WAIT_TAG, [3, 13]; case 7: return this._byteArray.byteAvailable < 11 ? [4] : [3, 9]; case 8: return o.sent(), [3, 7]; case 9: r = this._byteArray.readUint8(), n = this._byteArray.readUint24(), i = this._byteArray.readUint24(), a = this._byteArray.readUint8(), s = (a << 24 | i) >>> 0, this._byteArray.readUint24(), o.label = 10; case 10: return this._byteArray.byteAvailable < n ? [4] : [3, 12]; case 11: return o.sent(), [3, 10]; case 12: switch (d = this._byteArray.bytePosition, c = this._byteArray.read(n), l = void 0, r) { case 8: !1 !== this._config.hasAudio && (l = this._parseAudio(c, s)); break; case 9: !1 !== this._config.hasVideo && (l = this._parseVideo(c, s, d)); break; case 18: this._parseScript(c); break; default: m.warn("unsupport flv tag type", r) }return this._status = u.WAIT_PRE_TAG_SIZE, l ? [2, l] : [3, 13]; case 13: return [3, 0]; case 14: return [2] } }) }, FlvDemuxer.prototype._error = function (e) { this.onError && this.onError(e) }, FlvDemuxer.prototype._parseAudio = function (e, t) { var r = new d.default({ buffer: e }), n = r.readUint8(), i = (240 & n) >> 4, o = (12 & n) >> 2, s = 1 & n, u = r.read(r.byteAvailable), c = this._audioConfig; if (c.channelCount = 0 === s ? 1 : 2, c.audioSampleRate = this._flvSoundRateTable[o], 10 === i) { var l = new Uint8Array(u), h = l[0], _ = l.subarray(1), y = { type: "audio", trackId: c.trackId, dts: t, pts: t, codec: p.Codec.AAC, config: c, data: _ }; 0 === h ? (y.flag = "CFG", this._pushTrack(y)) : 1 === h ? this._pushTrack(y) : m.warn(this.TAG, "Flv: Unsupported AAC data type " + h) } else { if (2 !== i) return new f.DyDemuxError("unsupport audio type = " + i, f.ErrorIds.UnsupportedFlvAudio); var v = new Uint8Array(u); y = { type: "audio", trackId: c.trackId, dts: t, pts: t, codec: p.Codec.MP3, config: c, data: v }; if (this._needMp3Header) { var g = a(a({}, y), { flag: "CFG", data: new Uint8Array(u.slice(0, 4)) }); this._pushTrack(g), this._needMp3Header = !1 } this._pushTrack(y) } }, FlvDemuxer.prototype._parseVideo = function (e, t, r) { var n = new d.default({ buffer: e }), i = n.readUint8(), a = (240 & i) >> 4, o = 15 & i; if (7 !== o && 12 !== o) return new f.DyDemuxError("unsupport video codec type = " + o, f.ErrorIds.UnsupportedFlvVideo); var s = n.read(n.byteAvailable); return this._parseVideoPacket(s, 0, s.byteLength, t, r, a, o) }, FlvDemuxer.prototype._parseScript = function (e) { var t = c.default.parseScriptData(e, 0, e.byteLength); if ("onMetaData" in t) { var r = t.onMetaData; "number" === typeof r.audiodatarate && void 0 === this._audioConfig.dataRate && (this._audioConfig.dataRate = r.audiodatarate), "number" === typeof r.videodatarate && void 0 === this._videoConfig.dataRate && (this._videoConfig.dataRate = r.videodatarate), this._config.__internal.eventbus.emit(_.InternalEvents.METADATA, r), m.log(this.TAG, "Parsed onMetaData", r) } }, FlvDemuxer.prototype._parseVideoPacket = function (e, t, r, n, i, a, o) { if (r < 4) m.warn(this.TAG, "Flv: Invalid Video packet, missing PacketType or/and CompositionTime"); else { var s = new DataView(e, t, r), u = s.getUint8(0), d = (16777215 & s.getUint32(0, !1)) << 8 >> 8, c = this._videoConfig, l = new Uint8Array(e, t + 4, r - 4), h = { type: "video", trackId: c.trackId, dts: n, pts: n + d, codec: 12 === o ? p.Codec.H265 : p.Codec.H264, config: c, data: l, isKeyframe: 1 === a }; if (0 === u) h.flag = "CFG", this._pushTrack(h); else if (1 === u) this._pushTrack(h); else if (2 !== u) return new f.DyDemuxError("Flv: Invalid video packet type " + u, f.ErrorIds.InvalidFlvVideoPacket) } }, FlvDemuxer.prototype._pushTrack = function (e) { this._tracks.push(e) }, FlvDemuxer.prototype._dispatchTrack = function (e) { this._destroyed || this._appendTrack(e) }, FlvDemuxer.prototype._resetTrack = function (t) { e.prototype._resetTrack.call(this, t), this._byteArray.reset(), this._status = u.WAIT_FLV_FLAG, this._tracks = [], this._needMp3Header = !0, this._hasFirstFrame = !1, this._parser && (this._parser.return("reset"), this._parser = null) }, FlvDemuxer }(l.Demuxer); t.default = y }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var i, a = n(r(0)), o = n(r(35)), s = (i = new ArrayBuffer(2), new DataView(i).setInt16(0, 256, !0), 256 === new Int16Array(i)[0]), u = function () { function AMF() { } return AMF.parseScriptData = function (e, t, r) { var n = {}; try { var i = AMF.parseValue(e, t, r), o = AMF.parseValue(e, t + i.size, r - i.size); n[i.data] = o.data } catch (e) { a.default.error("AMF", e.toString()) } return n }, AMF.parseObject = function (e, t, r) { if (r < 3) throw new Error("Data not enough when parse ScriptDataObject"); var n = AMF.parseString(e, t, r), i = AMF.parseValue(e, t + n.size, r - n.size), a = i.objectEnd; return { data: { name: n.data, value: i.data }, size: n.size + i.size, objectEnd: a } }, AMF.parseVariable = function (e, t, r) { return AMF.parseObject(e, t, r) }, AMF.parseString = function (e, t, r) { if (r < 2) throw new Error("Data not enough when parse String"); var n = new DataView(e, t, r).getUint16(0, !s); return { data: n > 0 ? o.default(new Uint8Array(e, t + 2, n)) : "", size: 2 + n } }, AMF.parseLongString = function (e, t, r) { if (r < 4) throw new Error("Data not enough when parse LongString"); var n = new DataView(e, t, r).getUint32(0, !s); return { data: n > 0 ? o.default(new Uint8Array(e, t + 4, n)) : "", size: 4 + n } }, AMF.parseDate = function (e, t, r) { if (r < 10) throw new Error("Data size invalid when parse Date"); var n = new DataView(e, t, r), i = n.getFloat64(0, !s), a = n.getInt16(8, !s); return { data: new Date(i += 60 * a * 1e3), size: 10 } }, AMF.parseValue = function (e, t, r) { if (r < 1) throw new Error("Data not enough when parse Value"); var n, i = new DataView(e, t, r), o = 1, u = i.getUint8(0), d = !1; try { switch (u) { case 0: n = i.getFloat64(1, !s), o += 8; break; case 1: n = !!i.getUint8(1), o += 1; break; case 2: var c = AMF.parseString(e, t + 1, r - 1); n = c.data, o += c.size; break; case 3: n = {}; var l = 0; for (9 === (16777215 & i.getUint32(r - 4, !s)) && (l = 3); o < r - 4;) { var p = AMF.parseObject(e, t + o, r - o - l); if (p.objectEnd) break; n[p.data.name] = p.data.value, o += p.size } if (o <= r - 3) 9 === (16777215 & i.getUint32(o - 1, !s)) && (o += 3); break; case 8: n = {}, o += 4; l = 0; for (9 === (16777215 & i.getUint32(r - 4, !s)) && (l = 3); o < r - 8;) { var f = AMF.parseVariable(e, t + o, r - o - l); if (f.objectEnd) break; n[f.data.name] = f.data.value, o += f.size } if (o <= r - 3) 9 === (16777215 & i.getUint32(o - 1, !s)) && (o += 3); break; case 9: n = void 0, o = 1, d = !0; break; case 10: n = []; var h = i.getUint32(1, !s); o += 4; for (var _ = 0; _ < h; _++) { var m = AMF.parseValue(e, t + o, r - o); n.push(m.data), o += m.size } break; case 11: var y = AMF.parseDate(e, t + 1, r - 1); n = y.data, o += y.size; break; case 12: var v = AMF.parseString(e, t + 1, r - 1); n = v.data, o += v.size; break; default: o = r, a.default.warn("AMF", "Unsupported AMF value type " + u) } } catch (e) { a.default.error("AMF", e.toString()) } return { data: n, size: o, objectEnd: d } }, AMF }(); t.default = u }, function (e, t, r) { "use strict"; function checkContinuation(e, t, r) { var n = e; if (t + r < n.length) { for (; r--;)if (128 !== (192 & n[++t])) return !1; return !0 } return !1 } Object.defineProperty(t, "__esModule", { value: !0 }), t.default = function decodeUTF8(e) { for (var t = [], r = e, n = 0, i = e.length; n < i;)if (r[n] < 128) t.push(String.fromCharCode(r[n])), ++n; else { if (r[n] < 192); else if (r[n] < 224) { if (checkContinuation(r, n, 1) && (a = (31 & r[n]) << 6 | 63 & r[n + 1]) >= 128) { t.push(String.fromCharCode(65535 & a)), n += 2; continue } } else if (r[n] < 240) { if (checkContinuation(r, n, 2) && (a = (15 & r[n]) << 12 | (63 & r[n + 1]) << 6 | 63 & r[n + 2]) >= 2048 && 55296 !== (63488 & a)) { t.push(String.fromCharCode(65535 & a)), n += 3; continue } } else if (r[n] < 248) { var a; if (checkContinuation(r, n, 3) && (a = (7 & r[n]) << 18 | (63 & r[n + 1]) << 12 | (63 & r[n + 2]) << 6 | 63 & r[n + 3]) > 65536 && a < 1114112) { a -= 65536, t.push(String.fromCharCode(a >>> 10 | 55296)), t.push(String.fromCharCode(1023 & a | 56320)), n += 4; continue } } t.push(String.fromCharCode(65533)), ++n } return t.join("") } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.TsDemuxer = void 0; var s = r(17), u = r(0), d = o(r(10)), c = r(5), l = r(37), p = r(19), f = r(20), h = r(2), _ = u.makeLogger("ts-demuxer"), m = function (e) { function TsDemuxer(t) { var r = e.call(this, t) || this; return r._pmt = { streams: {} }, r._byteArray = new d.default({ initLength: r._config.stashBuffer, autoClear: !0 }), r } return i(TsDemuxer, e), TsDemuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._byteArray = null, this._pmt = null, this._audioConfig = null, this._videoConfig = null, _.log("disposed") }, TsDemuxer.prototype._appendArrayBuffer = function (e) { this._byteArray.write(e), this._parseTsPacket() }, TsDemuxer.prototype._parseTsPacket = function (e) { for (void 0 === e && (e = !1); this._byteArray.byteAvailable >= 188;) { var t = this._byteArray.read(188), r = new Uint8Array(t); if (0 === this._byteArray.byteAvailable && !e) return void this._byteArray.back(188); if (this._byteArray.byteAvailable > 0) { var n = this._byteArray.peekBytes(1)[0]; if (71 !== r[0] || 71 !== n) { _.log("invalid ts packet, trying find new ts"), this._resetPes(), this._byteArray.back(187), this._findTsPacket(); continue } } var i = r[1] >> 6 & 1, a = (31 & r[1]) << 8 | r[2], o = r[3] >> 4 & 3, s = 4; if (2 === o || 3 === o) { var u = r[s++]; s += u } if (0 !== a) { if (this._pmt.pid && a === this._pmt.pid) { g = r[s++], w = (s += g) + 3 + (b = (15 & r[s + 1]) << 8 | r[s + 2]) - 4; for (s += 12 + ((15 & r[s + 10]) << 8 | r[s + 11]); s < w;) { var l = r[s], p = (31 & r[s + 1]) << 8 | r[s + 2]; if (s += 5 + ((15 & r[s + 3]) << 8 | r[s + 4]), !this._pmt.streams[p]) { var f = void 0, h = void 0; switch (l) { case 27: f = "video", h = c.Codec.H264; break; case 36: f = "video", h = c.Codec.H265; break; case 15: f = "audio", h = c.Codec.AAC; break; case 3: f = "audio", h = c.Codec.MP3; break; case 21: break; default: _.warn("unsupport stream type: " + l + ", pid: " + p) }this._pmt.foundVideo && "video" === f ? _.warn("multiple video found, ignore this one: " + f + " " + h + " " + p) : this._pmt.foundAudio && "audio" === f ? _.warn("multiple audio found, ignore this one: " + f + " " + h + " " + p) : f && (this._pmt.streams[p] = { type: f, codec: h, pes: { ba: new d.default({ initLength: this._config.stashBuffer, autoClear: !0 }), waitStart: !0 } }, "video" === f ? this._pmt.foundVideo = !0 : this._pmt.foundAudio = !0, _.log("found stream: " + f + " " + h + " " + p)) } } } else if (this._pmt.streams[a]) { var m = this._pmt.streams[a].pes, y = r.subarray(s), v = this._isPesStart(y); if (m.waitStart && !v) { _.warn("ignore un-start packet pid=" + a + ", size=" + y.byteLength); continue } i && v && this._parsePes(a), m.ba.write(y), m.waitStart = !1 } } else { var g = r[s++], b = (15 & r[(s += g) + 1]) << 8 | r[s + 2]; if (!(1 & r[s + 5])) continue; var w = s + 3 + b - 4; for (s += 8; s < w;) { r[s] << 8 | r[s + 1] && (this._pmt.pid = (31 & r[s + 2]) << 8 | r[s + 3]), s += 4 } } } }, TsDemuxer.prototype._isPesStart = function (e) { return 0 === e[0] && 0 === e[1] && 1 === e[2] }, TsDemuxer.prototype._parsePes = function (e) { var t = this._pmt.streams[e], r = t.pes.ba; if (!(r.byteAvailable < 11)) { r.read(3); r.readUint8(), r.readUint16(), r.readUint8(); var n = r.readUint8(), i = (r.readUint8(), 536870912 * (14 & r.readUint8()) + (r.readUint16() >> 1 << 15) + (r.readUint16() >> 1)); i > 4294967295 && (i -= 8589934592); var a = i /= 90; 192 === n && ((a = 536870912 * (14 & r.readUint8()) + (r.readUint16() >> 1 << 15) + (r.readUint16() >> 1)) > 4294967295 && (a -= 8589934592), a /= 90); var o = r.read(r.byteAvailable), s = t.codec; switch (s) { case c.Codec.H264: case c.Codec.H265: this._parseNal(o, i, a, s); break; case c.Codec.AAC: this._parseAdts(o, i, a); break; case c.Codec.MP3: this._parseMp3(o, i, a); break; default: _.warn("unsupport codec=" + s) } } }, TsDemuxer.prototype._parseNal = function (e, t, r, n) { var i = this._videoConfig, o = new Uint8Array(e), s = { type: i.type, trackId: i.trackId, dts: r, pts: t, codec: n, config: i }, u = p.parseNal({ codec: n, bytes: o }); if (u.configNalus.length > 0) { var d = a(a({}, s), { flag: "CFG", data: o.slice(0), dataFormat: "nalu" }); this._appendTrack(d) } if (u.nals.length > 0) { var c = new l.BufferWriter(new ArrayBuffer(u.nalsLength + 4 * u.nals.length)); u.nals.forEach(function (e) { return c.writeUint32(e.naluData.byteLength).write(e.naluData) }), s.data = new Uint8Array(c.buf), this._appendTrack(s) } }, TsDemuxer.prototype._parseAdts = function (e, t, r) { for (var n = new Uint8Array(e), i = n.byteLength, o = this._audioConfig, s = { type: "audio", trackId: o.trackId, dts: r, pts: t, codec: c.Codec.AAC, config: o }, u = 0, d = 0; u < i;) { var l = n.slice(u, u + 7); if (!this._audioHeader || !h.isBufferEqual(this._audioHeader, l)) { this._audioHeader = l; var p = n[u + 2] >> 6, m = n[u + 2] >> 2 & 15, y = f.reference.mpegSamplingRates[m]; o.refSampleDuration = 1024 / y * 1e3; var v = (1 & n[u + 2]) << 2 | n[u + 3] >> 6, g = [], b = p + 1; g[0] = b << 3, g[0] |= (15 & m) >>> 1, g[1] = (15 & m) << 7, g[1] |= (15 & v) << 3, 5 === b && (o[1] |= (15 & m) >>> 1, o[2] = (1 & m) << 7, o[2] |= 8, o[3] = 0); var w = a(a({}, s), { flag: "CFG", data: new Uint8Array(g) }); this._appendTrack(w) } var E = (3 & n[u + 3]) << 11 | n[u + 4] << 3 | n[u + 5] >> 5 & 7, T = u + E, S = t + d * o.refSampleDuration; if (n.length < T) return void _.warn("imcomplete aac frame, aac_frame_length=" + E + ", missing bytes=" + (T - n.length)); this._appendTrack(a(a({}, s), { pts: S, dts: S, data: n.subarray(u + 7, T) })), u = T, d++ } }, TsDemuxer.prototype._parseMp3 = function (e, t, r) { var n = new Uint8Array(e), i = this._audioConfig, o = { type: "audio", trackId: i.trackId, dts: r, pts: t, codec: c.Codec.MP3, config: i, data: n }, s = n.slice(0, 4); if (!this._audioHeader || !h.isBufferEqual(this._audioHeader, s)) { this._audioHeader = s; var u = a(a({}, o), { flag: "CFG", data: s }); this._appendTrack(u) } this._appendTrack(o) }, TsDemuxer.prototype._resetTrack = function (t) { e.prototype._resetTrack.call(this, t), this._byteArray.reset(), this._resetPes() }, TsDemuxer.prototype._resetPes = function () { var e = this; Object.keys(this._pmt.streams).forEach(function (t) { var r = e._pmt.streams[t]; r.pes.ba.reset(), r.pes.waitStart = !0 }) }, TsDemuxer.prototype._flush = function () { var e = this; this._parseTsPacket(!0), Object.keys(this._pmt.streams).forEach(function (t) { e._parsePes(+t) }) }, TsDemuxer.prototype._appendEnd = function () { this._flush(), e.prototype._appendEnd.call(this) }, TsDemuxer.prototype._findTsPacket = function () { var e = this; this._byteArray.peekBytes().some(function (t, r) { if (71 === t) return _.log("find new ts packet, skip " + r + " bytes."), e._byteArray.skip(r), !0 }) }, TsDemuxer }(s.Demuxer); t.TsDemuxer = m }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.BufferWriter = void 0; var n = function () { function BufferWriter(e) { this._offset = 0, this.buf = e, this.dv = new DataView(e), this.u8a = new Uint8Array(e) } return Object.defineProperty(BufferWriter.prototype, "offset", { get: function () { return this._offset }, enumerable: !1, configurable: !0 }), BufferWriter.prototype.write = function (e) { var t = e instanceof ArrayBuffer ? new Uint8Array(e) : e, r = t.length; return r > 0 && (this.u8a.set(t, this._offset), this._offset += r), this }, BufferWriter.prototype.writeString = function (e) { return e && e.length > 0 && this.write(e.split("").map(function (e) { return e.charCodeAt(0) })), this }, BufferWriter.prototype.writeInt8 = function (e) { return this.dv.setInt8(this._offset, e), this._offset += 1, this }, BufferWriter.prototype.writeInt16 = function (e, t) { return this.dv.setInt16(this._offset, e, t), this._offset += 2, this }, BufferWriter.prototype.writeInt32 = function (e, t) { return this.dv.setInt32(this._offset, e, t), this._offset += 4, this }, BufferWriter.prototype.writeUint8 = function (e) { return this.dv.setUint8(this._offset, e), this._offset += 1, this }, BufferWriter.prototype.writeUint16 = function (e, t) { return this.dv.setUint16(this._offset, e, t), this._offset += 2, this }, BufferWriter.prototype.writeUint32 = function (e, t) { return this.dv.setUint32(this._offset, e, t), this._offset += 4, this }, BufferWriter.prototype.skip = function (e) { return this._offset += e, this }, BufferWriter }(); t.BufferWriter = n }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function AAcFilParser() { } return AAcFilParser._getbits = function (e, t, r) { if (!r || t <= 0 || t > 8) return -1; var n, i, a = 0; if (i = 7 & e, a = r[n = e >> 3] << i & 255, a >>= 8 - t, i + t > 8) { if (void 0 === r[n + 1]) return -1; a |= r[n + 1] >> 16 - t - i } return a }, AAcFilParser.parseAacFilData = function (e) { for (var t = 0, r = 0, n = []; ;) { var i = 0, a = 0, o = 0, s = [1, 35, 69, 103, 137, 100, 111, 117, 121]; if (i = AAcFilParser._getbits(t, 3, e), t += 3, i < 0) return null; if (7 == i) return n; if (6 != i) return null; if (a = AAcFilParser._getbits(t, 4, e), t += 4, a < 0) return null; if (15 === a) { if (o = AAcFilParser._getbits(t, 8, e), t += 8, o < 0) return null; a += o - 1 } if (a < 9) return null; for (var u = 0; u < 9; u++) { if (t >> 3 >= e.length) return null; if (i = AAcFilParser._getbits(t, 8, e), t += 8, i != s[u]) return null } if (r + a - 9 > e.length) return null; for (u = 0; u < a - 9; u++) { if (t >> 3 >= e.length) return null; if (i = AAcFilParser._getbits(t, 8, e), t += 8, i < 0) return null; n[r++] = i } } return n }, AAcFilParser.getDbData = function (e) { if (!e) return null; var t = {}; if (e) { var r = 0; if (t.type = e[r++], 16 == t.type) { for (var n = e[r++], i = [], a = 0; a < n; a++) { var o = { uid: "", db: 0 }, s = e[r++], u = e[r++] - s; o.uid = ""; for (var d = 0; d < u; d++)o.uid += (e[r++] - 48).toString(); o.db = e[r++], i.push(o) } t.data = i } else t.data = e.slice(r) } return t }, AAcFilParser }(); t.default = n }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.Remuxer = void 0; var a = r(0), o = r(2), s = r(8), u = a.makeLogger("remuxer"), d = function (e) { function Remuxer(t) { var r = e.call(this) || this; return r._trackConfigs = {}, r._config = t, r } return i(Remuxer, e), Remuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._trackConfigs = {} }, Remuxer.prototype.append = function (e) { if (!this._destroyed) if ("CFG" === e.flag) { var t = e.config, r = this._trackConfigs[e.trackId]; o.isBufferEqual(null === r || void 0 === r ? void 0 : r.bytes, t.bytes) || (this._configChanged(t, r, e), this._trackConfigs[e.trackId] = Object.assign({}, t)) } else this._handleTrackData(e) }, Remuxer.prototype._handleTrackData = function (e) { this.onData(e) }, Remuxer.prototype._configChanged = function (e, t, r) { u.log("track config changed!", t, e) }, Remuxer }(s.BaseStream); t.Remuxer = d }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__assign || function () { return (a = Object.assign || function (e) { for (var t, r = 1, n = arguments.length; r < n; r++)for (var i in t = arguments[r]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]); return e }).apply(this, arguments) }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var s = o(r(41)), u = o(r(7)), d = r(21), c = r(0), l = r(2), p = c.makeLogger("mp4-remuxer"), f = function (e) { function Mp4Remuxer() { var t = null !== e && e.apply(this, arguments) || this; return t.TAG = "MP4Remuxer", t._useAudioMpeg = !1, t._isAudioTimeNeedUpdate = !1, t._trackInfos = {}, t } return i(Mp4Remuxer, e), Mp4Remuxer.prototype.dispose = function () { e.prototype.dispose.call(this), this._trackInfos = void 0 }, Mp4Remuxer.prototype._configChanged = function (e, t, r) { p.log("track config changed!", t, e); var n = a(a({}, e), { duration: l.timescaledTime64(e.duration, e.timescale) }); "audio" === e.type ? "mp3" !== e.detailCodec || u.default.firefox ? (e.mimeType = "audio/mp4; codecs=" + e.detailCodec, r.data = s.default.generateInitSegment(n), p.log("generate init audio segment")) : (e.mimeType = "audio/mpeg", this._useAudioMpeg = !0, this._isAudioTimeNeedUpdate = !0, delete r.data) : "video" === e.type && (e.mimeType = "video/mp4; codecs=" + e.detailCodec, r.data = s.default.generateInitSegment(n), p.log("generate init video segment")); var i = this._trackInfos[r.trackId]; i && i.lastTrack ? i.pendingConfigTrack = r : this.onData(r) }, Mp4Remuxer.prototype._handleTrackData = function (e) { var t = this._trackConfigs[e.trackId]; if (t) { if (e.config = t, "audio" === e.type && this._useAudioMpeg) return this._isAudioTimeNeedUpdate && (e.extradata.timeOffset = e.pts, this._isAudioTimeNeedUpdate = !1), void this.onData(e); var r = this._trackInfos[e.trackId]; if (r || (this._trackInfos[e.trackId] = r = { lastTrack: void 0, sequenceNumber: 1 }), e.isEnd || "RESET" === e.flag) return r.lastTrack && (r.lastTrack.duration = t.refSampleDuration, this._remuxTrack(r.lastTrack), r.lastTrack = null), e.duration = t.refSampleDuration, this.onData(e), void ("RESET" === e.flag && delete this._trackInfos[e.trackId]); e.data ? (r.lastTrack && (r.lastTrack.duration = e.dts - r.lastTrack.dts, (u.default.msedge || u.default.firefox) && "audio" === r.lastTrack.type && r.lastTrack.duration < this._config.audioDurationThreshold && (r.lastTrack.duration = e.config.refSampleDuration, e.dts = e.pts = r.lastTrack.dts + r.lastTrack.duration), this._remuxTrack(r.lastTrack), r.pendingConfigTrack && (this.onData(r.pendingConfigTrack), r.pendingConfigTrack = void 0)), r.lastTrack = e) : this.onData(e) } }, Mp4Remuxer.prototype._mergeBoxes = function (e, t) { var r = new Uint8Array(e.byteLength + t.byteLength); return r.set(e, 0), r.set(t, e.byteLength), r }, Mp4Remuxer.prototype._remuxAudio = function (e) { if (e.duration < 0 && (e.duration = 0), e.duration > this._config.audioDurationThreshold && !e.isFake && (p.warn("audio duration too long " + e.duration), e.extradata.jumpOverTs = e.pts + e.duration), e.data) { var t = { trackId: e.trackId, sequenceNumber: this._trackInfos[e.trackId].sequenceNumber++, samples: [{ duration: l.timescaledTime(e.duration, e.config.timescale), size: e.data.byteLength, cts: 0, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0, isNonSync: 0 } }] }, r = s.default.moof(t, l.timescaledTime64(e.dts, e.config.timescale)), n = s.default.mdat(e.data); e.data = this._mergeBoxes(r, n) } this.onData(e) }, Mp4Remuxer.prototype._remuxVideo = function (e) { e.duration < 0 && (e.duration = 0), e.duration > this._config.videoDurationThreshold && !e.isFake && p.warn("video duration too long " + e.duration); var t = e.isKeyframe; if (e.data) { var r = { trackId: e.trackId, sequenceNumber: this._trackInfos[e.trackId].sequenceNumber++, samples: [{ duration: l.timescaledTime(e.duration, e.config.timescale), size: e.data.byteLength, cts: l.timescaledTime(e.pts - e.dts, e.config.timescale), flags: { isLeading: 0, dependsOn: t ? 2 : 1, isDependedOn: t ? 1 : 0, hasRedundancy: 0, isNonSync: t ? 0 : 1 } }] }; if (u.default.chrome && (u.default.version.major < 50 || 50 === u.default.version.major && u.default.version.build < 2661)) { var n = r.samples[0].flags; n.dependsOn = 2, n.isNonSync = 0 } var i = s.default.moof(r, l.timescaledTime64(e.dts, e.config.timescale)), a = s.default.mdat(e.data); e.data = this._mergeBoxes(i, a) } this.onData(e) }, Mp4Remuxer.prototype._remuxTrack = function (e) { "audio" === e.type ? this._remuxAudio(e) : "video" === e.type && this._remuxVideo(e) }, Mp4Remuxer }(d.Remuxer); t.default = f }, function (e, t, r) { "use strict"; var n = this && this.__spreadArrays || function () { for (var e = 0, t = 0, r = arguments.length; t < r; t++)e += arguments[t].length; var n = Array(e), i = 0; for (t = 0; t < r; t++)for (var a = arguments[t], o = 0, s = a.length; o < s; o++, i++)n[i] = a[o]; return n }; Object.defineProperty(t, "__esModule", { value: !0 }); var i = function () { function MP4() { } return MP4.init = function () { for (var e in MP4.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [], ".mp3": [], hvc1: [], hvcC: [] }, MP4.types) MP4.types.hasOwnProperty(e) && (MP4.types[e] = [e.charCodeAt(0), e.charCodeAt(1), e.charCodeAt(2), e.charCodeAt(3)]); var t = MP4.constants = {}; t.FTYP = new Uint8Array([105, 115, 111, 109, 0, 0, 0, 1, 105, 115, 111, 109, 97, 118, 99, 49]), t.STSD_PREFIX = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), t.STTS = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), t.STSC = t.STCO = t.STTS, t.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), t.HDLR_VIDEO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), t.HDLR_AUDIO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), t.DREF = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), t.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), t.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) }, MP4.box = function (e) { for (var t = 8, r = null, n = Array.prototype.slice.call(arguments, 1), i = n.length, a = 0; a < i; a++)t += n[a].byteLength; (r = new Uint8Array(t))[0] = t >>> 24 & 255, r[1] = t >>> 16 & 255, r[2] = t >>> 8 & 255, r[3] = 255 & t, r.set(e, 4); var o = 8; for (a = 0; a < i; a++)r.set(n[a], o), o += n[a].byteLength; return r }, MP4.generateInitSegment = function (e) { var t = MP4.box(MP4.types.ftyp, MP4.constants.FTYP), r = MP4.moov(e), n = new Uint8Array(t.byteLength + r.byteLength); return n.set(t, 0), n.set(r, t.byteLength), n }, MP4.moov = function (e) { var t = MP4.mvhd(e.timescale, e.duration), r = MP4.trak(e), n = MP4.mvex(e); return MP4.box(MP4.types.moov, t, r, n) }, MP4.mvhd = function (e, t) { return MP4.box(MP4.types.mvhd, new Uint8Array(n([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, 255 & e], t.toBytesBE(), [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]))) }, MP4.trak = function (e) { return MP4.box(MP4.types.trak, MP4.tkhd(e), MP4.mdia(e)) }, MP4.tkhd = function (e) { var t = e.trackId, r = e.duration, i = e.presentWidth, a = e.presentHeight; return MP4.box(MP4.types.tkhd, new Uint8Array(n([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, 0, 0, 0, 0], r.toBytesBE(), [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, i >>> 8 & 255, 255 & i, 0, 0, a >>> 8 & 255, 255 & a, 0, 0]))) }, MP4.mdia = function (e) { return MP4.box(MP4.types.mdia, MP4.mdhd(e), MP4.hdlr(e), MP4.minf(e)) }, MP4.mdhd = function (e) { var t = e.timescale, r = e.duration; return MP4.box(MP4.types.mdhd, new Uint8Array(n([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t], r.toBytesBE(), [85, 196, 0, 0]))) }, MP4.hdlr = function (e) { var t = null; return t = "audio" === e.type ? MP4.constants.HDLR_AUDIO : MP4.constants.HDLR_VIDEO, MP4.box(MP4.types.hdlr, t) }, MP4.minf = function (e) { var t = null; return t = "audio" === e.type ? MP4.box(MP4.types.smhd, MP4.constants.SMHD) : MP4.box(MP4.types.vmhd, MP4.constants.VMHD), MP4.box(MP4.types.minf, t, MP4.dinf(), MP4.stbl(e)) }, MP4.dinf = function () { return MP4.box(MP4.types.dinf, MP4.box(MP4.types.dref, MP4.constants.DREF)) }, MP4.stbl = function (e) { return MP4.box(MP4.types.stbl, MP4.stsd(e), MP4.box(MP4.types.stts, MP4.constants.STTS), MP4.box(MP4.types.stsc, MP4.constants.STSC), MP4.box(MP4.types.stsz, MP4.constants.STSZ), MP4.box(MP4.types.stco, MP4.constants.STCO)) }, MP4.stsd = function (e) { return "audio" === e.type ? "mp3" === e.detailCodec ? MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp3(e)) : MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp4a(e)) : "h265" === e.codec ? MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.hvc1(e)) : MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.avc1(e)) }, MP4.mp3 = function (e) { var t = e.channelCount, r = e.audioSampleRate, n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t, 0, 16, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, 0, 0]); return MP4.box(MP4.types[".mp3"], n) }, MP4.mp4a = function (e) { var t = e.channelCount, r = e.audioSampleRate, n = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, t, 0, 16, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, 0, 0]); return MP4.box(MP4.types.mp4a, n, MP4.esds(e)) }, MP4.esds = function (e) { var t = n(e.bytes), r = t.length, i = new Uint8Array([0, 0, 0, 0, 3, 23 + r, 0, 1, 0, 4, 15 + r, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([r]).concat(t).concat([6, 1, 2])); return MP4.box(MP4.types.esds, i) }, MP4.avc1 = function (e) { var t = e.bytes, r = e.codecWidth, n = e.codecHeight, i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, n >>> 8 & 255, 255 & n, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 115, 107, 121, 45, 119, 97, 110, 103, 64, 113, 113, 46, 99, 111, 109, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return MP4.box(MP4.types.avc1, i, MP4.box(MP4.types.avcC, t)) }, MP4.hvc1 = function (e) { var t = e.bytes, r = e.codecWidth, n = e.codecHeight, i = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, r >>> 8 & 255, 255 & r, n >>> 8 & 255, 255 & n, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 115, 107, 121, 45, 119, 97, 110, 103, 64, 113, 113, 46, 99, 111, 109, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return MP4.box(MP4.types.hvc1, i, MP4.box(MP4.types.hvcC, t)) }, MP4.mvex = function (e) { return MP4.box(MP4.types.mvex, MP4.trex(e)) }, MP4.trex = function (e) { var t = e.trackId, r = new Uint8Array([0, 0, 0, 0, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return MP4.box(MP4.types.trex, r) }, MP4.moof = function (e, t) { return MP4.box(MP4.types.moof, MP4.mfhd(e.sequenceNumber), MP4.traf(e, t)) }, MP4.mfhd = function (e) { var t = new Uint8Array([0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, 255 & e]); return MP4.box(MP4.types.mfhd, t) }, MP4.traf = function (e, t) { var r = e.trackId, i = MP4.box(MP4.types.tfhd, new Uint8Array([0, 0, 0, 0, r >>> 24 & 255, r >>> 16 & 255, r >>> 8 & 255, 255 & r])), a = MP4.box(MP4.types.tfdt, new Uint8Array(n([1, 0, 0, 0], t.toBytesBE()))), o = MP4.sdtp(e), s = MP4.trun(e, o.byteLength + 16 + 16 + 8 + 16 + 8 + 8 + 4); return MP4.box(MP4.types.traf, i, a, s, o) }, MP4.sdtp = function (e) { for (var t = e.samples || [], r = t.length, n = new Uint8Array(4 + r), i = 0; i < r; i++) { var a = t[i].flags; n[i + 4] = a.isLeading << 6 | a.dependsOn << 4 | a.isDependedOn << 2 | a.hasRedundancy } return MP4.box(MP4.types.sdtp, n) }, MP4.trun = function (e, t) { var r = e.samples || [], n = r.length, i = 12 + 16 * n, a = new Uint8Array(i); t += 8 + i, a.set([0, 0, 15, 1, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, 255 & n, t >>> 24 & 255, t >>> 16 & 255, t >>> 8 & 255, 255 & t], 0); for (var o = 0; o < n; o++) { var s = r[o].duration, u = r[o].size, d = r[o].flags, c = r[o].cts; a.set([s >>> 24 & 255, s >>> 16 & 255, s >>> 8 & 255, 255 & s, u >>> 24 & 255, u >>> 16 & 255, u >>> 8 & 255, 255 & u, d.isLeading << 2 | d.dependsOn, d.isDependedOn << 6 | d.hasRedundancy << 4 | d.isNonSync, 0, 0, c >>> 24 & 255, c >>> 16 & 255, c >>> 8 & 255, 255 & c], 12 + 16 * o) } return MP4.box(MP4.types.trun, a) }, MP4.mdat = function (e) { return MP4.box(MP4.types.mdat, e) }, MP4 }(); i.init(), t.default = i }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.TrackParser = void 0; var o = r(0), s = r(8), u = r(43), d = r(1), c = a(r(7)), l = r(5), p = r(3), f = o.makeLogger("track-parser"), h = 50, _ = function (e) { function TrackParser(t) { var r = e.call(this) || this; return r._pendingTracks = [], r._isPending = !1, r._audioGap = h, r._vbrTime = 0, r._vbrBytes = 0, r._config = t, r } return i(TrackParser, e), TrackParser.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._pendingTracks = void 0 }, TrackParser.prototype.append = function (e) { if (!this._destroyed) if (this._isPending) this._pendingTracks.push(e); else if ("RESET" === e.flag && (this._pendingTracks = [], this._audioExpect = void 0, this._vbrTime = 0, this._vbrBytes = 0, f.log("reset")), e.data) { var t = e.codec, r = u.getParser(t); if (r) { if (!r.inited) return this._isPending = !0, this._pendingTracks.push(e), void r.init(this._config, this._onParserInited); var n = e.config; if (n.mimeType || "CFG" === e.flag) { if ("KEY" === e.flag && (e.isKeyframe = !0), "CFG" === e.flag) { if (n.bytes = e.data, !n.bytes.byteLength) return void f.warn(e.type + " track config bytes is missing"); if (0 !== r.parseConfig(n, e.dataFormat)) return void f.warn("parse " + t + " config error"); "audio" === e.type && (n.timescale = n.audioSampleRate) } else if (e.data && !e.isFake && (this._vbrDetect(e), this._audioGapDetect(e), 0 !== r.parseData(e))) return void f.warn("parse " + t + " data error"); this.onData(e) } else f.warn("first track is not cfg, ignore: trackId=" + e.trackId + ", type=" + e.type + ", dts=" + e.dts + ", pts=" + e.pts) } else this.onError(new d.DyDemuxError("unsupport codec: " + t, d.ErrorIds.ParserCodecUnsupport)) } else this.onData(e) }, TrackParser.prototype._onParserInited = function (e) { e ? this.onError(new d.DyDemuxError("" + e, d.ErrorIds.ParserInitError)) : (this._isPending = !1, this._pendingTracks.splice(0).forEach(this.append)) }, TrackParser.prototype._audioGapDetect = function (e) { if (c.default.chrome && "audio" === e.type && e.codec === l.Codec.AAC && e.data && ("KEY" === e.flag || void 0 === e.flag) && e.trackLength > 1) { if (void 0 === this._audioExpect) this._audioExpect = e.dts; else { var t = Math.floor(1e3 * this._audioExpect), r = 1e3 * e.dts - t, n = Math.floor(Math.abs(r) / 1e3); n > this._audioGap && (f.warn("Large timestamp gap detected; may cause AV sync to drift. time:" + 1e3 * e.dts + "us expected:" + t + "us delta:" + r + "us"), this._audioGap = n, this._audioGap > 150 && (f.warn("Large timestamp gap exceed 150ms, jump over " + e.dts + " and reset."), e.extradata.jumpOverTs = e.dts, this._audioGap = h, this._audioExpect = e.dts)) } this._audioExpect += e.config.refSampleDuration } }, TrackParser.prototype._vbrDetect = function (e) { if (this._vbrTime) { this._vbrBytes += e.data.byteLength; var t = e.dts - this._vbrTime; if (t >= 23e3) { var r = Math.round(8 * this._vbrBytes / 1024 / (t / 1e3)); this._vbrBytes = 0, this._vbrTime = e.dts, this._config.__internal.eventbus.emit(p.InternalEvents.VBR, { data: { vbr: r, pts: e.pts } }), f.log("vbr=" + r + ", dts=" + e.dts + ", delta=" + t) } } else this._vbrBytes = 0, this._vbrTime = e.dts }, TrackParser }(s.BaseStream); t.TrackParser = _ }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.getParser = t.registerParser = void 0; var n = r(20), i = r(44), a = r(48), o = {}; function registerParser(e) { o[e.name] = e } t.registerParser = registerParser, t.getParser = function getParser(e) { return o[e] }, registerParser(i.h264), registerParser(n.aac), registerParser(a.mp3) }, function (e, t, r) { "use strict"; var n = this && this.__createBinding || (Object.create ? function (e, t, r, n) { void 0 === n && (n = r), Object.defineProperty(e, n, { enumerable: !0, get: function () { return t[r] } }) } : function (e, t, r, n) { void 0 === n && (n = r), e[n] = t[r] }), i = this && this.__setModuleDefault || (Object.create ? function (e, t) { Object.defineProperty(e, "default", { enumerable: !0, value: t }) } : function (e, t) { e.default = t }), a = this && this.__importStar || function (e) { if (e && e.__esModule) return e; var t = {}; if (null != e) for (var r in e) "default" !== r && Object.hasOwnProperty.call(e, r) && n(t, e, r); return i(t, e), t }, o = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.h264 = void 0; var s = r(0), u = o(r(45)), d = a(r(47)), c = r(5), l = r(19), p = s.makeLogger("h264-parser"), f = { referenceFrameRate: { fixed: !0, fps: 23.976, fps_num: 23976, fps_den: 1e3 } }; t.h264 = { name: c.Codec.H264, inited: !0, parseConfig: function parseConfig(e, t) { if ("nalu" === t) { var r = l.parseNal({ codec: c.Codec.H264, bytes: e.bytes }); if (!(r.configNalus.length > 0)) return p.warn("wrong nalu config data", e), -1; e.bytes = function writeAvcc(e) { var t = e.configNalus.find(function (e) { return 7 === e.naluType }), r = e.configNalus.find(function (e) { return 8 === e.naluType }); if (!t || !t) return null; var n = u.default.parseSPS(t.naluData), i = t.naluData.byteLength, a = r.naluData.byteLength, o = [1, n.profile_idc, n.profile_compatibility, n.level_idc, 255, 225, i >> 8, 255 & i].concat(Array.prototype.slice.call(t.naluData)).concat([1, a >> 8, 255 & a]).concat(Array.prototype.slice.call(r.naluData)); return void 0 !== n.bit_depth_luma_minus8 && (o = o.concat([252 | n.chroma_format_idc, 248 | n.bit_depth_luma_minus8, 248 | n.bit_depth_chroma_minus8, 0])), new Uint8Array(o) }(r) } var n = e.bytes && e.bytes.byteLength; if (n < 7) return p.warn("Invalid AVCDecoderConfigurationRecord, lack of data!"), -1; var i, a = e.bytes.buffer, o = e.bytes.byteOffset, s = new DataView(a, o, n), d = (new Uint8Array(a.slice(o, o + n)), 0), h = 0, _ = 0, m = 0, y = 0, v = "", g = f.referenceFrameRate, b = s.getUint8(0), w = s.getUint8(1); if (s.getUint8(2), s.getUint8(3), 1 !== b || 0 === w) return p.warn("Invalid AVCDecoderConfigurationRecord"), -1; if (3 !== (i = 1 + (3 & s.getUint8(4))) && 4 !== i) return p.warn("Strange NaluLengthSizeMinusOne: " + (i - 1)), -1; var E = 31 & s.getUint8(5); if (0 === E) return p.warn("Invalid AVCDecoderConfigurationRecord: No SPS"), -1; E > 1 && p.warn("Strange AVCDecoderConfigurationRecord: SPS Count = " + E); for (var T = 6, S = 0; S < E; S++) { var P = s.getUint16(T, !1); if (T += 2, 0 !== P) { var A = new Uint8Array(a, o + T, P); T += P; var O = u.default.parseSPS(A); if (0 === S) { d = O.codec_size.width, h = O.codec_size.height, _ = O.present_size.width, m = O.present_size.height, 0 !== O.frame_rate.fps_num && 0 !== O.frame_rate.fps_den && (g = O.frame_rate), y = g.fps_den / g.fps_num * 1e3; for (var M = A.subarray(1, 4), k = "avc1.", D = 0; D < 3; D++) { var L = M[D].toString(16); L.length < 2 && (L = "0" + L), k += L } v = k } } } var x = s.getUint8(T); if (0 === x) return p.warn("Invalid AVCDecoderConfigurationRecord: No PPS"), -1; for (x > 1 && p.warn("Strange AVCDecoderConfigurationRecord: PPS Count = " + x), T++, S = 0; S < x; S++)P = s.getUint16(T, !1), T += 2, 0 !== P && (T += P); return e.naluLengthSize = i, e.codecWidth = d, e.codecHeight = h, e.presentWidth = _, e.presentHeight = m, e.refSampleDuration = y, e.detailCodec = v, e.fps = g.fps, p.debug("Parsed AVCDecoderConfigurationRecord"), 0 }, parseData: function parseData(e) { for (var t = e.data.byteLength, r = e.data.buffer, n = e.data.byteOffset, i = new DataView(r, n, t), a = 0, o = e.config.naluLengthSize; a < t;) { if (a + 4 >= t) { p.warn("Malformed Nalu"); break } var s = i.getUint32(a, !1); if (3 === o && (s >>>= 8), s > t - o) return p.warn("Malformed Nalus, NaluSize > DataSize!"), -1; var u = 31 & i.getUint8(a + o); if (5 === u) e.isKeyframe = !0, e.pureKeyframe = new Uint8Array(r, n + a, 4 + s); else if (6 === u) try { var c = new Uint8Array(r, n + a + 1 + o, s - 1), l = d.default.parseSEI(c), f = l.seiType, h = l.seiData; h && h.data && (f === d.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED && h.uuid === d.H264SeiUUIDType.CloudVideoStream && (e.extradata.seiTimestamp = h.data), e.extradata.sei || (e.extradata.sei = []), e.extradata.sei.push({ seiTimestamp: e.dts, seiType: f, seiData: h })) } catch (e) { p.warn("parse sei error, ignored!", e) } a += o + s } return 0 } } }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var i = n(r(46)), a = function () { function SPSParser() { } return SPSParser._ebsp2rbsp = function (e) { for (var t = e, r = t.byteLength, n = new Uint8Array(r), i = 0, a = 0; a < r; a++)a >= 2 && 3 === t[a] && 0 === t[a - 1] && 0 === t[a - 2] || (n[i] = t[a], i++); return new Uint8Array(n.buffer, 0, i) }, SPSParser.parseSPS = function (e) { var t = SPSParser._ebsp2rbsp(e), r = new i.default(t); r.readByte(); var n = r.readByte(), a = r.readByte(), o = r.readByte(); r.readUEG(); var s, u, d = SPSParser.getProfileString(n), c = SPSParser.getLevelString(o), l = 1, p = 420, f = 8; if ((100 === n || 110 === n || 122 === n || 244 === n || 44 === n || 83 === n || 86 === n || 118 === n || 128 === n || 138 === n || 144 === n) && (3 === (l = r.readUEG()) && r.readBits(1), l <= 3 && (p = [0, 420, 422, 444][l]), f = (s = r.readUEG()) + 8, u = r.readUEG(), r.readBits(1), r.readBool())) for (var h = 3 !== l ? 8 : 12, _ = 0; _ < h; _++)r.readBool() && (_ < 6 ? SPSParser._skipScalingList(r, 16) : SPSParser._skipScalingList(r, 64)); r.readUEG(); var m = r.readUEG(); if (0 === m) r.readUEG(); else if (1 === m) { r.readBits(1), r.readSEG(), r.readSEG(); var y = r.readUEG(); for (_ = 0; _ < y; _++)r.readSEG() } r.readUEG(), r.readBits(1); var v = r.readUEG(), g = r.readUEG(), b = r.readBits(1); 0 === b && r.readBits(1), r.readBits(1); var w = 0, E = 0, T = 0, S = 0; r.readBool() && (w = r.readUEG(), E = r.readUEG(), T = r.readUEG(), S = r.readUEG()); var P = 1, A = 1, O = 0, M = !0, k = 0, D = 0; if (r.readBool()) { if (r.readBool()) { var L = r.readByte(); L > 0 && L < 16 ? (P = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2][L - 1], A = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1][L - 1]) : 255 === L && (P = r.readByte() << 8 | r.readByte(), A = r.readByte() << 8 | r.readByte()) } if (r.readBool() && r.readBool(), r.readBool() && (r.readBits(4), r.readBool() && r.readBits(24)), r.readBool() && (r.readUEG(), r.readUEG()), r.readBool()) { var x = r.readBits(32), I = r.readBits(32); M = r.readBool(), O = (k = I) / (D = 2 * x) } } var R = 1; 1 === P && 1 === A || (R = P / A); var j = 0, C = 0; 0 === l ? (j = 1, C = 2 - b) : (j = 3 === l ? 1 : 2, C = (1 === l ? 2 : 1) * (2 - b)); var B = 16 * (v + 1), F = 16 * (g + 1) * (2 - b); B -= (w + E) * j, F -= (T + S) * C; var N = Math.ceil(B * R); return r.destroy(), r = null, { profile_idc: n, profile_compatibility: a, level_idc: o, profile_string: d, level_string: c, bit_depth: f, bit_depth_luma_minus8: s, bit_depth_chroma_minus8: u, chroma_format_idc: l, chroma_format: p, chroma_format_string: SPSParser.getChromaFormatString(p), frame_rate: { fixed: M, fps: O, fps_den: D, fps_num: k }, sar_ratio: { width: P, height: A }, codec_size: { width: B, height: F }, present_size: { width: N, height: F } } }, SPSParser._skipScalingList = function (e, t) { for (var r = 8, n = 8, i = 0; i < t; i++)0 !== n && (n = (r + e.readSEG() + 256) % 256), r = 0 === n ? r : n }, SPSParser.getProfileString = function (e) { switch (e) { case 66: return "Baseline"; case 77: return "Main"; case 88: return "Extended"; case 100: return "High"; case 110: return "High10"; case 122: return "High422"; case 244: return "High444"; default: return "Unknown" } }, SPSParser.getLevelString = function (e) { return (e / 10).toFixed(1) }, SPSParser.getChromaFormatString = function (e) { switch (e) { case 420: return "4:2:0"; case 422: return "4:2:2"; case 444: return "4:4:4"; default: return "Unknown" } }, SPSParser }(); t.default = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var n = function () { function ExpGolomb(e) { this.TAG = "ExpGolomb", this._buffer = e, this._buffer_index = 0, this._total_bytes = e.byteLength, this._total_bits = 8 * e.byteLength, this._current_word = 0, this._current_word_bits_left = 0 } return ExpGolomb.prototype.destroy = function () { this._buffer = null }, ExpGolomb.prototype._fillCurrentWord = function () { var e = this._total_bytes - this._buffer_index; if (e <= 0) throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available"); var t = Math.min(4, e), r = new Uint8Array(4); r.set(this._buffer.subarray(this._buffer_index, this._buffer_index + t)), this._current_word = new DataView(r.buffer).getUint32(0, !1), this._buffer_index += t, this._current_word_bits_left = 8 * t }, ExpGolomb.prototype.readBits = function (e) { if (e > 32) throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!"); if (e <= this._current_word_bits_left) { var t = this._current_word >>> 32 - e; return this._current_word <<= e, this._current_word_bits_left -= e, t } var r = this._current_word_bits_left ? this._current_word : 0; r >>>= 32 - this._current_word_bits_left; var n = e - this._current_word_bits_left; this._fillCurrentWord(); var i = Math.min(n, this._current_word_bits_left), a = this._current_word >>> 32 - i; return this._current_word <<= i, this._current_word_bits_left -= i, r = r << i | a }, ExpGolomb.prototype.readBool = function () { return 1 === this.readBits(1) }, ExpGolomb.prototype.readByte = function () { return this.readBits(8) }, ExpGolomb.prototype._skipLeadingZero = function () { var e; for (e = 0; e < this._current_word_bits_left; e++)if (0 !== (this._current_word & 2147483648 >>> e)) return this._current_word <<= e, this._current_word_bits_left -= e, e; return this._fillCurrentWord(), e + this._skipLeadingZero() }, ExpGolomb.prototype.readUEG = function () { var e = this._skipLeadingZero(); return this.readBits(e + 1) - 1 }, ExpGolomb.prototype.readSEG = function () { var e = this.readUEG(); return 1 & e ? e + 1 >>> 1 : -1 * (e >>> 1) }, ExpGolomb }(); t.default = n }, function (e, t, r) { "use strict"; var n = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.H264SeiUUIDType = t.H264SeiType = void 0; var i = n(r(0)); t.H264SeiType = { H264_SEI_TYPE_BUFFERING_PERIOD: 0, H264_SEI_TYPE_PIC_TIMING: 1, H264_SEI_TYPE_PAN_SCAN_RECT: 2, H264_SEI_TYPE_FILLER_PAYLOAD: 3, H264_SEI_TYPE_USER_DATA_REGISTERED: 4, H264_SEI_TYPE_USER_DATA_UNREGISTERED: 5, H264_SEI_TYPE_RECOVERY_POINT: 6, H264_SEI_TYPE_FRAME_PACKING: 45, H264_SEI_TYPE_DISPLAY_ORIENTATION: 47, H264_SEI_TYPE_GREEN_METADATA: 56, H264_SEI_TYPE_MASTERING_DISPLAY_COLOUR_VOLUME: 137, H264_SEI_TYPE_ALTERNATIVE_TRANSFER: 147 }, t.H264SeiUUIDType = { AdsCtrlSEIV00001: "AdsCtrlSEIV00001", AdsCtrlSEIV00003: "AdsCtrlSEIV00003", CloudVideoStream: "CloudVideoStream", RoiMaskSeiV00001: "RoiMaskSeiV00001" }; var a = function () { function SEIParser() { } return SEIParser._ebsp2rbsp = function (e) { for (var t = e, r = t.byteLength, n = new Uint8Array(r), i = 0, a = 0; a < r; a++)a >= 2 && 3 === t[a] && 0 === t[a - 1] && 0 === t[a - 2] || (n[i] = t[a], i++); return new Uint8Array(n.buffer, 0, i) }, SEIParser.parseSEI = function (e) { var r, n, i = SEIParser._ebsp2rbsp(e), a = new DataView(i.buffer), o = 0, s = 0, u = 0; do { n = a.getUint8(u), u += 1, o += n } while (255 === n); do { n = a.getUint8(u), u += 1, s += n } while (255 === n); switch (o) { case t.H264SeiType.H264_SEI_TYPE_USER_DATA_UNREGISTERED: r = SEIParser.decodeUnregisteredUserData(a, u, s) }return { seiType: o, seiData: r } }, SEIParser.buffer2JSON = function (e) { for (var t = [], r = new Uint8Array(e), n = 0, i = e.byteLength; n < i; n++)t.push(String.fromCharCode(r[n])); return JSON.parse(t.join("")) }, SEIParser.decodeUnregisteredUserData = function (e, r, n) { if (n < 16) return i.default.warn("SEIParser ", "error size: ", n), null; var a, o, s = String.fromCharCode.apply(null, new Uint8Array(e.buffer, r, 16)); switch (r += 16, s) { case t.H264SeiUUIDType.AdsCtrlSEIV00001: case t.H264SeiUUIDType.AdsCtrlSEIV00003: 0 === (o = e.getUint8(r++)) && (a = SEIParser.buffer2JSON(e.buffer.slice(r, n + r - 17))); break; case t.H264SeiUUIDType.CloudVideoStream: var u = e.getUint32(r).toString(2), d = e.getUint32(r + 4).toString(2); a = parseInt("" + u + (d.length < 32 ? new Array(32 - d.length + 1).join("0") : "") + d, 2); break; case t.H264SeiUUIDType.RoiMaskSeiV00001: var c = e.getUint8(r); r += 1, 1 === c && (a = String.fromCharCode.apply(null, new Uint8Array(e.buffer, r, n - 17))) }return { uuid: s, enctype: o, data: a } }, SEIParser }(); t.default = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.mp3 = void 0; var n = r(0), i = r(5), a = n.makeLogger("mp3-parser"), o = { _mpegAudioV10SampleRateTable: [44100, 48e3, 32e3, 0], _mpegAudioV20SampleRateTable: [22050, 24e3, 16e3, 0], _mpegAudioV25SampleRateTable: [11025, 12e3, 8e3, 0], _mpegAudioL1BitRateTable: [0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1], _mpegAudioL2BitRateTable: [0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1], _mpegAudioL3BitRateTable: [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, -1] }; t.mp3 = { name: i.Codec.MP3, inited: !0, parseConfig: function parseConfig(e) { if (e.bytes.byteLength < 4) return a.warn("Invalid MP3 packet, header missing!"), -1; var t = e.bytes; if (255 !== t[0]) return -1; var r = t[1] >>> 3 & 3, n = (6 & t[1]) >> 1, i = (240 & t[2]) >>> 4, s = (12 & t[2]) >>> 2, u = 3 !== (t[3] >>> 6 & 3) ? 2 : 1, d = 0, c = 0; switch (r) { case 0: d = o._mpegAudioV25SampleRateTable[s]; break; case 2: d = o._mpegAudioV20SampleRateTable[s]; break; case 3: d = o._mpegAudioV10SampleRateTable[s] }switch (n) { case 1: i < o._mpegAudioL3BitRateTable.length && (c = o._mpegAudioL3BitRateTable[i]); break; case 2: i < o._mpegAudioL2BitRateTable.length && (c = o._mpegAudioL2BitRateTable[i]); break; case 3: i < o._mpegAudioL1BitRateTable.length && (c = o._mpegAudioL1BitRateTable[i]) }return e.audioSampleRate = d, e.channelCount = u, e.detailCodec = "mp3", e.dataRate = c, e.refSampleDuration = 1152 / d * 1e3, a.log("Parsed MPEG Audio Frame Header"), 0 }, parseData: function parseData(e) { return 0 } } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.Workerable = void 0; var n = r(4), i = r(1), a = r(2), o = function () { function Workerable() { var e = this; this.inWorker = !1, n.bindAll(this), this.inWorker = "object" !== typeof window, this.inWorker && (self.onmessage = this._onMessage, self.onerror = function (t) { return e._onError(new i.DyError("worker error: " + t, i.ErrorIds.WorkerError)) }) } return Workerable.prototype.init = function (e) { this._config = e, this.inWorker && a.connectEventbus(this, this._onMessage, e) }, Workerable.prototype.postMessage = function (e, t) { this._onMessage({ data: e }) }, Workerable.prototype.terminate = function () { var e, t; this.onmessage = null, this.onerror = null, this.inWorker && this._config && (null === (t = null === (e = this._config.__internal) || void 0 === e ? void 0 : e.eventbus) || void 0 === t || t.removeAllListeners(), this._config = null) }, Workerable.prototype.dispatchMessage = function (e, t) { this.inWorker ? t && t[0] instanceof ArrayBuffer ? self.postMessage(e, t) : self.postMessage(e) : this.onmessage && this.onmessage({ data: e }) }, Workerable.prototype._onError = function (e) { this.dispatchMessage({ name: "_onError", params: this.inWorker ? i.errorClone(e) : e }), this.terminate() }, Workerable }(); t.Workerable = o }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }); var o = r(13), s = r(8), u = r(5), d = r(1), c = a(r(10)), l = function (e) { function WsTranscoder(t) { var r = e.call(this) || this; return r.pendingTracks = [], r.bufferSize = 51200, r.buffer = new c.default({ autoClear: !0, initLength: r.bufferSize }), r.isEnd = !1, r.transcodedMimeType = "", r.config = t, r.ws = new WebSocket(r.config.accelerator.url), r.ws.binaryType = "arraybuffer", r.ws.onopen = r.onOpen, r.ws.onmessage = r.onMessage, r.ws.onclose = function (e) { r.isEnd || r._error(new o.DyError("accelerator closed: code=" + e.code + ", msg=" + e.reason, d.ErrorIds.AcceleratorClosed)) }, r.ws.onerror = function () { return r._error(new o.DyError("accelerator error", d.ErrorIds.AcceleratorError)) }, r } return i(WsTranscoder, e), Object.defineProperty(WsTranscoder.prototype, "isConnected", { get: function () { return !(!this.ws || 1 !== this.ws.readyState) }, enumerable: !1, configurable: !0 }), WsTranscoder.prototype.dispose = function () { e.prototype.dispose.call(this), this.ws && (this.ws.onopen = null, this.ws.onmessage = null, this.ws.onclose = null, this.ws.onerror = null, this.ws.close(), this.ws = null), this.buffer = null, this.pendingTracks = null }, WsTranscoder.prototype.append = function (e) { this._destroyed || this.isEnd || ("video" === e.type ? (e.isEnd && !this.isEnd && (this.ws.send(JSON.stringify({ type: "end" })), this.isEnd = !0), this.send(e), this.lastVideoTrack = e) : this.onData(e)) }, WsTranscoder.prototype.send = function (e) { this.isConnected ? (e.data && this.sendBuffer(e.data), delete e.data, e.codec = u.Codec.H264, e.isEnd = !1, this._dispatchVideoTrack(e)) : this.pendingTracks.push(e) }, WsTranscoder.prototype.sendBuffer = function (e) { this.buffer.write(e), this.buffer.byteAvailable >= this.bufferSize && this.flush() }, WsTranscoder.prototype.flush = function () { if (this.buffer.byteAvailable) { var e = new Uint8Array(this.buffer.readAll()); this.ws.send(e) } }, WsTranscoder.prototype.onOpen = function () { this.ws.send(JSON.stringify({ type: "S", client: location.href, codec: this.config.videoCodec, byteRate: this.config.accelerator.byteRate })), this.pendingTracks.length && this.pendingTracks.splice(0).forEach(this.send) }, WsTranscoder.prototype.onMessage = function (e) { if ("string" === typeof e.data) { var t = JSON.parse(e.data); "end" === t.type ? this._dispatchVideoTrack({ type: "video", trackLength: this.lastVideoTrack.trackLength, trackId: this.lastVideoTrack.trackId, config: this.lastVideoTrack.config, dts: this.lastVideoTrack.dts, pts: this.lastVideoTrack.pts, isKeyframe: !1, codec: u.Codec.H264, isEnd: !0 }) : t.mimeType && (this.transcodedMimeType = t.mimeType, this.pendingTracks.length && this.pendingTracks.splice(0).forEach(this._dispatchVideoTrack)) } else e.data instanceof ArrayBuffer && this._dispatchVideoTrack({ type: "video", trackLength: this.lastVideoTrack.trackLength, trackId: this.lastVideoTrack.trackId, config: this.lastVideoTrack.config, dts: this.lastVideoTrack.dts, pts: this.lastVideoTrack.pts, isKeyframe: !1, codec: u.Codec.H264, data: new Uint8Array(e.data) }) }, WsTranscoder.prototype._error = function (e) { this.onError && this.onError(e) }, WsTranscoder.prototype._dispatchVideoTrack = function (e) { this.transcodedMimeType ? (e.config.mimeType = this.transcodedMimeType, this.onData(e)) : this.pendingTracks.push(e) }, WsTranscoder }(s.BaseStream); t.default = l }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.TrackGenerator = void 0; var a = r(6), o = r(0), s = r(8), u = (o.makeLogger("track-generator"), function (e) { function TrackGenerator(t) { var r = e.call(this) || this; return r._needGenerateVideo = !1, r._config = t, r } return i(TrackGenerator, e), TrackGenerator.prototype.dispose = function () { e.prototype.dispose.call(this), this._config = void 0, this._lastKeyframe = void 0, this._lastVideoTrack = void 0 }, TrackGenerator.prototype.append = function (e) { var t; if (!this._destroyed && ("RESET" === e.flag && (this._lastVideoTrack = void 0), this.onData(e), a.isFrameTrack(e))) { if (1 === e.trackLength ? this._needGenerateVideo || "audio" !== e.type || 2 !== (null === (t = this._lastKeyframe) || void 0 === t ? void 0 : t.trackLength) || (this._needGenerateVideo = !0) : this._needGenerateVideo = !1, "video" === e.type) { var r = Object.assign({}, e); this._lastVideoTrack = r, r.isKeyframe && (this._lastKeyframe = r) } if (this._needGenerateVideo && "audio" === e.type) { var n = this._lastVideoTrack; if (this._lastKeyframe && (!n || Math.abs(e.dts - n.dts) > 50)) { var i = Object.assign({}, this._lastKeyframe); i.dts = e.dts, i.pts = e.pts, i.isFake = !0, i.extradata = {}, i.pureKeyframe && (i.data = i.pureKeyframe), this.onData(i), this._lastVideoTrack = i } } } }, TrackGenerator }(s.BaseStream)); t.TrackGenerator = u }, function (e, t, r) { function webpackBootstrapFunc(e) { var t = {}; function __webpack_require__(r) { if (t[r]) return t[r].exports; var n = t[r] = { i: r, l: !1, exports: {} }; return e[r].call(n.exports, n, n.exports, __webpack_require__), n.l = !0, n.exports } __webpack_require__.m = e, __webpack_require__.c = t, __webpack_require__.i = function (e) { return e }, __webpack_require__.d = function (e, t, r) { __webpack_require__.o(e, t) || Object.defineProperty(e, t, { configurable: !1, enumerable: !0, get: r }) }, __webpack_require__.r = function (e) { Object.defineProperty(e, "__esModule", { value: !0 }) }, __webpack_require__.n = function (e) { var t = e && e.__esModule ? function getDefault() { return e.default } : function getModuleExports() { return e }; return __webpack_require__.d(t, "a", t), t }, __webpack_require__.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, __webpack_require__.p = "/", __webpack_require__.oe = function (e) { throw console.error(e), e }; var r = __webpack_require__(__webpack_require__.s = ENTRY_MODULE); return r.default || r } var n = "[\\.|\\-|\\+|\\w|/|@]+", i = "\\((/\\*.*?\\*/)?s?.*?(" + n + ").*?\\)"; function quoteRegExp(e) { return (e + "").replace(/[.?*+^$[\]\\(){}|-]/g, "\\$&") } function getModuleDependencies(e, t, a) { var o = {}; o[a] = []; var s = t.toString(), u = s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/); if (!u) return o; for (var d, c = u[1], l = new RegExp("(\\\\n|\\W)" + quoteRegExp(c) + i, "g"); d = l.exec(s);)"dll-reference" !== d[3] && o[a].push(d[3]); for (l = new RegExp("\\(" + quoteRegExp(c) + '\\("(dll-reference\\s(' + n + '))"\\)\\)' + i, "g"); d = l.exec(s);)e[d[2]] || (o[a].push(d[1]), e[d[2]] = r(d[1]).m), o[d[2]] = o[d[2]] || [], o[d[2]].push(d[4]); return o } function hasValuesInQueues(e) { return Object.keys(e).reduce(function (t, r) { return t || e[r].length > 0 }, !1) } e.exports = function (e, t) { t = t || {}; var n = { main: r.m }, i = t.all ? { main: Object.keys(n) } : function getRequiredModules(e, t) { for (var r = { main: [t] }, n = { main: [] }, i = { main: {} }; hasValuesInQueues(r);)for (var a = Object.keys(r), o = 0; o < a.length; o++) { var s = a[o], u = r[s].pop(); if (i[s] = i[s] || {}, !i[s][u] && e[s][u]) { i[s][u] = !0, n[s] = n[s] || [], n[s].push(u); for (var d = getModuleDependencies(e, e[s][u], s), c = Object.keys(d), l = 0; l < c.length; l++)r[c[l]] = r[c[l]] || [], r[c[l]] = r[c[l]].concat(d[c[l]]) } } return n }(n, e), a = ""; Object.keys(i).filter(function (e) { return "main" !== e }).forEach(function (e) { for (var t = 0; i[e][t];)t++; i[e].push(t), n[e][t] = "(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })", a = a + "var " + e + " = (" + webpackBootstrapFunc.toString().replace("ENTRY_MODULE", JSON.stringify(t)) + ")({" + i[e].map(function (t) { return JSON.stringify(t) + ": " + n[e][t].toString() }).join(",") + "});\n" }), a = a + "new ((" + webpackBootstrapFunc.toString().replace("ENTRY_MODULE", JSON.stringify(e)) + ")({" + i.main.map(function (e) { return JSON.stringify(e) + ": " + n.main[e].toString() }).join(",") + "}))(self);"; var o = new window.Blob([a], { type: "text/javascript" }); if (t.bare) return o; var s = (window.URL || window.webkitURL || window.mozURL || window.msURL).createObjectURL(o), u = new window.Worker(s); return u.objectURL = s, u } }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.TimeDispatch = void 0; var n = r(4), i = r(2), a = function () { function TimeDispatch() { this.array = [], n.bindAll(this), this._timer = setInterval(this._onTimeUpdate, 100) } return TimeDispatch.prototype.destroy = function () { this.detach(), clearInterval(this._timer) }, TimeDispatch.prototype.attach = function (e) { this.video = e }, TimeDispatch.prototype.detach = function () { this.video = null, this.array = [] }, TimeDispatch.prototype.add = function (e) { i.binsert(this.array, e, function (e, t) { return e.ts - t.ts }), this._onTimeUpdate() }, TimeDispatch.prototype.clear = function () { this.array = [] }, TimeDispatch.prototype._send = function (e) { this.onSend && this.onSend(e) }, TimeDispatch.prototype._onTimeUpdate = function () { if (this.video) { for (var e = 1e3 * this.video.currentTime, t = this.array.length, r = 0; r < t; r++) { var n = this.array[r]; if (n.ts > e) break; this._send(n) } r > 0 && this.array.splice(0, r) } }, TimeDispatch }(); t.TimeDispatch = a }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.MediaHandler = void 0; var n = r(3), i = r(4), a = function () { function MediaHandler(e) { this._destroyed = !1, this._mediaInfo = { fps: 0, width: 100, height: 100, audioMimeType: "", videoMimeType: "", audioDataRate: 0, videoDataRate: 0, mimeType: "", metadata: {} }, this._config = e, i.bindAll(this), e.__internal.eventbus.on(n.InternalEvents.METADATA, this._onMetadata), e.__internal.eventbus.on(n.InternalEvents.VBR, this._onVbr) } return Object.defineProperty(MediaHandler.prototype, "video", { get: function () { return this._video }, enumerable: !1, configurable: !0 }), MediaHandler.prototype.dispose = function () { this._config.__internal.eventbus.off(n.InternalEvents.METADATA, this._onMetadata), this._config.__internal.eventbus.off(n.InternalEvents.VBR, this._onVbr), this.detach(), this.onMediaInfo = void 0, this.onHasKeyframe = void 0, this.onExtraData = void 0, this.onError = void 0, this._destroyed = !0 }, MediaHandler.prototype.appendData = function (e) { this._destroyed || "CFG" === e.flag && this._updateMediaInfo(e.config) }, MediaHandler.prototype.attach = function (e) { this._video = e }, MediaHandler.prototype.detach = function () { this._video = null }, MediaHandler.prototype.getStatInfo = function () { return {} }, MediaHandler.prototype.getBufferTime = function () { return 0 }, MediaHandler.prototype.getCurrentTime = function () { return 0 }, MediaHandler.prototype.getIsWaiting = function () { return !1 }, MediaHandler.prototype._updateMediaInfo = function (e) { "audio" === e.type && (void 0 !== e.dataRate && (this._mediaInfo.audioDataRate = e.dataRate), this._mediaInfo.audioMimeType = e.mimeType), "video" === e.type && (void 0 !== e.dataRate && (this._mediaInfo.videoDataRate = e.dataRate), this._mediaInfo.videoMimeType = e.mimeType, this._mediaInfo.fps = e.fps, this._mediaInfo.width = e.codecWidth, this._mediaInfo.height = e.codecHeight), this._mediaInfo.mimeType = [this._mediaInfo.audioMimeType, this._mediaInfo.videoMimeType].filter(function (e) { return e }).join(","), this.onMediaInfo && this.onMediaInfo(this._mediaInfo) }, MediaHandler.prototype.T_ADV_Timestamp = function () { return null }, MediaHandler.prototype._onExtraData = function (e) { this.onExtraData && this.onExtraData(e) }, MediaHandler.prototype._onMetadata = function (e) { this._mediaInfo.metadata = e, this.onMediaInfo && this.onMediaInfo(this._mediaInfo) }, MediaHandler.prototype._onVbr = function (e) { var t = e.data, r = t.vbr, n = t.pts; this._onExtraData({ type: "vbr", ts: n, data: r }) }, MediaHandler }(); t.MediaHandler = a }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }); Object.defineProperty(t, "__esModule", { value: !0 }), t.ToMSE = void 0; var a = r(1), o = r(56), s = r(12), u = r(6), d = r(0), c = r(2), l = r(3), p = d.makeLogger("to-mse"), f = function (e) { function ToMSE(t) { var r = e.call(this, t) || this; return r.preTimestamp = 0, r._tracks = {}, r._sourceBufferAdded = {}, r._trackEndedFlag = {}, r._isLoadEnded = !1, r._isPlayEnded = !1, r._isWaiting = !0, r._reachCanplay = !1, r._jumpOverList = [], r._keyframes = [], r._isTracksReady = !1, r._lastPlayTime = -1, r._removeBuffer = o.throttle(r._removeBufferNow, 1e3), r._smoothSwitchTime = 1 / 0, window.T_ADV_Timestamp = r.T_ADV_Timestamp, r._config.enableJitterBuffer && (r._checkBufferTimer = setInterval(r._checkBuffer, 1e3)), r._jumpOverTimer = setInterval(r._jumpOver, 200), r._checkBufferGapTimer = setInterval(r._checkBufferGap, 500), r._checkStuckTimer = setInterval(r._checkPlayStuck, 2e3), r._config.__internal.eventbus.on(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, r._onGetSmoothSwitchTime), r } return i(ToMSE, e), ToMSE.prototype.dispose = function () { if (e.prototype.dispose.call(this), this._config.__internal.eventbus.off(l.InternalEvents.GET_SMOOTH_SWITCH_TIME, this._onGetSmoothSwitchTime), this._mediaSource) { if ("closed" !== this._mediaSource.readyState) for (var t = this._mediaSource.sourceBuffers, r = 0; r < t.length; r++) { var n = t[r]; try { this._mediaSource.removeSourceBuffer(n) } catch (e) { p.warn("remove source buffer error: ", e) } n.removeEventListener("updateend", this._onUpdateend) } if ("open" === this._mediaSource.readyState) try { this._mediaSource.endOfStream() } catch (e) { p.warn("endOfStream error: ", e) } this._mediaSource.removeEventListener("sourceopen", this._appendBuffer), this._mediaSource = null } this._mediaSourceUrl && (URL.revokeObjectURL(this._mediaSourceUrl), this._mediaSourceUrl = null), this._sourceBufferAdded = {} }, ToMSE.prototype.appendData = function (t) { var r; if (!this._destroyed) { if (e.prototype.appendData.call(this, t), "RESET" === t.flag) return (null === (r = t.extradata) || void 0 === r ? void 0 : r.switchSource) && (this._switchingSource = t.extradata.switchSource, this._switchingSource.pendingAppend = !0), void this._reset(); var n = this._tracks[t.trackId]; n || (n = this._tracks[t.trackId] = []), n.push(t), this._switchingSource && this._checkSwitchSource(t), this._isTracksReady || (this._isTracksReady = this._checkTracksReady()), this._isTracksReady && this._appendBuffer(), t.isEnd && this._onUpdateend() } }, ToMSE.prototype.appendEnd = function () { if (!this._destroyed && this._mediaSource && "open" === this._mediaSource.readyState) { for (var e = this._mediaSource.sourceBuffers, t = !1, r = 0; r < e.length; r++) { if (e[r].updating) { t = !0; break } } t || (this._mediaSource.endOfStream(), p.log("media end")) } }, ToMSE.prototype.attach = function (t) { if (e.prototype.attach.call(this, t), this._video.addEventListener("stalled", this._onStalled), this._video.addEventListener("progress", this._checkBufferGap), this._video.addEventListener("canplay", this._onCanplay), this._video.addEventListener("waiting", this._onWaiting), this._video.addEventListener("ended", this._onEnded), this._video.addEventListener("error", this._onMediaError), this._video.addEventListener("seeking", this._onSeeking), this._video.addEventListener("play", this._onPlay), !this._mediaSourceUrl) { var r = this._mediaSource = new MediaSource; r.addEventListener("sourceopen", this._appendBuffer), this._mediaSourceUrl = URL.createObjectURL(r) } this._video.src = this._mediaSourceUrl }, ToMSE.prototype.detach = function () { this._video && (this._video.removeEventListener("stalled", this._onStalled), this._video.removeEventListener("progress", this._checkBufferGap), this._video.removeEventListener("canplay", this._onCanplay), this._video.removeEventListener("waiting", this._onWaiting), this._video.removeEventListener("ended", this._onEnded), this._video.removeEventListener("error", this._onMediaError), this._video.removeEventListener("seeking", this._onSeeking), this._video.removeEventListener("play", this._onPlay), this._video.playbackRate = 1, this._video.src = "", this._video.removeAttribute("src"), this._video = null), this._removeBuffer.cancel(), clearInterval(this._checkStuckTimer), clearInterval(this._checkBufferTimer), clearInterval(this._jumpOverTimer), clearInterval(this._checkBufferGapTimer), e.prototype.detach.call(this) }, ToMSE.prototype._appendBuffer = function () { var e, t = this; this._destroyed || !this._mediaSource || "closed" === this._mediaSource.readyState || null !== (e = this._switchingSource) && void 0 !== e && e.pendingAppend || Object.keys(this._tracks).some(function (e) { for (var r = t._tracks[e], n = [], i = t._sourceBufferAdded[e]; r.length > 0;) { var o = r[0]; if (!i) { var s = o.config.mimeType; if (!MediaSource.isTypeSupported(s)) return t._onError(new a.DyMediaError("Unsupported MIME type or codec: " + s, a.ErrorIds.MediaUnsupportCodec)), !0; try { p.log("add source buffer " + o.trackId + ": " + s), (i = t._mediaSource.addSourceBuffer(s)).addEventListener("updateend", t._onUpdateend), t._sourceBufferAdded[o.trackId] = i } catch (e) { return t._onError(new a.DyMediaError("failed add more source buffer, length=" + t._mediaSource.sourceBuffers.length + ", readyState=" + t._mediaSource.readyState + "\n" + e, a.ErrorIds.MediaAddSourceBufferError)), !0 } return } if (!i || i.updating) return; if (o.isEnd && !t._isLoadEnded && (t._trackEndedFlag[o.trackId] = !0, o.trackLength === Object.keys(t._trackEndedFlag).length && (t._isLoadEnded = !0)), o.extradata) { var u = o.extradata, d = u.jumpOverTs, l = u.timeOffset, f = u.seiTimestamp, h = u.aacfil, _ = u.sei; d > 0 && (t._jumpOverList.push({ start: o.pts / 1e3, end: d / 1e3 }), p.warn("jumpover timestamp list changed: ", JSON.stringify(t._jumpOverList))), l && -1 !== l && (i.timestampOffset = l / 1e3, p.log("buffer time offset change: " + i.timestampOffset)), f && (t.seiTimestamp = f), h && t._onExtraData({ type: "aacfil", ts: o.pts, data: h }), _ && t._onExtraData({ type: "sei", ts: o.pts, data: _ }) } o.pts && (t.preTimestamp = o.pts, t._switchingSource && "video" === o.type && (t._switchingSource.lastUpdateVideoTs = o.pts)), "video" === o.type && o.isKeyframe && (c.binsert(t._keyframes, o.pts / 1e3), t.onHasKeyframe && t.onHasKeyframe()), o.data && o.data.byteLength > 0 && n.push(o.data), delete o.data, r.shift() } if (n.length > 0) try { i.appendBuffer(c.bufferConcat(n)) } catch (e) { p.warn("append buffer error: ", e, t._video.error), 22 === e.code || t._onError(new a.DyMediaError("append buffer error: " + e + " " + t._video.error, a.ErrorIds.MediaAppendError)) } }) }, ToMSE.prototype._removeBufferNow = function () { var e; if (this._video && !this._isPlayEnded && (null === (e = this._switchingSource) || void 0 === e || !e.pendingAppend)) for (var t = this._video.currentTime, r = this._mediaSource.sourceBuffers, n = function (e) { var n = r[e]; if (!n.updating) { var a = n.buffered; if (a.length > 0) { var o = a.start(0); if (t - o > i._config.videoBackTimeThreshold) { var s = t - i._config.videoBackTime; (s = i._searchNearestKeyframe(s) - 1) && s - o > 5 && (p.debug("remove played sb[" + e + "]: " + o + " --\x3e " + s), n.remove(Math.max(o - 1, 0), s), i._keyframes = i._keyframes.filter(function (e) { return e >= s })) } } } }, i = this, a = 0; a < r.length; a++)n(a) }, ToMSE.prototype._searchNearestKeyframe = function (e) { var t = this._keyframes.length; if (0 === t) return p.log("no keyframe info!"), e; if (!(e < this._keyframes[0])) for (var r = 0; r < t; r++) { if (e >= this._keyframes[r] && (r === t - 1 || e < this._keyframes[r + 1])) return this._keyframes[r] } }, ToMSE.prototype._onUpdateend = function () { this._switchingSource && this._trySwitchSourceSmooth(), this._removeBuffer(), this._appendBuffer(), this._isLoadEnded && this.appendEnd() }, ToMSE.prototype._checkPlayStuck = function () { if (this._video && !this._video.paused && this._reachCanplay) { var e = this._video.buffered, t = this._video.currentTime; if (this._lastPlayTime === t && this._isWaiting && e.length > 0 && !this._isPlayEnded) if (e.end(e.length - 1) > t + 3) { var r = t + 1; p.warn("player stuck, force move forward: " + t + " -> " + r), this._printBuffer(this._video.buffered), this._video.currentTime = r } this._lastPlayTime = this._video.currentTime } }, ToMSE.prototype._checkBufferGap = function () { if (this._video && this._isWaiting) for (var e = this._video.buffered, t = this._video.currentTime, r = 0; r < e.length; r++) { var n = e.start(r), i = e.end(r); if (n > t && (!this._reachCanplay || i - n > 1)) { if (r > 0) if (e.end(r - 1) - t > 2) return; this._video.currentTime = n, p.log("jump over buffer gap " + (r > 0 ? "[" + e.start(r - 1) + ", " + e.end(r - 1) + "], [" + e.start(r) + ", " + e.end(r) + "]" : "0, [" + e.start(r) + ", " + e.end(r) + "]") + ", " + t + " --\x3e " + n); break } } }, ToMSE.prototype._checkBuffer = function () { if (this._video) { var e = this._video.buffered; if (e && e.length > 0) { var t = e.end(e.length - 1) - this._video.currentTime, r = this._video.playbackRate, n = void 0; if (t < this._config.minBuffer) n = this._config.slowRate; else if (t < this._config.maxBuffer) { var i = (this._config.minBuffer + this._config.maxBuffer) / 2; r < 1 && t > i && (n = 1), r > 1 && t < i && (n = 1) } else n = this._config.fastRate; n && n !== r && (this._video.playbackRate = n, p.log("playback rate change to " + n)) } } }, ToMSE.prototype._printBuffer = function (e) { var t = "buffer status: current = " + this._video.currentTime, r = e.length; t += " buffered ="; for (var n = 0; n < r; n++)t += " [" + e.start(n) + ", " + e.end(n) + "]"; p.log(t) }, ToMSE.prototype._jumpOver = function () { var e = this._jumpOverList.length; if (e > 0) { if (!this._video) return; for (var t = this._video.currentTime, r = this._jumpOverList.concat(), n = e - 1; n >= 0; n--) { var i = r[n]; if (t >= i.start && t < i.end) { var a = i.end + 1; p.warn("Large gap detected, jump from " + t + " to " + a), this._video.currentTime = a, this._jumpOverList.splice(0, n + 1); break } t > i.end && this._jumpOverList.splice(n, 1) } } }, ToMSE.prototype._onStalled = function () { }, ToMSE.prototype._onWaiting = function () { this._isWaiting = !0, this._checkBufferGap() }, ToMSE.prototype._onCanplay = function () { this._reachCanplay = !0, this._isWaiting = !1, this._video.removeEventListener("progress", this._checkBufferGap) }, ToMSE.prototype._onEnded = function () { this._isPlayEnded = !0, this._removeBufferNow() }, ToMSE.prototype._onMediaError = function () { var e = "Media Error"; this._video && this._video.error && (e = "code=" + this._video.error.code + ", message=" + this._video.error.message + ", url=" + this._video.src), this._onError(new a.DyMediaError(e, a.ErrorIds.MediaError)) }, ToMSE.prototype._onError = function (e) { this.onError && this.onError(e) }, ToMSE.prototype._checkTracksReady = function () { var e = this, t = Object.keys(this._tracks)[0]; if (!t) return !1; var r = this._tracks[t]; if (!r || 0 === r.length) return !1; var n = r[0].trackLength, i = Object.keys(this._tracks).map(function (t) { return e._tracks[t][0] }).map(function (e) { return e && e.config.mimeType }).filter(function (e) { return e }); return i.length !== n ? (p.log("tracks not ready, trackLength=" + n + ", now we have [" + i.join(",") + "], waiting..."), !1) : (p.log("tracks are ready, trackLength=" + n + ", now we have [" + i.join(",") + "]"), !0) }, ToMSE.prototype.T_ADV_Timestamp = function () { if (this._video) { if (0 == this._video.buffered.length) return; return { bufferLength: this.getBufferTime(), ptsTimestamp: this.preTimestamp, seiTimestamp: this.seiTimestamp, keyframes: this._keyframes.concat() } } }, ToMSE.prototype.getBufferTime = function () { return this._video && !this._video.seeking && this._video.buffered.length ? this._video.buffered.end(0) - this._video.currentTime : 0 }, ToMSE.prototype.getCurrentTime = function () { return this._video ? this._video.currentTime : 0 }, ToMSE.prototype.getIsWaiting = function () { return this._isWaiting }, ToMSE.prototype._onSeeking = function () { if (p.log("seeking to " + this._video.currentTime), this._isPlayEnded = !1, this._smoothSwitchTime = 1 / 0, "live" !== this._config.mode) { if (this._video) for (var e = this._video.buffered.length, t = this._video.currentTime, r = 0; r < e; r++) { var n = this._video.buffered.start(r), i = this._video.buffered.end(r); if (n - t <= .1 && t - i <= this._config.hls.seekThreshold) return } this._config.__internal.eventbus.emit(l.InternalEvents.SEEK, { data: this._video.currentTime }) } }, ToMSE.prototype._reset = function () { var e = this; if (this._isPlayEnded = !1, this._isLoadEnded = !1, this._jumpOverList = [], this._keyframes = [], this._smoothSwitchTime !== 1 / 0) { var t = 1e3 * this._smoothSwitchTime; Object.keys(this._tracks).forEach(function (r) { e._tracks[r] = e._tracks[r].filter(function (e) { return e.dts < t }) }) } else this._tracks = {}; p.log("mse reset") }, ToMSE.prototype._onPlay = function () { this._isPlayEnded && this._reset() }, ToMSE.prototype._onGetSmoothSwitchTime = function (e) { var t = e.data.time; this._smoothSwitchTime = t + 1 }, ToMSE.prototype._checkSwitchSource = function (e) { var t = this; if (void 0 === this._switchingSource.firstTs && "video" === e.type && e.isKeyframe && u.isFrameTrack(e)) { this._switchingSource.firstTs = e.pts; var r = this._switchingSource.firstTs / 1e3, n = this._video.buffered; if (n.length) { var i = n.start(0), a = n.end(0); if (this._switchingSource.firstTs > 1e3 && i - 2 <= r && r <= a && !this._switchingSource.quick) return p.warn("switch source smooth=true, current=" + this._video.currentTime + ", sourceStart=" + r), this._switchingSource.smooth = !0, void (this._switchingSource.pendingAppend = !1) } p.warn("switch source smooth=false"), this._switchingSource.smooth = !1; var o = this._switchingSource; this._clearAllBuffer().then(function () { o.pendingAppend = !1, t._appendBuffer() }) } }, ToMSE.prototype._trySwitchSourceSmooth = function () { if (!this._destroyed && this._switchingSource && !this._switchingSource.pendingAppend) if (!0 === this._switchingSource.smooth) this._switchingSource.lastUpdateVideoTs >= 1e3 * this._video.currentTime && (p.log("switch source success: smooth=true"), this._printBuffer(this._video.buffered), this._switchingSource = void 0, this._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_SUCCESS, { data: { smooth: !0 } })); else if (!1 === this._switchingSource.smooth) { var e = this._video.buffered; if (0 === e.length) return; p.log("switch source success: smooth=false"), this._video.currentTime = e.start(0), this._printBuffer(this._video.buffered), this._switchingSource = void 0, this._config.__internal.eventbus.emit(l.InternalEvents.SWITCH_SOURCE_SUCCESS, { data: { smooth: !1 } }) } }, ToMSE.prototype._clearAllBuffer = function () { var e = this; return new Promise(function (t) { var r = function () { var n = Object.keys(e._sourceBufferAdded).map(function (t) { return e._sourceBufferAdded[t] }); if (n.every(function (e) { return !e.updating })) return n.forEach(function (e) { e.buffered.length && e.remove(0, 1 / 0) }), p.log("buffer all cleared."), t(); setTimeout(r, 50) }; r() }) }, ToMSE }(s.MediaHandler); t.ToMSE = f }, function (e, t, r) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }), t.throttle = void 0, t.throttle = function (e, t, r) { var n, i, a, o, s = 0; r || (r = {}); var u = function () { s = !1 === r.leading ? 0 : performance.now(), n = null, o = e.apply(i, a), n || (i = a = null) }, d = function () { var d = performance.now(); s || !1 !== r.leading || (s = d); var c = t - (d - s); return i = this, a = arguments, c <= 0 || c > t ? (n && (clearTimeout(n), n = null), s = d, o = e.apply(i, a), n || (i = a = null)) : n || !1 === r.trailing || (n = setTimeout(u, c)), o }; return d.cancel = function () { clearTimeout(n), s = 0, n = i = a = null }, d } }, function (e, t, r) { "use strict"; var n, i = this && this.__extends || (n = function (e, t) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var r in t) t.hasOwnProperty(r) && (e[r] = t[r]) })(e, t) }, function (e, t) { function __() { this.constructor = e } n(e, t), e.prototype = null === t ? Object.create(t) : (__.prototype = t.prototype, new __) }), a = this && this.__importDefault || function (e) { return e && e.__esModule ? e : { default: e } }; Object.defineProperty(t, "__esModule", { value: !0 }), t.ToFile = void 0; var o = a(r(10)), s = r(12), u = r(2), d = function (e) { function ToFile(t) { var r = e.call(this, t) || this; return r._byteArray = new o.default, r } return i(ToFile, e), ToFile.prototype.dispose = function () { }, ToFile.prototype.appendData = function (e) { "video" === e.type && (this._byteArray.write(e.data), e.isEnd && this.appendEnd()) }, ToFile.prototype.appendEnd = function () { u.saveAs(new Blob([this._byteArray.buffer], { type: "octet/stream" }), "sample.mp4") }, ToFile.prototype.attach = function (e) { }, ToFile.prototype.detach = function () { }, ToFile }(s.MediaHandler); t.ToFile = d }]) }, "1b396": function (e, t, r) { "use strict"; var n = r("d3043"); e.exports = function settle(e, t, r) { var i = r.config.validateStatus; r.status && i && !i(r.status) ? t(n("Request failed with status code " + r.status, r.config, null, r.request, r)) : e(r) } }, "1c1a3": function (e, t, r) { "use strict"; r.r(t), r.d(t, "getVideo", function () { return getVideo }); var i = {}; r.r(i), r.d(i, "getData", function () { return getData }), r.d(i, "setEnterPlay", function () { return setEnterPlay }), r.d(i, "changeVolumeByKeyboard", function () { return changeVolumeByKeyboard }), r.d(i, "setVideoReady", function () { return setVideoReady }), r.d(i, "P2PRollback", function () { return P2PRollback }), r.d(i, "udpateVidoReal", function () { return udpateVidoReal }), r.d(i, "setByteCount", function () { return setByteCount }), r.d(i, "changeVolume", function () { return changeVolume }), r.d(i, "setPlay", function () { return setPlay }), r.d(i, "refeshplayerStreamNameAndStatus", function () { return refeshplayerStreamNameAndStatus }), r.d(i, "refeshplayerSrc", function () { return refeshplayerSrc }), r.d(i, "refeshplayerisPlay", function () { return refeshplayerisPlay }), r.d(i, "refeshplayerisRollback", function () { return refeshplayerisRollback }), r.d(i, "refeshplayerP2p", function () { return refeshplayerP2p }), r.d(i, "refeshplayerP2pData", function () { return refeshplayerP2pData }), r.d(i, "changeHaveShowVideoState", function () { return changeHaveShowVideoState }), r.d(i, "setPlayerError", function () { return setPlayerError }), r.d(i, "videoContentResize", function () { return videoContentResize }), r.d(i, "checkAccelerator", function () { return checkAccelerator }), r.d(i, "handleAcceleratorError", function () { return handleAcceleratorError }), r.d(i, "openAcc", function () { return openAcc }), r.d(i, "switchToHwMode", function () { return switchToHwMode }), r.d(i, "upView", function () { return upView }), r.d(i, "initData", function () { return action_initData }), r.d(i, "changeisAudio", function () { return changeisAudio }); var a = {}; r.r(a), r.d(a, "getData", function () { return action_getData }), r.d(a, "loadVideo", function () { return loadVideo }), r.d(a, "loadStream", function () { return loadStream }), r.d(a, "streamDataHandle", function () { return streamDataHandle }), r.d(a, "playStream", function () { return playStream }), r.d(a, "reloadVideo", function () { return reloadVideo }), r.d(a, "loadTicketStream", function () { return loadTicketStream }), r.d(a, "initData", function () { return loadVideoNet_action_initData }), r.d(a, "httpClientLoadStremUrl", function () { return httpClientLoadStremUrl }), r.d(a, "getIsOpenAutio", function () { return getIsOpenAutio }), r.d(a, "lianmaireloadVideo", function () { return lianmaireloadVideo }); var o = r("e55c4"), s = r("09565"), u = r("300f3"), d = r.n(u), c = r("366c1"); function _inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function _defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var f = function (e) { function BaseModule(t) { !function _classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, BaseModule); var r = function _possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return Object(c.bindAll)(r, BaseModule.prototype), Object(c.bindAll)(r), r.h5video = t, r.props = null, r } return _inherits(BaseModule, e), BaseModule.prototype.init = function init(e) { this.container = e }, BaseModule.prototype.Uprops = function Uprops(e, t) { this.props.key = t }, BaseModule.prototype.destroy = function destroy() { this.removeAllListeners(), this.container && this.element && this.container.contains(this.element) && this.container.removeChild(this.element), this.element = null }, BaseModule }(s.EventEmitter), h = r("4f033"), _ = r("5e757"), y = r("3b42b"); function firstVideoBg_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function firstVideoBg_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var v = function (e) { function VideoBg() { !function firstVideoBg_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, VideoBg); var t = function firstVideoBg_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return t.id = "videoBg", t.isYinping = !1, t.yinpingBgUrl = "", t } return firstVideoBg_inherits(VideoBg, e), VideoBg.prototype.changeBg = function changeBg(e) { this.yinpingBgUrl = e.img || "https://img.douyucdn.cn/data/yuba/admin/2020/10/13/202010131133549362659697832.png", this.updateURL() }, VideoBg.prototype.init = function init(e) { var t = this; void 0 === this.element && (this.element = document.createElement("div"), this.element.className = d.a.bg, e.appendChild(this.element), this.element.style.display = "none"), o.DataCenter.event.load().subscribe(function () { o.DataCenter.common.get("$DATA").subscribe(function (r) { var n = 0; r.room && r.room.cate1_id && (n = +r.room.cate1_id), (1 === +Object(c.getPageData)("$ROOM.show_status") && Object(_.b)().app.Status || 20 === +n) && (20 === +n && (t.isYinping = !0), Object(c.setISinping)(20 === +n), t.container = e, t.updateURL()) }) }) }, VideoBg.prototype.updateScale = function updateScale() { }, VideoBg.prototype.updateURL = function updateURL() { var e = Object(h.j)(["app", "roomInfo", "isVertical"]), t = Object(h.j)(["app", "roomInfo", "coverSrc"]), r = Object(h.j)(["app", "roomInfo", "owner_avatar"]), n = Object(h.j)(["app", "roomInfo", "isDefaultAvatar"]), i = Object(h.j)(["app", "roomInfo", "defaultSrc"]); if (1 === e || void 0 !== Object(c.getPageData)("$ROOM.audioWEBBGIMG")) { var a = void 0; if (void 0 !== Object(c.getPageData)("$ROOM.audioWEBBGIMG")) if (this.isYinping) { if (!this.yinpingBgUrl) return this.rxACJObject || (this.rxACJObject = new y.a), void this.rxACJObject.MonitorData("bj_to_videoBg_change", this.changeBg); a = this.yinpingBgUrl } else a = Object(c.getPageData)("$ROOM.audioWEBBGIMG"); else t ? a = t : r && 0 === n ? a = r : i && (a = i); a ? (this.initDom(a), this.element && "block" !== this.element.style.display && (this.element.style.display = "block")) : this.element && (this.element.style.display = "none") } else this.element && "block" === this.element.style.display && (this.element.style.display = "none") }, VideoBg.prototype.initDom = function initDom(e) { this.element && (this.element.className = d.a.bg + " " + (void 0 === Object(c.getPageData)("$ROOM.audioWEBBGIMG") ? d.a.yzBg : ""), this.element.style.backgroundImage = "url(" + e + ")") }, VideoBg.prototype.destroy = function destroy(t) { 2 !== t && e.prototype.destroy.call(this) }, VideoBg }(f), g = r("949dc"), b = r.n(g), w = r("a63b0"), E = r.n(w); var T = {}, S = {}, P = 0, A = 6e4, O = 0, M = 0, k = 0, D = 1, L = 0, x = 0, I = 0, R = 0; function starTimePs2() { clearInterval(k), k = setInterval(function () { !function sendps2() { M = (new Date).valueOf(), sendPot({ ps: 2 }) }() }, A) } function sendPot(e) { var t = {}, r = [], n = {}, i = {}, a = S, o = a.type, s = a.surl, u = a.quality, d = a.st, c = a.vt, l = e.ps, p = e.watch_time, f = e.ltime, h = T, _ = h.did, m = h.uid, y = void 0 === m ? 0 : m, v = h.ct, g = h.ver, w = void 0 === g ? 0 : g, O = h.rid, M = h.tid, k = h.refer, R = h.pt, j = h.r_type, C = h.env, B = void 0 === C ? 1 : C; i.r_type = j, i.vt = c, 5 === l && (i.ltime = f), x && (i.vpid = x), L && (i.vid = L), I && 5 === l && (i.ctime = I), n.i = y || 0, n.d = _ || 0, n.ct = v || 0, n.ver = w || 0, n.r = O || 0, n.t = M || 0, n.hc = A || 0, n.m = d || 0, n.st = o || 0, n.ps = l || 0, n.pt = R || 0, n.sst = "", n.surl = s || "", n.p = P || 0, n.re = k || "", 5 === l && (n.wt = p), n.lt = D || 0, n.q = u || 0, n.e = i, n.ot = (new Date).valueOf(), t.v = "1.5", r.push(n), t.m = JSON.stringify(r); var F = "http://10.1.100.44:6999/beats"; 1 === B && (F = "https://dotbeats.douyucdn.cn/beats"), function post(e) { var t = e.url, r = e.data, n = e.type, i = b.a.CancelToken.source(), a = { method: "post", headers: { "content-type": "application/x-www-form-urlencoded" }, url: t, data: "string" === typeof r ? r : E.a.stringify(r), responseType: n, cancelToken: i.token }; "text" === n && (a.transformResponse = void 0); var o = b()(a).then(function (e) { return e.data }).catch(function (e) { throw b.a.isCancel(e), e }); return Object.defineProperty(o, "abort", { get: function get() { return i.cancel("request abort by user.") } }), o }({ url: F, data: t, type: "text" }).then(function (e) { var t = JSON.parse(e); 1 === l && t && t.data && 0 === t.error && t.data.interval && (A = t.data.interval), 1 === l && starTimePs2() }).catch(function () { 1 === l && starTimePs2() }) } function sendPot_sendps1(e) { O = (new Date).valueOf(), sendPot({ ps: 1, ext: e }) } function sendPot_sendps5() { var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0]; clearInterval(k), O && sendPot({ ps: 5, watch_time: (new Date).valueOf() - O, ltime: M > 0 ? (new Date).valueOf() - M : null }), O = 0, M = 0, A = 6e4, e && (P = 0) } var j = function () { function baseStreamDot(e) { !function es_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, baseStreamDot), function initBasePotData(e) { T = e }(e) } return baseStreamDot.prototype.onReady = function onReady(e) { !function creatPid() { for (var e = T.ct, t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "q", "w", "e", "r", "t", "y", "u", "i", "o", "p", "a", "s", "d", "f", "g", "h", "j", "k", "l", "z", "x", "c", "v", "b", "n", "m"], r = "", n = 0; n < 6; n++)r += t[parseInt(36 * Math.random(), 10)]; P = e + "-" + r + parseInt((new Date).valueOf(), 10) }(), function freashStreamDate(e) { if (S = e, R && (S.vt = R, R = 0), L) { var t = P, r = t.substr(0, t.length - 13); x = "" + r + parseInt((new Date).valueOf(), 10) + "-" + L } }(e), sendPot_sendps1() }, baseStreamDot.prototype.onComplete = function onComplete() { sendPot_sendps5() }, baseStreamDot.prototype.onError = function onError() { sendPot_sendps5() }, baseStreamDot.prototype.onstop = function onstop() { sendPot_sendps5() }, baseStreamDot.prototype.dispose = function dispose() { !function sendPot_dispose() { clearInterval(k) }() }, baseStreamDot.prototype.setlt = function setlt(e) { !function sendPot_setlt(e) { D = e }(e) }, baseStreamDot.prototype.setvt = function setvt(e) { !function sendPot_setvt(e) { S && (S.vt = e), R = e }(e) }, baseStreamDot.prototype.setvid = function setvid(e) { !function sendPot_setvid(e) { L = e }(e) }, baseStreamDot.prototype.setvpid = function setvpid(e) { !function sendPot_setvpid(e) { x = e }(e) }, baseStreamDot.prototype.setctime = function setctime(e) { !function sendPot_setctime(e) { I = e }(e) }, baseStreamDot.prototype.getpid = function getpid() { return function sendPot_getpid() { return P }() }, baseStreamDot.prototype.sendps5 = function sendps5() { sendPot_sendps5(!1) }, baseStreamDot.prototype.sendps1 = function sendps1() { sendPot_sendps1() }, baseStreamDot }(), C = r("f8ab5"), B = r.n(C), F = r("82e48"), N = null, H = { byteCount: 0, haveShowVideo: !1, isAudio: !1, inpip: !1, inLiveBack: !1, inticket: !1, inpassword: !1, player: { isReady: !1, isPlay: !0, volume: Object(c.getIsHostlive)() ? 0 : Object(F.b)(F.a.player_storage_volume, .5), getPlayTime: function getPlayTime() { return 0 }, getBuffered: function getBuffered() { return 0 }, getPlayerStat: function getPlayerStat() { return {} }, videoWidth: 0, vidoRealWidth: 0, vidoRealHeight: 0, videoHeight: 0, videoAngle: 0, src: "", starEnterH5Play: 0, showFrameTimePoint: 0, p2p: "", error: 0, isRollback: !1, isPreload: !1, acceleratorRollback: !1, useH265: !0, accOpen: !1 } }; function getData() { return H } function setEnterPlay(e) { getData().player.starEnterH5Play = e } function changeVolumeByKeyboard(e) { var t = Object(h.j)(["videoModule", "player", "volume"]); 1 === +e ? t -= .1 : t += .1, t < 0 && (t = 0), t > 1 && (t = 1), getData().player.volume = t, N && N.refreshPlayer() } function setVideoReady(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, r = e.getPlayTime, n = e.getBuffered, i = e.getPlayerStat; getData().player.isReady = !0, getData().player.isBuffering = !1, getData().player.getPlayTime = r, getData().player.getBuffered = n, getData().player.getPlayerStat = i, getData().player.videoWidth = e.getVideoWidth(), getData().player.videoHeight = e.getVideoHeight(), N && N.viewFresh(), 0 === +t && Object(h.b)({ id: "loading", action: "showLoading", data: [!1] }) } function P2PRollback() { Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ isRollback: !0 }] }) } function udpateVidoReal(e, t) { getData().player.vidoRealWidth = e, getData().player.vidoRealHeight = t } function setByteCount(e) { getData().byteCount = e } function changeVolume(e) { getData().player.volume = e, N && N.refreshPlayer() } function setPlay(e, t) { getData().player.isPlay !== e && (getData().player.isPlay = e, N && N.refreshPlayer(), e && Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ manual: t }] })) } function refeshplayerStreamNameAndStatus(e, t) { getData().player.multiratesName = e, getData().player.streamStatus = t } function refeshplayerSrc(e) { var t = getData().player.src; getData().player.src = e, N && t !== e && N.SrcFresh() } function refeshplayerisPlay(e) { getData().player.isPlay = e, N && N.refreshPlayer() } function refeshplayerisRollback(e) { getData().player.isRollback = e } function refeshplayerP2p(e) { getData().player.p2p = e } function refeshplayerP2pData(e) { for (var t in e) getData().player[t] = e[t] } function changeHaveShowVideoState() { getData().haveShowVideo = !0 } function changeisAudio(e) { getData().isAudio = e } function setPlayerError(e) { getData().player.error = e } function upView(e) { N = e } function action_initData() { H = { byteCount: 0, haveShowVideo: !1, player: { isReady: !1, isPlay: !0, volume: Object(c.getIsHostlive)() ? 0 : Object(F.b)(F.a.player_storage_volume, .5), getPlayTime: function getPlayTime() { return 0 }, getBuffered: function getBuffered() { return 0 }, getPlayerStat: function getPlayerStat() { return {} }, videoWidth: 0, vidoRealWidth: 0, vidoRealHeight: 0, videoHeight: 0, videoAngle: 0, src: "", starEnterH5Play: 0, showFrameTimePoint: 0, p2p: "", error: 0, isRollback: !1, isPreload: !1, acceleratorRollback: !1, accOpen: !1 } } } function switchToHwMode(e) { getData().player.useH265 = e, Object(c.isSupportAccelerator)() && (getData().player.acceleratorRollback = !1), Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !0 }] }) } function openAcc() { getData().player.accOpen = !0 } function handleAcceleratorError() { getData().player.acceleratorRollback = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !0 }] }) } function checkAccelerator(e, t) { void 0 === e && (e = Object(h.j)(["app", "cdn"])), void 0 === t && (t = Object(h.j)(["app", "rate"])), fetch("http://127.0.0.1:64646/probe?cdn=" + e + "&rate=" + t).then(function (e) { 200 === e.status ? Object(c.setSupportAccelerator)(!0) : Object(c.setSupportAccelerator)(!1) }).catch(function () { Object(c.setSupportAccelerator)(!1) }) } function videoContentResize(e) { var t = e.width, r = e.height; getData().player.videoWidth = t, getData().player.videoHeight = r, N && N.viewFresh() } var U = r("d30de"), V = r("51bc5"), W = r("d1a6f"), G = r("0fa6e"); function Player_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function Player_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var q, z, Y, X, K, J, $ = function (e) { function Player(t, r) { !function Player_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, Player); var n = function Player_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return n.tag = "Player", n.ready = !1, n.src = t, n.options = r, Object(c.bindAll)(n, Player.prototype), Object(c.bindAll)(n), n } return Player_inherits(Player, e), Player.prototype.attachMedia = function attachMedia(e) { this.video = e, this.video.ondurationchange = this.ondurationchange, this.video.onended = this.onended, this.video.onprogress = this.onprogress, this.video.onwaiting = this.onwaiting, this.video.onseeking = this.onseeking, this.video.onseeked = this.onseeked, this.video.oncanplay = this.oncanplay, this.video.addEventListener("resize", this.onresize) }, Player.prototype.detachMedia = function detachMedia() { this.removeAllListeners(), this.video = null }, Player.prototype.removeAllListeners = function removeAllListeners(t) { e.prototype.removeAllListeners.call(this, t), this.video && (this.video.ondurationchange = void 0, this.video.onended = void 0, this.video.onprogress = void 0, this.video.onwaiting = void 0, this.video.onseeking = void 0, this.video.onseeked = void 0, this.video.oncanplay = void 0, this.video = void 0) }, Player.prototype.ondurationchange = function ondurationchange() { this.emit(ce.DURATION_CHANGE, this.video.duration) }, Player.prototype.onended = function onended() { this.emit(ce.COMPLETE) }, Player.prototype.onprogress = function onprogress() { this.emit(ce.BUFFER_PROGRESS) }, Player.prototype.onwaiting = function onwaiting() { this.emit(ce.BUFFER_EMPTY) }, Player.prototype.oncanplay = function oncanplay() { this.emit(ce.BUFFER_FULL), this.ready || (this.ready = !0, this.emit(ce.READY)) }, Player.prototype.onresize = function onresize() { this.emit(ce.ON_RESIZE) }, Player.prototype.onseeking = function onseeking() { }, Player.prototype.onseeked = function onseeked() { }, Player.prototype.onerror = function onerror() { }, Player.prototype.load = function load() { }, Player.prototype.play = function play() { var e = this; if (this.video) { var t = this.video.play(); t && t.catch(function (t) { var r = t.toString(); -1 === r.indexOf("play() failed because the user didn't interact with the document first") && -1 === r.indexOf("The play method is not allowed by the user agent or the platform in the current context, possibly because the user denied permission") || e.emit(ce.CANAUTO_PLAY) }) } }, Player.prototype.pause = function pause() { this.video && this.video.pause() }, Player.prototype.seek = function seek(e) { this.video && this.ready && (this.video.currentTime = e) }, Player.prototype.dispose = function dispose() { this.ready = !1, this.removeAllListeners(), this.detachMedia() }, Player.prototype.volume = function volume(e) { return "number" !== typeof e ? this.video ? this.video.volume : 1 : (this.video && (this.video.volume = e), 1) }, Player.prototype.getPlayTime = function getPlayTime() { return this.video ? this.video.currentTime : 0 }, Player.prototype.getBuffered = function getBuffered() { return this.video && this.video.buffered.length > 0 ? this.video.buffered.end(this.video.buffered.length - 1) : 0 }, Player.prototype.getVideoWidth = function getVideoWidth() { return this.video ? this.video.videoWidth : 0 }, Player.prototype.getVideoHeight = function getVideoHeight() { return this.video ? this.video.videoHeight : 0 }, Player.prototype.getPlayerStat = function getPlayerStat() { return { mediaInfo: this.mediaInfo, statInfo: this.statInfo } }, Player.prototype._error = function _error(e) { var t = this; Object(c.callLater)(function () { t.emit(ce.ERROR, e) }) }, Player }(s.EventEmitter); function P2PError_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function P2PError_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t } function P2PError_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function P2PError_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var Q = (z = q = function (e) { function P2PInitError() { P2PError_classCallCheck(this, P2PInitError); for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; var i = P2PError_possibleConstructorReturn(this, e.call.apply(e, [this].concat(r))); return i.name = P2PInitError.NAME, i } return P2PError_inherits(P2PInitError, e), P2PInitError }(Error), q.NAME = "P2PInitError", z), Z = (X = Y = function (e) { function P2PRollbackError() { P2PError_classCallCheck(this, P2PRollbackError); for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; var i = P2PError_possibleConstructorReturn(this, e.call.apply(e, [this].concat(r))); return i.name = P2PRollbackError.NAME, i.eCode = r.length > 1 ? r[1] : 0, i } return P2PError_inherits(P2PRollbackError, e), P2PRollbackError }(Error), Y.NAME = "P2PRollbackError", X), ee = (J = K = function (e) { function P2PStreamNotFound() { P2PError_classCallCheck(this, P2PStreamNotFound); for (var t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; var i = P2PError_possibleConstructorReturn(this, e.call.apply(e, [this].concat(r))); return i.name = P2PStreamNotFound.NAME, i } return P2PError_inherits(P2PStreamNotFound, e), P2PStreamNotFound }(Error), K.NAME = "P2PStreamNotFound", J), te = r("5675a"); function QQLoader_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t } function QQLoader_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function QQLoader_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var re = function (e) { function QQLoader() { var t, r; !function QQLoader_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, QQLoader); for (var n = arguments.length, i = Array(n), a = 0; a < n; a++)i[a] = arguments[a]; return t = r = QQLoader_possibleConstructorReturn(this, e.call.apply(e, [this].concat(i))), r.sdk = "https://xp2p-1255868781.file.myqcloud.com/xp2psdk/h5/douyu/qvbp2p.js", r.isSdkLoad = !1, r._cdnBytes = 0, r._p2pBytes = 0, r._beginGetSdkTime = 0, r._GetSdkTime = 0, r._60scdnBytes = 0, r._60sp2pBytes = 0, r._url = "", QQLoader_possibleConstructorReturn(r, t) } return QQLoader_inherits(QQLoader, e), QQLoader.prototype.load = function load(t, n) { var i = this; if (e.prototype.load.call(this, t, n), this.isSdkLoad) { if (!window.QVBP2P) { var a = "qq p2p sdk init error."; return V.a.warn(a), void (this.onError && this.onError(new Q(a))) } if (!window.QVBP2P.isSupported()) { var o = "qq p2p not support"; return V.a.warn(o), void (this.onError && this.onError(new Q(o))) } window.qvbp2p && (window.qvbp2p.destroy(), window.qvbp2p = null), window.qvbp2p = new window.QVBP2P({ debug: Object(c.getIsDebug)() }), window.qvbp2p.listen(window.QVBP2P.ComEvents.STATE_CHANGE, this._onStateChange), window.qvbp2p.loadSource({ videoId: U.k, src: t }), this._url = t, this.report() } else { this.isSdkLoad = !0, this._beginGetSdkTime = (new Date).getTime(); var s = +Object(h.j)(["app", "rid"]); 4258555 === s || 78561 === s ? Object(c.runGlobalJs)({ url: this.sdk }).then(function () { i.load(t), i._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: i._beginGetSdkTime, et: i._GetSdkTime }) }).catch(function () { i.load(t) }) : r.e(2).then(r.t.bind(null, "f1e0e", 7)).then(function () { i.load(t), i._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: i._beginGetSdkTime, et: i._GetSdkTime }) }).catch(function (e) { V.a.warn("qqv1.0.0 p2p sdk load error.", e), i.load(t) }) } }, QQLoader.prototype.report = function report() { var e = this; this.reportTimer = setInterval(function () { e._sendTxllMsg(e._60scdnBytes, e._60sp2pBytes, e._url), e._60scdnBytes = 0, e._60sp2pBytes = 0 }, 6e4) }, QQLoader.prototype.dispose = function dispose() { window.qvbp2p && (window.qvbp2p.destroy(), window.qvbp2p = null), this.reportTimer && clearInterval(this.reportTimer), e.prototype.dispose.call(this) }, QQLoader.prototype.getStatistics = function getStatistics() { if (window.qvbp2p && window.qvbp2p.getStatistics) { var e = window.qvbp2p.getStatistics(), t = e.cdnBytes, r = e.p2pReceiveBytes; this._cdnBytes += t, this._p2pBytes += r, this._60scdnBytes += t, this._60sp2pBytes += r } return { loaderBytes: this._loaderBytes, cdnBytes: this._cdnBytes, p2pBytes: this._p2pBytes } }, QQLoader.prototype._onStateChange = function _onStateChange(e, t) { var r = window.QVBP2P.ComCodes; switch (t.code) { case r.RECEIVE_BUFFER: this._receiveBuffer(t.payload); break; case r.ROLLBACK: this._rollback(t.player, t.rollbackReason); break; case r.END_OF_STREAM: this._onEnd(); break; case r.STREAM_NOT_FOUND: this._streamNotFound() } }, QQLoader.prototype._receiveBuffer = function _receiveBuffer(e) { this._onData(e) }, QQLoader.prototype._onEnd = function _onEnd() { this.onEnd && this.onEnd() }, QQLoader.prototype._rollback = function _rollback(e, t) { this.onError && this.onError(new Z("p2p error, rollback.", t)), this.dispose() }, QQLoader.prototype._streamNotFound = function _streamNotFound() { this.onError && this.onError(new ee("p2p error, stream not found.")), this.dispose() }, QQLoader.prototype._sendTxllMsg = function _sendTxllMsg(e, t, r) { var n = +Object(h.j)(["app", "rid"]); 2935323 !== n && 7179465 !== n && 52787 !== n && 1409682 !== n || o.httpClient.post(String, "https://p2plog.douyucdn.cn/tencentlogreport", { cdnBytes: e, p2pBytes: t, url: r, rid: n }, { headers: { "content-type": "application/json" } }) }, QQLoader }(G.BaseLoader); function WSLoader_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t } function WSLoader_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function WSLoader_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var ne = function (e) { function WSLoader() { var t, r; !function WSLoader_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, WSLoader); for (var n = arguments.length, i = Array(n), a = 0; a < n; a++)i[a] = arguments[a]; return t = r = WSLoader_possibleConstructorReturn(this, e.call.apply(e, [this].concat(i))), r.sdk = "https://www.vod.lxdns.com/html5/douyu.com/whprelease.js", r.isSdkLoad = !1, r._cdnBytes = 0, r._p2pBytes = 0, r._beginGetSdkTime = 0, r._GetSdkTime = 0, WSLoader_possibleConstructorReturn(r, t) } return WSLoader_inherits(WSLoader, e), WSLoader.prototype.load = function load(t, n) { var i = this; if (e.prototype.load.call(this, t, n), !this.isSdkLoad) { var a = +Object(h.j)(["app", "rid"]); return this.isSdkLoad = !0, this._beginGetSdkTime = (new Date).getTime(), void (122402 === a || 5551065 === a || 606118 === a || 1863767 === a || 5382830 === a || 4549169 === a ? Object(c.runGlobalJs)({ url: this.sdk }).then(function () { i.load(t), i._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: i._beginGetSdkTime, et: i._GetSdkTime }) }).catch(function (e) { V.a.warn("ws sdk yuanduan load error.", e), i.load(t) }) : r.e(5).then(r.t.bind(null, "dbdb7", 7)).then(function () { i.load(t), i._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: i._beginGetSdkTime, et: i._GetSdkTime }) }).catch(function () { V.a.warn("WS 3.0p2p sdk init error."), i.load(t) })) } if (!window.wshp2p) { var o = "WS p2p sdk init error."; return V.a.warn(o), void (this.onError && this.onError(new Q(o))) } if (!window.wshp2p.isSupported()) { var s = "WS p2p not support"; return V.a.warn(s), void (this.onError && this.onError(new Q(s))) } this.wshp2pload && (this.wshp2pload.close(), this.wshp2pload = null); var u = { vedio: document.getElementById(U.k), customid: "douyu.com", url: t }; this.wshp2pload = new window.wshp2p.p2pLive, this.wshp2pload.rollback = this.rollbackHandle, this.wshp2pload.dataarrival = this.dataarrivalHandle, this.wshp2pload.open(u) }, WSLoader.prototype.dispose = function dispose() { this.wshp2pload && (this.wshp2pload.close(), this.wshp2pload = null), e.prototype.dispose.call(this) }, WSLoader.prototype.rollbackHandle = function rollbackHandle(e) { this._rollback(e) }, WSLoader.prototype.dataarrivalHandle = function dataarrivalHandle(e) { this._receiveBuffer(e) }, WSLoader.prototype.getStatistics = function getStatistics() { if (this.wshp2pload) { var e = this.wshp2pload.infoget(), t = e.http_bytesLoaded, r = e.p2p_bytesLoaded; this._cdnBytes += t, this._p2pBytes += r } return { loaderBytes: this._loaderBytes, cdnBytes: this._cdnBytes, p2pBytes: this._p2pBytes } }, WSLoader.prototype._receiveBuffer = function _receiveBuffer(e) { this._onData(e) }, WSLoader.prototype._rollback = function _rollback(e) { this.onError && this.onError(new Z("p2p error, rollback.", e)), this.dispose() }, WSLoader }(G.BaseLoader); function XYLoader_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t } function XYLoader_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function XYLoader_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var ie = function (e) { function XYLoader() { var t, r; !function XYLoader_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, XYLoader); for (var n = arguments.length, i = Array(n), a = 0; a < n; a++)i[a] = arguments[a]; return t = r = XYLoader_possibleConstructorReturn(this, e.call.apply(e, [this].concat(i))), r.sdk = "https://static.galaxyclouds.cn/0.0.1/kiwi.min.js", r.isSdkLoad = !1, r._cdnBytes = 0, r._p2pBytes = 0, r._beginGetSdkTime = 0, r._GetSdkTime = 0, XYLoader_possibleConstructorReturn(r, t) } return XYLoader_inherits(XYLoader, e), XYLoader.prototype.load = function load(t, n) { var i = this; if (e.prototype.load.call(this, t, n), !this.isSdkLoad) return this.isSdkLoad = !0, this._beginGetSdkTime = (new Date).getTime(), void r.e(1).then(r.t.bind(null, "6b4b2", 7)).then(function () { i.load(t), i._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: i._beginGetSdkTime, et: i._GetSdkTime }) }).catch(function () { V.a.warn("XY p2p sdk init error."), i.load(t) }); if (!window.KiwiJs) { var a = "XY p2p sdk init error."; return V.a.warn(a), void (this.onError && this.onError(new Q(a))) } if (!window.KiwiJs.isSupported()) { var o = "XY p2p not support"; return V.a.warn(o), void (this.onError && this.onError(new Q(o))) } this.xyp2pload && (this.xyp2pload.destroy(), this.xyp2pload = null), this.xyp2pload = new window.KiwiJs({ appid: "589ac3b89be5e8493fd1b336", secret: "MAdVFu", url: t, only_data: !0, media_id: U.k, rollback: this.rollbackHandle, log_level: Object(c.getIsDebug)() ? "debug" : void 0 }), this.xyp2pload.on("data", this.dataarrivalHandle), this.xyp2pload.on("reset", this.rollbackHandle), this.xyp2pload.play() }, XYLoader.prototype.dispose = function dispose() { this.xyp2pload && (this.xyp2pload.destroy(), this.xyp2pload = null), e.prototype.dispose.call(this) }, XYLoader.prototype.rollbackHandle = function rollbackHandle() { this._rollback() }, XYLoader.prototype.dataarrivalHandle = function dataarrivalHandle(e) { this._receiveBuffer(e.buffer) }, XYLoader.prototype.getStatistics = function getStatistics() { if (this.xyp2pload) { var e = this.xyp2pload.getStatistics(); this._cdnBytes += e.cdnBytes, this._p2pBytes += e.p2pBytes } return { loaderBytes: this._loaderBytes, cdnBytes: this._cdnBytes, p2pBytes: this._p2pBytes } }, XYLoader.prototype._receiveBuffer = function _receiveBuffer(e) { this._onData(e) }, XYLoader.prototype._rollback = function _rollback() { this.onError && this.onError(new Z("p2p error, rollback.")), this.dispose() }, XYLoader }(G.BaseLoader); var ae = new (function () { function SharkLoader() { !function SharkLoader_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, SharkLoader), this.body = document.getElementsByTagName("body")[0], this.loader = document.createElement("div"), this.loader.setAttribute("data-module", "loader"), this.loader.style.display = "none", this.body.appendChild(this.loader) } return SharkLoader.prototype.loadDynamicJs = function loadDynamicJs(e, t) { var r = document.createElement("script"); r.type = "text/javascript", r.charset = "UTF-8", -1 === e.toLowerCase().indexOf("sta-op.douyucdn") && -1 === e.toLowerCase().indexOf("sta-op-test.douyucdn") || (r.crossOrigin = "anonymous"), r.readyState ? r.onreadystatechange = function () { "loaded" !== r.readyState && "complete" !== r.readyState || (r.onreadystatechange = null, t && t()) } : (r.onload = function () { t && t() }, r.onerror = function (e) { t && t(e) }), r.src = e, this.loader.appendChild(r) }, SharkLoader }()), oe = function () { function defineProperties(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (e, t, r) { return t && defineProperties(e.prototype, t), r && defineProperties(e, r), e } }(); function DYLoader_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function DYLoader_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var se = function (e) { function DYLoader() { !function DYLoader_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, DYLoader); var t = function DYLoader_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); t.isSdkLoad = !1, t._cdnBytes = 0, t._p2pBytes = 0, t._beginGetSdkTime = 0, t._GetSdkTime = 0, t._useXp2p = !1, t._useRawPlay = !1; var r = Object(h.j)(["videoModule", "player", "p2pMeta"]); return t._useXp2p = r && r.xp2p_txSecret && r.xp2p_txTime && (r.xp2p_domain && r.xp2p_subs_domain || r.dyxp2p_domain && r.dyxp2p_subs_domain && r.dyxp2p_api_domain), t._useRawPlay = Object(c.useRawPlay)() && !t._useXp2p, t } return DYLoader_inherits(DYLoader, e), oe(DYLoader, [{ key: "supportRaw", get: function get() { return this._useRawPlay } }, { key: "format", get: function get() { return this._useRawPlay ? "raw" : "flv" } }]), DYLoader.prototype.load = function load(t, r) { var n = this; e.prototype.load.call(this, t, r); var i = Object(h.j)(["videoModule", "player", "p2pMeta"]), a = this._useXp2p ? window.DyP2PX : window.DyP2P; if (!a && !this.isSdkLoad) { this.isSdkLoad = !0, this._beginGetSdkTime = (new Date).getTime(); var o = void 0; return this._useXp2p ? (V.a.log("load dyp2pxp2p"), o = window.streamSdkXP2P) : (V.a.log("load dyp2pzl"), o = window.streamSdkZL), void ae.loadDynamicJs(o, function (e) { if (e) { V.a.warn("DY p2p sdk init error."), n.load(t) } else n.load(t), n._GetSdkTime = (new Date).getTime(), W.a.emit(te.h, { bt: n._beginGetSdkTime, et: n._GetSdkTime }) }) } if (!a) { var s = "DY p2p sdk init error."; return V.a.warn(s), void (this.onError && this.onError(new Q(s))) } if (!a.isSupported()) { var u = "DY p2p not support"; return V.a.warn(u), void (this.onError && this.onError(new Q(u))) } this.xyp2pload && (this.xyp2pload.destroy(), this.xyp2pload = null); var d = Object(h.j)(["videoModule", "player", "p2pCids"]); this.xyp2pload = new a({ appid: "589ac3b89be5e8493fd1b336", secret: "MAdVFu", url: t, p2pCids: d, p2pMeta: i, only_data: !0, media_id: U.k, rollback: this.rollbackHandle, log_level: Object(c.getIsDebug)() ? "debug" : void 0, logLevel: Object(c.getIsDebug)() ? 3 : void 0 }), this.xyp2pload.on("data", this.dataarrivalHandle), this.xyp2pload.on("reset", this.rollbackHandle), this.xyp2pload.play() }, DYLoader.prototype.dispose = function dispose() { this.xyp2pload && (this.xyp2pload.destroy(), this.xyp2pload = null), e.prototype.dispose.call(this) }, DYLoader.prototype.rollbackHandle = function rollbackHandle(e, t) { t && (window.p2pComeBackinfo = t), this._rollback() }, DYLoader.prototype.dataarrivalHandle = function dataarrivalHandle(e) { this._receiveBuffer(this._useRawPlay ? e : e.buffer) }, DYLoader.prototype.getStatistics = function getStatistics() { if (this.xyp2pload) { var e = this.xyp2pload.getStatistics(); this._cdnBytes += e.cdnBytes, this._p2pBytes += e.p2pBytes, this._dropBytes = e.totalDropBytes ? e.totalDropBytes : 0 } return { loaderBytes: this._loaderBytes, cdnBytes: this._cdnBytes, p2pBytes: this._p2pBytes, totalDropBytes: this._dropBytes } }, DYLoader.prototype._receiveBuffer = function _receiveBuffer(e) { this._onData(e) }, DYLoader.prototype._rollback = function _rollback() { this._onError(new Z("p2p error, rollback.")), this.dispose() }, DYLoader }(G.BaseLoader), ue = function () { function defineProperties(e, t) { for (var r = 0; r < t.length; r++) { var n = t[r]; n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n) } } return function (e, t, r) { return t && defineProperties(e.prototype, t), r && defineProperties(e, r), e } }(); function LivePlayer_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function LivePlayer_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var de = function (e) { function FlvPlayer(t, r) { !function LivePlayer_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, FlvPlayer); var n = function LivePlayer_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this, t, r)); n.tag = "FlvPlayer", n._createPlayer(t); var i = (new Date).getTime(); return W.a.emit(te.d, { sdkok: i }), n } return LivePlayer_inherits(FlvPlayer, e), FlvPlayer.prototype._createPlayer = function _createPlayer(e) { var t = this; this.dispose(); var r = { url: e, enableWorker: !0, debug: Object(c.getIsDebug)(), videoCodec: this.options.videoCodec, canvasId: this.options.canvasId, accelerator: this.options.accelerator }; if (this.options) { switch (this.options.p2p) { case U.g.QQ: r.loader = new re; break; case U.g.WS: r.loader = new ne; break; case U.g.XY: r.loader = new ie; break; case U.g.DOUYU: var n = new se; n.supportRaw && (r.format = "raw"), r.loader = n }void 0 !== this.options.hasVideo && (r.hasVideo = this.options.hasVideo), void 0 !== this.options.hasAudio && (r.hasAudio = this.options.hasAudio) } this.player = new G.LivePlayer(r), this.player && (this.player.on(G.PlayerEvents.ON_LOW_PERFORMANCE, function () { t.emit(ce.ON_LOW_PERFORMANCEL) }), this.player.on(G.PlayerEvents.ON_MEDIA_INFO, function (e) { V.a.log("ON_MEDIA_INFO: ", e), t.mediaInfo = e }), this.player.on(G.PlayerEvents.ON_FIRST_FRAME, function () { t.emit(ce.FIRST_FRAME) }), this.player.on(G.PlayerEvents.ON_ERROR, function (e) { t._error(e) }), this.player.on(G.PlayerEvents.ON_SEI, function (e) { V.a.log("ON_SEI: ", e), 5 === e.seiType && "RoiMaskSeiV00001" === e.seiData.uuid && Object(h.b)({ id: "comment", action: "seiMcdatachange", data: [e.seiData.data] }), t.emit(ce.ON_SEI, e) }), this.player.on(G.PlayerEvents.ON_LOAD_SEI, function (e) { t.emit(ce.ON_LOAD_SEI, e) }), this.player.on(G.PlayerEvents.ON_AAC_DATA, function (e) { if (V.a.log("ON_AAC_DATA: ", e), 16 === +e.type) { var r = Date.now(); r - (t.aacTimeFlag || 0) > 1e3 && (t.emit(ce.ON_AAC_DATA, e), t.aacTimeFlag = r) } else t.emit(ce.ON_AAC_DATA, e) }), this.player.on(G.PlayerEvents.ON_EXTRA_DATA_PLAY, function (e) { t.emit(ce.ON_EXTRA_DATA_PLAY, e) }), this.player.on(G.PlayerEvents.ON_SWITCH_SUCCESS, function (e) { t.emit(ce.ON_SWITCH_SUCCESS, e) }), this.player.on(G.PlayerEvents.ON_SWITCH_FAIL, function (e) { t.emit(ce.ON_SWITCH_FAIL, e) })) }, FlvPlayer.prototype.attachMedia = function attachMedia(t) { e.prototype.attachMedia.call(this, t), this.player && this.player.attach(t) }, FlvPlayer.prototype.detachMedia = function detachMedia() { this.player && this.player.detach(), e.prototype.detachMedia.call(this) }, FlvPlayer.prototype.load = function load() { this.player && this.player.load() }, FlvPlayer.prototype.dispose = function dispose() { this.player && (this.player.dispose(), this.player = null), e.prototype.dispose.call(this) }, FlvPlayer.prototype.updateSource = function updateSource(e) { var t = {}; if (t.url = e.url, t.switch = e.switch, t.quick = e.quick, 1 === e.type) switch (e.p2p) { case U.g.QQ: t.loader = new re; break; case U.g.WS: t.loader = new ne; break; case U.g.XY: t.loader = new ie; break; case U.g.DOUYU: var r = new se; t.loader = r; break; default: t.loader = null } else t.loader = null; this.player && this.player.updateSource(t) }, ue(FlvPlayer, [{ key: "statInfo", get: function get() { return this.player && this.player.getStatInfo() } }]), FlvPlayer }($); function player_createPlayer(e, t) { return new de(e, t) } var ce = { ERROR: "ERROR", FIRST_FRAME: "FIRST_FRAME", READY: "READY", BUFFER_EMPTY: "BUFFER_EMPTY", BUFFER_FULL: "BUFFER_FULL", BUFFER_PROGRESS: "BUFFER_PROGRESS", COMPLETE: "COMPLETE", DURATION_CHANGE: "DURATION_CHANGE", CANAUTO_PLAY: "CANAUTO_PLAY", ON_SEI: "ON_SEI", ON_AAC_DATA: "ON_AAC_DATA", ON_RESIZE: "ON_RESIZE", ON_LOW_PERFORMANCEL: "ON_LOW_PERFORMANCE", ON_EXTRA_DATA_LOAD: "extra_data_load", ON_EXTRA_DATA_PLAY: "extra_data_play", ON_LOAD_SEI: "ON_LOAD_SEI", ON_SWITCH_SUCCESS: "ON_SWITCH_SUCCESS", ON_SWITCH_FAIL: "ON_SWITCH_FAIL" }, le = void 0, pe = 0, fe = void 0, he = 3; function isAnotherDay() { var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0], t = Object(F.b)(F.a.GaoRateTimestamp, 0); le || (le = new Date); var r = Object(c.isNextDay)(t, le.valueOf(), 19); return r && e && Object(F.c)(F.a.GaoRateTimestamp, le.valueOf()), r } function revordTime() { pe += 1, Object(F.c)(F.a.RateRecordTime, pe), +pe === +he && (Object(h.b)({ id: "multiBitRate", action: "ChangeRateNotify", data: [2] }), clearInterval(fe)) } function switchRateTip(e) { var t = Object(h.j)(["app", "pageRateSwitch"]), r = Object(h.j)(["app", "isLogin"]); return pe = parseInt(Object(F.b)(F.a.RateRecordTime, 0), 10), isAnotherDay(e) ? 1 === +t && 0 === +r && (e && (clearInterval(fe), fe = setInterval(function () { revordTime() }, 6e4)), !0) : 1 === +t && 0 === +r && pe < he && (e && (clearInterval(fe), fe = setInterval(function () { revordTime() }, 6e4)), !0) } function clearRecordRateTimeIDInterval() { clearInterval(fe) } var _e = "hidden" in document ? "hidden" : "webkitHidden" in document ? "webkitHidden" : "mozHidden" in document ? "mozHidden" : null, me = !1, ye = void 0; function getIsHidden() { if (_e) return document[_e] } function firstvideo_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function firstvideo_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } _e && (ye = _e.replace(/hidden/i, "visibilitychange"), document.addEventListener(ye, function handleVisibilityChange(e) { me || (me = document[_e]) }, !1)); var ve = function (e) { function Video() { !function firstvideo_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, Video); var t = function firstvideo_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return t.subNewList = [], t.addindex = 0, t.Delayerrindex = 1, t.pid = "", t.firstReadVide = !0, t.lon = 90, t.lat = 0, t.phi = 0, t.theta = 0, t.index = 1, action_initData(), upView(t), t.id = "videoModule", t.isstartPlayer = !1, t.videoId = U.k, t.canvasId = U.d, t._byteAnotherTimerID = "", t._byteTmp = 0, t._byteCount = 0, t._byteP2PTmp = 0, t._byteP2PCount = 0, t.P2PtotalByteCount = 0, t.P2PCurrentCount = 0, t.inEmpty = !1, t.StarEmptyTime = 0, t.StarFullTime = 0, t.totalEmptyTime = 0, t.emptyCount = 0, t.fullCount = 0, t.hasNetStream = !1, t.failTimeIndex = 0, t.playTimeIndex = 0, t.showFrameTimePoint = 0, t.aliNotified = !1, t.hasP2PRollback = !1, t.videoRealWidth = 0, t.videoRealHeight = 0, t.loopVodObj = { t: 0, e: 0 }, t.bufferCheckTimer = 0, t.speedTencounts = 0, t.speedArray = [], t.lastLoaderBytes = 0, t.lastUpBytes = 0, t.minuesUpBytes = 0, t.minuesDownBytes = 0, t.lastTimestamp = 0, t.firstReadData = null, t.disposeTimer = 0, t.startsdkTimevalue = 0, t.getsdkTimevalue = 0, t.beginloadTime = 0, t.pid = "", t.seiTimeList = [], W.a.on(te.h, t.getsdkTime), W.a.on(te.d, t.beginLoadTimefun), t.P2Pfresh = 0, t.PairFrameok = !1, t.subDelay = 0, t.bufT = 0, t.bufIndex = 0, t.bandwidth = 0, t.lastst = "", t.currentSt = "", t.asyncImport(), W.a.on("videoPairFrameCan", t.videoPairFrameCanHandle), W.a.on("videoPairFrameOverErr", t.videoPairFrameOverErrHandle), W.a.on("videoPairFrame10Over", t.videoPairFrame10Over), W.a.on("diposeFirstVideo", t.diposeFirstVideoHandle), W.a.on("updateLoginres", t.upUid), t.lastGetJieliuConfigTime = 0, t.jieliucd = 0, t.enttime = (new Date).valueOf(), t } return firstvideo_inherits(Video, e), Video.prototype.init = function init(t) { e.prototype.init.call(this, t), this.videoContent = document.createElement("div"), this.videoContent.className = B.a.videoContainer, t.appendChild(this.videoContent), this.video = document.createElement("video"), this.video.className = B.a.video, this.video.id = this.videoId, this.videoContent.appendChild(this.video), this.canvas = document.createElement("canvas"), this.canvas.className = B.a.screenshot, this.videoContent.appendChild(this.canvas), this.canvas2 = document.createElement("canvas"), this.canvas2.id = this.canvasId, this.canvas2.className = B.a.screenshot, this.videoContent.appendChild(this.canvas2), this.element = this.videoContent, this.videoContent.addEventListener("mouseover", this.onmouseover), this.videoContent.addEventListener("mouseleave", this.onmouseleave), this.videoContent.addEventListener("dblclick", this.ondblclick), Object(c.delayStreamWhilte)() && (this.videoContent.style.visibility = "hidden"), this.root = document.getElementsByClassName("layout-Player-videoMain")[0], this.viewFresh() }, Video.prototype.SrcFresh = function SrcFresh() { getData().player.src && (this.lastst = this.currentSt, this.currentSt = Object(h.j)(["videoModule", "player", "p2p"])); var e = Object(h.j)(["videoModule", "isAudio"]); if (!Object(c.getIsPlayAudio)() && e) this.player && (Object(c.setIsPlayAudio)(!0), this.currentSt = 0, this.player.updateSource({ type: 2, url: getData().player.src, switch: "smooth", p2p: 0, quick: !1 })); else if (Object(c.getIsPlayAudio)() && !e) if (this.player) { Object(c.setIsPlayAudio)(!1); var t = Object(h.j)(["videoModule", "player", "p2p"]); this.player.updateSource({ type: 1, url: getData().player.src, switch: "smooth", p2p: t, quick: !0 }) } else Object(c.setIsPlayAudio)(!1), this.createPlayer(getData().player.src); else Object(c.getIsPlayAudio)() && e ? this.player && (Object(c.setIsPlayAudio)(!0), this.currentSt = 0, this.player.updateSource({ type: 2, url: getData().player.src, switch: "smooth", p2p: 0, quick: !0 })) : (Object(c.setIsPlayAudio)(!1), this.createPlayer(getData().player.src)); this.refreshPlayer() }, Video.prototype.actionHandle = function actionHandle(e) { var t = e.action, r = e.data; i && i[t] && i[t].apply(i, r) }, Video.prototype.render = function render(e) { var t = e.id, r = e.action, n = e.data; t === this.id && this.actionList.indexOf(r) > -1 && this.actionHandle({ action: r, data: n }) }, Video.prototype.destroy = function destroy(t) { if (this.bufIndex = 0, this.bufT = 0, this.baseStreamDot && (this.baseStreamDot.onComplete(), this.baseStreamDot.dispose()), 1 === +t && (e.prototype.destroy.call(this), W.a.off(te.h, this.getsdkTime), W.a.off(te.d, this.beginLoadTimefun), this.firstReadVide = !0, W.a.off("videoPairFrameCan", this.videoPairFrameCanHandle), W.a.off("videoPairFrameOverErr", this.videoPairFrameOverErrHandle), W.a.off("videoPairFrame10Over", this.videoPairFrame10Over), W.a.off("diposeFirstVideo", this.diposeFirstVideoHandle)), this.disposeVr(), clearTimeout(this.PairFrameokID), clearTimeout(this.disposeTimer), clearInterval(this.bufferCheckTimer), clearInterval(this._byteAnotherTimerID), clearInterval(this.failTimeIndex), clearInterval(this.playTimeIndex), clearInterval(this.speedTencounts), this.player) { var r = Object(h.j)(["app", "rid"]), n = Object(h.j)(["tcp", "loginres", "userid"]), i = Object(h.j)(["app", "streamInfo", "is_mixed"]), a = Object(h.j)(["videoModule", "player", "streamName"]), o = { ps: 6, rid: r, uid: n, b_cdn: this._byteCount, b_p2p: this._byteP2PCount, b_up: 0, b_wst: 0, kd_c: this.emptyCount, kd_t: this.totalEmptyTime, play_time: (new Date).getTime() - this.starTimePlayer, res: i ? 3 : this.getRateInt(a) }; window.streamSubSdkReport ? window.streamSubSdkReport(o) : this.subNewList.length > 100 ? this.subNewList.shift() : this.subNewList.push(o), this.player.dispose(), this.player = null } this._byteTmp = 0, this._byteCount = 0, this._byteP2PTmp = 0, this._byteP2PCount = 0, this.seiTimeList = [], this.isstartPlayer = !1, Object(h.b)({ id: "videoModule", action: "setByteCount", data: [0] }), this.P2PtotalByteCount = 0, this.P2PCurrentCount = 0, this.inEmpty = !1, this.loopVodObj = { t: 0, e: 0 }, this.StarEmptyTime = 0, this.StarFullTime = 0, this.totalEmptyTime = 0, this.emptyCount = 0, this.fullCount = 0, this.hasNetStream = !1, this.showFrameTimePoint = 0, this.speedArray = [], this.lastLoaderBytes = 0, this.minuesUpBytes = 0, this.minuesDownBytes = 0, this.lastUpBytes = 0, this.lastTimestamp = 0, V.a.log("video disposed.") }, Video.prototype.createPlayer = function createPlayer(e) { var t = this; if (this.reportCarlton(), this.destroy(), clearTimeout(this.P2PRollbackId), e && 0 === e.indexOf("rtmp")) return V.a.warn("can't play " + e + ", switch to flash player."), Object(c.switchToFlash)(); if (this.canvas && (this.canvas.style.visibility = "hidden"), this.canvas2 && (this.canvas2.style.visibility = "hidden"), e) { var r = Object(h.j)(["videoModule", "player", "p2p"]), n = Object(h.j)(["app", "streamInfo", "isH265"]), i = Object(h.j)(["videoModule", "player", "acceleratorRollback"]), a = "h264"; if (n && (a = "h265"), r ? (V.a.log("player init with p2p: " + r), this.hasP2PRollback = !1) : V.a.log("player init with no p2p"), this.player = player_createPlayer(e, { p2p: r, hasVideo: !Object(c.getPageData)("$ROOM.audioWEBBGIMG") && void 0, videoCodec: a, canvasId: this.canvasId, accelerator: { enable: Object(c.isSupportAccelerator)() && !i, url: "ws://127.0.0.1:64646", byteRate: this.getByteRate() } }), this.player) { this.video.src = "", this.player.attachMedia(this.video), this.player.on(ce.FIRST_FRAME, this.onFirstFrame), this.player.on(ce.READY, this.onReady), this.player.on(ce.COMPLETE, this.onComplete), this.player.on(ce.DURATION_CHANGE, this.onDurationChange), this.player.on(ce.ERROR, this.onError), this.player.on(ce.ON_SEI, this.seiDateHandle), this.player.on(ce.ON_LOAD_SEI, this.seiloadSeiDateHandle), this.player.on(ce.ON_AAC_DATA, this.aacDataHandler), this.player.on(ce.ON_EXTRA_DATA_PLAY, this.extraPlayerDataHandler), this.player.on(ce.ON_LOW_PERFORMANCEL, this.lowPerformHandle), this.player.on(ce.ON_SWITCH_SUCCESS, this.switchSuccess), this.player.on(ce.ON_SWITCH_FAIL, this.switchFail), this.player.load(); for (var o = (new Date).valueOf(), s = "", u = 0; u < 4; u++)s += parseInt(10 * Math.random(), 10); this.pid = s + o, this._byteAnotherTimerID && clearInterval(this._byteAnotherTimerID), clearInterval(this.failTimeIndex), this.failTimeIndex = setInterval(function () { t.failStreamHander() }, 5e3), this.starTimePlayer = (new Date).getTime(), this._byteAnotherTimerID = setInterval(function () { t.getAnotherByteTimer() }, 6e4) } } return "" !== e && (!this.intOK && Object(c.isVRPlayer)() ? (window.loader.loadFile("https://sta-op.douyucdn.cn/front-publish/sdk-file-master/vrsdk_32b9147.js", function () { t.initVrPlayer() }), this.intOK = !0) : this.intOK && this.initVrPlayer()), null }, Video.prototype.getByteRate = function getByteRate() { var e = Object(h.j)(["app", "multirates"]) || [], t = Object(h.j)(["app", "rate"]), r = e.find(function (e) { return e.rate === t }); if (r) return r.bit }, Video.prototype.seiDateHandle = function seiDateHandle(e) { e && 5 === e.seiType && (e.seiData && "CloudVideoStream" === e.seiData.uuid && (this.seiTimeList.push(Date.now() - e.seiData.data), Object(h.a)("room_sei_data", e.seiData)), e.seiData && "AdsCtrlSEIV00003" === e.seiData.uuid && Object(h.a)("room_lolad_data", e.seiData)) }, Video.prototype.seiloadSeiDateHandle = function seiloadSeiDateHandle(e) { if (e && 5 === e.seiType && e.seiData && "CloudVideoStream" === e.seiData.uuid) { var t = Date.now() - e.seiData.data; t > 0 && t < 3e4 && (this.bufT = this.bufT + t, this.bufIndex = this.bufIndex + 1) } }, Video.prototype.aacDataHandler = function aacDataHandler(e) { e && (16 === +e.type && e.data && e.data.length ? e.data.length > 0 && Object(h.a)("room_web_acc_data", e) : Object(h.a)("room_web_acc_data", e)) }, Video.prototype.extraPlayerDataHandler = function extraPlayerDataHandler(e) { Object(h.a)("extra_data_play", e) }, Video.prototype.getMoudleDate = function getMoudleDate() { return getData() }, Video.prototype.refreshPlayer = function refreshPlayer() { var e = Object(h.j)(["videoModule", "player", "volume"]), t = Object(h.j)(["videoModule", "player", "isPlay"]), r = Object(h.j)(["app", "canAutoPlay"]), n = Object(h.j)(["xvideoModule", "xplayer", "openWichVideo"]); this.player && (Object(c.delayStreamWhilte)() ? this.PairFrameok ? n ? this.player.volume(0) : this.player.volume(parseFloat(e, 10)) : this.player.volume(0) : n ? this.player.volume(0) : this.player.volume(parseFloat(e, 10)), t && r ? this.player.play() : this.stop()) }, Video.prototype.onFirstFrame = function onFirstFrame() { var e = this, t = Object(h.j)(["app", "rid"]), r = Object(h.j)(["app", "streamInfo", "rtmp_live"]), n = Object(h.j)(["videoModule", "player", "p2p"]), i = Object(h.j)(["app", "cdn"]), a = Object(h.j)(["app", "isLogin"]), o = Object(h.j)(["app", "pageRateSwitch"]), s = Object(h.j)(["app", "rate"]), u = Object(h.j)(["app", "uip"]), d = n === U.g.QQ || "tct-h5" === i; Object(c.delayStreamWhilte)() && this.player && this.player.player && this.player.player.T_ADV_Timestamp && (window.T_ADV_Timestamp = this.player.player.T_ADV_Timestamp), Object(h.a)("room_video_replay", { rtmp_live: r, rid: t, hightligth: d, cdn: i, p2p: n }), this.showFrameTimePoint = (new Date).valueOf(), this.performancePoint(), this.refreshPlayer(), Object(h.b)({ id: "videoModule", action: "setVideoReady", data: [this.player, 1] }), Object(h.b)({ id: "videoModule", action: "changeHaveShowVideoState" }), !1 === Boolean(a) && 1 === +o && (switchRateTip() || Object(h.b)({ id: "multiBitRate", action: "ChangeRateNotify", data: [1] })), 1 !== +s && 2 !== +s && switchRateTip(!0), this.hasNetStream = !0, clearInterval(this.failTimeIndex), this.playTimeIndex = setInterval(function () { e.playSucss() }, 3e3); var l = new Date; this.lastTimestamp = l.getTime(), Object(c.setauthenticationTime)((new Date).valueOf()), n || this.streamReport({ rid: t, ip: u, ret: 0 }) }, Video.prototype.countSpeed = function countSpeed() { var e = Object(h.j)(["videoModule", "player", "getPlayerStat"])().statInfo.loaderBytes, t = 0, r = (new Date).getTime(), n = r - this.lastTimestamp; this.lastLoaderBytes && e > this.lastLoaderBytes && (t = parseInt((e - this.lastLoaderBytes) / 1024 / (n / 1e3), 10)), this.speedArray.push(t), this.speedArray.length > 10 && (this.speedArray = this.speedArray.slice(1)), this.lastLoaderBytes = e, this.lastTimestamp = r }, Video.prototype.onReady = function onReady() { var e = this; if (this.isstartPlayer = !0, null != this.firstReadData) { var t = (new Date).valueOf(); this.firstReadData.canplay_matadate = t - this.showFrameTimePoint, Object(c.prfLoad)(this.firstReadData), this.firstReadData = null } this.player.on(ce.BUFFER_EMPTY, this.onBufferEmpty), this.player.on(ce.BUFFER_FULL, this.onBufferFull), this.player.on(ce.BUFFER_PROGRESS, this.onBufferProgress), this.player.on(ce.CANAUTO_PLAY, this.onCanAutoPlay), this.player.on(ce.ON_RESIZE, this.onVideoResize), this.refreshPlayer(), Object(h.b)({ id: "videoModule", action: "setVideoReady", data: [this.player] }), setTimeout(function () { e.player && Object(h.b)({ id: "videoModule", action: "setVideoReady", data: [e.player] }) }, 50), this.bufferCheckTimer = setInterval(this.checkBuffer, 2e3), this.checkBuffer(), Object(c.notifyLoadjs)(), this.pairFrameHandel(); var r = Object(h.j)(["app", "rid"]); if (this.initStreamSubSdk) { var n = this.dataCollectToFlv(); this.initStreamSubSdk(r, n) } this.subNewInit(this.isstartPlayer, 0); var i = Object(h.j)(["app", "streamInfo", "is_mixed"]), a = Object(h.j)(["videoModule", "player", "p2p"]), o = Object(h.j)(["app", "streamInfo", "mixed_url"]), s = Object(h.j)(["app", "streamInfo", "mixed_live"]), u = Object(h.j)(["app", "streamInfo", "rtmp_url"]), d = Object(h.j)(["app", "streamInfo", "rtmp_live"]), l = Object(h.j)(["app", "cdn"]), p = Object(h.j)(["app", "rate"]), f = Object(h.j)(["app", "multirates"]), _ = 0; if (f && f.length > 0) for (var m = 0; m < f.length; m++)if (+f[m].type === +p) { _ = f[m].bit || "0"; break } var v = 0; switch (a) { case U.g.QQ: v = 2; break; case U.g.WS: v = 3; break; case U.g.XY: v = 1; break; case U.g.DOUYU: v = 9 }var g = { type: v ? 2 : 1, surl: i ? o + "/" + s : u + "/" + d, quality: _, st: v || l, vt: "" }; this.baseStreamDot ? (this.baseStreamDot.onReady(g), window.__playerDot = { dot: this.baseStreamDot, parm: this.loopVodObj }) : (this.baseStreamDot = new j({ did: Object(y.e)(), uid: Object(c.getuid)(), ct: "web", pt: "2", ver: U.h, rid: Object(h.j)(["app", "rid"]), tid: Object(c.getPageData)("$ROOM.cate_id"), refer: window.location.href, env: 1, r_type: Object(c.getPageData)("$ROOM.audioWEBBGIMG") ? 3 : Object(c.getPageData)("$ROOM.isVertical") ? 2 : 1 }), this.baseStreamDot.onReady(g), window.__playerDot = { dot: this.baseStreamDot, parm: this.loopVodObj }), this.haveaddListenerHide || (this.haveaddListenerHide = !0, this.addListenerHide()) }, Video.prototype.addListenerHide = function addListenerHide() { var e = this; document.addEventListener("visibilitychange", function () { var t = document.visibilityState; if ("hidden" === t && Object(c.isSuperHideGetAudio)() && e.enterHide(), "visible" === t) { Object(c.setIsInHide)(!1), W.a.off("loadAudioCd", e.loadAudioCdHandele), e.loadAudioCdId && clearTimeout(e.loadAudioCdId); var r = Object(h.j)(["app", "isenterUseNoHandle"]); Object(c.getIsPlayAudio)() && !r && (e.AudiochangeTime = (new Date).valueOf(), V.a.warn("isnoLoading2-----" + !0), Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ isnoLoading: !0 }] })) } }) }, Video.prototype.asyncImport = function asyncImport() { var e = this; this.rxACJObject || (this.rxACJObject = new y.a), this.rxACJObject.MonitorData("set_first_frame_to_player", this.handlePlayerSub); var t = Object(h.j)(["app", "rid"]); this.flvAsynTimer = setTimeout(function () { Promise.all([r.e(4), r.e(3)]).then(r.bind(null, "6b94d")).then(function (r) { var n = r.initStreamSubSdk, i = r.setUiD, a = e.dataCollectToFlv(); if (e.setUiD = i, n(t, a), e.initStreamSubSdk = n, e.subNewList.length > 0) for (var o = 0; o < e.subNewList.length; o++)window.streamSubSdkReport(e.subNewList[o]) }) }, 1e4) }, Video.prototype.dataCollectToFlv = function dataCollectToFlv() { var e = Object(h.j)(["app", "streamInfo", "is_mixed"]), t = Object(h.j)(["videoModule", "player", "streamName"]), r = Object(h.j)(["videoModule", "player", "p2p"]), n = Object(h.j)(["app", "streamInfo", "mixed_url"]), i = Object(h.j)(["app", "streamInfo", "mixed_live"]), a = Object(h.j)(["app", "streamInfo", "rtmp_url"]), o = Object(h.j)(["app", "streamInfo", "rtmp_live"]), s = Object(h.j)(["app", "cdn"]), u = Object(h.j)(["app", "acdn"]), d = Object(h.j)(["tcp", "loginres", "userid"]), l = {}, p = Object(y.e)(), f = 0, _ = Object(h.j)(["videoModule", "player", "getPlayerStat"]), m = Object(h.j)(["app", "rate"]), v = Object(h.j)(["app", "multirates"]), g = _().mediaInfo; if (v && v.length > 0) for (var b = 0; b < v.length; b++)if (+v[b].type === +m) { f = v[b].bit || "0"; break } return l.zone = Object(c.getPageData)("$ROOM.cate_id"), l.rid = Object(h.j)(["app", "rid"]), l.res = e ? 3 : this.getRateInt(t), l.lt = 1, l.pt = U.i, l.pv = U.h, l.cv = U.h, l.p2p = Object(h.j)(["videoModule", "player", "p2pValue"]), l.st = r ? 2 : 1, l.surl = e ? n + "/" + i : a + "/" + o, l.zone = Object(c.getPageData)("$ROOM.cate_id"), l.s_cdn = Object(c.getIsPlayAudio)() ? u : s, l.uid = d, l.vt = Object(c.getPageData)("$ROOM.audioWEBBGIMG") || Object(c.getIsPlayAudio)() ? 1 : 2, l.mix = e ? 1 : 0, l.vdecode = Object(h.j)(["app", "streamInfo", "isH265"]) ? 2 : 1, l.fps = g ? parseInt(g.fps, 10) : "", l.did = p, l.bit = f, l }, Video.prototype.handlePlayerSub = function handlePlayerSub(e) { window.streamSubSdkReport ? window.streamSubSdkReport(e.data) : this.subNewList.length > 100 ? this.subNewList.shift() : this.subNewList.push(e.data) }, Video.prototype.pairFrameHandel = function pairFrameHandel() { Object(c.delayStreamWhilte)() && Object(c.setAuthenticationPlayer)(this.player.player) }, Video.prototype.checkBuffer = function checkBuffer() { if (this.video && this.video.buffered.length > 0) { var e = this.video.buffered, t = this.video.currentTime, r = e.length, n = e.end(r - 1); if (n - t > 30) { var i = e.start(r - 1), a = Math.max(i, n - 8); V.a.warn("buffer too much, seek to " + a + ". cur=" + t + " buffered=" + n), this.video.currentTime = a } } }, Video.prototype.videoPairFrame10Over = function videoPairFrame10Over(e) { 1 === e && (this.videoContent.style.visibility = "", this.PairFrameok = !0, this.refreshPlayer()) }, Video.prototype.diposeFirstVideoHandle = function diposeFirstVideoHandle() { this.player && this.player.pause(), this.destroy() }, Video.prototype.videoPairFrameCanHandle = function videoPairFrameCanHandle(e) { var t = this; this.video.currentTime = e.time, this.PairFrameokID = setTimeout(function () { t.videoContent.style.visibility = "", t.PairFrameok = !0, t.refreshPlayer(), W.a.emit("embedmentPlayerdispose") }, 50) }, Video.prototype.videoPairFrameOverErrHandle = function videoPairFrameOverErrHandle(e) { 1 !== e.type && 4 !== e.type || (this.videoContent.style.visibility = "", this.PairFrameok = !0, this.refreshPlayer(), W.a.emit("embedmentPlayerdispose")), -1 === e.type && this.destroy() }, Video.prototype.onCanAutoPlay = function onCanAutoPlay() { this.baseStreamDot && this.baseStreamDot.onError(), Object(h.a)("room_yuba_sdk_streamErr", { code: 1 }), Object(h.b)({ id: "app", action: "setAutoPlay", data: [!1] }), W.a.emit("embedmentPlayerdispose") }, Video.prototype.onComplete = function onComplete() { var e = Object(h.j)(["app", "cdn"]), t = Object(h.j)(["videoModule", "player", "src"]), r = Object(h.j)(["videoModule", "player", "p2p"]), n = Object(h.j)(["app", "uip"]); Object(h.c)("video", te.b, { delta: this.player.getBuffered() - this.player.getPlayTime(), playTime: this.player.getPlayTime(), emptyCount: this.emptyCount, fullCount: this.fullCount, browser: navigator.userAgent, location: window.location.href, cdn: e, p2p: r, uip: n, src: t }), this.stop(), V.a.log("play complete") }, Video.prototype.onBufferEmpty = function onBufferEmpty() { if (!this.video.seeking) { Object(h.b)({ id: "controller", action: "setKDShow", data: [!0] }); var e = Object(h.j)(["app", "cdn"]), t = Object(h.j)(["videoModule", "player", "src"]), r = Object(h.j)(["videoModule", "player", "p2p"]), n = Object(h.j)(["app", "uip"]); Object(h.c)("video", te.a, { seeking: this.video.seeking, readyState: this.video.readyState, delta: this.player.getBuffered() - this.player.getPlayTime(), buffered: this.player.getBuffered(), playTime: this.player.getPlayTime(), bufferLength: this.video.buffered.length, emptyCount: this.emptyCount, fullCount: this.fullCount, browser: navigator.userAgent, cdn: e, p2p: r, uip: n, src: t, speedArray: this.speedArray }), this.player.getBuffered() - this.player.getPlayTime() < 1 && (this.emptyCount += 1, this.inEmpty = !0, this.StarEmptyTime = (new Date).valueOf(), this.loopVodObj.e = (new Date).valueOf()), V.a.log("buffer empty") } }, Video.prototype.onBufferFull = function onBufferFull() { this.fullCount += 1, this.inEmpty && (this.totalEmptyTime = this.totalEmptyTime + (new Date).valueOf() - this.StarEmptyTime, this.loopVodObj.t = this.loopVodObj.t + (new Date).valueOf() - this.loopVodObj.e), this.inEmpty = !1, V.a.log("buffer full") }, Video.prototype.onVideoResize = function onVideoResize() { V.a.log("video resize videoWidth is " + this.player.getVideoWidth() + ", videoHeight is " + this.player.getVideoHeight()), Object(h.b)({ id: "videoModule", action: "videoContentResize", data: [{ width: this.player.getVideoWidth(), height: this.player.getVideoHeight() }] }) }, Video.prototype.onBufferProgress = function onBufferProgress() { }, Video.prototype.onDurationChange = function onDurationChange() { }, Video.prototype.getManValue = function getManValue(e) { var t = Object(h.j)(["videoModule", "player", "p2p"]), r = Object(h.j)(["videoModule", "player", "p2pValue"]); if (t) { if (9 === r) return 6; if (1 === r) return 4; if (2 === r) return 2; if (3 === r) return 1; if (4 === r) return 3 } else { if (-1 !== e.indexOf("tct")) return 2; if (-1 !== e.indexOf("ws")) return 1; if (-1 !== e.indexOf("ali")) return 3 } return -1 }, Video.prototype.streamReport = function streamReport(e) { o.httpClient.post(String, "//streamdot.douyucdn.cn/tianshu/access/gate/report/100", { data: JSON.stringify(e) }, { headers: { "Content-Type": "text/plain; charset=utf-8" }, noXReq: !0 }) }, Video.prototype.subStreamErrorbyType = function subStreamErrorbyType(e) { if (this.isstartPlayer) { var t = Object(h.j)(["app", "rid"]), r = Object(h.j)(["app", "streamInfo", "is_mixed"]), n = Object(h.j)(["app", "streamInfo", "mixed_url"]), i = Object(h.j)(["app", "streamInfo", "mixed_live"]), a = Object(h.j)(["app", "streamInfo", "rtmp_url"]), o = Object(h.j)(["app", "streamInfo", "rtmp_live"]), s = Object(h.j)(["videoModule", "player", "streamName"]), u = Object(h.j)(["videoModule", "player", "isPreload"]), d = Object(h.j)(["videoModule", "player", "p2pValue"]), l = Object(h.j)(["tcp", "loginres", "userid"]), p = Object(h.j)(["videoModule", "player", "p2p"]), f = Object(h.j)(["app", "cdn"]), _ = Object(h.j)(["app", "acdn"]), m = { ps: 2, net: 1, rid: t, vt: Object(c.getPageData)("$ROOM.audioWEBBGIMG") || Object(c.getIsPlayAudio)() ? 1 : 2, mix: r ? 1 : 0, surl: r ? n + "/" + i : a + "/" + o, res: r ? 3 : this.getRateInt(s), lt: 1, ec: e, d_ec: 0, is_err: 1, is_ma: u ? 1 : 0, is_b: this.hasP2PRollback ? 1 : 0, pv: U.h, cv: U.h, p2p: d, uid: l, st: p ? 2 : 1, wtype: Object(c.getPageData)("pageType"), s_cdn: Object(c.getIsPlayAudio)() ? _ : f, zone: Object(c.getPageData)("$ROOM.cate_id"), et: 2 }; window.streamSubSdkReport ? window.streamSubSdkReport(m) : this.subNewList.length > 99 ? this.subNewList.shift() : this.subNewList.push(m) } else this.subNewInit(this.isstartPlayer, e) }, Video.prototype.lowPerformHandle = function lowPerformHandle() { Object(c.setH265BackLocastorege)(), Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ manual: !0 }] }) }, Video.prototype.switchSuccess = function switchSuccess() { Object(h.b)({ id: "loading", action: "showLoading", data: [!1] }), this.audioDot(0) }, Video.prototype.switchFail = function switchFail() { Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }), this.audioDot(1) }, Video.prototype.onError = function onError(e) { var t = this; if (e && e.fatal) { this.baseStreamDot && this.baseStreamDot.onError(), Object(c.notifyLoadjs)(), clearInterval(this.failTimeIndex); var r = 3, n = Object(h.j)(["yzView", "isYanzhi"]), i = Object(h.j)(["app", "cdn"]), a = Object(h.j)(["videoModule", "player", "src"]), s = Object(h.j)(["videoModule", "player", "p2p"]), u = Object(h.j)(["app", "uip"]), d = Object(h.j)(["app", "rid"]); if (e instanceof Error) switch (e.name) { case Q.NAME: case Z.NAME: this.initError = e.name === Q.NAME, this.hasP2PRollback = !0; var l = e.name === Q.NAME ? 1 : 2, p = { playstate: 4, enum: this.emptyCount, fnum: this.fullCount, error: e.message, eCode: e.eCode, us: l }; V.a.warn("p2p error, rollback", e.name), this.DataHandle(p), this.firstReadVide ? this.p2pRollback() : (clearTimeout(this.P2PRollbackId), this.P2PRollbackId = setTimeout(function () { t.p2pRollback() }, 5e3 * Math.random())), this.stop(); var f = Object(h.j)(["videoModule", "player", "p2pValue"]); if ((9 === f || 10 === f) && e.name !== Q.NAME) { clearTimeout(this.P2Pfresh); var _ = 12e5, m = 18e5; window.p2pComeBackinfo && (_ = window.p2pComeBackinfo.minComeBackms, m = window.p2pComeBackinfo.maxComeBackms), this.P2Pfresh = setTimeout(function () { "" !== Object(h.j)(["videoModule", "player", "p2p"]) || 9 !== f && 10 !== f || (Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ manual: !0 }] }), o.httpClient.post(String, "https://p2perrorlog.douyucdn.cn/errorlogreport", { rid: d, errortype: "refreshZjP2p" }, { headers: { "content-type": "application/json" } })) }, Math.random() * (m - _) + _) } return void this.subStreamErrorbyType(201); case "DyNetworkError": var y = { playstate: 3, enum: this.emptyCount, fnum: this.fullCount, error: e.message, error_num: 1 }; this.DataHandle(y), r = 1, this.subStreamErrorbyType(202), this.streamReport({ rid: d, ip: u, ret: 1 }); break; case "DyMediaError": var v = { playstate: 3, error: e.message, error_num: 100, spec_error: 180 }; 5 === Object(c.getPageData)("$ROOM.cate_id") && this.DataHandle(v), this.subStreamErrorbyType(203); break; case "DyDemuxError": var g = { playstate: 3, error: e.message, error_num: 100, spec_error: e.errorId ? e.errorId : 0 }; 5 === Object(c.getPageData)("$ROOM.cate_id") && this.DataHandle(g), this.subStreamErrorbyType(204); break; case ee.NAME: break; case "DyError": 133 !== e.errorId && 132 !== e.errorId || Object(h.b)({ id: "videoModule", action: "handleAcceleratorError" }) }Object(h.c)("video", te.c, { errorType: r, error: e.message, playTime: this.player.getPlayTime(), browser: navigator.userAgent, isYanzhi: n, location: window.location.href, cdn: i, p2p: s, uip: u, src: a }), Object(c.delayStreamWhilte)() ? e.name === Q.NAME && e.name === Z.NAME || (0 === Object(c.getInPairFrameState)() ? (Object(c.closeVideoPairFrame)(2, 5), W.a.emit("embedmentPlayerdispose")) : 1 === Object(c.getInPairFrameState)() ? Object(c.closeVideoPairFrame)(2, 5) : 2 !== Object(c.getInPairFrameState)() && 3 !== Object(c.getInPairFrameState)() || (Object(h.b)({ id: "videoModule", action: "setPlayerError", data: [r] }), Object(c.closeVideoPairFrame)(2, 5))) : Object(h.b)({ id: "videoModule", action: "setPlayerError", data: [r] }), this.stop(), V.a.warn("player error", e) } }, Video.prototype.p2pRollback = function p2pRollback() { Object(h.b)({ id: "videoModule", action: "P2PRollback" }) }, Video.prototype.ondblclick = function ondblclick() { var e = Object(h.j)(["app", "isFullscreen"]), t = Object(h.j)(["app", "isWebFullscreen"]); e || t ? (e && Object(h.b)({ id: "app", action: "setFullScreen", data: [!1] }), t && Object(h.b)({ id: "app", action: "setPagescreen", data: [!1] })) : Object(h.b)({ id: "app", action: "setPagescreen", data: [!0] }) }, Video.prototype.getsdkTime = function getsdkTime(e) { e && (this.startsdkTimevalue = e.bt, this.getsdkTimevalue = e.et) }, Video.prototype.beginLoadTimefun = function beginLoadTimefun(e) { e && (this.beginloadTime = e.sdkok) }, Video.prototype.loadAudioCdHandele = function loadAudioCdHandele(e) { var t = this; W.a.off("loadAudioCd", this.loadAudioCdHandele), clearTimeout(this.loadAudioCdId), this.hideGetAudio = e, e && (this.jieliucd = e.ct || 0), 1 === +e.switch && (this.loadAudioCdId = setTimeout(function () { Object(c.isSuperHideGetAudio)() && (t.player && t.player.statInfo && (t.bandwidth = parseInt(60 * t.player.statInfo.vbr / 8, 10) || 0), V.a.warn("isnoLoading3-----" + !0), Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ isaudio: !0, isnoLoading: !0 }] })) }, 1e3 * e.st || 1)) }, Video.prototype.enterHide = function enterHide() { var e = this; Object(c.setIsInHide)(!0); var t = (new Date).valueOf(); if (t - this.lastGetJieliuConfigTime >= 1e3 * this.jieliucd) { if (this.lastGetJieliuConfigTime = t, W.a.on("loadAudioCd", this.loadAudioCdHandele), this.player) { var r = this.player.statInfo, n = r.loaderBytes, i = r.uploadBytes; Object(h.b)({ id: "LoadVideoNet", action: "getIsOpenAutio", data: [t - this.enttime, n ? i / n : 0, this.minuesDownBytes ? this.minuesUpBytes / this.minuesDownBytes : 0] }) } } else this.hideGetAudio && 1 === +this.hideGetAudio.switch && (clearTimeout(this.loadAudioCdId), this.loadAudioCdId = setTimeout(function () { Object(c.isSuperHideGetAudio)() && (V.a.warn("isnoLoading4-----" + !0), e.player && e.player.statInfo && (e.bandwidth = parseInt(60 * e.player.statInfo.vbr / 8, 10) || 0), Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ isaudio: !0, isnoLoading: !0 }] })) }, 1e3 * this.hideGetAudio.st)) }, Video.prototype.componentDidMount = function componentDidMount() { V.a.log("start loadVideo") }, Video.prototype.componentWillUnmount = function componentWillUnmount() { e.prototype.componentWillUnmount.call(this), this.firstReadVide = !0, clearInterval(this._byteAnotherTimerID), clearInterval(this.failTimeIndex), clearTimeout(this.P2PRollbackId), clearTimeout(this.P2Pfresh), clearTimeout(this.flvAsynTimer), this.destroy() }, Video.prototype.onmouseover = function onmouseover() { Object(h.b)({ id: "xvideoModule", action: "showmusicIconfun", data: [!0] }) }, Video.prototype.onmouseleave = function onmouseleave() { Object(h.b)({ id: "xvideoModule", action: "showmusicIconfun", data: [!1] }) }, Video.prototype.viewFresh = function viewFresh() { var e = Object(h.j)(["app", "width"]), t = Object(h.j)(["app", "height"]), r = Object(h.j)(["app", "isFullscreen"]), n = Object(h.j)(["app", "isWebFullscreen"]), i = Object(h.j)(["app", "playbModel"]), a = Object(h.j)(["videoModule", "player", "videoWidth"]), o = Object(h.j)(["videoModule", "player", "videoHeight"]), s = void 0; if (t -= r || n || !i ? 0 : U.e, 0 === a || 0 === o) s = { width: e, height: t }, this.videoRealWidth = e, this.videoRealHeight = t; else { var u = 1, d = 0, c = 0, l = 0, p = 0; o / a <= t / e ? (c = e, d = o * (u = e / a), p = .5 * t - o * u * .5) : (d = t, c = a * (u = t / o), l = .5 * e - a * u * .5), s = { width: c, height: d, left: l, top: p }, this.videoRealWidth = c, this.videoRealHeight = d } var f = { width: s.width + "px", height: s.height + "px" }; Object.assign(this.video.style, f), Object.assign(this.canvas.style, f), Object.assign(this.canvas2.style, f), this.videoRealWidth && this.videoRealHeight && Object(h.b)({ id: "videoModule", action: "udpateVidoReal", data: [this.videoRealWidth, this.videoRealHeight] }), this.onWindowResize(s.width, s.height) }, Video.prototype.stop = function stop() { var e = this; if (this.onstop && this.baseStreamDot.onError(), Object(h.j)(["app", "streamInfo", "isH265"])) this.destroy(); else { if (this.player && this.canvas && this.video && this.videoRealWidth && this.videoRealHeight) { this.player.pause(), this.canvas.width = this.videoRealWidth, this.canvas.height = this.videoRealHeight; var t = this.canvas.getContext("2d"); try { Object(c.isVRPlayer)() && this.renderer && this.renderer.domElement ? t.drawImage(this.renderer.domElement, 0, 0, this.videoRealWidth, this.videoRealHeight) : t.drawImage(this.video, 0, 0, this.videoRealWidth, this.videoRealHeight) } catch (e) { V.a.log("\u622a\u56fe\u5931\u8d25") } this.canvas.style.visibility = "" } getIsHidden() ? this.destroy() : (clearTimeout(this.disposeTimer), this.disposeTimer = setTimeout(function () { e.destroy() }, 20)) } }, Video.prototype.getRateInt = function getRateInt(e) { var t = 0; return "\u6781\u6e054K" === e ? t = 11 : "\u6781\u6e052K" === e ? t = 10 : "4K" === e ? t = 9 : "\u539f\u59cb\u753b\u9762" === e ? t = 8 : "\u84dd\u514910M" === e ? t = 7 : "\u84dd\u51498M" === e ? t = 6 : "\u84dd\u51494M" === e ? t = 5 : "\u84dd\u5149" === e ? t = 4 : "\u8d85\u6e05" === e ? t = 3 : "\u9ad8\u6e05" === e ? t = 2 : "\u6d41\u7545" === e && (t = 1), t }, Video.prototype.subNewInit = function subNewInit(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, r = Object(h.j)(["app", "rid"]), n = Object(h.j)(["app", "streamInfo", "rtmp_url"]), i = Object(h.j)(["app", "streamInfo", "rtmp_live"]), a = Object(h.j)(["videoModule", "player", "p2pValue"]), o = Object(h.j)(["app", "streamInfo", "is_mixed"]), s = Object(h.j)(["videoModule", "player", "p2p"]), u = Object(h.j)(["videoModule", "player", "isPreload"]), d = Object(h.j)(["app", "cdn"]), l = Object(h.j)(["app", "acdn"]), p = Object(h.j)(["videoModule", "player", "streamName"]), f = Object(h.j)(["tcp", "loginres", "userid"]), _ = Object(h.j)(["app", "streamInfo", "mixed_url"]), m = Object(h.j)(["app", "streamInfo", "mixed_live"]), y = 0; 0 !== t && e ? y = 2 : 0 === t || e || (y = 1); var v = { ps: 2, net: 1, rid: r, vt: Object(c.getPageData)("$ROOM.audioWEBBGIMG") || Object(c.getIsPlayAudio)() ? 1 : 2, mix: o ? 1 : 0, surl: o ? _ + "/" + m : n + "/" + i, res: o ? 3 : this.getRateInt(p), lt: 1, ec: t, d_ec: 0, is_err: e && 0 === t ? 0 : 1, is_ma: u ? 1 : 0, is_b: this.hasP2PRollback ? 1 : 0, pv: U.h, cv: U.h, p2p: a, uid: f, st: s ? 2 : 1, wtype: Object(c.getPageData)("pageType"), s_cdn: Object(c.getIsPlayAudio)() ? l : d, zone: Object(c.getPageData)("$ROOM.cate_id"), et: y }; window.streamSubSdkReport ? window.streamSubSdkReport(v) : this.subNewList.length > 100 ? this.subNewList.shift() : this.subNewList.push(v) }, Video.prototype.getAnotherByteTimer = function getAnotherByteTimer() { if (this.player) { var e = this.player.statInfo; if (e) { var t = e.cdnBytes, r = e.p2pBytes, n = e.loaderBytes, i = e.uploadBytes; this._byteCount = t - this._byteTmp, this._byteTmp = t, this._byteP2PCount = r - this._byteP2PTmp, this._byteP2PTmp = r, this.P2PCurrentCount = n - this.P2PtotalByteCount, this.minuesDownBytes = n - this.P2PtotalByteCount, this.P2PtotalByteCount = n, this.minuesUpBytes = i - this.lastUpBytes, this.lastUpBytes = i } } this._byteCount < 0 && (this._byteCount = 0), this._byteP2PCount < 0 && (this._byteP2PCount = 0), this.P2PCurrentCount < 0 && (this.P2PCurrentCount = 0); var a = this._byteCount + this._byteP2PCount; if (a > 62914560 && (a = 62914560), a < 0 && (a = 0), Object(h.b)({ id: "videoModule", action: "setByteCount", data: [a] }), this.inEmpty && (this.totalEmptyTime = this.totalEmptyTime + (new Date).valueOf() - this.StarEmptyTime, this.StarEmptyTime = (new Date).valueOf()), this.hasNetStream) { if (this.emptyCount >= 1) { var o = { playstate: 0, enum: this.emptyCount, fnum: this.fullCount, emptyTime: this.totalEmptyTime, caton_type: 0 }; this.DataHandle(o) } var s = { playstate: 2, enum: this.emptyCount, fnum: this.fullCount, emptyTime: this.totalEmptyTime, dl: this.P2PCurrentCount, tdl: this.P2PtotalByteCount, pdl: this._byteP2PCount, pcdl: this._byteCount }; this.DataHandle(s); var u = Object(h.j)(["app", "streamInfo", "is_mixed"]), d = Object(h.j)(["videoModule", "player", "p2p"]), l = Object(h.j)(["videoModule", "player", "getPlayerStat"]), p = this.player ? this.player.statInfo : null, f = l().statInfo, _ = f ? f.droppedFrames : 0, m = this.subDelay, y = Object(h.j)(["videoModule", "player", "streamName"]), v = 0; this.bufIndex > 0 && (v = parseInt(this.bufT / this.bufIndex, 10)), this.bufIndex = 0, this.bufT = 0, !Object(c.getIsPlayAudio)() && this.player && this.player.statInfo && (this.bandwidth = parseInt(60 * this.player.statInfo.vbr / 8, 10) || 0); var g = { is_heartbeat: 1, ps: 4, vbr: p && p.vbr || 0, delay: m, av_diff: 0, cpu: "", mem: "", dfc: _, ec: 0, d_ec: 0, is_err: 0, b_cdn: this._byteCount, b_p2p: this._byteP2PCount, b_up: 0, b_wst: 0, st: d ? 2 : 1, res: u ? 3 : this.getRateInt(y), vt: Object(c.getPageData)("$ROOM.audioWEBBGIMG") || Object(c.getIsPlayAudio)() ? 1 : 2, down: parseInt((this._byteCount + this._byteP2PCount) / 60 / 1024, 10), kd_c: this.emptyCount, kd_t: this.totalEmptyTime, vdecode: Object(h.j)(["app", "streamInfo", "isH265"]) ? 2 : 1, play_time: (new Date).getTime() - this.starTimePlayer, buff_delay: v, bg_play: getIsHidden() ? 1 : 0, bg_bandwidth: Object(c.getIsPlayAudio)() && this.bandwidth || 0, bg_type: 1, last_st: this.lastst ? "2" : "1" }; window.streamSubSdkReport ? window.streamSubSdkReport(g) : this.subNewList.length > 100 ? this.subNewList.shift() : this.subNewList.push(g) } this.totalEmptyTime = 0, this.emptyCount = 0, this.fullCount = 0 }, Video.prototype.countDelay = function countDelay() { var e = 0, t = 0; if (this.seiTimeList.length > 0) { for (var r = 0; r < this.seiTimeList.length; r++)this.seiTimeList[r] > 0 && this.seiTimeList[r] < 3e4 && (t += 1, e += this.seiTimeList[r]); t > 0 && (e = parseInt(e / t, 10)) } else e = -1; return e }, Video.prototype.playSucss = function playSucss() { clearInterval(this.playTimeIndex); var e = { playstate: 1, enum: this.emptyCount, fnum: this.fullCount }; this.DataHandle(e) }, Video.prototype.failStreamHander = function failStreamHander() { clearInterval(this.failTimeIndex); var e = { playstate: 3, enum: this.emptyCount, fnum: this.fullCount, error_num: 0, error: "" }; this.DataHandle(e) }, Video.prototype.DataHandle = function DataHandle(e) { var t = Object(h.j)(["tcp", "loginres", "userid"]), r = Object(h.j)(["app", "rid"]), n = Object(h.j)(["app", "ct"]), i = Object(h.j)(["app", "cdn"]), a = Object(h.j)(["videoModule", "player", "src"]), o = Object(h.j)(["videoModule", "player", "p2p"]), s = Object(h.j)(["app", "uip"]), u = Object(h.j)(["app", "streamInfo", "is_mixed"]), d = Object(h.j)(["videoModule", "player", "isPreload"]), l = Object(h.j)(["videoModule", "player", "getPlayerStat"]), p = Object(h.j)(["videoModule", "player", "streamName"]), f = Object(h.j)(["videoModule", "player", "streamStatus"]), _ = l().mediaInfo, m = a.match(/(^|&)isp=([^&]*)(&|$)/), v = m && m[2] ? m[2] : "", g = e.playstate, b = e.enum, w = a, E = o ? 1 : 0, T = +(void 0 !== Object(c.getPageData)("$ROOM.audioWEBBGIMG")), S = { bt: e.emptyTime || 0, ex: e.error || "", is_ma: d ? 1 : 0, isp: v }; if (1 !== T && (S.is_mix = void 0 === u ? 0 : +u), o && (S.pn = o), S.definition = p, 0 === +g) S.caton_type = e.caton_type, _ && (S.vbr = parseInt(_.videoDataRate, 10)), S.spd = parseInt((this._byteCount + this._byteP2PCount) / 1024 / 60 * 8, 10); else if (1 === +g) _ && (S.vbr = parseInt(_.videoDataRate, 10)), S.cs = f; else if (2 === +g) { S.dl = e.dl, S.tdl = e.tdl, S.pdl = e.pdl, S.pcdl = e.pcdl, _ && (S.vbr = parseInt(_.videoDataRate, 10)), S.spd = parseInt((this._byteCount + this._byteP2PCount) / 1024 / 60 * 8, 10); var P = this.countDelay(); S.delay = P, this.subDelay = P, this.seiTimeList = [] } else 3 === +g ? (S.error_num = f ? e.error_num : 4, S.cs = f, S.spec_error = e.spec_error ? e.spec_error : 0) : 4 === +g && (S.us = e.us, E = 0, S.err_p2p = e.eCode || ""); S.bws = navigator.userAgent.toLowerCase(); var A = JSON.stringify(S), O = { type: "ssr", uid: t, rid: r, ec: b, surl: w, cdn: i, isp2p: E, did: Object(y.e)(), ps: g, ct: n, pt: U.i, ext: A, pid: this.pid, uip: s, v_type: T, aver: U.h }; Object(h.g)(O) }, Video.prototype.performancePoint = function performancePoint() { var e, t = Object(h.j)(["videoModule", "player", "p2p"]), r = Object(h.j)(["videoModule", "player", "isPreload"]), n = Object(h.j)(["app", "cdn"]), i = Object(h.j)(["videoModule", "player", "src"]).match(/(^|&)isp=([^&]*)(&|$)/), a = i && i[2] ? i[2] : "", o = Object(h.j)(["videoModule", "player", "starEnterH5Play"]), s = Object(h.j)(["LoadVideoNet", "requestRoomInfoTimePoint"]), u = Object(h.j)(["LoadVideoNet", "requestStreamUrlTimePoint"]), d = Object(h.j)(["LoadVideoNet", "starPlayStreamTimePoint"]), c = Object(h.j)(["LoadVideoNet", "loadNum"]), l = t || n, p = void 0; e = d - u; var f = this.showFrameTimePoint - d, _ = t ? "prf_pl_ss_p2p_0" : "prf_pl_ss_cdn_0", m = t ? 2 : 1; Object(h.j)(["app", "manualLoadVideo"]) && (this.firstReadVide = !1), p = -1 === +s ? -1 : u - s, V.a.log("firstReadVide\u4e3a" + this.firstReadVide); var y = window.__player && window.__player.isSwitched, v = 0; if (y && (v = window.__player.timeSwitch), this.firstReadVide && !y) this.firstReadVide = !1, V.a.log("\u53d1\u9001room_video_catchtime"), this.firstReadData = { type: m, service_t: l, enterFlashTimer: o, getRoomInfoTimer: s, getStramUrlTimer: u, starRequstStramTimer: d, showStramTimer: this.showFrameTimePoint, isH5: !0, is_back: this.hasP2PRollback ? 1 : 0, av: U.h, is_ma: r ? 1 : 0, requestSDKTime: this.startsdkTimevalue, getSDKTime: this.getsdkTimevalue, starRequstStramTimer2: this.beginloadTime, showStramTimer2: this.showFrameTimePoint, isp: a }; else { var g = void 0, b = 0; if (this.firstReadVide) { var w, E = o - v, T = s - o; b = this.showFrameTimePoint - v, (w = { type: m, service_t: l, cnt: c, prf_pl_ro_0: p, prf_pl_pf_0: e })[_] = f, w.prf_pl_dls_0 = E, w.prf_pl_sa_0 = T, w.prf_pl_fs_0 = b, w.ac_type = 1, w.is_back = this.hasP2PRollback ? 1 : 0, w.isp = a, g = w } else { var S; b = -1 === +s ? this.showFrameTimePoint - u : this.showFrameTimePoint - s, (S = { type: m, service_t: l, cnt: c, prf_pl_ro_0: p, prf_pl_pf_0: e })[_] = f, S.prf_pl_fs_0 = b, S.ac_type = 2, S.is_back = this.hasP2PRollback ? 1 : 0, S.isp = a, g = S } Object(h.d)(te.i, g, U.h), this.firstReadVide = !1 } }, Video.prototype.reportCarlton = function reportCarlton() { if (this.emptyCount >= 1) { var e = { playstate: 0, enum: this.emptyCount, fnum: this.fullCount, emptyTime: this.totalEmptyTime, caton_type: 1 }; this.DataHandle(e) } this.emptyCount = 0 }, Video.prototype.initVrPlayer = function initVrPlayer() { this.disposeVr(), this.target = new window.THREE.Vector3; var e, t = void 0; this.video.style.visibility = "hidden", this.camera = new window.THREE.PerspectiveCamera(75, this.videoContent.innerWidth / this.videoContent.innerHeight, 1, 1100), this.camera.target = new window.THREE.Vector3(0, 0, 0), this.scene = new window.THREE.Scene; var r = new window.THREE.SphereBufferGeometry(500, 60, 40); r.scale(-1, 1, 1), (t = new window.THREE.VideoTexture(this.video)).minFilter = window.THREE.LinearFilter, t.format = window.THREE.RGBFormat; var n = new window.THREE.MeshBasicMaterial({ map: t }); e = new window.THREE.Mesh(r, n), this.scene.add(e), this.renderer = new window.THREE.WebGLRenderer, this.renderer.setSize(this.videoContent.innerWidth / 4, this.videoContent.innerHeight / 4), this.videoContent.appendChild(this.renderer.domElement), this.root.addEventListener("mousedown", this.onDocumentMouseDown, !1), this.root.addEventListener("mouseup", this.onDocumentMouseUp, !1), this.vrAnimate() }, Video.prototype.vrAnimate = function vrAnimate() { this.vrAnimateId = requestAnimationFrame(this.vrAnimate), this.lat = Math.max(-85, Math.min(85, this.lat)), this.phi = window.THREE.Math.degToRad(90 - this.lat), this.theta = window.THREE.Math.degToRad(this.lon), this.target.x = Math.sin(this.phi) * Math.cos(this.theta), this.target.y = Math.cos(this.phi), this.target.z = Math.sin(this.phi) * Math.sin(this.theta), this.camera.lookAt(this.target), this.renderer.render(this.scene, this.camera) }, Video.prototype.onWindowResize = function onWindowResize(e, t) { this.camera && (this.camera.aspect = e / t, this.camera.updateProjectionMatrix(), this.renderer.setSize(e, t)); var r = Object(h.j)(["app", "width"]), n = Object(h.j)(["app", "height"]); this.renderer && this.renderer.domElement && (this.renderer.domElement.style.marginTop = (n - this.renderer.domElement.height) / 2 + "px", this.renderer.domElement.style.marginLeft = (r - this.renderer.domElement.width) / 2 + "px") }, Video.prototype.onDocumentMouseDown = function onDocumentMouseDown(e) { 0 === e.button && (e.preventDefault(), this.root.addEventListener("mousemove", this.onDocumentMouseMove, !1), this.root.addEventListener("mouseup", this.onDocumentMouseUp, !1), this.root.addEventListener("mouseleave", this.onDocumentMouseUp, !1)) }, Video.prototype.onDocumentMouseMove = function onDocumentMouseMove(e) { var t = e.movementX || e.mozMovementX || e.webkitMovementX || 0, r = e.movementY || e.mozMovementY || e.webkitMovementY || 0; this.lon -= .1 * t, this.lat += .1 * r }, Video.prototype.onDocumentMouseUp = function onDocumentMouseUp() { this.root.removeEventListener("mousemove", this.onDocumentMouseMove), this.root.removeEventListener("mouseup", this.onDocumentMouseUp) }, Video.prototype.onDocumentMouseWheel = function onDocumentMouseWheel(e) { this.camera.fov += .05 * e.deltaY, this.camera.updateProjectionMatrix() }, Video.prototype.onDocumentTouchStart = function onDocumentTouchStart(e) { e.preventDefault(); var t = e.touches[0]; this.touchX = t.screenX, this.touchY = t.screenY }, Video.prototype.onDocumentTouchMove = function onDocumentTouchMove(e) { e.preventDefault(); var t = e.touches[0]; this.lon -= .1 * (t.screenX - this.touchX), this.lat += .1 * (t.screenY - this.touchY), this.touchX = t.screenX, this.touchY = t.screenY }, Video.prototype.disposeVr = function disposeVr() { this.lon = 90, this.lat = 0, this.phi = 0, this.theta = 0, this.vrAnimateId && cancelAnimationFrame(this.vrAnimateId), this.target = null, this.camera = null, this.renderer && (this.renderer.domElement && (this.renderer.domElement.parentNode.removeChild(this.renderer.domElement), this.renderer.domElement = null), this.renderer = null), this.scene = null, this.root.removeEventListener("mousedown", this.onDocumentMouseDown, !1), this.root.removeEventListener("mousemove", this.onDocumentMouseMove, !1), this.root.removeEventListener("mouseup", this.onDocumentMouseUp, !1) }, Video.prototype.upUid = function upUid(e) { this.setUiD && this.setUiD(e.uid) }, Video.prototype.audioDot = function audioDot(e) { var t = Object(h.j)(["app", "rid"]), r = Object(h.j)(["app", "streamInfo", "rtmp_url"]), n = Object(h.j)(["app", "streamInfo", "rtmp_live"]), i = Object(h.j)(["videoModule", "player", "p2pValue"]), a = Object(h.j)(["app", "streamInfo", "is_mixed"]), o = Object(h.j)(["videoModule", "player", "p2p"]), s = Object(h.j)(["videoModule", "player", "isPreload"]), u = Object(h.j)(["app", "cdn"]), d = Object(h.j)(["app", "acdn"]), l = Object(h.j)(["videoModule", "player", "streamName"]), p = Object(h.j)(["tcp", "loginres", "userid"]), f = Object(h.j)(["app", "streamInfo", "mixed_url"]), _ = Object(h.j)(["app", "streamInfo", "mixed_live"]), m = { net: 1, rid: t, vt: Object(c.getPageData)("$ROOM.audioWEBBGIMG") || Object(c.getIsPlayAudio)() ? 1 : 2, mix: a ? 1 : 0, surl: a ? f + "/" + _ : r + "/" + n, res: a ? 3 : this.getRateInt(l), lt: 1, ec: e, d_ec: 0, is_err: 0 === e ? 0 : 1, is_ma: s ? 1 : 0, is_b: this.hasP2PRollback ? 1 : 0, pv: U.h, cv: U.h, p2p: i, uid: p, st: o ? 2 : 1, wtype: Object(c.getPageData)("pageType"), s_cdn: Object(c.getIsPlayAudio)() ? d : u, zone: Object(c.getPageData)("$ROOM.cate_id"), et: 1, reportId: 615, stime: (new Date).valueOf() - Object(c.getrequstTime)() }; window.streamSubSdkReport ? window.streamSubSdkReport(m) : this.subNewList.length > 100 ? this.subNewList.shift() : this.subNewList.push(m) }, Video }(f), ge = r("a9aad"), be = r.n(ge); function video2_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function video2_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var we = function (e) { function Video2() { return function video2_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, Video2), function video2_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.apply(this, arguments)) } return video2_inherits(Video2, e), Video2.prototype.init = function init(t) { e.prototype.init.call(this, t), this.videoContent = document.createElement("div"), this.videoContent.className = be.a.videoContainer, t.appendChild(this.videoContent), this.video = document.createElement("video"), this.video.className = be.a.video, this.videoContent.appendChild(this.video), this.video.id = this.videoId, this.canvas = document.createElement("canvas"), this.canvas.className = be.a.screenshot, this.videoContent.appendChild(this.canvas), this.element = this.videoContent, this.autoplaydiv = document.createElement("div"), this.videoContent.appendChild(this.autoplaydiv), this.canAutoPlay = !0, this.firstReadVide = !0, this.starIndex = 0, W.a.on("embedmentPlayerdispose", this.embedmentPlayerdisposeHandle), W.a.on("videoPairFrame10Over", this.videoPairFrame10Over), W.a.on(te.h, this.getsdkTime), W.a.on(te.d, this.beginLoadTimefun), this.viewFresh() }, Video2.prototype.viewFresh = function viewFresh() { var e = Object(h.j)(["app", "width"]), t = Object(h.j)(["app", "height"]), r = Object(h.j)(["app", "isFullscreen"]), n = Object(h.j)(["app", "isWebFullscreen"]), i = Object(h.j)(["app", "playbModel"]), a = Object(h.j)(["videoModule", "player", "videoWidth"]), o = Object(h.j)(["videoModule", "player", "videoHeight"]), s = void 0; if (t -= r || n || !i ? 0 : U.e, 0 === a || 0 === o) s = { width: e, height: t }, this.videoRealWidth = e, this.videoRealHeight = t; else { var u = 1, d = 0, c = 0, l = 0, p = 0; o / a <= t / e ? (c = e, d = o * (u = e / a), p = .5 * t - o * u * .5) : (d = t, c = a * (u = t / o), l = .5 * e - a * u * .5), s = { width: c, height: d, left: l, top: p }, this.videoRealWidth = c, this.videoRealHeight = d } var f = { width: s.width + "px", height: s.height + "px" }; Object.assign(this.video.style, f), Object.assign(this.canvas.style, f) }, Video2.prototype.setvideo2Src = function setvideo2Src(e) { if (this.player && (this.player.dispose(), this.player = null), this.canvas && (this.canvas.style.visibility = "hidden"), this.player = player_createPlayer(e, { P2P: "", hasVideo: !Object(c.getPageData)("$ROOM.audioWEBBGIMG") && void 0 }), this.player) { this.video.src = "", this.player.attachMedia(this.video), this.player.on(ce.FIRST_FRAME, this.onFirstFrame), this.player.on(ce.READY, this.onReady), this.player.on(ce.COMPLETE, this.onComplete), this.player.on(ce.ERROR, this.onError), this.player.load(); for (var t = (new Date).valueOf(), r = "", n = 0; n < 4; n++)r += parseInt(10 * Math.random(), 10); this.pid = r + t, this._byteAnotherTimerID && clearInterval(this._byteAnotherTimerID), clearInterval(this.failTimeIndex) } this.refreshPlayer() }, Video2.prototype.refreshPlayer = function refreshPlayer() { var e = Object(h.j)(["videoModule", "player", "volume"]); this.player && (this.player.volume(parseFloat(e, 10)), this.canAutoPlay ? this.player.play() : this.stop()) }, Video2.prototype.stop = function stop() { var e = this; this.player && this.canvas && this.video && this.videoRealWidth && this.videoRealHeight && (this.player.pause(), this.canvas.width = this.videoRealWidth, this.canvas.height = this.videoRealHeight, this.canvas.getContext("2d").drawImage(this.video, 0, 0, this.videoRealWidth, this.videoRealHeight), this.canvas.style.visibility = ""); getIsHidden() ? this.dispose() : (clearTimeout(this.disposeTimer), this.disposeTimer = setTimeout(function () { e.dispose() }, 20)) }, Video2.prototype.onCanAutoPlay = function onCanAutoPlay() { this.canAutoPlay = !1, this.showAutoplaydiv(), this.stop(), W.a.emit("diposeFirstVideo") }, Video2.prototype.dispose = function dispose() { this.player && (this.player.pause(), this.player.dispose()), this.player = null, W.a.off("embedmentPlayerdispose", this.embedmentPlayerdisposeHandle), W.a.off("videoPairFrame10Over", this.videoPairFrame10Over) }, Video2.prototype.onFirstFrame = function onFirstFrame() { this.refreshPlayer(), this.showFrameTimePoint = (new Date).valueOf(), this.performancePoint(), Object(c.setEmbedmentShowTime)((new Date).valueOf()) }, Video2.prototype.onReady = function onReady() { if (null != this.firstReadData) { var e = (new Date).valueOf(); this.firstReadData.canplay_matadate = e - this.showFrameTimePoint, Object(c.prfLoad)(this.firstReadData), this.firstReadData = null } this.player.on(ce.CANAUTO_PLAY, this.onCanAutoPlay), this.refreshPlayer(), Object(c.setEmbedmentPlayer)(this.player.player), 0 === this.starIndex && (Object(c.starVideoPairFrame)(), this.starIndex = 2) }, Video2.prototype.onComplete = function onComplete() { Object(c.authenticationPlayerComplate)() }, Video2.prototype.onError = function onError() { Object(c.closeVideoPairFrame)(1, 8) }, Video2.prototype.onclick1 = function onclick1() { this.canAutoPlay = !0, this.autoplaydiv.style.visibility = "hidden", Object(h.b)({ id: "LoadVideoNet", action: "reloadVideo", data: [{ manual: !0 }] }), this.embedmentPlayerdisposeHandle() }, Video2.prototype.videoPairFrame10Over = function videoPairFrame10Over(e) { 1 === e && this.embedmentPlayerdisposeHandle() }, Video2.prototype.embedmentPlayerdisposeHandle = function embedmentPlayerdisposeHandle() { this.player && (this.player.pause(), this.player.dispose()), this.player = null, e.prototype.destroy.call(this), W.a.off("embedmentPlayerdispose", this.embedmentPlayerdisposeHandle), W.a.off("videoPairFrame10Over", this.videoPairFrame10Over) }, Video2.prototype.showAutoplaydiv = function showAutoplaydiv() { Object(c.closeVideoPairFrame)(-1, 9); var e = Object(h.j)(["app", "width"]), t = Object(h.j)(["app", "height"]); this.Autoplaydiv1 = document.createElement("div"), this.Autoplaydiv1.className = be.a.mask1, this.Autoplaydiv1.onclick = this.onclick1, this.Autoplaydiv2 = document.createElement("div"), this.Autoplaydiv2.className = be.a.autoPlayImg, this.Autoplaydiv2.style.transform = "matrix(1, 0, 0, 1, " + parseInt((e - 252) / 2, 10) + ", " + parseInt((t - 178) / 2, 10) + ")", this.Autoplaydiv1.appendChild(this.Autoplaydiv2), this.autoplaydiv.appendChild(this.Autoplaydiv1), this.Autoplaydiv3 = document.createElement("div"), this.Autoplaydiv3.className = be.a.jumpdetail, this.Autoplaydiv3.style.transform = "matrix(1, 0, 0, 1, " + parseInt((e - 252) / 2, 10) + ", " + parseInt((t - 178) / 2, 10) + ")", this.Autoplaydiv3.onclick = function () { window.open("https://www.douyu.com/cms/gong/201807/06/8146.shtml") }, this.autoplaydiv.appendChild(this.Autoplaydiv3), this.canAutoPlay = !0 }, Video2.prototype.getsdkTime = function getsdkTime(e) { e && (this.startsdkTimevalue = e.bt, this.getsdkTimevalue = e.et) }, Video2.prototype.beginLoadTimefun = function beginLoadTimefun(e) { e && (this.beginloadTime = e.sdkok) }, Video2.prototype.performancePoint = function performancePoint() { var e = Object(h.j)(["videoModule", "player", "p2p"]), t = Object(h.j)(["videoModule", "player", "isPreload"]), r = Object(h.j)(["app", "cdn"]), n = Object(h.j)(["videoModule", "player", "src"]).match(/(^|&)isp=([^&]*)(&|$)/), i = n && n[2] ? n[2] : "", a = Object(h.j)(["videoModule", "player", "starEnterH5Play"]), o = Object(h.j)(["LoadVideoNet", "requestRoomInfoTimePoint"]), s = (new Date).valueOf(), u = (new Date).valueOf(), d = e || r; Object(h.j)(["app", "manualLoadVideo"]) && (this.firstReadVide = !1); var c = window.__player && window.__player.isSwitched; this.firstReadVide && !c && (this.firstReadVide = !1, this.firstReadData = { type: 3, service_t: d, enterFlashTimer: a, getRoomInfoTimer: o, getStramUrlTimer: s, starRequstStramTimer: u, showStramTimer: this.showFrameTimePoint, isH5: !0, is_back: 0, av: U.h, is_ma: t ? 1 : 0, requestSDKTime: this.startsdkTimevalue, getSDKTime: this.getsdkTimevalue, starRequstStramTimer2: this.beginloadTime, showStramTimer2: this.showFrameTimePoint, isp: i }) }, Video2 }(f), Ee = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" === typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, Te = !1, Se = void 0, Pe = void 0, Ae = void 0, Oe = void 0, Me = void 0; function onRuntimeInitialized() { var e = +Object(h.j)(["app", "rid"]), t = (new Date).getTime(), r = t.toString(16), n = parseInt("0x" + r.substring(0, r.length - 8), 16), i = parseInt("0x" + r.substring(r.length - 8, r.length), 16), a = Object(y.e)(), o = Object(y.d)("auth") || "201806211659380f83e682207dd1293cea68f98662b1660083967948219fe20"; Promise.resolve().then(function () { return Pe = (new Date).getTime(), window.SQSSMURFNEEDALONGLONGLONGNAME.sqsneedalongname(e, n, i, a, o, 3186) }).then(function (e) { Ae = (new Date).getTime(), Object(h.b)({ id: "LoadVideoNet", action: "httpClientLoadStremUrl", data: [e, t, Oe, Me] }), Te ? V.a.log("****\u5f00\u59cb\u52a0\u5bc6\u5230\u7b97\u51fa\u52a0\u5bc6\u6570---" + (Ae - Pe)) : V.a.log("****\u52a0\u8f7d\u5230\u7b97\u51fa\u52a0\u5bc6\u503c-\u4e0b\u8f7d\u5230\u56de\u8c03\u5f00\u59cb\u52a0\u5bc6--" + (Pe - Se) + "\u5f00\u59cb\u52a0\u5bc6\u5230\u7b97\u51fa\u52a0\u5bc6\u6570---" + (Ae - Pe)), Te = !0 }).catch(function () { Object(c.notifyLoadjs)() }) } function StreamEncode(e, t) { if (Oe = e, Me = t, Te) onRuntimeInitialized(); else { Se = (new Date).getTime(); var r = ""; r = document.createElement("script"), "object" !== ("undefined" === typeof WebAssembly ? "undefined" : Ee(WebAssembly)) ? r.src = "https://shark2.douyucdn.cn/front-publish/sdk-file-master/aanode_131510b.js" : r.src = "https://shark2.douyucdn.cn/front-publish/sdk-file-master/wanode_fd27bd3.js", r.type = "text/javascript", document.getElementsByTagName("head")[0].appendChild(r), r.onerror = function () { !function errHandle() { Object(c.notifyLoadjs)() }() } } } function FecthGetRequest(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1e3; return new Promise(function (r) { var n = 0, i = setTimeout(function () { 0 === n && (n = 2, clearTimeout(i), i = null, r({ statusCode: -2, json: {} })) }, t); fetch(e, { method: "GET", headers: {} }).then(function (e) { clearTimeout(i), i = null; var t = e.status; if (e.ok) 2 !== n && (n = 1, e.json().then(function (e) { return r({ statusCode: t, json: e }) })); else if (2 !== n) return n = 1, r({ statusCode: t, json: {} }) }).catch(function () { return r({ statusCode: 400, json: {} }) }) }) } window.SQSSMURFNEEDALONGLONGLONGNAME = { onRuntimeInitialized: onRuntimeInitialized }; var ke = !1, De = Object(V.b)("MSG"), Le = { requestRoomInfoTimePoint: -1, requestStreamUrlTimePoint: 0, starPlayStreamTimePoint: 0, loadNum: 0 }; function action_getData() { return Le } function streamDataHandle(e) { Object(_.b)().app.cdn = e.rtmp_cdn, Object(_.b)().app.acdn = e.acdn, Object(h.b)({ id: "app", action: "refreshRidAndCdn", data: [e.room_id, e.rtmp_cdn] }); var t = { is_mixed: e.is_mixed, mixed_url: e.mixed_url, mixed_live: e.mixed_live, rtmp_url: e.rtmp_url, rtmp_live: e.rtmp_live, player_1: e.player_1, isH265: Object(c.checkIsSupporH265)() && e.player_1 ? 1 : 0 }; Object(_.b)().app.uip = e.client_ip, Object(h.b)({ id: "app", action: "freshUip", data: [e.client_ip] }), Object(_.d)(t), Object(h.b)({ id: "app", action: "refeshStreamInfo", data: [t] }), Object(h.b)({ id: "LoadVideoNet", action: "playStream", data: [] }) } function loadVideo() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.cdn, r = e.rate, n = e.isRollback, i = e.isInit, a = e.manual, o = void 0 !== a && a, s = e.isLianmaiOver, u = e.isnoLoading, d = e.isaudio, l = void 0 !== d && d; if (Object(c.setrequstTime)((new Date).valueOf()), o && Object(c.closeVideoPairFrame)(4, 6), clearRecordRateTimeIDInterval(), l || Object(c.getIsPlayAudio)() || Object(h.b)({ id: "videoModule", action: "refeshplayerSrc", data: [""] }), Object(h.b)({ id: "videoModule", action: "setPlayerError", data: [0] }), Object(h.b)({ id: "videoModule", action: "refeshplayerisRollback", data: [n] }), Object(h.b)({ id: "comment", action: "seiMcdatachange", data: [""] }), o && (Object(_.b)().app.manualLoadVideo = o, Object(h.b)({ id: "app", action: "manualLoadVideo", data: [o] })), i) { var p = Object(c.getPageData)("$ROOM.p2p_setting"), f = Object(c.getPageData)("$ROOM.multirates"), m = void 0; Object(h.b)({ id: "videoModule", action: "checkAccelerator", data: [t, r] }); try { var y = localStorage.getItem("h5StreamPreload_h5p_room"); if (y) y = JSON.parse(y), Date.now() < y.e && (m = JSON.parse(y.v)) } catch (e) { De.warn("parse preload stream error", e) } var v = Object(h.j)(["app", "rid"]); m && +v === +m.room_id && m.multirates && m.multirates.length > 0 && (m.multirates.forEach(function (e) { e.type = e.rate }), f = m.multirates, r = m.rate); var g = Object(c.getPageData)("$ROOM.coverSrc"), b = Object(c.getPageData)("$ROOM.owner_avatar"), w = Object(c.getPageData)("$ROOM.isDefaultAvatar"), E = Object(c.getPageData)("$ROOM.roomSrc"), T = Object(c.getPageData)("$ROOM.defaultSrc"), S = f && f.length > 1 ? 1 : 0, P = f && f.length > 1 ? 1 : 0, A = Object(c.getPageData)("$ROOM.is_high_game"), O = Object(c.getPageData)("$ROOM.room_idle"); Object(_.b)().app.changeRateSwitch = S, Object(h.b)({ id: "app", action: "changeRateSwitch", data: [S] }), Object(_.b)().app.pageRateSwitch = P, Object(h.b)({ id: "app", action: "changePageRateSwitch", data: [P] }), O && O.hasOwnProperty("active") && O.hasOwnProperty("minute_limit") && Object(h.a)(te.f, O), isAnotherDay() && (F.c("rateRecordTime", 0), F.c("realRateModel", -1)); var M = { p2p_settings: p, coverSrc: g, owner_avatar: b, isDefaultAvatar: w, roomSrc: E, defaultSrc: T }, k = { rateSwitch: S, liveType: A, rate: r = F.b("realRateModel", -1) }; Object(_.a)(M, k) } else r = Object(h.j)(["app", "rate"]); Object(h.b)({ id: "LoadVideoNet", action: "loadStream", data: [t, r, n, o, i, s, u, l] }) } function playStream() { var e = "", t = Object(h.j)(["app", "streamInfo", "rtmp_url"]); t && (e = t + "/" + Object(h.j)(["app", "streamInfo", "rtmp_live"])); (t = Object(h.j)(["ticket", "rtmp_url"])) && (e = t + "/" + Object(h.j)(["ticket", "rtmp_live"])); Object(h.j)(["app", "streamInfo", "is_mixed"]) && (e = Object(h.j)(["app", "streamInfo", "mixed_url"]) + "/" + Object(h.j)(["app", "streamInfo", "mixed_live"])); Object(h.j)(["app", "streamInfo", "isH265"]) && (e = Object(h.j)(["app", "streamInfo", "player_1"])); var r = (new Date).valueOf(); action_getData().starPlayStreamTimePoint = r, Object(h.b)({ id: "videoModule", action: "refeshplayerisPlay", data: [!0] }); var n = Object(h.j)(["app", "roomInfo"]), i = { rateSwitch: Object(h.j)(["app", "rateSwitch"]), rate: Object(h.j)(["app", "rate"]), multirates: Object(h.j)(["app", "multirates"]) }; Object(h.b)({ id: "app", action: "refreshAppinfo", data: [n, i] }), Object(h.b)({ id: "videoModule", action: "refeshplayerSrc", data: [e] }) } var xe = "", Ie = void 0, Re = void 0, je = void 0; function loadStream(e, t, r, n, i, a, s, u) { var d = Object(h.j)(["LoadVideoNet", "loadNum"]); Object(h.b)({ id: "videoModule", action: "changeisAudio", data: [u] }), d += 1; var l = (new Date).valueOf(), p = (new Date).valueOf(); action_getData().requestStreamUrlTimePoint = l, action_getData().loadNum = d, action_getData().requestRoomInfoTimePoint = p; var f = Object(h.j)(["app", "rid"]), _ = Object(y.e)(), m = parseInt((new Date).getTime() / 1e3, 10); void 0 === e && (e = Object(h.j)(["app", "cdn"])), void 0 === t && (t = Object(h.j)(["app", "rate"])); var v = void 0, g = Object(h.j)(["videoModule", "haveShowVideo"]) ? 0 : 1, b = 0; F.b(F.a.RateRecordTime, 0) >= 3 && (b = 1); var w = Object(c.checkIsSupporH265)(e) ? 1 : 0; try { v = window.ub98484234(f, _, m) + "&cdn=" + e + "&rate=" + t + "&ver=" + U.h + "&iar=" + g + "&ive=" + b + "&hevc=" + w + "&fa=" + (u ? 1 : 0), Object(c.isVip)() && !ke && (v = v + "&aid=web-alone&uid=" + (Object(y.d)("uid") || "0") + "&fa=" + (u ? 1 : 0)) } catch (e) { return Object(h.d)(U.f, { s_error: 2, err_type: 1, en_ver: window.vdwdae325w_64we, em: e.message }), Object(c.notifyLoadjs)(), De.error("get stream url error.", e) } var E = !1; return Promise.resolve().then(function () { var n = window.__player && window.__player.isSwitched; if (i && !n) { var d = void 0; try { var l = localStorage.getItem("h5StreamPreload_h5p_room"); if (l) l = JSON.parse(l), Date.now() < l.e && (d = JSON.parse(l.v)) } catch (e) { De.warn("parse preload stream error", e) } if (d && +f === +d.room_id && d.multirates && d.multirates.length > 0) { if (E = !0, !d.rtmp_live) { var p = d.multirates[0]; d.rtmp_url = p.rtmp_url, d.rtmp_live = p.rtmp_live, d.rate = p.rate, De.warn("\u627e\u4e0d\u5230\u6307\u5b9a\u6e05\u6670\u5ea6\u7684\u6d41\uff0c\u4f7f\u7528rate=" + p.rate + "\u4ee3\u66ff") } return d.rtmp_live && (d.rtmp_live += "&" + v), d.mixed_live && (d.mixed_live += "&" + v), localStorage.removeItem("h5StreamPreload_h5p_room"), De.log("use preload stream"), Object(c.streamHandle)(d, t, r, E, e, s) } } xe = e.toString(), Ie = t, Re = a, je = r; var _ = +Object(c.getPageData)("$ROOM.cate_id"); return 208 !== +_ && 181 !== +_ ? Object(c.isVip)() && !ke ? FecthGetRequest(Object(y.f)().play_web_url + U.a + "/" + f + "?" + v, 1e3).then(function (n) { var i = n.statusCode, o = n.json; if (-2 === +i) Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()); else if (200 === i) { var u = o.error; try { if (0 !== u) throw Object(c.notifyLoadjs)(), -1 === u ? Object(h.d)(U.f, { s_error: 2, err_type: 2, en_ver: window.vdwdae325w_64we, em: o.msg }) : -9 === +u ? Object(h.a)(te.j) : -15 === +u && Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()), Object(c.closeVideoPairFrame)(4, 7), new Error("stream error code = " + u); var d = o.data; a && d && (d.is_mixed = !1), Object(c.streamHandle)(d, t, r, E, e, s) } catch (e) { Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }) } } else Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()) }) : o.httpClient.post(String, Object(c.isSupermanager)() || Object(c.getIsHostlive)() ? U.b + "/" + f : U.a + "/" + f, v, { withCredentials: !0 }).subscribe(function (n) { var i = n.error; try { if (0 !== i) throw Object(c.notifyLoadjs)(), -1 === i ? Object(h.d)(U.f, { s_error: 2, err_type: 2, en_ver: window.vdwdae325w_64we, em: n.msg }) : -9 === +i && Object(h.a)(te.j), Object(c.closeVideoPairFrame)(4, 7), new Error("stream error code = " + i); var o = JSON.parse(n.data); a && o && (o.is_mixed = !1), Object(c.streamHandle)(o, t, r, E, e, s) } catch (e) { Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }), Object(c.notifyLoadjs)() } }) : (Object(c.delayStreamWhilte)() && Object(c.getInPairFrameState)() < 2 || s || (De.warn("isnoLoading-----" + s), Object(h.b)({ id: "loading", action: "showLoading", data: [!0] })), StreamEncode(u, s)) }).catch(function (e) { De.error("Load stream api error : roomid = " + f, e), Object(c.notifyLoadjs)() }), null } function httpClientLoadStremUrl(e, t, r, n) { var i = Object(h.j)(["app", "rid"]), a = Object(h.j)(["videoModule", "haveShowVideo"]) ? 0 : 1, s = 0; F.b(F.a.RateRecordTime, 0) >= 3 && (s = 1); var u = xe, d = Ie; void 0 === u && (u = Object(h.j)(["app", "cdn"]).toString()), void 0 === d && (d = Object(h.j)(["app", "rate"])); var l = Object(y.e)(), p = Object(c.checkIsSupporH265)() ? 1 : 0, f = "cdn=" + u + "&rate=" + d + "&ver=" + U.h + "&iar=" + a + "&ive=" + s + "&" + e + "&sov=1&tt=" + t + "&did=" + l + "&hevc=" + p + "&fa=" + (r ? 1 : 0); if (Object(c.isVip)() && !ke && (f = f + "&aid=web-alone&uid=" + (Object(y.d)("uid") || 0)), Object(c.isVip)() && !ke) { var _ = Object(y.f)().play_web_url + U.a + "/" + i + "?" + f; Promise.resolve().then(function () { return FecthGetRequest(_, 1e3).then(function (e) { var t = e.statusCode, r = e.json; if (-2 === +t) Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()); else if (200 === t) { var i = r.error; try { if (0 !== i) throw Object(c.notifyLoadjs)(), -1 === i ? Object(h.d)(U.f, { s_error: 2, err_type: 2, en_ver: window.vdwdae325w_64we, em: r.msg }) : -9 === +i ? Object(h.a)(te.j) : -15 === +i && Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()), Object(c.closeVideoPairFrame)(4, 7), new Error("stream error code = " + i); var a = r.data; a && (a.is_mixed = !1), Object(c.streamHandle)(a, d, je, !1, u, n) } catch (e) { Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }) } } else Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()) }) }).catch(function (e) { De.error("Load stream api error : roomid = " + i, e), Object(c.notifyLoadjs)(), e.response && e.response.status && (200 !== +e.response.status || 403 !== +e.response.status) && Object(c.isVip)() && (ke = !0, Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: !1, isLianmaiOver: !1 }] }), Object(c.setvipBack)()) }) } else Promise.resolve().then(function () { return o.httpClient.post(String, Object(c.isSupermanager)() || Object(c.getIsHostlive)() ? U.b + "/" + i : U.a + "/" + i, f, { withCredentials: !0 }).subscribe(function (e) { var t = e.error; try { if (0 !== t) throw Object(c.notifyLoadjs)(), -1 === t ? Object(h.d)(U.f, { s_error: 2, err_type: 2, en_ver: window.vdwdae325w_64we, em: e.msg }) : -9 === +t && Object(h.a)(te.j), Object(c.closeVideoPairFrame)(4, 7), new Error("stream error code = " + t); var r = JSON.parse(e.data); Re && r && (r.is_mixed = !1), Object(c.streamHandle)(r, d, je, !1, u, n) } catch (e) { Object(c.notifyLoadjs)(), Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }) } }) }).catch(function (e) { De.error("Load stream api error : roomid = " + i, e), Object(c.notifyLoadjs)() }); return null } var Ce = !1; function loadTicketStream(e, t, r) { if (!Ce && r && (Object(h.b)({ id: "ticket", action: "initpayment_mode", data: [r.payment_mode] }), Object(h.a)(te.n, { status: 1, ticketId: r.ticket_id }), Ce = !0), !1 !== Object(h.j)(["app", "isLogin"])) { var n = Object(h.j)(["LoadVideoNet", "loadNum"]); n += 1; var i = (new Date).valueOf(); action_getData().requestStreamUrlTimePoint = i, action_getData().loadNum = n, action_getData().requestRoomInfoTimePoint = -1; var a = Object(h.j)(["videoModule", "haveShowVideo"]) ? 0 : 1; Object(_.b)().app.rate = t, Object(h.b)({ id: "app", action: "freshRate", data: [t] }); var s = Object(h.j)(["app", "rid"]), u = Object(h.j)(["app", "isYuanhua"]), d = Object(y.e)(), l = parseInt((new Date).getTime() / 1e3, 10); void 0 === e && (e = Object(h.j)(["app", "cdn"])), void 0 === t && (t = Object(h.j)(["app", "rate"])), o.httpClient.post(String, U.c + "/" + s, window.ub98484234(s, d, l) + "&cdn=" + e + "&rate=" + t + "&iar=" + a + "&ver=" + U.h).subscribe(function (e) { try { var t = JSON.stringify(e); 0 === +(e = JSON.parse(t)).error && (e.data = JSON.parse(e.data)), e.flash_is_yuanhua = u ? 1 : 0, Object(_.b)().app.uip = e.client_ip, Object(h.b)({ id: "app", action: "freshUip", data: [e.client_ip] }), Object(h.b)({ id: "app", action: "setTicketData", data: [e] }), Object(_.b)().app.cdn = e.data.rtmp_cdn, Object(h.b)({ id: "app", action: "freshCdn", data: [e.data.rtmp_cdn] }) } catch (e) { Object(c.notifyLoadjs)(), De.warn("parse preload stream error", e), Object(h.b)({ id: "loading", action: "showLoading", data: [!0] }), Object(h.b)({ id: "videoModule", action: "setPlay", data: [!0, !0] }) } }) } else Object(c.notifyLoadjs)() } function reloadVideo() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.manual, r = e.isLianmaiOver, n = e.isnoLoading, i = e.isaudio; Object(h.b)({ id: "videoModule", action: "refeshplayerisPlay", data: [!0] }), Object(h.j)(["app", "inVod"]) || Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ manual: t, isLianmaiOver: r, isnoLoading: n, isaudio: i }] }) } function loadVideoNet_action_initData() { Le = { requestRoomInfoTimePoint: -1, requestStreamUrlTimePoint: 0, starPlayStreamTimePoint: 0, loadNum: 0 } } function getIsOpenAutio(e, t, r) { var n = Object(h.j)(["app", "rid"]), i = Object(y.e)(), a = Object(h.j)(["app", "cdn"]), s = Object(h.j)(["app", "rate"]), u = parseInt((new Date).getTime() / 1e3, 10), d = Object(h.j)(["videoModule", "player", "p2pValue"]) || 0, c = window.ub98484234(n, i, u) + "&cdn=" + a + "&rate=" + s + "&iar=1&ver=" + U.h + "&p2p=" + d + "&pt=" + e + "&dt=&txdw=0&il=0&ar=0&nt=&rs=1&bp=1&os=web_h5&p2p_total=" + t + "&p2p_dur=" + r; o.httpClient.post(String, "/gapi/live/web/autoswitch/" + n + "?client_sys=web_h5", c, { withCredentials: !0 }).subscribe(function (e) { var t = e.error, r = JSON.parse(e.data); 0 === t && W.a.emit("loadAudioCd", r) }) } function lianmaireloadVideo() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = e.manual, r = e.isLianmaiOver; Object(c.getIsPlayAudio)() ? reloadVideo({ isaudio: !0, isnoLoading: !0, manual: t, isLianmaiOver: r }) : reloadVideo({ manual: t, isLianmaiOver: r }) } function loadVideoNet_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function loadVideoNet_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var Be = function (e) { function LoadVideoNet() { !function loadVideoNet_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, LoadVideoNet); var t = function loadVideoNet_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return loadVideoNet_action_initData(), t.id = "LoadVideoNet", t.actionList = ["reloadVideo", "lianmaireloadVideo"], t } return loadVideoNet_inherits(LoadVideoNet, e), LoadVideoNet.prototype.init = function init(t) { e.prototype.init.call(this, t) }, LoadVideoNet.prototype.destroy = function destroy() { e.prototype.destroy.call(this) }, LoadVideoNet.prototype.getMoudleDate = function getMoudleDate() { return action_getData() }, LoadVideoNet.prototype.actionHandle = function actionHandle(e) { var t = e.action, r = e.data; a && a[t] && a[t].apply(a, r) }, LoadVideoNet }(f); function h5Video_inherits(e, t) { if ("function" !== typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : function h5Video_defaults(e, t) { for (var r = Object.getOwnPropertyNames(t), n = 0; n < r.length; n++) { var i = r[n], a = Object.getOwnPropertyDescriptor(t, i); a && a.configurable && void 0 === e[i] && Object.defineProperty(e, i, a) } return e }(e, t)) } var Fe = function (e) { function H5Video() { !function h5Video_classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, H5Video); var t = function h5Video_possibleConstructorReturn(e, t) { if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !t || "object" !== typeof t && "function" !== typeof t ? e : t }(this, e.call(this)); return Object(h.e)(), t.modules = [], t.isVideoShow = !1, t } return h5Video_inherits(H5Video, e), H5Video.prototype.init = function init(e, t) { this.container = e, Object(_.c)(Object(c.get$ROOM)()), Object(_.f)(e.getBoundingClientRect()); var r = void 0; Object(c.delayStreamWhilte)() && 2 !== t ? (r = new we, this.registerModule(new v(this), new ve(this), r, new Be(this))) : this.registerModule(new v(this), new ve(this), new Be(this)), Object(h.i)(this.modules); var n = (new Date).valueOf(); Object(h.b)({ id: "videoModule", action: "setEnterPlay", data: [n] }), Object(c.delayStreamWhilte)() && 2 !== t && r.setvideo2Src(window.streamUrl), Object(h.b)({ id: "LoadVideoNet", action: "loadVideo", data: [{ isInit: !0 }] }), Object(y.b)(U.j) }, H5Video.prototype.destroy = function destroy(e) { this.removeAllListeners(), this.modules.forEach(function (t) { return t.destroy(e) }), this.modules = null, clearRecordRateTimeIDInterval(), this.container = null, Object(c.closeVideoPairFrame)(4, 4) }, H5Video.prototype.registerModule = function registerModule() { for (var e = this, t = arguments.length, r = Array(t), n = 0; n < t; n++)r[n] = arguments[n]; r.forEach(function (t) { t.init(e.container), e.modules.push(t) }), function PageVisibility_init() { _e && (me = document[_e]) }() }, H5Video.prototype.getModule = function getModule(e) { for (var t = 0; t < this.modules.length; t++) { var r = this.modules[t]; if (r.id === e) return r } return null }, H5Video }(s.EventEmitter), Ne = Ne || function (e, t) { var r = {}, n = r.lib = {}, i = function n() { }, a = n.Base = { extend: function extend(e) { i.prototype = this; var t = new i; return e && t.mixIn(e), t.hasOwnProperty("init") || (t.init = function () { t.$super.init.apply(this, arguments) }), t.init.prototype = t, t.$super = this, t }, create: function create() { var e = this.extend(); return e.init.apply(e, arguments), e }, init: function init() { }, mixIn: function mixIn(e) { for (var t in e) e.hasOwnProperty(t) && (this[t] = e[t]); e.hasOwnProperty("toString") && (this.toString = e.toString) }, clone: function clone() { return this.init.prototype.extend(this) } }, o = n.WordArray = a.extend({ init: function init(e, t) { e = this.words = e || [], this.sigBytes = void 0 != t ? t : 4 * e.length }, toString: function toString(e) { return (e || u).stringify(this) }, concat: function concat(e) { var t = this.words, r = e.words, n = this.sigBytes; if (e = e.sigBytes, this.clamp(), n % 4) for (var i = 0; i < e; i++)t[n + i >>> 2] |= (r[i >>> 2] >>> 24 - i % 4 * 8 & 255) << 24 - (n + i) % 4 * 8; else if (65535 < r.length) for (i = 0; i < e; i += 4)t[n + i >>> 2] = r[i >>> 2]; else t.push.apply(t, r); return this.sigBytes += e, this }, clamp: function clamp() { var t = this.words, r = this.sigBytes; t[r >>> 2] &= 4294967295 << 32 - r % 4 * 8, t.length = e.ceil(r / 4) }, clone: function clone() { var e = a.clone.call(this); return e.words = this.words.slice(0), e }, random: function random(t) { for (var r = [], n = 0; n < t; n += 4)r.push(4294967296 * e.random() | 0); return new o.init(r, t) } }), s = r.enc = {}, u = s.Hex = { stringify: function stringify(e) { var t = e.words; e = e.sigBytes; for (var r = [], n = 0; n < e; n++) { var i = t[n >>> 2] >>> 24 - n % 4 * 8 & 255; r.push((i >>> 4).toString(16)), r.push((15 & i).toString(16)) } return r.join("") }, parse: function parse(e) { for (var t = e.length, r = [], n = 0; n < t; n += 2)r[n >>> 3] |= parseInt(e.substr(n, 2), 16) << 24 - n % 8 * 4; return new o.init(r, t / 2) } }, d = s.Latin1 = { stringify: function stringify(e) { var t = e.words; e = e.sigBytes; for (var r = [], n = 0; n < e; n++)r.push(String.fromCharCode(t[n >>> 2] >>> 24 - n % 4 * 8 & 255)); return r.join("") }, parse: function parse(e) { for (var t = e.length, r = [], n = 0; n < t; n++)r[n >>> 2] |= (255 & e.charCodeAt(n)) << 24 - n % 4 * 8; return new o.init(r, t) } }, c = s.Utf8 = { stringify: function stringify(e) { try { return decodeURIComponent(escape(d.stringify(e))) } catch (e) { throw Error("Malformed UTF-8 data") } }, parse: function parse(e) { return d.parse(unescape(encodeURIComponent(e))) } }, l = n.BufferedBlockAlgorithm = a.extend({ reset: function reset() { this._data = new o.init, this._nDataBytes = 0 }, _append: function _append(e) { "string" == typeof e && (e = c.parse(e)), this._data.concat(e), this._nDataBytes += e.sigBytes }, _process: function _process(t) { var r = this._data, n = r.words, i = r.sigBytes, a = this.blockSize, s = i / (4 * a); if (t = (s = t ? e.ceil(s) : e.max((0 | s) - this._minBufferSize, 0)) * a, i = e.min(4 * t, i), t) { for (var u = 0; u < t; u += a)this._doProcessBlock(n, u); u = n.splice(0, t), r.sigBytes -= i } return new o.init(u, i) }, clone: function clone() { var e = a.clone.call(this); return e._data = this._data.clone(), e }, _minBufferSize: 0 }); n.Hasher = l.extend({ cfg: a.extend(), init: function init(e) { this.cfg = this.cfg.extend(e), this.reset() }, reset: function reset() { l.reset.call(this), this._doReset() }, update: function update(e) { return this._append(e), this._process(), this }, finalize: function finalize(e) { return e && this._append(e), this._doFinalize() }, blockSize: 16, _createHelper: function _createHelper(e) { return function (t, r) { return new e.init(r).finalize(t) } }, _createHmacHelper: function _createHmacHelper(e) { return function (t, r) { return new p.HMAC.init(e, r).finalize(t) } } }); var p = r.algo = {}; return r }(Math); !function (e) { function p(e, t, r, n, i, a, o) { return ((e = e + (t & r | ~t & n) + i + o) << a | e >>> 32 - a) + t } function m(e, t, r, n, i, a, o) { return ((e = e + (t & n | r & ~n) + i + o) << a | e >>> 32 - a) + t } function l(e, t, r, n, i, a, o) { return ((e = e + (t ^ r ^ n) + i + o) << a | e >>> 32 - a) + t } function n(e, t, r, n, i, a, o) { return ((e = e + (r ^ (t | ~n)) + i + o) << a | e >>> 32 - a) + t } for (var t = Ne, r = (a = t.lib).WordArray, i = a.Hasher, a = t.algo, o = [], s = 0; 64 > s; s++)o[s] = 4294967296 * e.abs(e.sin(s + 1)) | 0; a = a.MD5 = i.extend({ _doReset: function _doReset() { this._hash = new r.init([1732584193, 4023233417, 2562383102, 271733878]) }, _doProcessBlock: function _doProcessBlock(e, t) { for (var r = 0; 16 > r; r++) { var i = e[u = t + r]; e[u] = 16711935 & (i << 8 | i >>> 24) | 4278255360 & (i << 24 | i >>> 8) } r = this._hash.words; var a, s, u = e[t + 0], d = (i = e[t + 1], e[t + 2]), c = e[t + 3], f = e[t + 4], h = e[t + 5], _ = e[t + 6], y = e[t + 7], v = e[t + 8], g = e[t + 9], b = e[t + 10], w = e[t + 11], E = e[t + 12], T = e[t + 13], S = e[t + 14], P = e[t + 15], A = r[0], O = n(O = n(O = n(O = n(O = l(O = l(O = l(O = l(O = m(O = m(O = m(O = m(O = p(O = p(O = p(O = p(O = r[1], s = p(s = r[2], a = p(a = r[3], A = p(A, O, s, a, u, 7, o[0]), O, s, i, 12, o[1]), A, O, d, 17, o[2]), a, A, c, 22, o[3]), s = p(s, a = p(a, A = p(A, O, s, a, f, 7, o[4]), O, s, h, 12, o[5]), A, O, _, 17, o[6]), a, A, y, 22, o[7]), s = p(s, a = p(a, A = p(A, O, s, a, v, 7, o[8]), O, s, g, 12, o[9]), A, O, b, 17, o[10]), a, A, w, 22, o[11]), s = p(s, a = p(a, A = p(A, O, s, a, E, 7, o[12]), O, s, T, 12, o[13]), A, O, S, 17, o[14]), a, A, P, 22, o[15]), s = m(s, a = m(a, A = m(A, O, s, a, i, 5, o[16]), O, s, _, 9, o[17]), A, O, w, 14, o[18]), a, A, u, 20, o[19]), s = m(s, a = m(a, A = m(A, O, s, a, h, 5, o[20]), O, s, b, 9, o[21]), A, O, P, 14, o[22]), a, A, f, 20, o[23]), s = m(s, a = m(a, A = m(A, O, s, a, g, 5, o[24]), O, s, S, 9, o[25]), A, O, c, 14, o[26]), a, A, v, 20, o[27]), s = m(s, a = m(a, A = m(A, O, s, a, T, 5, o[28]), O, s, d, 9, o[29]), A, O, y, 14, o[30]), a, A, E, 20, o[31]), s = l(s, a = l(a, A = l(A, O, s, a, h, 4, o[32]), O, s, v, 11, o[33]), A, O, w, 16, o[34]), a, A, S, 23, o[35]), s = l(s, a = l(a, A = l(A, O, s, a, i, 4, o[36]), O, s, f, 11, o[37]), A, O, y, 16, o[38]), a, A, b, 23, o[39]), s = l(s, a = l(a, A = l(A, O, s, a, T, 4, o[40]), O, s, u, 11, o[41]), A, O, c, 16, o[42]), a, A, _, 23, o[43]), s = l(s, a = l(a, A = l(A, O, s, a, g, 4, o[44]), O, s, E, 11, o[45]), A, O, P, 16, o[46]), a, A, d, 23, o[47]), s = n(s, a = n(a, A = n(A, O, s, a, u, 6, o[48]), O, s, y, 10, o[49]), A, O, S, 15, o[50]), a, A, h, 21, o[51]), s = n(s, a = n(a, A = n(A, O, s, a, E, 6, o[52]), O, s, c, 10, o[53]), A, O, b, 15, o[54]), a, A, i, 21, o[55]), s = n(s, a = n(a, A = n(A, O, s, a, v, 6, o[56]), O, s, P, 10, o[57]), A, O, _, 15, o[58]), a, A, T, 21, o[59]), s = n(s, a = n(a, A = n(A, O, s, a, f, 6, o[60]), O, s, w, 10, o[61]), A, O, d, 15, o[62]), a, A, g, 21, o[63]); r[0] = r[0] + A | 0, r[1] = r[1] + O | 0, r[2] = r[2] + s | 0, r[3] = r[3] + a | 0 }, _doFinalize: function _doFinalize() { var t = this._data, r = t.words, n = 8 * this._nDataBytes, i = 8 * t.sigBytes; r[i >>> 5] |= 128 << 24 - i % 32; var a = e.floor(n / 4294967296); for (r[15 + (i + 64 >>> 9 << 4)] = 16711935 & (a << 8 | a >>> 24) | 4278255360 & (a << 24 | a >>> 8), r[14 + (i + 64 >>> 9 << 4)] = 16711935 & (n << 8 | n >>> 24) | 4278255360 & (n << 24 | n >>> 8), t.sigBytes = 4 * (r.length + 1), this._process(), r = (t = this._hash).words, n = 0; 4 > n; n++)i = r[n], r[n] = 16711935 & (i << 8 | i >>> 24) | 4278255360 & (i << 24 | i >>> 8); return t }, clone: function clone() { var e = i.clone.call(this); return e._hash = this._hash.clone(), e } }), t.MD5 = i._createHelper(a), t.HmacMD5 = i._createHmacHelper(a) }(Math), window.CryptoJS = Ne; var He = o.DataCenter.global.get("$ROOM.room_id"); He || (He = window.room_id); var Ue = "betard/" + He, Ve = o.DataCenter.cookie() || {}, We = Ve.get("uid"), Ge = "/roomapi/biz/getSwitch?rid=" + He; 5 !== +Ve.get("groupid") && +We !== +o.DataCenter.global.get("$ROOM.owner_uid") || (Ue = "betard/" + He + "?_r=" + Math.random()); var qe = { $DATA: Ue, $ROLE_BARRAGE_SWITCH: Ge }; window.GIAS || o.DataCenter.event.load().subscribe(function (e) { o.DataCenter.setCommonDataConfig(qe), o.DataCenter.common.get("$DATA") }), Object(V.c)(Object(c.getIsDebug)()), function checkRef() { return window.document.referrer.indexOf("//graph.qq.com/oauth2.0/show") > -1 || window.document.referrer.indexOf("//open.weixin.qq.com/connect/qrconnect") > -1 || window.document.referrer.indexOf("//api.weibo.com/oauth2/authorize") > -1 }() && (F.c("realRateModel", -1), F.c("thridLoginPlayer", 0)); var ze = void 0, Ye = void 0; function getVideo() { return ze } function createVideo(e) { var t = document.getElementById("js-player-video-first"); return ze && (ze.destroy(1), ze = null), Object(c.showVideo)() || 3 === e ? (Object(c.showVideo)() || Object(c.notifyLoadjs)(), (ze = new Fe).init(t, e), ze) : null } var Xe = "", Ke = !1; function flashSwfObjectReadyOK() { var e = this; Ke = !0; var t = window.webRoomEnter, r = document.getElementById("js-player-video-first"); if (!document.getElementById("room-flash-player")) { var n = document.createElement("div"); n.id = "room-flash-player", r.appendChild(n) } var i = Object(c.getFlashvars)(), a = { quality: "high", bgcolor: "#333333", allowscriptaccess: "always", allowfullscreen: "true", wmode: "Opaque", allowFullScreenInteractive: "true" }, o = { id: "room-flash-player", name: "room-flash-player", align: "middle", allowscriptaccess: "always", allowfullscreen: "true", allowFullScreenInteractive: "true" }; window.__player.flashShellLoadTime = (new Date).getTime(), window.swfobject.embedSWF(t, "room-flash-player", "100%", "100%", "0", "", i, a, o, function (t) { var r = t.success, n = t.ref; r ? (window.flashPlayer = n, window.setFlashPlayer && window.setFlashPlayer()) : e.logger.warn("\u5d4c\u5165Flash\u64ad\u653e\u5668\u5931\u8d25") }) } function CreateFirstVideo(e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0, r = Object(c.checkH5)(); if (1 === t ? r = !0 : 2 === t && (r = !1), window.$Player = { useh5: r }, r && Object(c.openFirst)()) V.a.log("enable fast video."), window.FIRST_VIDEO = !0, window.__use_player_video_ready = !0, createVideo(e); else if (!r) { if (Object(c.showVideo)() && (window.FIRST_VIDEO = !0, window.__use_player_video_ready = !0), Ke) return void flashSwfObjectReadyOK(); (Xe = document.createElement("script")).src = Object(c.getPageData)("$SYS.res_flash_url") + "v2/swfobject.js", Xe.onload = flashSwfObjectReadyOK, Xe.type = "text/javascript", document.getElementsByTagName("head")[0].appendChild(Xe) } } window.checkCreateFirstVideo = function checkCreateFirstVideo() { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0, t = !e; window.$Player = { useh5: t }, 0 === e ? (Object(c.openFirst)() && (V.a.log("enable fast video."), window.FIRST_VIDEO = !0, window.__use_player_video_ready = !0, createVideo(2)), window.swfobject && window.swfobject.removeSWF("room-flash-player")) : CreateFirstVideo(e, 2) }, window.destroyFirstVideo = function destroyFirstVideo(e) { ze && ze.destroy(e), ze = null }; var Je = window.location.href.indexOf("carnivalBarrageRoom"); window.GIAS ? -1 === Je && o.DataCenter.common.get("Player.room").subscribe(function (e) { e && e.decrypt && 1 === e.decrypt.status ? CreateFirstVideo(0, 0) : V.a.warn("\u591a\u623f\u95f4\u4e13\u9898\u9875\u6ca1\u6709\u521d\u59cb\u5316H5\u64ad\u653e\u5668") }) : -1 === Je && CreateFirstVideo(0, 0), window.flashTwoLoad = function flashTwoLoad() { (Ye = function getFlashOBJECT(e) { return -1 !== navigator.appName.indexOf("Microsoft") ? window[e] : document[e] }("room-flash-player")) && Ye.loadTwo && Ye.loadTwo(), window.playerJSok = !0 }; var $e = document.getElementsByClassName("layout-Player-videoMain")[0]; $e && ($e.addEventListener("mousemove", function () { window.$Player && !window.$Player.useh5 && Object(h.a)(te.m, {}) }), $e.addEventListener("mouseleave", function () { window.$Player && !window.$Player.useh5 && Object(h.a)(te.l, {}) })) }, "1cce9": function (e, t) { e.exports = "https://shark2.douyucdn.cn/front-publish/live-master/assets/wasm/7e23150678a0f1673e1faccf44a06635_a18a4d3.wasm" }, "26d59": function (e, t, r) { e.exports = r("9b638")("26d59") }, "300f3": function (e, t, r) { e.exports = { bg: "_1mkeE5FoAGEpF_lL5zlZRC", yzBg: "_2D8rsQEl1J7W6Ud_6l0VGe" } }, "366c1": function (e, t, r) { "use strict"; r.r(t), r.d(t, "get$ROOM", function () { return get$ROOM }), r.d(t, "notifyLoadjs", function () { return notifyLoadjs }), r.d(t, "checkH5", function () { return checkH5 }), r.d(t, "getIsDebug", function () { return getIsDebug }), r.d(t, "isNextDay", function () { return isNextDay }), r.d(t, "getDid", function () { return getDid }), r.d(t, "getPageData", function () { return getPageData }), r.d(t, "callLater", function () { return callLater }), r.d(t, "bindAll", function () { return bindAll }), r.d(t, "runGlobalJs", function () { return runGlobalJs }), r.d(t, "chooseP2P", function () { return chooseP2P }), r.d(t, "switchToFlash", function () { return switchToFlash }), r.d(t, "isSupermanager", function () { return isSupermanager }), r.d(t, "getIsHostlive", function () { return getIsHostlive }), r.d(t, "delayStreamWhilte", function () { return delayStreamWhilte }), r.d(t, "useRawPlay", function () { return useRawPlay }), r.d(t, "isVRPlayer", function () { return isVRPlayer }), r.d(t, "setH265BackLocastorege", function () { return setH265BackLocastorege }), r.d(t, "roomIsOpenH265", function () { return roomIsOpenH265 }), r.d(t, "setSupportAccelerator", function () { return setSupportAccelerator }), r.d(t, "isSupportAccelerator", function () { return isSupportAccelerator }), r.d(t, "checkIsSupporH265", function () { return checkIsSupporH265 }), r.d(t, "getisTickect", function () { return getisTickect }), r.d(t, "setisTickect", function () { return setisTickect }), r.d(t, "streamHandle", function () { return streamHandle }), r.d(t, "showVideo", function () { return showVideo }), r.d(t, "openFirst", function () { return openFirst }), r.d(t, "getFlashvars", function () { return getFlashvars }), r.d(t, "setEmbedmentShowTime", function () { return setEmbedmentShowTime }), r.d(t, "setauthenticationTime", function () { return setauthenticationTime }), r.d(t, "sendPairFrameStatePoint", function () { return sendPairFrameStatePoint }), r.d(t, "setEmbedmentPlayer", function () { return setEmbedmentPlayer }), r.d(t, "setAuthenticationPlayer", function () { return setAuthenticationPlayer }), r.d(t, "setInPairFrameState", function () { return setInPairFrameState }), r.d(t, "getInPairFrameState", function () { return getInPairFrameState }), r.d(t, "videoPairFrame", function () { return videoPairFrame }), r.d(t, "starVideoPairFrame", function () { return starVideoPairFrame }), r.d(t, "closeVideoPairFrame", function () { return closeVideoPairFrame }), r.d(t, "authenticationPlayerComplate", function () { return authenticationPlayerComplate }), r.d(t, "getembedmentPlayerOK", function () { return getembedmentPlayerOK }), r.d(t, "getauthenticationPlayerOk", function () { return getauthenticationPlayerOk }), r.d(t, "prfLoad", function () { return prfLoad }), r.d(t, "getbrowsType", function () { return getbrowsType }), r.d(t, "setvipBack", function () { return setvipBack }), r.d(t, "isVip", function () { return isVip }), r.d(t, "getuid", function () { return getuid }), r.d(t, "setIsPlayAudio", function () { return setIsPlayAudio }), r.d(t, "getIsPlayAudio", function () { return getIsPlayAudio }), r.d(t, "setIsInHide", function () { return setIsInHide }), r.d(t, "getIsInHide", function () { return getIsInHide }), r.d(t, "setISinping", function () { return setISinping }), r.d(t, "getISinping", function () { return getISinping }), r.d(t, "isSuperHideGetAudio", function () { return isSuperHideGetAudio }), r.d(t, "setrequstTime", function () { return setrequstTime }), r.d(t, "getrequstTime", function () { return getrequstTime }); var n = r("e55c4"), i = r("82e48"), a = r("5e757"), o = r("4f033"), s = r("d30de"), u = r("3b42b"), d = r("51bc5"), c = r("5675a"), l = r("d1a6f"), p = r("0fa6e"); function get$ROOM() { return n.DataCenter.global.get("$ROOM") || {} } var f = !1; function notifyLoadjs() { window.player_video_ready && !f && (f = !0, window.player_video_ready.next()) } function checkH5() { var e = location.search; if (-1 !== e.search("[?&]useflash(&|$)")) return !1; var t = -1 !== e.search("[?&]useh5(&|$)"); return (1 === get$ROOM().defaulth5 || t) && function checkBrowser() { if (!window.vdwdae325w_64we) return !1; var e = navigator.userAgent, t = e.toLowerCase().match(/version\/([\d{2}]+).*safari/); if (t) { var r = parseInt(t[1], 10); if (!Number.isNaN(r) && r >= 11) return !0 } if (t = e.match(/Chrome\/(\d{2})/)) { var n = parseInt(t[1], 10); if (!Number.isNaN(n) && n >= 43) return !0 } if (t = e.match(/Firefox\/(\d{2})/)) { var i = parseInt(t[1], 10); if (!Number.isNaN(i) && i >= 43) return !0 } return !1 }() } function getIsDebug() { return window.location.href.indexOf("shark_debug=2") > 0 || window.location.href.indexOf("dydg") > 0 } function isNextDay(e, t, r) { var n = new Date(t); return e < new Date(n.getFullYear(), n.getMonth(), n.getHours() >= r ? n.getDate() : n.getDate() - 1, r).getTime() } function getDid() { return "" } function getPageData(e) { return n.DataCenter.global.get(e) } function callLater(e) { setTimeout(e, 0) } function bindAll(e, t) { void 0 === t && (t = Object.getPrototypeOf(e)), Object.getOwnPropertyNames(t).forEach(function (t) { var r = e[t]; "function" === typeof r && (e[t] = r.bind(e)) }) } function runGlobalJs(e) { var t = e.content, r = e.url; return new Promise(function (e, n) { var i = document.head || document.body, a = document.createElement("script"), o = function finish() { return i.removeChild(a) }; t ? a.text = t : (a.src = r, a.async = !0), a.onload = function () { o(), e() }, a.onerror = function () { o(), n(new Error("load " + r + " failed.")) }, i.appendChild(a) }) } function chooseP2P(e, t) { return Promise.resolve().then(function () { if (t) return ""; var r = Object(o.j)(["app", "isHostlive"]), n = Object(o.j)(["app", "isLogin"]), i = Object(o.j)(["app", "isPhone"]), a = Object(o.j)(["ticket", "isTicketNeed"]), u = ""; return e > 0 && (1 === +e ? u = s.g.XY : 2 === +e ? u = s.g.QQ : 3 === +e ? u = s.g.WS : 9 !== +e && 10 !== +e || (u = s.g.DOUYU)), r ? "" : e ? n && i && a ? "" : u : "" }) } function switchToFlash() { window.__player && window.__player.switchPlayer(!1) } function isSupermanager() { return 5 === +Object(u.d)("groupid") } function getIsHostlive() { var e = getPageData("$ROOM.owner_uid"), t = Object(u.d)("uid") || "0"; return !(!e || e !== Number(t)) } function delayStreamWhilte() { return !1 } function useRawPlay() { return !0 } var h = 0, _ = !1, m = !0; function isVRPlayer() { return _ } function setH265BackLocastorege() { var e = (new Date).valueOf(); i.c("H265BackTime", e) } function roomIsOpenH265() { return 431460 === +getPageData("$ROOM.room_id") } function setSupportAccelerator(e) { e ? localStorage.setItem("isSupportAccelerator", 1) : localStorage.setItem("isSupportAccelerator", 0) } function isSupportAccelerator() { return "1" === localStorage.getItem("isSupportAccelerator") } function checkIsSupporH265(e) { if (Object(o.j)(["videoModule", "player", "accOpen"])) { void 0 === e && (e = Object(o.j)(["app", "cdn"])); var t = Object(o.j)(["app", "roomInfo", "cdnsWithName"]) || [], r = Object(o.j)(["videoModule", "player", "acceleratorRollback"]), n = Object(o.j)(["videoModule", "player", "useH265"]), a = t.find(function (t) { return t.cdn === e }), s = a && a.isH265; return !(!n || r || !s) } return !!((new Date).valueOf() - i.b("H265BackTime", 0) > 864e5 && p.LivePlayer.isH265Supported && p.LivePlayer.isH265Supported() && roomIsOpenH265()) } var y = !1; function getisTickect() { return y } function setisTickect(e) { y = e } function streamHandle(e, t, r, n, s, u) { try { e && 1 === +e.smt ? (m && (Object(o.a)(c.k), m = !1), _ = !0) : _ = !1, u || Object(o.b)({ id: "loading", action: "showLoading", data: [!0] }); for (var l = e.multirates, p = 0; p < l.length; p++)l[p].type = l[p].rate; var f = l.find(function (e) { return e.type === t }), h = f ? f.name : "", y = l && l.length > 1 ? 1 : 0, v = y, g = e.cdnsWithName; Object(a.b)().app.pageRateSwitch = v, Object(o.b)({ id: "app", action: "changePageRateSwitch", data: [v] }); var b = void 0, w = !1; void 0 !== e.eticket && null != e.eticket ? (b = e.eticket, w = !0, setisTickect(!0)) : setisTickect(!1); var E = "", T = checkIsSupporH265(e.rtmp_cdn) && e.player_1 ? 1 : 0; chooseP2P(T ? e.h265_p2p : e.p2p, r).then(function (e) { E = e }).then(function () { Object(o.b)({ id: "ticket", action: "initeticketData", data: [b] }); var r = { src: null, p2p: E, ish265: T, streamName: h, streamStatus: e.streamStatus, isPreload: n, p2pValue: e.p2p, p2pCids: T ? e.h265_p2p_cids : e.p2pCids, p2pMeta: e.p2pMeta }; Object(o.b)({ id: "videoModule", action: "refeshplayerP2pData", data: [r] }); var u = { cdnsWithName: g, is_pass_player: e.isPassPlayer }; i.c("realRateModel", e.rate); var d = { multirates: l, rateSwitch: y, rate: e.rate }; Object(a.e)(u, d), w ? Object(o.b)({ id: "LoadVideoNet", action: "loadTicketStream", data: [s, t, b] }) : Object(o.b)({ id: "LoadVideoNet", action: "streamDataHandle", data: [e] }) }) } catch (e) { d.a.warn(e + "streamHandle err"), notifyLoadjs() } } function showVideo() { var e = 1 === +getPageData("$ROOM.show_status") || Object(a.b)().app.Status, t = Object(u.d)("groupid"), r = getPageData("$ROOM.owner_uid"), n = Object(u.d)("uid") || "0", i = !(!r || r !== Number(n)); return e || !e && (1 === +i || 5 === +t) } function openFirst() { return !0 } function getFlashvars() { var e = {}; return e.DomainName = window.location.host, e.cdn = function getUrlParam(e) { var t = e.replace(/[[]/, "\\[").replace(/[\]]/, "\\]"), r = new RegExp("[\\?&]" + t + "=([^&#]*)").exec(location.search); return null == r ? "" : decodeURIComponent(r[1].replace(/\+/g, " ")) }("cdn") || "", e.asset_url = getPageData("$SYS.res_url"), e.usergroupid = Object(u.d)("groupid") || "0", e.uid = +(Object(u.d)("uid") || 0), e.RoomId = getPageData("$ROOM.room_id"), e.RoomTitle = getPageData("$ROOM.room_name"), e.OwnerId = getPageData("$ROOM.owner_uid"), e.Status = 1 === +getPageData("$ROOM.show_status"), e.roompass = getPageData("$ROOM.room_pwd"), navigator.appVersion.indexOf("MSIE") > 0 ? e.barrage_delay_time = 400 : e.barrage_delay_time = 250, e.phonestatus = Object(u.d)("phonestatus") || 0, e.did = Object(u.d)("did"), e.avatar_url = getPageData("$SYS.avatar_url"), e.logUrl = getPageData("$SYS.fh2") || "", window.__player || (window.__player = {}, window.__player.getGlobal = getPageData), e } var v = -1; function setEmbedmentShowTime(e) { v = e } var g = -1; function setauthenticationTime(e) { g = e } var b = 1; function sendPairFrameStatePoint(e, t) { if (1 === b) { b = 2, d.a.log("show_frame_con" + e); var r = Object(o.j)(["videoModule", "player", "p2p"]), n = 0; g > v && -1 !== v && (n = g - v), Object(o.d)("show_frame_con", { result: e, errcode: t, Eurl: window.streamUrl, isp2p: r, codeVer: "2019112601", dTime: n }, "") } } var w = null, E = null, T = !1, S = !1; function setEmbedmentPlayer(e) { w = e, T = !0 } function setAuthenticationPlayer(e) { E = e, S = !0, T || (l.a.emit("videoPairFrame10Over", 1), d.a.log("\u9274\u6743\u64ad\u653e\u5668\u6bd4\u9884\u57cb\u6d41\u5148\u6765"), sendPairFrameStatePoint(0, 1)) } var P = null, A = null; function setInPairFrameState(e, t) { h = e, 2 === e ? sendPairFrameStatePoint(1, t) : 3 === e && sendPairFrameStatePoint(0, t) } function getInPairFrameState() { return h } var O = 50; function videoPairFrame() { var e = void 0, t = void 0; clearInterval(P), P = setInterval(function () { if (w && E) { setInPairFrameState(1); var r = w.T_ADV_Timestamp(), n = E.T_ADV_Timestamp(); if (!r || !n) return; var i = 1e3 * w._video.currentTime, a = r.keyframes; if (e = r.seiTimestamp - 1e3 * r.bufferLength, t = n.seiTimestamp - 1e3 * n.bufferLength, d.a.log("aaa- " + (e - t) + " buf:" + 1e3 * n.bufferLength), a) for (var o = 0; o < a.length; o++) { var s = 1e3 * a[o]; if (i > s - O && i < s + O) { d.a.log("\u5bfb\u627e\u5230\u5173\u952e\u5e27 \u5173\u952e\u5e27\u6570\u636e" + o + " \u662f\u64ad\u653e" + s + "\u79d2\u4e0e\u5f53\u524d\u64ad\u653e\u8bef\u5dee\u5728" + (s - i)); var u = e + s - i; if (u > t && n.seiTimestamp > u) return d.a.log("\u5173\u952e\u5e27\u5728\u7f13\u5b58\u533a\u57df \u5173\u952e\u5e27\u65f6\u95f4\u6413" + u), P && clearInterval(P), clearInterval(A), l.a.emit("videoPairFrameCan", { time: u }), void setInPairFrameState(2) } } } }, 30) } function starVideoPairFrame() { S ? l.a.emit("videoPairFrameOverErr", { type: 1 }) : (videoPairFrame(), A = setInterval(function () { clearInterval(P), clearInterval(A), l.a.emit("videoPairFrame10Over", getInPairFrameState()), 2 !== getInPairFrameState() && setInPairFrameState(3, 2) }, 1e4)) } function closeVideoPairFrame(e, t) { } function authenticationPlayerComplate() { clearInterval(P), clearInterval(A), setInPairFrameState(3, 3), Object(o.b)({ id: "videoModule", action: "setPlayerError", data: [3] }) } function getembedmentPlayerOK() { return T } function getauthenticationPlayerOk() { return S } var M = 1, k = !1; function prfLoad(e) { if (1 === M) { var t = 1; 1 === +getPageData("$ROOM.isVip") && (t = k ? 3 : 2), (getIsHostlive() || isSupermanager()) && (t = 1), e.gst = t, Object(o.a)(c.g, e), M = 2 } } function getbrowsType() { var e = {}, t = navigator.userAgent.toLowerCase(), r = void 0, n = void 0; return t.match(/msie ([\d.]+)/) ? (r = t.match(/msie ([\d.]+)/), e.ie = r[1]) : t.match(/firefox\/([\d.]+)/) ? (r = t.match(/firefox\/([\d.]+)/), e.firefox = r[1]) : t.match(/chrome\/([\d.]+)/) ? (r = t.match(/chrome\/([\d.]+)/), e.chrome = r[1]) : t.match(/opera.([\d.]+)/) ? (r = t.match(/opera.([\d.]+)/), e.opera = r[1]) : t.match(/version\/([\d.]+).*safari/) && (r = t.match(/version\/([\d.]+).*safari/), e.safari = r[1]), !e.ie && t.match(/trident/) && (e.ie = t.match(/rv:([\d].)/)[1]), t.match(/edge\/([(\d).]+)/) && (e.edge = t.match(/edge\/([(\d).]+)/)[1]), e.ie && (n = "IE: " + e.ie), e.edge && (n = "Edge: " + e.edge), e.firefox && (n = "Firefox: " + e.firefox), e.chrome && !document.getBoxObjectFor && (n = "Chrome: " + e.chrome), e.opera && (n = "Opera: " + e.opera), e.safari && (n = "Safari: " + e.safari), n } function setvipBack() { k = !0 } function isVip() { return !getIsHostlive() && (!isSupermanager() && (1 === +getPageData("$ROOM.isVip") && !k)) } function getuid() { return Object(u.d)("uid") || "0" } var D = !1; function setIsPlayAudio(e) { D = e } function getIsPlayAudio() { return D } var L = !1; function setIsInHide(e) { L = e } function getIsInHide() { return L } var x = !0; function setISinping(e) { x = e } function getISinping() { return x } function isSuperHideGetAudio() { var e = Object(o.j)(["app", "streamInfo", "isH265"]) ? 1 : 0, t = Object(o.j)(["app", "isHostlive"]), r = isSupermanager(), n = Object(o.j)(["app", "inVod"]), i = Object(o.j)(["app", "inpip"]), a = Object(o.j)(["app", "IspwdRoom"]), s = Object(o.j)(["app", "illegal"]); return !(e || t || r || n || s || a || y || i || getISinping()) } var I = 0; function setrequstTime(e) { I = e } function getrequstTime() { return I } }, "3b42b": function (e, t, r) { "use strict"; r.d(t, "b", function () { return acjMonitorData }), r.d(t, "g", function () { return pushAcj }), r.d(t, "e", function () { return getDid }), r.d(t, "d", function () { return getCookie }), r.d(t, "c", function () { return disposeAcj }), r.d(t, "f", function () { return getSYS }), r.d(t, "a", function () { return _ }); var n, i, a, o, s, u, d, c, l, p = r("e55c4"), f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" === typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }; function _initDefineProp(e, t, r, n) { r && Object.defineProperty(e, t, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(n) : void 0 }) } function _applyDecoratedDescriptor(e, t, r, n, i) { var a = {}; return Object.keys(n).forEach(function (e) { a[e] = n[e] }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, ("value" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(e, t, r) || r }, a), i && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(i) : void 0, a.initializer = void 0), void 0 === a.initializer && (Object.defineProperty(e, t, a), a = null), a } var h = function Service(e) { return function (t, r) { var n = "undefined" === typeof e ? "undefined" : f(e); return "object" === n ? t[r] = e : "Service" === Object.getPrototypeOf(e).name || -1 !== e.name.toLowerCase().indexOf("service") || e.prototype.type && -1 !== e.prototype.type.indexOf("service") ? (void 0 === e.instance && (e.instance = new e), t[r] = e.instance) : "function" === n && (t[r] = e()), t } }, _ = (n = h(p.DataCenter.acj), i = h(p.DataCenter.global), a = h(p.DataCenter.sessionStorage), o = h(p.DataCenter.cookie), s = function () { function RxACJ() { !function _classCallCheck(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, RxACJ), _initDefineProp(this, "acj", u, this), _initDefineProp(this, "global", d, this), _initDefineProp(this, "sessionStorage", c, this), _initDefineProp(this, "cookie", l, this) } return RxACJ.prototype.pushData = function pushData(e, t) { this.acj.push(e, t, 0) }, RxACJ.prototype.MonitorData = function MonitorData(e, t) { this.acj.get(e).subscribe(function () { var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; t(e) }) }, RxACJ.prototype.getDid = function getDid() { return this.cookie.get("did") || "10000000000000000000000000001501" }, RxACJ.prototype.setSessionStorage = function setSessionStorage(e, t) { this.sessionStorage.set(e, t) }, RxACJ.prototype.getCookie = function getCookie(e) { return this.cookie.get(e) || "" }, RxACJ.prototype.getSys = function getSys() { return this.global.get("$SYS") || "" }, RxACJ.prototype.getSessionStorage = function getSessionStorage(e) { return this.sessionStorage.get(e) }, RxACJ.prototype.setPlayerVersion = function setPlayerVersion(e) { this.global.set("PLAYER_VERSION", e) }, RxACJ }(), u = _applyDecoratedDescriptor(s.prototype, "acj", [n], { enumerable: !0, initializer: null }), d = _applyDecoratedDescriptor(s.prototype, "global", [i], { enumerable: !0, initializer: null }), c = _applyDecoratedDescriptor(s.prototype, "sessionStorage", [a], { enumerable: !0, initializer: null }), l = _applyDecoratedDescriptor(s.prototype, "cookie", [o], { enumerable: !0, initializer: null }), s), m = r("5675a"), y = r("4f033"), v = r("5e757"), g = r("366c1"), b = r("d1a6f"); function businessActionHandle(e, t, r) { if ("controller" === e) switch (t) { case "setShowHeight": (function setShowHeight(e) { Object(v.b)().controller.showHeight = e, Object(y.f)("videoBg") && Object(y.f)("videoBg").updateScale() }).apply(void 0, r) } else if ("xvideoModule" === e) switch (t) { case "setOpenWichVideo": (function setOpenWichVideo(e) { Object(v.b)().xvideoModule.xplayer.openWichVideo = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").refreshPlayer(), Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh() }).apply(void 0, r); break; case "openshowXc": (function openshowXc(e) { Object(v.b)().xvideoModule.xplayer.showXc = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh() }).apply(void 0, r); break; case "showmusicIconfun": (function showmusicIconfun(e) { Object(v.b)().xvideoModule.xplayer.showmusicicon = e }).apply(void 0, r) } else if ("ticket" === e) "userTickStream" === t && function userTickStream(e) { Object(v.b)().ticket.rtmp_url = e.rtmp_url, Object(v.b)().ticket.rtmp_live = e.rtmp_live }.apply(void 0, r); else if ("app" === e) switch (t) { case "playBigModel": (function playBigModel(e) { Object(v.b)().app.playbModel = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh() }).apply(void 0, r); break; case "initDelayRoomInfo": (function initDelayRoomInfo(e) { Object(v.b)().app.roomInfo.isVertical = e.roomInfo.isVertical, Object(v.b)().app.roomInfo.roomSrc = e.roomInfo.roomSrc, Object(y.f)("videoBg") && Object(y.f)("videoBg").updateURL() }).apply(void 0, r); break; case "setAutoPlay": (function setAutoPlay(e) { Object(v.b)().app.canAutoPlay = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").refreshPlayer() }).apply(void 0, r); break; case "setPagescreen": (function setPagescreen(e) { Object(v.b)().app.isWebFullscreen = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh() }).apply(void 0, r); break; case "setFullScreen": (function setFullScreen(e) { Object(v.b)().app.isFullscreen = e, Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh() }).apply(void 0, r); break; case "resize": (function resize(e, t) { Object(v.b)().app.width = e, Object(v.b)().app.height = t, Object(y.f)("videoModule") && Object(y.f)("videoModule").viewFresh(), Object(y.f)("videoBg") && Object(y.f)("videoBg").updateScale() }).apply(void 0, r); break; case "refeshStreamInfo": (function refeshStreamInfo(e) { Object(v.b)().app.streamInfo = e }).apply(void 0, r); break; case "refreshRidAndCdn": (function refreshRidAndCdn(e, t) { Object(v.b)().app.rid = e, Object(v.b)().app.cdn = t }).apply(void 0, r); break; case "refreshAppinfo": (function refreshAppinfo(e, t, r) { for (var n in e) Object(v.b)().app.roomInfo[n] = e[n]; Object(v.b)().app.rateSwitch = t.rateSwitch, Object(v.b)().app.rate = r.rate, Object(y.f)("videoBg") && Object(y.f)("videoBg").updateURL() }).apply(void 0, r); break; case "initRoomInfo": (function initRoomInfo(e, t, r) { for (var n in e) Object(v.b)().app.roomInfo[n] = e[n]; Object(v.b)().app.rateSwitch = t.rateSwitch, Object(v.b)().app.rate = r.rate, Object(y.f)("videoBg") && Object(y.f)("videoBg").updateURL() }).apply(void 0, r); break; case "changePageRateSwitch": (function changePageRateSwitch(e) { Object(v.b)().app.pageRateSwitch = e }).apply(void 0, r); break; case "changeRateSwitch": (function changeRateSwitch(e) { Object(v.b)().app.rateSwitch = e }).apply(void 0, r); break; case "manualLoadVideo": (function manualLoadVideo(e) { Object(v.b)().app.manualLoadVideo = e.manualLoadVideo }).apply(void 0, r); break; case "freshUip": (function freshUip(e) { Object(v.b)().app.uip = e }).apply(void 0, r); break; case "freshRate": (function freshRate(e) { Object(v.b)().app.rate = e }).apply(void 0, r); break; case "freshCdn": (function freshCdn(e) { Object(v.b)().app.cdn = e }).apply(void 0, r); break; case "closeRoom": !function closeRoom() { var e = getCookie("groupid"), t = Object(g.getPageData)("$ROOM.owner_uid"), r = getCookie("uid") || "0", n = 1 === +!(!t || t !== Number(r)) || 5 === +e; p.DataCenter.common.get("$DATA").subscribe(function (e) { var t = 0; e.room && e.room.cate1_id && (t = +e.room.cate1_id), 20 === +t ? !n && window.destroyFirstVideo && window.destroyFirstVideo(2) : (!n && window.destroyFirstVideo && window.destroyFirstVideo(1), Object(y.f)("videoBg") && Object(y.f)("videoBg").destroy()) }) }(); break; case "enterVod": (function enterVod(e) { Object(v.b)().app.inVod = e }).apply(void 0, r); break; case "checkIspwdRoom": (function checkIspwdRoom(e) { Object(v.b)().app.IspwdRoom = e }).apply(void 0, r); break; case "setInPIP": (function setInPIP(e) { Object(v.b)().app.inpip = e }).apply(void 0, r); break; case "changeIllegal": (function changeIllegal(e) { Object(v.b)().app.illegal = e }).apply(void 0, r); break; case "enterUseNoHandle": (function enterUseNoHandle(e) { Object(v.b)().app.isenterUseNoHandle = e }).apply(void 0, r) } else "tcp" === e && "updateLoginres" === t && function freshloginres(e) { Object(v.b)().tcp.loginres = e, e && b.a.emit("updateLoginres", { uid: e.userid || "0" }) }.apply(void 0, r) } var w = r("51bc5"), E = void 0; function callBack(e) { var t = e.action, r = e.id, n = e.data; Object(y.f)(r) ? Object(y.f)(r).actionHandle({ action: t, data: n }) : businessActionHandle(r, t, n) } function ReadcallBack() { w.a.warn("aaaaaaaa+\u6536\u5230\u7b2c\u4e8c\u68af\u961f\u4e1a\u52a1ok"), Object(y.h)() } var T = void 0; function acjMonitorData(e) { E || (E = new _), T || (E.MonitorData(m.o, callBack), E.MonitorData(m.e, ReadcallBack), T = !0), !0 === window.playerBusinessREADY && ReadcallBack(), E.setPlayerVersion(e) } function pushAcj(e, t) { E || (E = new _), E.pushData(e, t) } function getDid() { return E || (E = new _), E.getDid() } function getCookie(e) { return E || (E = new _), E.getCookie(e) } function getSYS() { return E || (E = new _), E.getSys() } function disposeAcj() { } }, 41571: function (e, t, r) { "use strict"; (function (t) { var n = r("c9415"), i = r("c7646"), a = { "Content-Type": "application/x-www-form-urlencoded" }; function setContentTypeIfUnset(e, t) { !n.isUndefined(e) && n.isUndefined(e["Content-Type"]) && (e["Content-Type"] = t) } var o = { adapter: function getDefaultAdapter() { var e; return "undefined" !== typeof XMLHttpRequest ? e = r("13c9f") : "undefined" !== typeof t && (e = r("13c9f")), e }(), transformRequest: [function transformRequest(e, t) { return i(t, "Content-Type"), n.isFormData(e) || n.isArrayBuffer(e) || n.isBuffer(e) || n.isStream(e) || n.isFile(e) || n.isBlob(e) ? e : n.isArrayBufferView(e) ? e.buffer : n.isURLSearchParams(e) ? (setContentTypeIfUnset(t, "application/x-www-form-urlencoded;charset=utf-8"), e.toString()) : n.isObject(e) ? (setContentTypeIfUnset(t, "application/json;charset=utf-8"), JSON.stringify(e)) : e }], transformResponse: [function transformResponse(e) { if ("string" === typeof e) try { e = JSON.parse(e) } catch (e) { } return e }], timeout: 0, xsrfCookieName: "XSRF-TOKEN", xsrfHeaderName: "X-XSRF-TOKEN", maxContentLength: -1, validateStatus: function validateStatus(e) { return e >= 200 && e < 300 }, headers: { common: { Accept: "application/json, text/plain, */*" } } }; n.forEach(["delete", "get", "head"], function forEachMethodNoData(e) { o.headers[e] = {} }), n.forEach(["post", "put", "patch"], function forEachMethodWithData(e) { o.headers[e] = n.merge(a) }), e.exports = o }).call(this, r("26d59")) }, 48936: function (e, t, r) { "use strict"; var n = r("c9415"); function InterceptorManager() { this.handlers = [] } InterceptorManager.prototype.use = function use(e, t) { return this.handlers.push({ fulfilled: e, rejected: t }), this.handlers.length - 1 }, InterceptorManager.prototype.eject = function eject(e) { this.handlers[e] && (this.handlers[e] = null) }, InterceptorManager.prototype.forEach = function forEach(e) { n.forEach(this.handlers, function forEachHandler(t) { null !== t && e(t) }) }, e.exports = InterceptorManager }, "4f033": function (e, t, r) { "use strict"; r.d(t, "i", function () { return setmodules }), r.d(t, "b", function () { return actionCall }), r.d(t, "d", function () { return addPerformanceLog }), r.d(t, "j", function () { return stateGetIn }), r.d(t, "f", function () { return getModule }), r.d(t, "h", function () { return pushList }), r.d(t, "c", function () { return addAssistantLog }), r.d(t, "a", function () { return acjCall }), r.d(t, "g", function () { return keeplivePoint }), r.d(t, "e", function () { return disposeDataManager }); var n = r("5e757"), i = r("3b42b"), a = r("5675a"), o = [], s = !1, u = [], d = [], c = [], l = [], p = []; function getModule(e) { for (var t = 0; t < o.length; t++) { var r = o[t]; if (r.id === e) return r } return null } function actionCall(e) { var t = e.id, r = e.action, n = e.data, o = getModule(t); o && o.actionHandle({ action: r, data: n }), "LoadVideoNet" !== t && (s ? Object(i.g)(a.r, { id: t, action: r, data: n }) : u.push({ id: t, action: r, data: n })) } function acjCall(e, t) { "room_mouse_move" === e || "room_mouse_leave" === e ? Object(i.g)(e, t) : s ? Object(i.g)(a.p, { type: e, data: t }) : l.push({ type: e, data: t }) } function pushList() { s = !0, Object(i.g)(a.s, u), Object(i.g)(a.w, d), Object(i.g)(a.t, c), Object(i.g)(a.q, l), Object(i.g)(a.y, p) } function setmodules(e) { o = e } function addPerformanceLog(e, t, r) { s ? Object(i.g)(a.v, { type: e, data: t, av: r }) : d.push({ type: e, data: t, av: r }) } function addAssistantLog(e, t, r) { s ? Object(i.g)(a.u, { modu: e, mid: t, det: r }) : c.push({ modu: e, mid: t, det: r }) } function keeplivePoint(e) { s ? Object(i.g)(a.x, e) : p.push(e) } function stateGetIn(e) { var t = e[0], r = getModule(t), i = 0; try { i = r ? r.getMoudleDate() : Object(n.b)()[t]; for (var a = 1; a < e.length; a++)i = i[e[a]] } catch (e) { i = 0 } return i } function disposeDataManager() { o = [], s = !1, u = [], d = [], c = [], l = [], p = [], Object(i.c)() } }, "51bc5": function (e, t, r) { "use strict"; r.d(t, "c", function () { return setEnable }), r.d(t, "b", function () { return makeLogger }); var n = !1; function setEnable(e) { n = e } function customize(e) { for (var t = arguments.length, r = Array(t > 1 ? t - 1 : 0), i = 1; i < t; i++)r[i - 1] = arguments[i]; var a = ["[html5 player]"].concat(r.map(function (e) { return "[" + e + "]" })); return function () { for (var t = arguments.length, r = Array(t), i = 0; i < t; i++)r[i] = arguments[i]; n && e.call.apply(e, [console].concat(a, r)) } } function makeLogger() { for (var e = arguments.length, t = Array(e), r = 0; r < e; r++)t[r] = arguments[r]; return { log: customize.apply(void 0, [console.log].concat(t)), debug: customize.apply(void 0, [console.debug].concat(t)), info: customize.apply(void 0, [console.info].concat(t)), warn: customize.apply(void 0, [console.warn].concat(t)), error: customize.apply(void 0, [console.error].concat(t)) } } t.a = makeLogger("first") }, "5675a": function (e, t, r) { "use strict"; r.d(t, "i", function () { return n }), r.d(t, "g", function () { return i }), r.d(t, "f", function () { return a }), r.d(t, "j", function () { return o }), r.d(t, "a", function () { return s }), r.d(t, "c", function () { return u }), r.d(t, "b", function () { return d }), r.d(t, "o", function () { return c }), r.d(t, "e", function () { return l }), r.d(t, "r", function () { return p }), r.d(t, "s", function () { return f }), r.d(t, "v", function () { return h }), r.d(t, "w", function () { return _ }), r.d(t, "p", function () { return m }), r.d(t, "q", function () { return y }), r.d(t, "t", function () { return v }), r.d(t, "u", function () { return g }), r.d(t, "x", function () { return b }), r.d(t, "y", function () { return w }), r.d(t, "h", function () { return E }), r.d(t, "d", function () { return T }), r.d(t, "n", function () { return S }), r.d(t, "k", function () { return P }), r.d(t, "m", function () { return A }), r.d(t, "l", function () { return O }); var n = "player_load_o", i = "room_video_catchtime", a = "room_data_idle", o = "room_bus_checksevertime", s = "ASSIST_BUFFER_EMPTY", u = "ASSIST_PLAY_ERROR", d = "ASSIST_PLAY_COMPLETE", c = "video_play_business", l = "business_to_video_ready", p = "js_to_business_action", f = "js_to_business_action_list", h = "js_to_business_point", _ = "js_to_business_point_list", m = "js_to_business_acj", y = "js_to_business_acj_list", v = "js_to_business_asstion_list", g = "js_to_business_asstion_point", b = "js_to_keeplive_point", w = "js_to_keeplive_point_list", E = "GET_SDK_SUS", T = "BEGIN_START_LOADER", S = "room_ticket_status", P = "room_bus_isVrRoom", A = "room_mouse_move", O = "room_mouse_leave" }, "5e757": function (e, t, r) { "use strict"; r.d(t, "c", function () { return initWebMRoomData }), r.d(t, "a", function () { return appRoomDateHandle }), r.d(t, "e", function () { return refreshAppinfo }), r.d(t, "d", function () { return refeshStreamInfo }), r.d(t, "b", function () { return getBaseData }), r.d(t, "f", function () { return refreshSize }); var n = r("d30de"), i = r("82e48"), a = r("3b42b"), o = { $ROOM: {} }, s = { app: { Status: !0, usergroupid: "", rid: 0, isLogin: !1, haveChangeMultirates: 1, definitionConfig: "", rate: i.b("realRateModel", "-1"), isYuanHua: !1, cdn: i.b(i.a.player_storage_cdn, ""), isYuanhua: !1, pageRateSwitch: 0, streamInfo: {}, roomInfo: {}, width: 1217, height: 726, isFullscreen: !1, isWebFullscreen: !1, rateSwitch: 0, ct: 0, uip: "", manualLoadVideo: !1, canAutoPlay: !0, playbModel: !0, isHostlive: !1, isPhone: !1, p2p: "" }, videoModule: { haveShowVideo: !1 }, tcp: { loginres: { userid: 0 } }, LoadVideoNet: { requestRoomInfoTimePoint: -1, requestStreamUrlTimePoint: 0, starPlayStreamTimePoint: 0, loadNum: 0 }, xvideoModule: { xplayer: { showXc: !1, showmusicicon: !1, openWichVideo: !1 } }, ticket: { isTicketNeed: !1, rtmp_url: void 0, rtmp_live: void 0 }, controller: { showHeight: n.e } }; function initBaseData() { var e = o.$ROOM.show_status, t = o.$ROOM.room_id, r = Object(a.d)("uid") || "0", u = o.$ROOM.owner_uid, d = o.$ROOM.eticket, c = o.$ROOM.is_video_high_quality_time, l = o.$ROOM.video_high_quality_resolution; if ("undefined" !== c && "undefined" !== l) { var p = [parseInt(l, 10), 0, parseInt(c, 10)]; s.ticket.definitionConfig = p ? escape(JSON.stringify(p)) : "" } !function resetBaseData() { s = { app: { Status: !0, usergroupid: "", rid: 0, isLogin: !1, haveChangeMultirates: 1, definitionConfig: "", rate: i.b("realRateModel", "-1"), isYuanHua: !1, cdn: i.b(i.a.player_storage_cdn, ""), isYuanhua: !1, pageRateSwitch: 0, streamInfo: {}, roomInfo: {}, width: 1217, height: 726, isFullscreen: !1, isWebFullscreen: !1, rateSwitch: 0, ct: 0, uip: "", manualLoadVideo: !1, canAutoPlay: !0, playbModel: !0, isHostlive: !1, isPhone: !1, p2p: "" }, videoModule: { haveShowVideo: !1 }, tcp: { loginres: { userid: 0 } }, LoadVideoNet: { requestRoomInfoTimePoint: -1, requestStreamUrlTimePoint: 0, starPlayStreamTimePoint: 0, loadNum: 0 }, xvideoModule: { xplayer: { showXc: !1, showmusicicon: !1, openWichVideo: !1 } }, ticket: { isTicketNeed: !1, rtmp_url: void 0, rtmp_live: void 0 }, controller: { showHeight: n.e } } }(), s.app.Status = 1 === +e, s.app.usergroupid = Object(a.d)("groupid") || "0", s.app.rid = t, s.app.isLogin = !!(r && parseFloat(r) > 0), s.app.isHostlive = !(!u || u !== Number(r)), s.app.isYuanhua = -1 !== ["673327", "429265"].indexOf(t), s.app.isPhone = 1 === (Object(a.d)("phonestatus") || 0), s.ticket.isTicketNeed = void 0 !== d && "" !== d && null !== d } function initWebMRoomData(e) { o.$ROOM.show_status = e.show_status, o.$ROOM.p2p_setting = e.p2p_setting, o.$ROOM.multirates = e.multirates, o.$ROOM.cate_id = e.cate_id, o.$ROOM.isVertical = e.isVertical, o.$ROOM.coverSrc = e.coverSrc, o.$ROOM.owner_avatar = e.owner_avatar, o.$ROOM.isDefaultAvatar = e.isDefaultAvatar, o.$ROOM.roomSrc = e.roomSrc, o.$ROOM.defaultSrc = e.defaultSrc, o.$ROOM.is_high_game = e.is_high_game, o.$ROOM.room_idle = e.room_idle, o.$ROOM.show_status = e.show_status, o.$ROOM.room_id = e.room_id, o.$ROOM.owner_uid = e.owner_uid, o.$ROOM.eticket = e.eticket, o.$ROOM.is_video_high_quality_time = e.is_video_high_quality_time, o.$ROOM.video_high_quality_resolution = e.video_high_quality_resolution, initBaseData() } function refeshStreamInfo(e) { for (var t in e) s.app.streamInfo[t] = e[t] } function refreshAppinfo(e, t) { for (var r in e) s.app.roomInfo[r] = e[r]; s.app.multirates = t.multirates, s.app.rateSwitch = t.rateSwitch, s.app.rate = t.rate } function appRoomDateHandle(e, t) { for (var r in e) s.app.roomInfo[r] = e[r]; s.app.rateSwitch = t.rateSwitch, s.app.rate = t.rate } function refreshSize(e) { var t = e.width, r = e.height; t && (s.app.width = t), r && (s.app.height = r) } function getBaseData() { return s } }, "63e3f": function (e, t, r) { "use strict"; e.exports = function bind(e, t) { return function wrap() { for (var r = new Array(arguments.length), n = 0; n < r.length; n++)r[n] = arguments[n]; return e.apply(t, r) } } }, "68e4d": function (e, t, r) { "use strict"; e.exports = function combineURLs(e, t) { return t ? e.replace(/\/+$/, "") + "/" + t.replace(/^\/+/, "") : e } }, "6d420": function (e, t, r) { "use strict"; var n = r("c9415"); e.exports = n.isStandardBrowserEnv() ? function standardBrowserEnv() { var e, t = /(msie|trident)/i.test(navigator.userAgent), r = document.createElement("a"); function resolveURL(e) { var n = e; return t && (r.setAttribute("href", n), n = r.href), r.setAttribute("href", n), { href: r.href, protocol: r.protocol ? r.protocol.replace(/:$/, "") : "", host: r.host, search: r.search ? r.search.replace(/^\?/, "") : "", hash: r.hash ? r.hash.replace(/^#/, "") : "", hostname: r.hostname, port: r.port, pathname: "/" === r.pathname.charAt(0) ? r.pathname : "/" + r.pathname } } return e = resolveURL(window.location.href), function isURLSameOrigin(t) { var r = n.isString(t) ? resolveURL(t) : t; return r.protocol === e.protocol && r.host === e.host } }() : function isURLSameOrigin() { return !0 } }, "6da80": function (e, t, r) { "use strict"; e.exports = function spread(e) { return function wrap(t) { return e.apply(null, t) } } }, "7436c": function (e, t) { e.exports = function isBuffer(e) { return null != e && null != e.constructor && "function" === typeof e.constructor.isBuffer && e.constructor.isBuffer(e) } }, "82e48": function (e, t, r) { "use strict"; r.d(t, "b", function () { return get }), r.d(t, "c", function () { return set }), r.d(t, "a", function () { return s }); var n = r("e55c4"), i = r("51bc5"); function uniqueKey(e) { return e + "_h5p_room" } var a = function getLocalStorage(e) { return n.DataCenter.localStorage.get(e) }, o = function setLocalStorage(e, t, r) { return n.DataCenter.localStorage.set(e, t, r) }; function get(e, t) { var r = a(uniqueKey(e)); return void 0 === r || null === r ? t : r } function set(e, t) { try { o(uniqueKey(e), t) } catch (t) { i.a.warn("set localStorage:" + e + " error.") } } var s = { player_storage_volume: "player_storage_volume", player_storage_cdn: "player_storage_cdn", GaoRateTimestamp: "GaoRateTimestamp", RateRecordTime: "rateRecordTime" } }, 92545: function (e, t, r) { "use strict"; function Cancel(e) { this.message = e } Cancel.prototype.toString = function toString() { return "Cancel" + (this.message ? ": " + this.message : "") }, Cancel.prototype.__CANCEL__ = !0, e.exports = Cancel }, "949dc": function (e, t, r) { e.exports = r("11489") }, "9511e": function (e, t, r) { "use strict"; var n = r("92545"); function CancelToken(e) { if ("function" !== typeof e) throw new TypeError("executor must be a function."); var t; this.promise = new Promise(function promiseExecutor(e) { t = e }); var r = this; e(function cancel(e) { r.reason || (r.reason = new n(e), t(r.reason)) }) } CancelToken.prototype.throwIfRequested = function throwIfRequested() { if (this.reason) throw this.reason }, CancelToken.source = function source() { var e; return { token: new CancelToken(function executor(t) { e = t }), cancel: e } }, e.exports = CancelToken }, "9992b": function (e, t, r) { "use strict"; var n = r("c9415"), i = ["age", "authorization", "content-length", "content-type", "etag", "expires", "from", "host", "if-modified-since", "if-unmodified-since", "last-modified", "location", "max-forwards", "proxy-authorization", "referer", "retry-after", "user-agent"]; e.exports = function parseHeaders(e) { var t, r, a, o = {}; return e ? (n.forEach(e.split("\n"), function parser(e) { if (a = e.indexOf(":"), t = n.trim(e.substr(0, a)).toLowerCase(), r = n.trim(e.substr(a + 1)), t) { if (o[t] && i.indexOf(t) >= 0) return; o[t] = "set-cookie" === t ? (o[t] ? o[t] : []).concat([r]) : o[t] ? o[t] + ", " + r : r } }), o) : o } }, "9b5d6": function (e, t, r) { "use strict"; var n = r("41571"), i = r("c9415"), a = r("48936"), o = r("097de"); function Axios(e) { this.defaults = e, this.interceptors = { request: new a, response: new a } } Axios.prototype.request = function request(e) { "string" === typeof e && (e = i.merge({ url: arguments[0] }, arguments[1])), (e = i.merge(n, { method: "get" }, this.defaults, e)).method = e.method.toLowerCase(); var t = [o, void 0], r = Promise.resolve(e); for (this.interceptors.request.forEach(function unshiftRequestInterceptors(e) { t.unshift(e.fulfilled, e.rejected) }), this.interceptors.response.forEach(function pushResponseInterceptors(e) { t.push(e.fulfilled, e.rejected) }); t.length;)r = r.then(t.shift(), t.shift()); return r }, i.forEach(["delete", "get", "head", "options"], function forEachMethodNoData(e) { Axios.prototype[e] = function (t, r) { return this.request(i.merge(r || {}, { method: e, url: t })) } }), i.forEach(["post", "put", "patch"], function forEachMethodWithData(e) { Axios.prototype[e] = function (t, r, n) { return this.request(i.merge(n || {}, { method: e, url: t, data: r })) } }), e.exports = Axios }, "9b638": function (e, t) { e.exports = playerSDK2da5b1f3a3deccaa435b }, "9ebb9": function (e, t, r) { "use strict"; var n = r("c9415"); function encode(e) { return encodeURIComponent(e).replace(/%40/gi, "@").replace(/%3A/gi, ":").replace(/%24/g, "$").replace(/%2C/gi, ",").replace(/%20/g, "+").replace(/%5B/gi, "[").replace(/%5D/gi, "]") } e.exports = function buildURL(e, t, r) { if (!t) return e; var i; if (r) i = r(t); else if (n.isURLSearchParams(t)) i = t.toString(); else { var a = []; n.forEach(t, function serialize(e, t) { null !== e && "undefined" !== typeof e && (n.isArray(e) ? t += "[]" : e = [e], n.forEach(e, function parseValue(e) { n.isDate(e) ? e = e.toISOString() : n.isObject(e) && (e = JSON.stringify(e)), a.push(encode(t) + "=" + encode(e)) })) }), i = a.join("&") } return i && (e += (-1 === e.indexOf("?") ? "?" : "&") + i), e } }, "9faa2": function (e, t, r) { "use strict"; e.exports = function isAbsoluteURL(e) { return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e) } }, "9ffc5": function (e, t, r) { "use strict"; e.exports = function enhanceError(e, t, r, n, i) { return e.config = t, r && (e.code = r), e.request = n, e.response = i, e } }, a63b0: function (e, t, r) { e.exports = r("9b638")("a63b0") }, a9aad: function (e, t, r) { e.exports = { videoContainer: "_3ZYUK0Gs39NKdRXHu7ok_k", video: "_2HUt2doZ86wOVgnO3O641n", screenshot: "jQtGHdq7S8qaVOaYlmyW5", mask1: "_1DuJNXB5Do4tFJDnNBIwl1", autoPlayImg: "LHL5lhn1jBO4lxwZJZ9ji", jumpdetail: "_20JhvNfhXCfurtEh1iGaxV" } }, b76a7: function (e, t, r) { "use strict"; var n = r("c9415"); e.exports = n.isStandardBrowserEnv() ? function standardBrowserEnv() { return { write: function write(e, t, r, i, a, o) { var s = []; s.push(e + "=" + encodeURIComponent(t)), n.isNumber(r) && s.push("expires=" + new Date(r).toGMTString()), n.isString(i) && s.push("path=" + i), n.isString(a) && s.push("domain=" + a), !0 === o && s.push("secure"), document.cookie = s.join("; ") }, read: function read(e) { var t = document.cookie.match(new RegExp("(^|;\\s*)(" + e + ")=([^;]*)")); return t ? decodeURIComponent(t[3]) : null }, remove: function remove(e) { this.write(e, "", Date.now() - 864e5) } } }() : { write: function write() { }, read: function read() { return null }, remove: function remove() { } } }, c7646: function (e, t, r) { "use strict"; var n = r("c9415"); e.exports = function normalizeHeaderName(e, t) { n.forEach(e, function processHeader(r, n) { n !== t && n.toUpperCase() === t.toUpperCase() && (e[t] = r, delete e[n]) }) } }, c9415: function (e, t, r) { "use strict"; var n = r("63e3f"), i = r("7436c"), a = Object.prototype.toString; function isArray(e) { return "[object Array]" === a.call(e) } function isObject(e) { return null !== e && "object" === typeof e } function isFunction(e) { return "[object Function]" === a.call(e) } function forEach(e, t) { if (null !== e && "undefined" !== typeof e) if ("object" !== typeof e && (e = [e]), isArray(e)) for (var r = 0, n = e.length; r < n; r++)t.call(null, e[r], r, e); else for (var i in e) Object.prototype.hasOwnProperty.call(e, i) && t.call(null, e[i], i, e) } e.exports = { isArray: isArray, isArrayBuffer: function isArrayBuffer(e) { return "[object ArrayBuffer]" === a.call(e) }, isBuffer: i, isFormData: function isFormData(e) { return "undefined" !== typeof FormData && e instanceof FormData }, isArrayBufferView: function isArrayBufferView(e) { return "undefined" !== typeof ArrayBuffer && ArrayBuffer.isView ? ArrayBuffer.isView(e) : e && e.buffer && e.buffer instanceof ArrayBuffer }, isString: function isString(e) { return "string" === typeof e }, isNumber: function isNumber(e) { return "number" === typeof e }, isObject: isObject, isUndefined: function isUndefined(e) { return "undefined" === typeof e }, isDate: function isDate(e) { return "[object Date]" === a.call(e) }, isFile: function isFile(e) { return "[object File]" === a.call(e) }, isBlob: function isBlob(e) { return "[object Blob]" === a.call(e) }, isFunction: isFunction, isStream: function isStream(e) { return isObject(e) && isFunction(e.pipe) }, isURLSearchParams: function isURLSearchParams(e) { return "undefined" !== typeof URLSearchParams && e instanceof URLSearchParams }, isStandardBrowserEnv: function isStandardBrowserEnv() { return ("undefined" === typeof navigator || "ReactNative" !== navigator.product) && "undefined" !== typeof window && "undefined" !== typeof document }, forEach: forEach, merge: function merge() { var e = {}; function assignValue(t, r) { "object" === typeof e[r] && "object" === typeof t ? e[r] = merge(e[r], t) : e[r] = t } for (var t = 0, r = arguments.length; t < r; t++)forEach(arguments[t], assignValue); return e }, extend: function extend(e, t, r) { return forEach(t, function assignValue(t, i) { e[i] = r && "function" === typeof t ? n(t, r) : t }), e }, trim: function trim(e) { return e.replace(/^\s*/, "").replace(/\s*$/, "") } } }, d1a6f: function (e, t, r) { "use strict"; r.d(t, "a", function () { return a }); var n = r("51bc5"), i = {}, a = { on: function on(e, t) { var r = (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {}).once; e && (i[e] || (i[e] = []), i[e].push({ listener: t, once: r })) }, off: function off(e, t) { i[e] && (i[e] = i[e].filter(function (e) { return e.listener !== t })) }, once: function once(e, t) { this.on(e, t, { once: !0 }) }, emit: function emit(e) { for (var t = this, r = arguments.length, a = Array(r > 1 ? r - 1 : 0), o = 1; o < r; o++)a[o - 1] = arguments[o]; i[e] && i[e].every(function (r) { if (r.listener) try { var i = r.listener.apply(null, a); return r.once && t.off(e, r.listener), !i } catch (t) { n.a.warn("Event emit error", e, t) } return !0 }) }, clear: function clear() { i = {} } } }, d3043: function (e, t, r) { "use strict"; var n = r("9ffc5"); e.exports = function createError(e, t, r, i, a) { var o = new Error(e); return n(o, t, r, i, a) } }, d30de: function (e, t, r) { "use strict"; r.d(t, "j", function () { return n }), r.d(t, "i", function () { return i }), r.d(t, "h", function () { return a }), r.d(t, "k", function () { return o }), r.d(t, "d", function () { return s }), r.d(t, "e", function () { return u }), r.d(t, "a", function () { return d }), r.d(t, "b", function () { return c }), r.d(t, "c", function () { return l }), r.d(t, "g", function () { return p }), r.d(t, "f", function () { return f }); var n = 221040105, i = "2", a = "Douyu_" + n, o = "__video2", s = "__canvas2", u = 0, d = "/lapi/live/getH5Play", c = "/gapi/live/web/super/stream", l = "/gapi/live/ticket/getH5Play", p = { QQ: "tct-h5", WS: "ws-h5", XY: "xy-h5", DOUYU: "dyp2p" }, f = "errlog_encrypt_error" }, db265: function (e, t) { e.exports = "https://shark2.douyucdn.cn/front-publish/live-master/assets/wasm/777ffd0edc470e85cc606d45b8d634e0_3ed08ab.wasm" }, e55c4: function (e, t, r) { e.exports = r("9b638")("e55c4") }, f8ab5: function (e, t, r) { e.exports = { videoContainer: "_1GyzL9trVIbYlAVmuA9KJ1", video: "_3kBBGV3-d-EIxmN6JRZPar", screenshot: "_1Osm4fzGmcuRK9M8IVy3u6" } } });
//# sourceMappingURL=http://sourcemap.douyucdn.cn:4567/room/online/sourcemaps/h5_video_747bee5.js.map